var Ae=Object.defineProperty;var Oe=(s,e,n)=>e in s?Ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var S=(s,e,n)=>Oe(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as A,u as w,a as y,M as Te,b as _e,r as c,d as U,F as Z,e as ve,f as Qe,g as ee,P as Re,h as ke,A as Be,$ as Ee,s as Fe,O as Le,C as R,i as Me,S as $e,k as se,l as q,m as Pe,p as D,n as H,R as Ue,o as De,q as k,T as He,t as We,v as ze,w as Je,x as qe}from"./vendor-DLRcHq6p.js";const I=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ke=()=>{let s=localStorage.getItem("theme");return s||(s="dark",te(s)),s},te=s=>{localStorage.setItem("theme",s)},Ge={theme:Ke()},ne=A({name:"theme",initialState:Ge,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",te(s.theme)}}}),Ve=ne.reducer,{switchTheme:Xe}=ne.actions,re=()=>{const s=w(n=>n.theme.theme),e=y();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Xe()),children:s=="light"?t.jsx(Te,{size:"24px",style:{background:"#00000000"}}):t.jsx(_e,{size:"24px",style:{background:"#00000000"}})})},Ye={sidebarOpen:!1},oe=A({name:"sidebarOpen",initialState:Ye,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),Ze=oe.reducer,{toggleSidebar:ae,setIsSidebarOpen:es}=oe.actions,zs=()=>{const s=w(f=>f.currSubject.subject),[e,n]=c.useState(!1),r=w(f=>f.sidebarOpen.sidebarOpen),o=U("screen and (max-width: 768px)"),d=y();return c.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[r]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>d(ae()),disabled:e,children:t.jsx(Z,{className:`BtnHamburgerIcon ${r?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!o&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx(ve,{color:"var(--secondary-text-color)"})}),t.jsx(I,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(I,{children:t.jsx(re,{})})]})};class ie{constructor(e){S(this,"id");S(this,"name");S(this,"subject_id");S(this,"_questions");S(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const ss=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),ts=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),ns=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let F=null;const rs=async()=>(F||(F=await Qe.createDbWorker([{from:"inline",config:{serverMode:"full",url:ns,requestChunkSize:4096}}],ss.toString(),ts.toString())),F),O=async s=>{const n=await(await rs()).db.query(s);return JSON.stringify(n)},os=async s=>{try{const e=await O(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ie(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},as=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await os(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},L=ee("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await as();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),is={course:null,loading:!1,error:null},ce=A({name:"currCourse",initialState:is,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(L.pending,e=>{e.loading=!0,e.error=null}).addCase(L.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase(L.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),cs=ce.reducer,{setCurrCourse:le}=ce.actions,ls=({children:s,...e})=>{const[n,r]=c.useState(!1),o=y(),d=U("screen and (max-width: 768px)");c.useEffect(()=>{e.currCourse?r(e.currCourse.id==e.course.id):r(!1)},[e.currCourse]);const f=()=>{o(le(e.course)),d&&o(es(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:f,children:[t.jsx(Re,{strokeWidth:"70px",className:"icon"})," ",s]})})};class us{constructor(e){S(this,"id");S(this,"name");S(this,"semester_id");Object.assign(this,e)}}const ds=async s=>{try{const e=await O(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new us(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},hs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await ds(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},M=ee("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await hs();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),fs={subject:null,loading:!1,error:null},ue=A({name:"currSubject",initialState:fs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(M.pending,e=>{e.loading=!0,e.error=null}).addCase(M.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase(M.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ms=ue.reducer,{setCurrSubject:ps}=ue.actions,ws=({subject:s})=>{const e=w(u=>u.currSubject.subject),n=w(u=>u.currCourse.course),[r,o]=c.useState(!1),[d,f]=c.useState(!1),[h,p]=c.useState([]),a=`SidebarGroupItem ${r?"selected":""} ${d?"expanded":""}`,l=y();c.useEffect(()=>{o((e==null?void 0:e.id)===s.id),f((e==null?void 0:e.id)===s.id)},[e]),c.useEffect(()=>{(async()=>{const i=await O(`select *
        from Course
        where subject_id = ${s.id}`),x=JSON.parse(i).map(C=>new ie(C));x&&p(x)})()},[]);const g=()=>{(e==null?void 0:e.id)!==s.id&&l(le(null)),l(ps(s)),f(u=>!u)};return t.jsxs("li",{className:a,children:[t.jsx("button",{onClick:g,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(ke,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(Be,{height:d?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:h.map((u,i)=>t.jsx(ls,{currCourse:n,course:u,children:u.name},i))})})]})},E=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Ee,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Js=()=>{const s=w(o=>o.sidebarOpen.sidebarOpen),[e,n]=c.useState([]),r=y();return c.useEffect(()=>{(async()=>{const d=await O("select * from Subject");n(JSON.parse(d))})()},[]),t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!e||e.length==0?t.jsx(E,{}):t.jsx("ul",{children:e.map((o,d)=>t.jsx(ws,{subject:o},d))}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>r(ae())})]})},gs={activeTest:!1},de=A({name:"activeTest",initialState:gs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),xs=de.reducer,{toggleActiveTest:he}=de.actions,bs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",js=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Cs=()=>localStorage.getItem("showQuestionByPageOption")==="true",Ss={shuffleAnswer:bs(),showAnswerOnChosen:js(),showQuestionByPage:Cs(),questionCount:"15"},fe=A({name:"testConfig",initialState:Ss,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Ns=fe.reducer,{toggleShuffleAnswer:ys,setQuestionCount:K,toggleShowAnswerOnChosen:Is,toggleShowQuestionByPage:As}=fe.actions,Os=Fe(Le)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),qs=()=>{var C,T,_,v;const s=w(b=>b.theme.theme),e=w(b=>b.sidebarOpen.sidebarOpen),n=w(b=>b.currSubject),r=w(b=>b.currCourse),{shuffleAnswer:o,showAnswerOnChosen:d,showQuestionByPage:f}=w(b=>b.testConfig),[h,p]=c.useState({semester:null,loading:!1}),[a,l]=c.useState([]),[g,u]=c.useState(""),i=y();c.useEffect(()=>{(()=>{if(!r.course)return;const m=[10,15,20,30,40,50,60,80,100,150],j=[],N=r.course.question_per_test;m.includes(N)||(m.push(N),m.sort()),m.forEach(Q=>{var J;!r.course||Q>=((J=r.course)==null?void 0:J.questions.length)||j.push(t.jsx(q,{value:Q,sx:{fontSize:14},children:Q},Q))}),j.push(t.jsx(q,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),l(j)})()},[r.course]),c.useEffect(()=>{const b=async()=>{var j;p({...h,loading:!0});const m=await O(`select *
        from Semester
        where id = ${(j=n.subject)==null?void 0:j.semester_id}`);p({semester:JSON.parse(m)[0],loading:!1})};n.subject&&b()},[n.subject]),c.useEffect(()=>{if(r.course){const b=r.course.question_per_test;u(b.toString()),i(K(b.toString()))}},[r.course]);const x=b=>{const m=b.target.value;u(m),i(K(m))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:h.loading||r.loading||n.loading?t.jsx(E,{}):n.subject&&r.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(C=r.course)==null?void 0:C.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(T=n.subject)==null?void 0:T.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(_=h.semester)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(v=r.course)==null?void 0:v.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:o,onClick:()=>i(ys()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>i(Is()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>i(As()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Me,{sx:{m:0,minWidth:120},size:"small",children:t.jsx($e,{value:g,onChange:x,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Os,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:a})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>i(he()),children:[t.jsx(se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},Ts={questions:[]},me=A({name:"testQuestion",initialState:Ts,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),_s=me.reducer,{addTestQuestion:Ks,setTestQuestion:B}=me.actions,vs={answers:{}},pe=A({name:"userAnswer",initialState:vs,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Qs=pe.reducer,{addUserAnswer:we,removeUserAnswer:Rs,removeAllUserAnswerById:ks,resetUserAnwser:G}=pe.actions,V={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ge=A({name:"testResult",initialState:V,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>V}}),Bs=ge.reducer,{addCorrectAnswer:Es,addWrongAnswer:Fs,setIsTestFinished:X,setScore:Ls,resetTestResut:Y}=ge.actions,Ms=Pe({reducer:{theme:Ve,sidebarOpen:Ze,currSubject:ms,currCourse:cs,activeTest:xs,testQuestion:_s,userAnswer:Qs,testResult:Bs,testConfig:Ns},middleware:s=>s({serializableCheck:!1})}),Gs=()=>y();class W{constructor(e){S(this,"id");S(this,"_question_direction");S(this,"question_type");S(this,"_answer_option");S(this,"_correct_answer");S(this,"cdr");S(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const z={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},xe=c.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:r,setSelectedValue:o})=>{const[d,f]=c.useState(""),h=w(i=>i.testResult.isTestFininshed),p=w(i=>i.userAnswer.answers[e.id]),a=w(i=>i.testConfig.showAnswerOnChosen),l=y(),g=c.useMemo(()=>{const i=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return H(i,z)},[s.value]);c.useEffect(()=>{if(!h)return;const i=Number.parseInt(s.id);if(!p||p.length==0){e.correct_answer.includes(i)&&f(" unanswer");return}p&&p.includes(i)&&(e.correct_answer.includes(i)||f(" incorrect")),e.correct_answer.includes(i)&&f(" correct")},[h]),c.useEffect(()=>{if(!a||(f(""),!p||p.length==0))return;const i=Number.parseInt(s.id);p&&p.includes(i)&&(e.correct_answer.includes(i)||f(" incorrect")),e.correct_answer.includes(i)&&f(" correct")},[a,p]);const u=i=>{h||(o(i.target.value),l(ks(e.id)),l(we({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(Ue,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:u,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});xe.displayName="RadioAnswerOption";const $s=({number:s,id:e,directionText:n,haveAnswer:r})=>{const o=c.useMemo(()=>{const d=D.sanitize(n,{USE_PROFILES:{html:!0}});return H(d,z)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!r&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:o})]})},be=c.memo($s),je=c.forwardRef(({question:s,number:e,...n},r)=>{const[o,d]=c.useState("0"),f=c.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.answer_option.length),[s.correct_answer]),h=f?"RadioQuestion":"RadioQuestion noAnswer",p=l=>{const g=Math.min(Math.max(65,l+65),90);return String.fromCharCode(g)},a=c.useCallback((l,g)=>t.jsx(xe,{answerOption:l,question:s,answerOptionBullet:p(g),selectedValue:o,setSelectedValue:d},`${s.id}_${l.id}`),[o]);return t.jsxs("div",{className:h,...n,ref:r,children:[t.jsx(be,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});je.displayName="RadioQuestion";const Ce=c.memo(je),Se=c.memo(({answerOption:s,question:e,answerOptionBullet:n,index:r,selectedValue:o,setSelectedValue:d})=>{const[f,h]=c.useState(""),p=w(x=>x.testResult.isTestFininshed),a=w(x=>x.userAnswer.answers[e.id]),l=w(x=>x.testConfig.showAnswerOnChosen),g=y(),u=c.useMemo(()=>{const x=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return H(x,z)},[s.value]);c.useEffect(()=>{if(!p)return;const x=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(x)&&h(" unanswer");return}a&&a.includes(x)&&(e.correct_answer.includes(x)||h(" incorrect")),e.correct_answer.includes(x)&&h(" correct")},[p]),c.useEffect(()=>{if(!l||(h(""),!a||a.length==0))return;const x=Number.parseInt(s.id);a&&a.includes(x)&&(e.correct_answer.includes(x)||h(" incorrect")),e.correct_answer.includes(x)&&h(" correct")},[l,a]);const i=()=>{p||(o[r]?g(Rs({id:e.id,answer:s.id})):g(we({id:e.id,answer:s.id})),d(o.map((x,C)=>C==r?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(R,{name:`question_${e.id}_${r}`,checked:o[r],onChange:i,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:u})]})]})});Se.displayName="CheckboxAnswerOption";const Ne=c.forwardRef(({question:s,number:e,...n},r)=>{const[o,d]=c.useState([!1,!1,!1,!1]),f=c.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.correct_answer.length),[s.correct_answer]),h=f?"CheckboxQuestion":"CheckboxQuestion noAnswer",p=l=>{const g=Math.min(Math.max(65,l+65),90);return String.fromCharCode(g)},a=c.useCallback((l,g)=>t.jsx(Se,{answerOption:l,question:s,answerOptionBullet:p(g),index:g,selectedValue:o,setSelectedValue:d},`${s.id}_${l.id}`),[o]);return t.jsxs("div",{className:h,...n,ref:r,children:[t.jsx(be,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});Ne.displayName="CheckboxQuestion";const ye=c.memo(Ne),Ps=({children:s,setCurrentIndex:e,sectionRefs:n,rootSelector:r,offset:o})=>{const d=De({sectionRefs:n,rootSelector:r,offset:o});return c.useEffect(()=>{e(d.currentElementIndexInViewport+1)},[d]),s},Vs=({setCurrentQuestionNumber:s})=>{const e=w(u=>u.testQuestion.questions),n=w(u=>u.testResult.isTestFininshed),r=w(u=>u.currCourse.course),{shuffleAnswer:o,questionCount:d}=w(u=>u.testConfig),f=y(),h=c.useRef([]),[p,a]=c.useState(-60);c.useEffect(()=>{window.innerHeight!==0&&a(-60-window.innerHeight/4)},[window.innerHeight]),c.useEffect(()=>{h.current.length!==e.length&&(h.current=Array(e.length).fill(null).map((u,i)=>h.current[i]||c.createRef()))},[e]),c.useEffect(()=>{if(n)return;f(B([])),(async()=>{const i=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),x=JSON.parse(i).map(T=>new W(T)),C=g(x);l(C),f(B(C))})()},[n]);const l=u=>{u.forEach(i=>{o&&i.shuffleable&&(i.answer_option=k(i.answer_option))})},g=u=>{const i=k(u);return i.sort((x,C)=>x.cdr-C.cdr),d==="all"||Number.isNaN(Number.parseInt(d))?i:i.slice(0,Number.parseInt(d))};return!e||e.length==0||!h.current?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer",children:t.jsx(Ps,{sectionRefs:h.current,offset:p,setCurrentIndex:s,children:e.map((u,i)=>u.question_type==="radio"?t.jsx(Ce,{ref:h.current[i],question:u,id:`questionNumber_${i+1}`,number:i+1},u.id):t.jsx(ye,{ref:h.current[i],question:u,id:`questionNumber_${i+1}`,number:i+1},u.id))})})},Xs=({setHidePopup:s})=>{const e=w(a=>a.currSubject.subject),n=w(a=>a.testQuestion.questions),r=w(a=>a.testResult),o=y(),d=U("screen and (max-width: 768px)"),f=()=>{!r.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(o(he()),o(Y()),o(G()))},h=()=>{o(X(!1)),o(Y()),o(G())},p=()=>{const l=Ms.getState().userAnswer.answers;let g=0;n.forEach(u=>{const i=JSON.stringify(u.correct_answer.sort()),x=JSON.stringify(l[u.id]&&[...l[u.id]].sort());i===x?(g++,o(Es(u.id))):o(Fs(u.id));const C=parseFloat((g/n.length*10).toFixed(2));o(Ls(C))}),o(X(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(He,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!d&&t.jsx(I,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:r.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:h,children:t.jsx(We,{})})}),t.jsx(I,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(a=>!a),children:[t.jsxs("div",{children:["Điểm: ",r.score]}),t.jsxs("div",{children:["Kết quả: ",r.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(I,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:p,children:[t.jsx(se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(I,{children:t.jsx(re,{})})]})},Ys=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:r,correctAnswers:o}=w(p=>p.testResult),d=w(p=>p.testQuestion.questions),[f,h]=c.useState("");return c.useEffect(()=>{e(!r),n<5?h("lowScore"):n<8&&h("mediumScore")},[r]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${f}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",o.length,"/",d.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Zs=({currentQuestionNumber:s})=>{const e=w(a=>a.testQuestion.questions),n=w(a=>a.testResult.isTestFininshed),r=w(a=>a.currCourse.course),{shuffleAnswer:o,questionCount:d}=w(a=>a.testConfig),f=y();c.useEffect(()=>{if(n)return;f(B([])),(async()=>{const l=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),g=JSON.parse(l).map(i=>new W(i)),u=p(g);h(u),f(B(u))})()},[n]);const h=a=>{a.forEach(l=>{o&&l.shuffleable&&(l.answer_option=k(l.answer_option))})},p=a=>{const l=k(a);return l.sort((g,u)=>g.cdr-u.cdr),d==="all"||Number.isNaN(Number.parseInt(d))?l:l.slice(0,Number.parseInt(d))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((a,l)=>a.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(Ce,{question:a,number:l+1})},a.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(ye,{question:a,number:l+1})},a.id))})},Us=({currentIndex:s,questionNumbers:e})=>{const r=c.useRef(null),o=c.useRef(null),[d,f]=c.useState(0),[h,p]=c.useState(0);return c.useEffect(()=>{if(o.current&&r.current){const a=r.current.clientWidth,{defaultWidth:l,offsetFromCenter:g}=Ds(o.current,a);f(l),p(g)}},[]),c.useEffect(()=>{if(!(!d||!h)&&o.current&&r.current){const a=s-1+2,l=o.current.querySelectorAll(".QuestionNumberIndicatorItem"),g=l[a];l.forEach((u,i)=>{u.classList.remove("neighbour","current"),i===a&&u.classList.add("current"),Math.abs(i-a)===1&&u.classList.add("neighbour")}),g&&(o.current.style.transform=`translateX(${-(d*a)+h}px)`)}},[s,d,h]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:r,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:o,children:t.jsx(Ie,{questionNumbers:e,fakeItemCount:2})})})},Ie=c.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=r=>Array(e).fill(0).map((o,d)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:o},d+r));return t.jsxs(t.Fragment,{children:[n(-e),s.map(r=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:r},r)),n(s.length+1)]})});Ie.displayName="QuestionNumberIndicatorList";const Ds=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",s.appendChild(n);const r=$(n);n.classList.add("neighbour");const o=$(n);n.classList.remove("neighbour"),n.classList.add("current");const d=$(n),f=o-r,h=(e-d)/2-f;return s.removeChild(n),{defaultWidth:r,neighborWidth:o,currentWidth:d,offsetFromCenter:h}},$=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},et=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const n=w(m=>m.theme.theme),r=w(m=>m.userAnswer.answers),o=w(m=>m.testQuestion.questions),{correctAnswers:d,wrongAnswers:f}=w(m=>m.testResult),{questionCount:h,showQuestionByPage:p}=w(m=>m.testConfig),a=h!=="all"?parseInt(h):o.length,l=c.useMemo(()=>[...Array(a).keys()].map(m=>m+1),[a]),[g,u]=c.useState(null),i=!!g,x=m=>{u(m.currentTarget)},C=()=>{u(null)},T=m=>{let j="QuestionListMenuItem";try{const N=o[m-1];N instanceof W&&(!r||r&&!r[N==null?void 0:N.id]?j+=" unanswer":d.includes(N==null?void 0:N.id)?j+=" correct":f.includes(N==null?void 0:N.id)&&(j+=" incorrect"))}catch{console.log(`Question number ${m} does not exists`)}return m===s&&(j+=" selected"),j},_=m=>{p?(e(m),C()):P(m)},v=m=>{const j=Math.min(s+1,a);s>=a-1&&m.currentTarget.blur(),p?e(j):P(j)},b=m=>{s<=2&&m.currentTarget.blur();const j=Math.max(s-1,1);p?e(j):P(j)};return!o||o.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":i?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:x,children:t.jsx(Z,{className:"icon",size:16})}),t.jsx(ze,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:g,open:i,onClose:C,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":n,children:t.jsx("div",{className:"QuestionListMenuContent",children:l.map(m=>t.jsx("button",{className:T(m),onClick:()=>_(m),children:m},m))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:b,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Je,{className:"icon"})})]}),t.jsx(Us,{currentIndex:s,questionNumbers:l}),t.jsxs("button",{className:"NextQuestionBtn",onClick:v,disabled:s===a,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(qe,{className:"icon"})})]})]})},P=(s,e=0)=>{const n=document.getElementById(`questionNumber_${s}`);if(!n)return;const d=n.offsetTop-60-20-e;window.scroll({top:d,behavior:"smooth"})};export{qs as C,zs as N,Js as S,Xs as T,Zs as a,Vs as b,Ys as c,et as d,L as e,M as l,Ms as s,Gs as u};
