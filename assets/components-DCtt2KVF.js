var is=Object.defineProperty;var as=(s,e,r)=>e in s?is(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var y=(s,e,r)=>as(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as w,a as _,M as cs,b as ls,r as a,d as se,F as fe,e as us,i as ds,f as te,P as hs,g as ps,A as fs,$ as ms,s as me,O as we,S as ge,h as G,k as xe,C as H,l as ws,m as be,n as gs,p as D,o as F,R as Se,B as xs,q as bs,t as Ss,v as je,D as js,w as Cs,x as Ns,y as ys,T as Is,z as _s,E as As,G as vs,H as Qs}from"./vendor-CjHvZUX8.js";const Q=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Os=()=>{let s=localStorage.getItem("theme");return s||(s="dark",Ce(s)),s},Ce=s=>{localStorage.setItem("theme",s)},Ts={theme:Os()},Ne=O({name:"theme",initialState:Ts,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",Ce(s.theme)}}}),Rs=Ne.reducer,{switchTheme:Es}=Ne.actions,ye=()=>{const s=w(r=>r.theme.theme),e=_();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Es()),children:s=="light"?t.jsx(cs,{size:"24px",style:{background:"#00000000"}}):t.jsx(ls,{size:"24px",style:{background:"#00000000"}})})},ks={sidebarOpen:!1},Ie=O({name:"sidebarOpen",initialState:ks,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),$s=Ie.reducer,{toggleSidebar:_e,setIsSidebarOpen:Ds}=Ie.actions,kt=()=>{const s=w(f=>f.currSubject.subject),[e,r]=a.useState(!1),n=w(f=>f.sidebarOpen.sidebarOpen),u=se("screen and (max-width: 768px)"),l=_();return a.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[n]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>l(_e()),disabled:e,children:t.jsx(fe,{className:`BtnHamburgerIcon ${n?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!u&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx(us,{color:"var(--secondary-text-color)"})}),t.jsx(Q,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(Q,{children:t.jsx(ye,{})})]})};class Ae{constructor(e){y(this,"id");y(this,"name");y(this,"subject_id");y(this,"_questions");y(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Fs=new URL(""+new URL("sql-wasm-C1U8OeUW.wasm",import.meta.url).href,import.meta.url).toString(),$=class ${constructor(){}static async getInstance(){if(!$.instance&&(await $.initialize(),!$.instance))throw new Error("Failed to initialize the database");return $.instance}static async initialize(){const e=ds({locateFile:()=>Fs}),n=(await fetch("/database.sqlite3")).arrayBuffer(),[u,l]=await Promise.all([e,n]);$.instance=new u.Database(new Uint8Array(l))}};y($,"instance",null);let q=$;const T=async s=>{const e=await q.getInstance();try{const r=e.prepare(s),n=[];for(;r.step();)n.push(r.getAsObject());return r.free(),n}catch(r){throw console.error("Error executing query:",r,"Query:",s),r}},Ms=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new Ae(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Bs=async()=>{const s=localStorage.getItem("CourseId");if(s){const e=await Ms(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},V=te("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Bs();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Ls={course:null,loading:!1,error:null},ve=O({name:"currCourse",initialState:Ls,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(V.pending,e=>{e.loading=!0,e.error=null}).addCase(V.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(V.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ps=ve.reducer,{setCurrCourse:Qe}=ve.actions,Us=({children:s,...e})=>{const[r,n]=a.useState(!1),u=_(),l=se("screen and (max-width: 768px)");a.useEffect(()=>{e.currCourse?n(e.currCourse.id==e.course.id):n(!1)},[e.currCourse]);const f=()=>{u(Qe(e.course)),l&&u(Ds(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:f,children:[t.jsx(hs,{strokeWidth:"70px",className:"icon"})," ",s]})})};class Oe{constructor(e){y(this,"id");y(this,"name");y(this,"semester_id");Object.assign(this,e)}}const Hs=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new Oe(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Gs=async()=>{const s=localStorage.getItem("SubjectId");if(s){const e=await Hs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},K=te("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Gs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),zs={subject:null,loading:!1,error:null},Te=O({name:"currSubject",initialState:zs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(K.pending,e=>{e.loading=!0,e.error=null}).addCase(K.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(K.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ws=Te.reducer,{setCurrSubject:Js}=Te.actions,Vs=({subject:s})=>{const e=w(h=>h.currSubject.subject),r=w(h=>h.currCourse.course),[n,u]=a.useState(!1),[l,f]=a.useState(!1),[c,i]=a.useState([]),p=`SidebarGroupItem ${n?"selected":""} ${l?"expanded":""}`,o=_();a.useEffect(()=>{u((e==null?void 0:e.id)===s.id),f((e==null?void 0:e.id)===s.id)},[e]),a.useEffect(()=>{(async()=>{const x=(await T(`select *
        from Course
        where subject_id = ${s.id}`)).map(j=>new Ae(j));x&&i(x)})()},[]);const d=()=>{(e==null?void 0:e.id)!==s.id&&o(Qe(null)),o(Js(s)),f(h=>!h)};return t.jsxs("li",{className:p,children:[t.jsx("button",{onClick:d,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(ps,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(fs,{height:l?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:c.map((h,m)=>t.jsx(Us,{currCourse:r,course:h,children:h.name},m))})})]})};class re{constructor(e){y(this,"id");y(this,"name");Object.assign(this,e)}}const Ks=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new re(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Xs=async()=>{const s=localStorage.getItem("SemesterId");if(s){const e=await Ks(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},X=te("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Xs();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Ys={semester:null,loading:!1,error:null},Re=O({name:"currSemester",initialState:Ys,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(X.pending,e=>{e.loading=!0,e.error=null}).addCase(X.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(X.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Zs=Re.reducer,{setCurrSemester:ie}=Re.actions,z=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ms,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),qs=me(we)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),$t=()=>{const s=w(o=>o.sidebarOpen.sidebarOpen),e=w(o=>o.currSemester.semester),[r,n]=a.useState([]),[u,l]=a.useState([]),[f,c]=a.useState([]),i=_();a.useEffect(()=>{(async()=>{const h=(await T("select * from Subject")).map(j=>new Oe(j));n(h);const x=(await T("select * from Semester")).map(j=>new re(j));l(x)})()},[]),a.useEffect(()=>{const o=e?r.filter(d=>d.semester_id===e.id):r;c(o)},[e,r]);const p=o=>{const d=Number(o.target.value);if(d===-1)i(ie(null));else{const h=u.find(m=>m.id===d);h&&i(ie(h))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!u?t.jsx(z,{}):t.jsxs(t.Fragment,{children:[t.jsxs(ge,{name:"semester",value:e&&u.length>0?e.id:-1,onChange:p,input:t.jsx(qs,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(G,{value:-1,children:"Tất cả"}),u.map(o=>t.jsx(G,{value:o.id,children:o.name},o.id))]}),!f||f.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:f.map(o=>t.jsx(Vs,{subject:o},o.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>i(_e())})]})};class W{constructor(e){y(this,"id");y(this,"_question_direction");y(this,"question_type");y(this,"_answer_option");y(this,"_correct_answer");y(this,"input_correct_answer");y(this,"cdr");y(this,"group_id");y(this,"_shuffleable");y(this,"number_answer_correct");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const et={activeTest:!1},Ee=O({name:"activeTest",initialState:et,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),st=Ee.reducer,{toggleActiveTest:ke}=Ee.actions,tt=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",rt=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",nt=()=>localStorage.getItem("showQuestionByPageOption")==="true",ot={shuffleAnswer:tt(),showAnswerOnChosen:rt(),showQuestionByPage:nt(),questionCount:"15"},$e=O({name:"testConfig",initialState:ot,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),it=$e.reducer,{toggleShuffleAnswer:at,setQuestionCount:ae,toggleShowAnswerOnChosen:ct,toggleShowQuestionByPage:lt}=$e.actions,M={replace(s){var r;const e=s;e.attribs&&(e.attribs["data-org"]==="serverAws"||(r=e.attribs.alt)!=null&&r.includes("serverAws"))&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},ee=s=>{const e=[],r={};return s.forEach(n=>{n.question_type==="grouping"&&n.group_id||n.question_type==="group-input"&&n.group_id||n.question_type==="drag_drop"&&n.group_id||n.question_type==="group-radio"&&n.group_id?r[n.group_id]=[...r[n.group_id]||[],n]:e.push(n)}),{filteredQuestions:e,groupedQuestions:r}},ut=s=>{s.forEach(e=>{e.shuffleable&&(e.answer_option=xe(e.answer_option))})},dt=(s,e)=>{const r=xe(s);return r.sort((n,u)=>n.cdr-u.cdr),e<0?r:r.slice(0,e)},ht=me(we)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Dt=()=>{var I,b,A;const s=w(N=>N.theme.theme),e=w(N=>N.sidebarOpen.sidebarOpen),r=w(N=>N.currSubject),n=w(N=>N.currCourse),{shuffleAnswer:u,showAnswerOnChosen:l,showQuestionByPage:f}=w(N=>N.testConfig),[c,i]=a.useState({semester:null,loading:!1}),[p,o]=a.useState([]),[d,h]=a.useState(""),[m,x]=a.useState({value:0,loading:!1}),[j,C]=a.useState({value:0,loading:!1}),S=_();a.useEffect(()=>{(()=>{if(!n.course)return;const v=[10,15,20,30,40,50,60,80,100,150],R=[],B=n.course.question_per_test;v.includes(B)||(v.push(B),v.sort()),v.forEach(E=>{!n.course||E>=j.value||R.push(t.jsx(G,{value:E,sx:{fontSize:14},children:E},E))}),R.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),o(R)})()},[n.course,j.value]),a.useEffect(()=>{const N=async()=>{var R;i({...c,loading:!0});const v=await T(`select *
        from Semester
        where id = ${(R=r.subject)==null?void 0:R.semester_id}`);i({semester:new re(v[0]),loading:!1})};r.subject&&N()},[r.subject]),a.useEffect(()=>{if(n.course){const v=n.course.question_per_test;h(v.toString()),S(ae(v.toString()))}(async()=>{if(!n.course)return;const R=(await T(`
        SELECT *
        FROM Question
        WHERE id IN (${n.course.questions.join(",")})
      `)).map(k=>new W(k)),{filteredQuestions:B,groupedQuestions:E}=ee(R),ns=B.length;let oe=B.filter(k=>!k.correct_answer.some(L=>L<0)&&(k.question_type==="radio"||k.question_type==="checkbox")).length;for(const k in E)if(Object.prototype.hasOwnProperty.call(E,k)){let L=!0;E[k].forEach(J=>{J.question_type!=="group-input"?J.correct_answer.some(os=>os<0)&&(L=!1):J.input_correct_answer||(L=!1)}),L&&oe++}x({value:oe,loading:!1}),C({value:ns,loading:!1})})()},[n.course]);const g=N=>{const v=N.target.value;h(v),S(ae(v))};return c.loading||n.loading||r.loading||m.loading||j.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(z,{})}):!r.subject||!n.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(I=n.course)==null?void 0:I.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(b=r.subject)==null?void 0:b.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(A=c.semester)==null?void 0:A.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:j.value})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:m.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>S(at()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:l,onClick:()=>S(ct()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>S(lt()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(ws,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(ge,{value:p.length>1?d:"",onChange:g,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(ht,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:p})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>S(ke()),children:[t.jsx(be,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},pt={questions:[],filteredQuestions:[],groupedQuestions:{}},De=O({name:"testQuestion",initialState:pt,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload);const{filteredQuestions:r,groupedQuestions:n}=ee(s.questions);s.filteredQuestions=r,s.groupedQuestions=n},setTestQuestion:(s,e)=>{const{questions:r,count:n=-1,shuffleAnswer:u=!1}=e.payload;u&&ut(r),s.questions=r;const{filteredQuestions:l,groupedQuestions:f}=ee(s.questions);s.filteredQuestions=dt(l,n),s.groupedQuestions=f},clearTestQuestion:s=>{s.questions=[],s.filteredQuestions=[],s.groupedQuestions={}}}}),ft=De.reducer,{addTestQuestion:Ft,setTestQuestion:Fe,clearTestQuestion:Me}=De.actions,mt={answers:{},input_answers:{}},Be=O({name:"userAnswer",initialState:mt,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(n=>!isNaN(n));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),wt=Be.reducer,{addUserAnswer:ne,removeUserAnswer:gt,updateUserAnswer:xt,setInputAnswer:bt,removeInputAnswer:Mt,removeAllUserAnswerById:Le,resetUserAnwser:ce}=Be.actions,le={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},Pe=O({name:"testResult",initialState:le,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>le}}),St=Pe.reducer,{addCorrectAnswer:ue,addWrongAnswer:de,setIsTestFinished:he,setScore:jt,resetTestResut:pe}=Pe.actions,Ue=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),Ct=Ue.reducer,{setCurrentQuestion:P}=Ue.actions,Nt=gs({reducer:{theme:Rs,sidebarOpen:$s,currSubject:Ws,currCourse:Ps,currSemester:Zs,activeTest:st,testQuestion:ft,userAnswer:wt,testResult:St,testConfig:it,testNavigation:Ct},middleware:s=>s({serializableCheck:!1})}),Bt=()=>_(),He=a.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:n,setSelectedValue:u})=>{const[l,f]=a.useState(""),c=w(m=>m.testResult.isTestFininshed),i=w(m=>m.userAnswer.answers[e.id]),p=w(m=>m.testConfig.showAnswerOnChosen),o=_(),d=a.useMemo(()=>{const m=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(m,M)},[s.value]);a.useEffect(()=>{if(!c)return;const m=Number.parseInt(s.id);if(!i||i.length==0){e.correct_answer.includes(m)&&f(" unanswer");return}i&&i.includes(m)&&(e.correct_answer.includes(m)||f(" incorrect")),e.correct_answer.includes(m)&&f(" correct")},[c]),a.useEffect(()=>{if(!p||(f(""),!i||i.length==0))return;const m=Number.parseInt(s.id);i&&i.includes(m)&&(e.correct_answer.includes(m)||f(" incorrect")),e.correct_answer.includes(m)&&f(" correct")},[p,i]);const h=m=>{c||(u(m.target.value),o(Le(e.id)),o(ne({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${l}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Se,{name:`question_${e.id}`,checked:n===s.id,value:s.id,onChange:h,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});He.displayName="RadioAnswerOption";const yt=({number:s,id:e,directionText:r,haveAnswer:n,children:u})=>{const l=a.useMemo(()=>{const f=D.sanitize(r,{USE_PROFILES:{html:!0}});return F(f,M)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!n&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:l}),u&&t.jsx("div",{className:"QuestionContainerAdditional",children:u})]})},U=a.memo(yt),Ge=a.forwardRef(({question:s,number:e,...r},n)=>{const[u,l]=a.useState("0"),f=a.useMemo(()=>s.correct_answer.some(o=>o>-1),[s.correct_answer]),c=f?"RadioQuestion":"RadioQuestion noAnswer",i=o=>{const d=Math.min(Math.max(65,o+65),90);return String.fromCharCode(d)},p=a.useCallback((o,d)=>t.jsx(He,{answerOption:o,question:s,answerOptionBullet:i(d),selectedValue:u,setSelectedValue:l},`${s.id}_${o.id}`),[u]);return t.jsxs("div",{className:c,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(p)})]})});Ge.displayName="RadioQuestion";const ze=a.memo(Ge),We=a.memo(({answerOption:s,question:e,answerOptionBullet:r,index:n,selectedValue:u,setSelectedValue:l})=>{const[f,c]=a.useState(""),i=w(C=>C.testResult.isTestFininshed),p=w(C=>C.userAnswer.answers[e.id]),o=w(C=>C.testConfig.showAnswerOnChosen),[d,h]=a.useState(!1),m=_(),x=a.useMemo(()=>{const C=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(C,M)},[s.value]);a.useEffect(()=>{if(!i)return;const C=Number.parseInt(s.id);if(!p||p.length==0){e.correct_answer.includes(C)&&c(" unanswer");return}p&&p.includes(C)&&(e.correct_answer.includes(C)||c(" incorrect")),e.correct_answer.includes(C)&&c(" correct")},[i]),a.useEffect(()=>{if(!o||(c(""),!p||p.length==0)||(h(S=>S||p.length>=e.correct_answer.length),!d))return;const C=Number.parseInt(s.id);p&&p.includes(C)&&(e.correct_answer.includes(C)||c(" incorrect")),e.correct_answer.includes(C)&&c(" correct")},[o,d,p]);const j=()=>{i||(u[n]?m(gt({id:e.id,answer:s.id})):m(ne({id:e.id,answer:s.id})),l(u.map((C,S)=>S==n?!C:C)))};return t.jsxs("div",{className:`CheckboxAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(H,{name:`question_${e.id}_${n}`,checked:u[n],onChange:j,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:x})]})]})});We.displayName="CheckboxAnswerOption";const Je=a.forwardRef(({question:s,number:e,...r},n)=>{const[u,l]=a.useState(Array(s.answer_option.length).fill(!1)),f=a.useMemo(()=>s.correct_answer.some(o=>o>-1),[s.correct_answer]),c=f?"CheckboxQuestion":"CheckboxQuestion noAnswer",i=o=>{const d=Math.min(Math.max(65,o+65),90);return String.fromCharCode(d)},p=a.useCallback((o,d)=>t.jsx(We,{answerOption:o,question:s,answerOptionBullet:i(d),index:d,selectedValue:u,setSelectedValue:l},`${s.id}_${o.id}`),[u]);return t.jsxs("div",{className:c,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f,children:t.jsxs("span",{className:"NumberCorrectAnswer",children:[t.jsx(xs,{className:"NumberCorrectAnswerIcon"}),"Sinh viên chọn ",s.number_answer_correct," phương án đúng nhất"]})}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(p)})]})});Je.displayName="CheckboxQuestion";const Ve=a.memo(Je),Ke=a.memo(({answerOption:s,question:e})=>{const r=w(p=>p.testResult.isTestFininshed),n=a.useMemo(()=>{const p=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(p,M)},[s.value]),{attributes:u,listeners:l,setNodeRef:f,transform:c}=bs({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id},disabled:r}),i={transform:Ss.Translate.toString(c),cursor:r?"default":"move",touchAction:"none"};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:f,...l,...u,style:i,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:n})})});Ke.displayName="DragDropAnswerOption";const It=({question:s,answerOption:e,index:r,selectedAnswers:n,children:u})=>{const{setNodeRef:l,isOver:f}=je({id:s.id}),[c,i]=a.useState(""),p=w(S=>S.testResult.isTestFininshed),o=w(S=>S.userAnswer.answers[s.id]),d=w(S=>S.testConfig.showAnswerOnChosen),[h,m]=a.useState(!1),x=_(),j=a.useMemo(()=>{const S=e.filter(g=>s.correct_answer.includes(Number(g.id)));return S.length>1?S.map(g=>`[${g.value}]`).join(", "):S.map(g=>g.value).join(", ")},[e,s.correct_answer]),C=a.useMemo(()=>{const S=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(S,M)},[s.question_direction]);return a.useEffect(()=>{if(!p)return;if(!o||o.length==0){s.correct_answer.length>0&&i(" unanswer");return}const S=JSON.stringify(s.correct_answer.sort()),g=JSON.stringify(o&&[...o].sort());i(S===g?" correct":" incorrect")},[p]),a.useEffect(()=>{if(!d||(i(""),!o||o.length==0)||(m(I=>I||o.length>=s.correct_answer.length),!h))return;const S=JSON.stringify(s.correct_answer.sort()),g=JSON.stringify(o&&[...o].sort());i(S===g?" correct":" incorrect")},[d,h,o]),a.useEffect(()=>{p||o===void 0&&n.length===0||x(xt({id:s.id,answers:n}))},[n]),t.jsxs("div",{className:`DragDropInputQuestion${c}`,children:[t.jsxs("div",{className:"DragDropInputWrapper",children:[t.jsx("span",{className:"DragDropInputTextDirection",children:r?`${r}) ${C}`:C}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:l,children:u}),t.jsx("p",{className:"DragDropInputMessage",style:f||u!=null&&u.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]}),j&&t.jsxs("span",{className:"DragDropInputCorrectAnswer",children:["Đáp án đúng: ",j]})]})},Xe=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},u)=>{const[l,f]=a.useState({[s.id]:s.answer_option.map(h=>Number(h.id))}),c=s.question_type==="grouping",i=a.useMemo(()=>{let h=!0;return e.forEach(m=>{m.correct_answer.some(x=>x>-1)||(h=!1)}),h},[e]),p=i?"DragDropQuestion":"DragDropQuestion noAnswer",o=h=>{const{active:m,over:x}=h;if(!x||!m.data.current)return;const j=Number(m.data.current.answerOptionId),C=x.id;f(S=>{const g={...S};g[C]||(g[C]=[]);let I=-1;for(const b in g)if(Object.prototype.hasOwnProperty.call(g,b)&&g[b].includes(j)){I=Number(b);break}if(I!==-1)if(!c&&C!==s.id&&g[C]&&g[C].length>=1){const b=g[C][0];g[C]=[j],g[I]=g[I].filter(A=>A!==j),g[I]=[...g[I],b]}else g[I]=g[I].filter(b=>b!==j),g[C]=[...g[C],j];return g})},d=a.useCallback(h=>t.jsx(Ke,{answerOption:h,question:s},`${s.id}_${h.id}`),[s]);return t.jsx("div",{className:p,...n,ref:u,children:t.jsxs(js,{onDragEnd:o,modifiers:[Cs],children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:i,children:t.jsx(_t,{questionId:s.id,children:s.answer_option.filter(h=>l[s.id].includes(Number(h.id))).map(d)})}),t.jsx("div",{className:`DragDropInputQuestions ${c?"card":"row"}`,children:e.map((h,m)=>t.jsx(It,{question:h,answerOption:s.answer_option,index:c?m+1:void 0,selectedAnswers:l[h.id]||[],children:l[h.id]&&s.answer_option.filter(x=>l[h.id].includes(Number(x.id))).map(d)},h.id))})]})})}),_t=({children:s,questionId:e})=>{const{setNodeRef:r}=je({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};Xe.displayName="DragDropQuestion";const Ye=a.memo(Xe),At=({question:s,index:e})=>{const[r,n]=a.useState(""),[u,l]=a.useState(""),f=w(x=>x.testResult.isTestFininshed),c=w(x=>x.userAnswer.input_answers[s.id]),i=w(x=>x.testConfig.showAnswerOnChosen),p=_(),o=a.useMemo(()=>{const x=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(x,M)},[s.question_direction]);a.useEffect(()=>{var x;if(f){if(!c){n(" unanswer");return}((x=s==null?void 0:s.input_correct_answer)==null?void 0:x.toLowerCase())===c.toLowerCase()?n(" correct"):n(" incorrect")}},[f]),a.useEffect(()=>{var x;i&&(n(""),c&&(((x=s==null?void 0:s.input_correct_answer)==null?void 0:x.toLowerCase())===c.toLowerCase()?n(" correct"):n(" incorrect")))},[i,c]);const d=c?350:1e3,h=a.useCallback(Ns.debounce(x=>{p(bt({id:s.id,answer:x}))},d),[p,s.id,d]),m=x=>{if(f)return;const j=x.target.value;l(j),h(j)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${o}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:u,onInput:m,spellCheck:!1,style:{cursor:f?"default":"text"}})}),s.input_correct_answer&&t.jsxs("span",{className:"GroupInputInputCorrectAnswer",children:["Đáp án đúng: ",s.input_correct_answer]})]})},Ze=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},u)=>{const l=a.useMemo(()=>!e.some(c=>c.input_correct_answer===null),[e]),f=l?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:f,...n,ref:u,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((c,i)=>t.jsx(At,{question:c,index:i+1},c.id))})]})});Ze.displayName="GroupInputQuestion";const qe=a.memo(Ze),es=a.memo(({answerOption:s,question:e,selectedValue:r,setSelectedValue:n})=>{const[u,l]=a.useState(""),f=w(h=>h.testResult.isTestFininshed),c=w(h=>h.userAnswer.answers[e.id]),i=w(h=>h.testConfig.showAnswerOnChosen),p=_(),o=a.useMemo(()=>{const h=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(h,M)},[s.value]);a.useEffect(()=>{if(!f)return;const h=Number.parseInt(s.id);if(!c||c.length==0){e.correct_answer.includes(h)&&l(" unanswer");return}c&&c.includes(h)&&(e.correct_answer.includes(h)||l(" incorrect")),e.correct_answer.includes(h)&&l(" correct")},[f]),a.useEffect(()=>{if(!i||(l(""),!c||c.length==0))return;const h=Number.parseInt(s.id);c&&c.includes(h)&&(e.correct_answer.includes(h)?l(" correct"):l(" incorrect"))},[i,c]);const d=h=>{f||(n(h.target.value),p(Le(e.id)),p(ne({id:e.id,answer:s.id})))};return t.jsxs("label",{className:`GroupRadioAnswerOption${u}`,children:[t.jsx(Se,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:d,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:o})]})});es.displayName="GroupRadioAnswerOption";const vt=({question:s,index:e})=>{const[r,n]=a.useState("-1"),u=a.useMemo(()=>{const l=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(l,M)},[s.question_direction]);return t.jsxs("div",{className:"GroupRadioInputQuestion",children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupRadioInputTextDirection",children:`${e}) ${u}`}),t.jsx("div",{className:"GroupRadioInputContainer",children:s.answer_option.map(l=>t.jsx(es,{answerOption:l,question:s,selectedValue:r,setSelectedValue:n},l.id))})]})},ss=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},u)=>{const l=a.useMemo(()=>{let c=!0;return e.forEach(i=>{i.correct_answer.some(p=>p>-1)||(c=!1)}),c},[e]),f=l?"GroupRadioQuestion":"GroupRadioQuestion noAnswer";return t.jsxs("div",{className:f,...n,ref:u,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupRadioInputQuestions",children:e.map((c,i)=>t.jsx(vt,{question:c,index:i+1},c.id))})]})});ss.displayName="GroupRadioQuestion";const ts=a.memo(ss),Qt=({children:s,sectionRefs:e,rootSelector:r,offset:n,as:u,...l})=>{const f=ys({sectionRefs:e,rootSelector:r,offset:n}),c=w(o=>o.testNavigation.currentQuestionNumber),i=_();a.useEffect(()=>{f.currentElementIndexInViewport===-1||f.currentElementIndexInViewport+1===c||i(P(f.currentElementIndexInViewport+1))},[f]);const p=u||"div";return t.jsx(p,{...l,children:s})},Lt=()=>{const s=w(o=>o.testQuestion.filteredQuestions),e=w(o=>o.testQuestion.groupedQuestions),r=w(o=>o.testResult.isTestFininshed),n=w(o=>o.currCourse.course),{shuffleAnswer:u,questionCount:l}=w(o=>o.testConfig),f=_(),c=a.useRef([]),[i,p]=a.useState(-60);return a.useEffect(()=>{window.innerHeight!==0&&p(-60-window.innerHeight/4)},[window.innerHeight]),a.useMemo(()=>{c.current.length!==s.length&&(c.current=Array(s.length).fill(null).map((o,d)=>c.current[d]||a.createRef()))},[s.length]),a.useEffect(()=>{if(r)return;f(Me()),(async()=>{const h=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`)).map(m=>new W(m));f(Fe({questions:h,count:Number.parseInt(l)||-1,shuffleAnswer:u}))})()},[r]),!s||s.length==0||!c.current?t.jsx("div",{className:"TestContainer",children:t.jsx(z,{})}):t.jsx(Qt,{as:"div",className:"TestContainer",sectionRefs:c.current,offset:i,children:s.map((o,d)=>o.question_type==="radio"?t.jsx(ze,{ref:c.current[d],question:o,id:`questionNumber_${d+1}`,number:d+1},o.id):o.question_type==="drag_drop"||o.question_type==="grouping"?t.jsx(Ye,{ref:c.current[d],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${d+1}`,number:d+1},o.id):o.question_type==="group-input"?t.jsx(qe,{ref:c.current[d],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${d+1}`,number:d+1},o.id):o.question_type==="group-radio"?t.jsx(ts,{ref:c.current[d],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${d+1}`,number:d+1},o.id):t.jsx(Ve,{ref:c.current[d],question:o,id:`questionNumber_${d+1}`,number:d+1},o.id))})},Pt=({setHidePopup:s})=>{const e=w(d=>d.currSubject.subject),r=w(d=>d.testQuestion.filteredQuestions),n=w(d=>d.testQuestion.groupedQuestions),u=w(d=>d.testResult),l=_(),f=se("screen and (max-width: 768px)"),c=()=>{!u.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(l(ke()),l(pe()),l(ce()))},i=()=>{l(he(!1)),l(pe()),l(ce())},p=(d,h)=>{if(Array.isArray(d)&&Array.isArray(h)){const m=JSON.stringify([...h].sort()),x=JSON.stringify([...d].sort());return m===x}else if(typeof d=="string"&&typeof h=="string")return d.toLowerCase().trim()===h.toLowerCase().trim();return!1},o=()=>{const d=Nt.getState(),h=d.userAnswer.answers,m=d.userAnswer.input_answers;let x=0;r.forEach(j=>{if(n[j.id]){let S=!0;n[j.id].forEach(g=>{if(g.question_type!=="group-input"){const I=h[g.id]||[];p(I,g.correct_answer)||(S=!1)}else{const I=m[g.id]||null;!I||!g.input_correct_answer?S=!1:p(I,g.input_correct_answer)||(S=!1)}}),S?(x++,l(ue(j.id))):l(de(j.id))}else{let S=!0;if(j.question_type!=="group-input"){const g=h[j.id]||[];p(g,j.correct_answer)||(S=!1)}else{const g=m[j.id]||null;!g||!j.input_correct_answer?S=!1:p(g,j.input_correct_answer)||(S=!1)}S?(x++,l(ue(j.id))):l(de(j.id))}const C=parseFloat((x/r.length*10).toFixed(2));l(jt(C))}),l(he(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:c,children:t.jsx(Is,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!f&&t.jsx(Q,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:u.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:i,children:t.jsx(_s,{})})}),t.jsx(Q,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(d=>!d),children:[t.jsxs("div",{children:["Điểm: ",u.score]}),t.jsxs("div",{children:["Kết quả: ",u.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(Q,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:o,children:[t.jsx(be,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(Q,{children:t.jsx(ye,{})})]})},Ut=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:n,correctAnswers:u}=w(i=>i.testResult),l=w(i=>i.testQuestion.filteredQuestions),[f,c]=a.useState("");return a.useEffect(()=>{e(!n),r<5?c("lowScore"):r<8?c("mediumScore"):c("")},[n]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${f}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",u.length,"/",l.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Ht=()=>{const s=w(i=>i.testQuestion.filteredQuestions),e=w(i=>i.testQuestion.groupedQuestions),r=w(i=>i.testResult.isTestFininshed),n=w(i=>i.currCourse.course),u=w(i=>i.testNavigation.currentQuestionNumber),{shuffleAnswer:l,questionCount:f}=w(i=>i.testConfig),c=_();return a.useEffect(()=>{if(r||c(P(1)),r)return;c(Me()),(async()=>{const o=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`)).map(d=>new W(d));c(Fe({questions:o,count:Number.parseInt(f)||-1,shuffleAnswer:l}))})()},[r]),!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(z,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((i,p)=>i.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:u!==p+1?{display:"none"}:{},children:t.jsx(ze,{question:i,number:p+1})},i.id):i.question_type==="drag_drop"?t.jsx("div",{className:"DragDropQuestionWrapper",style:u!==p+1?{display:"none"}:{},children:t.jsx(Ye,{topicQuestion:i,inputQuestions:e[i.id]||[],number:p+1})},i.id):i.question_type==="group-input"?t.jsx("div",{className:"GroupInputQuestionWrapper",style:u!==p+1?{display:"none"}:{},children:t.jsx(qe,{topicQuestion:i,inputQuestions:e[i.id]||[],number:p+1})},i.id):i.question_type==="group-radio"?t.jsx("div",{className:"GroupRadioQuestionWrapper",style:u!==p+1?{display:"none"}:{},children:t.jsx(ts,{topicQuestion:i,inputQuestions:e[i.id]||[],number:p+1})},i.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:u!==p+1?{display:"none"}:{},children:t.jsx(Ve,{question:i,number:p+1})},i.id))})},Ot=({currentIndex:s,questionNumbers:e})=>{const n=a.useRef(null),u=a.useRef(null),[l,f]=a.useState(0),[c,i]=a.useState(0);return a.useEffect(()=>{if(u.current&&n.current){const p=n.current.clientWidth,{defaultWidth:o,offsetFromCenter:d}=Tt(u.current,p);f(o),i(d)}},[]),a.useEffect(()=>{if(!(!l||!c)&&u.current&&n.current){const p=(s!==-1?s:1)-1+2,o=u.current.querySelectorAll(".QuestionNumberIndicatorItem"),d=o[p];o.forEach((h,m)=>{h.classList.remove("neighbour","current"),m===p&&h.classList.add("current"),Math.abs(m-p)===1&&h.classList.add("neighbour")}),d&&(u.current.style.transform=`translateX(${-(l*p)+c}px)`)}},[s,l,c]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:n,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:u,children:t.jsx(rs,{questionNumbers:e,fakeItemCount:2})})})},rs=a.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=n=>Array(e).fill(0).map((u,l)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:u},l+n));return t.jsxs(t.Fragment,{children:[r(-e),s.map(n=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:n},n)),r(s.length+1)]})});rs.displayName="QuestionNumberIndicatorList";const Tt=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const n=Y(r);r.classList.add("neighbour");const u=Y(r);r.classList.remove("neighbour"),r.classList.add("current");const l=Y(r),f=u-n,c=(e-l)/2-f;return s.removeChild(r),{defaultWidth:n,neighborWidth:u,currentWidth:l,offsetFromCenter:c}},Y=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Gt=()=>{const s=w(b=>b.theme.theme),e=w(b=>b.userAnswer.answers),r=w(b=>b.testQuestion.filteredQuestions),{correctAnswers:n,wrongAnswers:u}=w(b=>b.testResult),{questionCount:l,showQuestionByPage:f}=w(b=>b.testConfig),c=w(b=>b.testNavigation.currentQuestionNumber),i=_(),p=l!=="all"?parseInt(l):r.length,o=a.useMemo(()=>[...Array(p).keys()].map(b=>b+1),[p]),[d,h]=a.useState(null),m=!!d,x=b=>{h(b.currentTarget)},j=()=>{h(null)},C=b=>{let A="QuestionListMenuItem";try{const N=r[b-1];N instanceof W&&(!e||e&&!e[N==null?void 0:N.id]?A+=" unanswer":n.includes(N==null?void 0:N.id)?A+=" correct":u.includes(N==null?void 0:N.id)&&(A+=" incorrect"))}catch{console.log(`Question number ${b} does not exists`)}return b===c&&(A+=" selected"),A},S=b=>{f?i(P(b)):Z(b),j()},g=b=>{const A=Math.min(c+1,p);c>=p-1&&b.currentTarget.blur(),f?i(P(A)):Z(A)},I=b=>{c<=2&&b.currentTarget.blur();const A=Math.max(c-1,1);f?i(P(A)):Z(A)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":m?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":m?"true":void 0,onClick:x,children:t.jsx(fe,{className:"icon",size:16})}),t.jsx(As,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:d,open:m,onClose:j,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:o.map(b=>t.jsx("button",{className:C(b),onClick:()=>S(b),children:b},b))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:I,disabled:c<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(vs,{className:"icon"})})]}),t.jsx(Ot,{currentIndex:c,questionNumbers:o}),t.jsxs("button",{className:"NextQuestionBtn",onClick:g,disabled:c===p,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Qs,{className:"icon"})})]})]})},Z=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const l=r.offsetTop-60-20-e;window.scroll({top:l,behavior:"smooth"})};export{Dt as C,kt as N,$t as S,Pt as T,Ht as a,Lt as b,Ut as c,Gt as d,q as e,V as f,X as g,K as l,Nt as s,Bt as u};
