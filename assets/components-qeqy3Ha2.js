var Me=Object.defineProperty;var Fe=(s,e,r)=>e in s?Me(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var C=(s,e,r)=>Fe(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as I,u as g,a as N,M as Le,b as $e,r as l,d as z,F as oe,e as Pe,f as De,g as J,P as Ue,h as We,A as He,$ as ze,s as ae,O as ie,S as ce,i as E,C as k,k as Je,l as le,m as qe,p as q,n as K,R as Ke,o as Ge,q as B,T as Ve,t as Xe,v as Ye,w as Ze,x as es}from"./vendor-5CDF6wRa.js";const y=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),ss=()=>{let s=localStorage.getItem("theme");return s||(s="dark",ue(s)),s},ue=s=>{localStorage.setItem("theme",s)},ts={theme:ss()},de=I({name:"theme",initialState:ts,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",ue(s.theme)}}}),rs=de.reducer,{switchTheme:ns}=de.actions,he=()=>{const s=g(r=>r.theme.theme),e=N();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(ns()),children:s=="light"?t.jsx(Le,{size:"24px",style:{background:"#00000000"}}):t.jsx($e,{size:"24px",style:{background:"#00000000"}})})},os={sidebarOpen:!1},me=I({name:"sidebarOpen",initialState:os,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),as=me.reducer,{toggleSidebar:fe,setIsSidebarOpen:is}=me.actions,ot=()=>{const s=g(d=>d.currSubject.subject),[e,r]=l.useState(!1),n=g(d=>d.sidebarOpen.sidebarOpen),i=z("screen and (max-width: 768px)"),m=N();return l.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[n]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>m(fe()),disabled:e,children:t.jsx(oe,{className:`BtnHamburgerIcon ${n?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!i&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx(Pe,{color:"var(--secondary-text-color)"})}),t.jsx(y,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(y,{children:t.jsx(he,{})})]})};class pe{constructor(e){C(this,"id");C(this,"name");C(this,"subject_id");C(this,"_questions");C(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const cs=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),ls=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),us=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let $=null;const ds=async()=>($||($=await De.createDbWorker([{from:"inline",config:{serverMode:"full",url:us,requestChunkSize:4096}}],cs.toString(),ls.toString())),$),v=async s=>{const r=await(await ds()).db.query(s);return JSON.stringify(r)},hs=async s=>{try{const e=await v(`select *
            from Course 
            where id = ${s}
            limit 1`);return new pe(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ms=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await hs(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},P=J("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await ms();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),fs={course:null,loading:!1,error:null},ge=I({name:"currCourse",initialState:fs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(P.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ps=ge.reducer,{setCurrCourse:we}=ge.actions,gs=({children:s,...e})=>{const[r,n]=l.useState(!1),i=N(),m=z("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?n(e.currCourse.id==e.course.id):n(!1)},[e.currCourse]);const d=()=>{i(we(e.course)),m&&i(is(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:d,children:[t.jsx(Ue,{strokeWidth:"70px",className:"icon"})," ",s]})})};class ws{constructor(e){C(this,"id");C(this,"name");C(this,"semester_id");Object.assign(this,e)}}const xs=async s=>{try{const e=await v(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new ws(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Ss=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await xs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},D=J("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Ss();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),bs={subject:null,loading:!1,error:null},xe=I({name:"currSubject",initialState:bs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(D.pending,e=>{e.loading=!0,e.error=null}).addCase(D.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(D.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Cs=xe.reducer,{setCurrSubject:js}=xe.actions,Ns=({subject:s})=>{const e=g(c=>c.currSubject.subject),r=g(c=>c.currCourse.course),[n,i]=l.useState(!1),[m,d]=l.useState(!1),[h,p]=l.useState([]),o=`SidebarGroupItem ${n?"selected":""} ${m?"expanded":""}`,u=N();l.useEffect(()=>{i((e==null?void 0:e.id)===s.id),d((e==null?void 0:e.id)===s.id)},[e]),l.useEffect(()=>{(async()=>{const f=await v(`select *
        from Course
        where subject_id = ${s.id}`),w=JSON.parse(f).map(j=>new pe(j));w&&p(w)})()},[]);const a=()=>{(e==null?void 0:e.id)!==s.id&&u(we(null)),u(js(s)),d(c=>!c)};return t.jsxs("li",{className:o,children:[t.jsx("button",{onClick:a,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(We,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(He,{height:m?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:h.map((c,f)=>t.jsx(gs,{currCourse:r,course:c,children:c.name},f))})})]})};class ys{constructor(e){C(this,"id");C(this,"name");Object.assign(this,e)}}const Is=async s=>{try{const e=await v(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new ys(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},vs=async()=>{let s=localStorage.getItem("SemesterId");if(s){const e=await Is(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},U=J("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await vs();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Os={semester:null,loading:!1,error:null},Se=I({name:"currSemester",initialState:Os,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(U.pending,e=>{e.loading=!0,e.error=null}).addCase(U.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(U.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),As=Se.reducer,{setCurrSemester:Z}=Se.actions,F=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ze,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Ts=ae(ie)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),at=()=>{const s=g(a=>a.sidebarOpen.sidebarOpen),e=g(a=>a.currSemester.semester),[r,n]=l.useState([]),[i,m]=l.useState([]),[d,h]=l.useState([]),p=N();l.useEffect(()=>{(async()=>{const c=await v("select * from Subject");n(JSON.parse(c));const f=await v("select * from Semester");m(JSON.parse(f))})()},[]),l.useEffect(()=>{const a=e?r.filter(c=>c.semester_id===e.id):r;h(a)},[e,r]);const o=a=>{const c=Number(a.target.value);if(c===-1)p(Z(null));else{const f=i.find(w=>w.id===c);f&&p(Z(f))}},u=!r||r.length===0||!i||i.length===0;return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[u?t.jsx(F,{}):t.jsxs(t.Fragment,{children:[t.jsxs(ce,{name:"semester",value:e?e.id:-1,onChange:o,input:t.jsx(Ts,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(E,{value:-1,children:"Tất cả"}),i.map(a=>t.jsx(E,{value:a.id,children:a.name},a.id))]}),t.jsx("ul",{children:d.map((a,c)=>t.jsx(Ns,{subject:a},c))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>p(fe())})]})},_s={activeTest:!1},be=I({name:"activeTest",initialState:_s,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),Qs=be.reducer,{toggleActiveTest:Ce}=be.actions,Rs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ks=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Es=()=>localStorage.getItem("showQuestionByPageOption")==="true",Bs={shuffleAnswer:Rs(),showAnswerOnChosen:ks(),showQuestionByPage:Es(),questionCount:"15"},je=I({name:"testConfig",initialState:Bs,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Ms=je.reducer,{toggleShuffleAnswer:Fs,setQuestionCount:ee,toggleShowAnswerOnChosen:Ls,toggleShowQuestionByPage:$s}=je.actions,Ps=ae(ie)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),it=()=>{var T,_,Q,x;const s=g(S=>S.theme.theme),e=g(S=>S.sidebarOpen.sidebarOpen),r=g(S=>S.currSubject),n=g(S=>S.currCourse),{shuffleAnswer:i,showAnswerOnChosen:m,showQuestionByPage:d}=g(S=>S.testConfig),[h,p]=l.useState({semester:null,loading:!1}),[o,u]=l.useState([]),[a,c]=l.useState(""),[f,w]=l.useState({value:0,loading:!1}),j=N();l.useEffect(()=>{(()=>{if(!n.course)return;const b=[10,15,20,30,40,50,60,80,100,150],O=[],X=n.course.question_per_test;b.includes(X)||(b.push(X),b.sort()),b.forEach(R=>{var Y;!n.course||R>=((Y=n.course)==null?void 0:Y.questions.length)||O.push(t.jsx(E,{value:R,sx:{fontSize:14},children:R},R))}),O.push(t.jsx(E,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),u(O)})()},[n.course]),l.useEffect(()=>{const S=async()=>{var O;p({...h,loading:!0});const b=await v(`select *
        from Semester
        where id = ${(O=r.subject)==null?void 0:O.semester_id}`);p({semester:JSON.parse(b)[0],loading:!1})};r.subject&&S()},[r.subject]),l.useEffect(()=>{if(n.course){const b=n.course.question_per_test;c(b.toString()),j(ee(b.toString()))}(async()=>{if(!n.course)return;const b=await v(`
        SELECT COUNT(DISTINCT Question.id) as count
        FROM Question
        WHERE id IN (${n.course.questions.join(",")})
        AND (
          (json_valid(correct_answer)
          AND json_array_length(correct_answer) > 0
          AND EXISTS (SELECT 1 FROM json_each(correct_answer) WHERE json_each.value > 0))
          OR correct_answer != 0
        )
      `),O=JSON.parse(b)[0].count;w({value:O,loading:!1})})()},[n.course]);const L=S=>{const b=S.target.value;c(b),j(ee(b))};return h.loading||n.loading||r.loading||f.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(F,{})}):!r.subject||!n.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(T=n.course)==null?void 0:T.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(_=r.subject)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(Q=h.semester)==null?void 0:Q.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(x=n.course)==null?void 0:x.questions.length})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:f.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:i,onClick:()=>j(Fs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:m,onClick:()=>j(Ls()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>j($s()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Je,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(ce,{value:a,onChange:L,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Ps,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>j(Ce()),children:[t.jsx(le,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},Ds={questions:[]},Ne=I({name:"testQuestion",initialState:Ds,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Us=Ne.reducer,{addTestQuestion:ct,setTestQuestion:M}=Ne.actions,Ws={answers:{}},ye=I({name:"userAnswer",initialState:Ws,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Hs=ye.reducer,{addUserAnswer:Ie,removeUserAnswer:zs,removeAllUserAnswerById:Js,resetUserAnwser:se}=ye.actions,te={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ve=I({name:"testResult",initialState:te,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>te}}),qs=ve.reducer,{addCorrectAnswer:Ks,addWrongAnswer:Gs,setIsTestFinished:re,setScore:Vs,resetTestResut:ne}=ve.actions,Oe=I({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),Xs=Oe.reducer,{setCurrentQuestion:A}=Oe.actions,Ys=qe({reducer:{theme:rs,sidebarOpen:as,currSubject:Cs,currCourse:ps,currSemester:As,activeTest:Qs,testQuestion:Us,userAnswer:Hs,testResult:qs,testConfig:Ms,testNavigation:Xs},middleware:s=>s({serializableCheck:!1})}),lt=()=>N();class G{constructor(e){C(this,"id");C(this,"_question_direction");C(this,"question_type");C(this,"_answer_option");C(this,"_correct_answer");C(this,"cdr");C(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const V={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},Ae=l.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:n,setSelectedValue:i})=>{const[m,d]=l.useState(""),h=g(f=>f.testResult.isTestFininshed),p=g(f=>f.userAnswer.answers[e.id]),o=g(f=>f.testConfig.showAnswerOnChosen),u=N(),a=l.useMemo(()=>{const f=q.sanitize(s.value,{USE_PROFILES:{html:!0}});return K(f,V)},[s.value]);l.useEffect(()=>{if(!h)return;const f=Number.parseInt(s.id);if(!p||p.length==0){e.correct_answer.includes(f)&&d(" unanswer");return}p&&p.includes(f)&&(e.correct_answer.includes(f)||d(" incorrect")),e.correct_answer.includes(f)&&d(" correct")},[h]),l.useEffect(()=>{if(!o||(d(""),!p||p.length==0))return;const f=Number.parseInt(s.id);p&&p.includes(f)&&(e.correct_answer.includes(f)||d(" incorrect")),e.correct_answer.includes(f)&&d(" correct")},[o,p]);const c=f=>{h||(i(f.target.value),u(Js(e.id)),u(Ie({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${m}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Ke,{name:`question_${e.id}`,checked:n===s.id,value:s.id,onChange:c,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:a})]})]})});Ae.displayName="RadioAnswerOption";const Zs=({number:s,id:e,directionText:r,haveAnswer:n})=>{const i=l.useMemo(()=>{const m=q.sanitize(r,{USE_PROFILES:{html:!0}});return K(m,V)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!n&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:i})]})},Te=l.memo(Zs),_e=l.forwardRef(({question:s,number:e,...r},n)=>{const[i,m]=l.useState("0"),d=l.useMemo(()=>s.correct_answer.some(u=>u>0&&u<=s.answer_option.length),[s.correct_answer]),h=d?"RadioQuestion":"RadioQuestion noAnswer",p=u=>{const a=Math.min(Math.max(65,u+65),90);return String.fromCharCode(a)},o=l.useCallback((u,a)=>t.jsx(Ae,{answerOption:u,question:s,answerOptionBullet:p(a),selectedValue:i,setSelectedValue:m},`${s.id}_${u.id}`),[i]);return t.jsxs("div",{className:h,...r,ref:n,children:[t.jsx(Te,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});_e.displayName="RadioQuestion";const Qe=l.memo(_e),Re=l.memo(({answerOption:s,question:e,answerOptionBullet:r,index:n,selectedValue:i,setSelectedValue:m})=>{const[d,h]=l.useState(""),p=g(w=>w.testResult.isTestFininshed),o=g(w=>w.userAnswer.answers[e.id]),u=g(w=>w.testConfig.showAnswerOnChosen),a=N(),c=l.useMemo(()=>{const w=q.sanitize(s.value,{USE_PROFILES:{html:!0}});return K(w,V)},[s.value]);l.useEffect(()=>{if(!p)return;const w=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(w)&&h(" unanswer");return}o&&o.includes(w)&&(e.correct_answer.includes(w)||h(" incorrect")),e.correct_answer.includes(w)&&h(" correct")},[p]),l.useEffect(()=>{if(!u||(h(""),!o||o.length==0))return;const w=Number.parseInt(s.id);o&&o.includes(w)&&(e.correct_answer.includes(w)||h(" incorrect")),e.correct_answer.includes(w)&&h(" correct")},[u,o]);const f=()=>{p||(i[n]?a(zs({id:e.id,answer:s.id})):a(Ie({id:e.id,answer:s.id})),m(i.map((w,j)=>j==n?!w:w)))};return t.jsxs("div",{className:`CheckboxAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(k,{name:`question_${e.id}_${n}`,checked:i[n],onChange:f,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:c})]})]})});Re.displayName="CheckboxAnswerOption";const ke=l.forwardRef(({question:s,number:e,...r},n)=>{const[i,m]=l.useState([!1,!1,!1,!1]),d=l.useMemo(()=>s.correct_answer.some(u=>u>0&&u<=s.correct_answer.length),[s.correct_answer]),h=d?"CheckboxQuestion":"CheckboxQuestion noAnswer",p=u=>{const a=Math.min(Math.max(65,u+65),90);return String.fromCharCode(a)},o=l.useCallback((u,a)=>t.jsx(Re,{answerOption:u,question:s,answerOptionBullet:p(a),index:a,selectedValue:i,setSelectedValue:m},`${s.id}_${u.id}`),[i]);return t.jsxs("div",{className:h,...r,ref:n,children:[t.jsx(Te,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});ke.displayName="CheckboxQuestion";const Ee=l.memo(ke),et=({children:s,sectionRefs:e,rootSelector:r,offset:n,as:i,...m})=>{const d=Ge({sectionRefs:e,rootSelector:r,offset:n}),h=N();l.useEffect(()=>{d.currentElementIndexInViewport!==-1&&h(A(d.currentElementIndexInViewport+1))},[d]);const p=i||"div";return t.jsx(p,{...m,children:s})},ut=()=>{const s=g(a=>a.testQuestion.questions),e=g(a=>a.testResult.isTestFininshed),r=g(a=>a.currCourse.course),{shuffleAnswer:n,questionCount:i}=g(a=>a.testConfig),m=N(),d=l.useRef([]),[h,p]=l.useState(-60);l.useEffect(()=>{window.innerHeight!==0&&p(-60-window.innerHeight/4)},[window.innerHeight]),l.useMemo(()=>{d.current.length!==s.length&&(d.current=Array(s.length).fill(null).map((a,c)=>d.current[c]||l.createRef()))},[s.length]),l.useEffect(()=>{if(e)return;m(M([])),(async()=>{const c=await v(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),f=JSON.parse(c).map(j=>new G(j)),w=u(f);o(w),m(M(w))})()},[e]);const o=a=>{a.forEach(c=>{n&&c.shuffleable&&(c.answer_option=B(c.answer_option))})},u=a=>{const c=B(a);return c.sort((f,w)=>f.cdr-w.cdr),i==="all"||Number.isNaN(Number.parseInt(i))?c:c.slice(0,Number.parseInt(i))};return!s||s.length==0||!d.current?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx(et,{as:"div",className:"TestContainer",sectionRefs:d.current,offset:h,children:s.map((a,c)=>a.question_type==="radio"?t.jsx(Qe,{ref:d.current[c],question:a,id:`questionNumber_${c+1}`,number:c+1},a.id):t.jsx(Ee,{ref:d.current[c],question:a,id:`questionNumber_${c+1}`,number:c+1},a.id))})},dt=({setHidePopup:s})=>{const e=g(o=>o.currSubject.subject),r=g(o=>o.testQuestion.questions),n=g(o=>o.testResult),i=N(),m=z("screen and (max-width: 768px)"),d=()=>{!n.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(i(Ce()),i(ne()),i(se()))},h=()=>{i(re(!1)),i(ne()),i(se())},p=()=>{const u=Ys.getState().userAnswer.answers;let a=0;r.forEach(c=>{const f=JSON.stringify(c.correct_answer.sort()),w=JSON.stringify(u[c.id]&&[...u[c.id]].sort());f===w?(a++,i(Ks(c.id))):i(Gs(c.id));const j=parseFloat((a/r.length*10).toFixed(2));i(Vs(j))}),i(re(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:d,children:t.jsx(Ve,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!m&&t.jsx(y,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:n.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:h,children:t.jsx(Xe,{})})}),t.jsx(y,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",n.score]}),t.jsxs("div",{children:["Kết quả: ",n.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(y,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:p,children:[t.jsx(le,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(y,{children:t.jsx(he,{})})]})},ht=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:n,correctAnswers:i}=g(p=>p.testResult),m=g(p=>p.testQuestion.questions),[d,h]=l.useState("");return l.useEffect(()=>{e(!n),r<5?h("lowScore"):r<8?h("mediumScore"):h("")},[n]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${d}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",i.length,"/",m.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},mt=()=>{const s=g(o=>o.testQuestion.questions),e=g(o=>o.testResult.isTestFininshed),r=g(o=>o.currCourse.course),n=g(o=>o.testNavigation.currentQuestionNumber),{shuffleAnswer:i,questionCount:m}=g(o=>o.testConfig),d=N();l.useEffect(()=>{if(e||d(A(1)),e)return;d(M([])),(async()=>{const u=await v(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),a=JSON.parse(u).map(f=>new G(f)),c=p(a);h(c),d(M(c))})()},[e]);const h=o=>{o.forEach(u=>{i&&u.shuffleable&&(u.answer_option=B(u.answer_option))})},p=o=>{const u=B(o);return u.sort((a,c)=>a.cdr-c.cdr),m==="all"||Number.isNaN(Number.parseInt(m))?u:u.slice(0,Number.parseInt(m))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((o,u)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:n!==u+1?{display:"none"}:{},children:t.jsx(Qe,{question:o,number:u+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:n!==u+1?{display:"none"}:{},children:t.jsx(Ee,{question:o,number:u+1})},o.id))})},st=({currentIndex:s,questionNumbers:e})=>{const n=l.useRef(null),i=l.useRef(null),[m,d]=l.useState(0),[h,p]=l.useState(0);return l.useEffect(()=>{if(i.current&&n.current){const o=n.current.clientWidth,{defaultWidth:u,offsetFromCenter:a}=tt(i.current,o);d(u),p(a)}},[]),l.useEffect(()=>{if(!(!m||!h)&&i.current&&n.current){const o=(s!==-1?s:1)-1+2,u=i.current.querySelectorAll(".QuestionNumberIndicatorItem"),a=u[o];u.forEach((c,f)=>{c.classList.remove("neighbour","current"),f===o&&c.classList.add("current"),Math.abs(f-o)===1&&c.classList.add("neighbour")}),a&&(i.current.style.transform=`translateX(${-(m*o)+h}px)`)}},[s,m,h]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:n,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:i,children:t.jsx(Be,{questionNumbers:e,fakeItemCount:2})})})},Be=l.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=n=>Array(e).fill(0).map((i,m)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:i},m+n));return t.jsxs(t.Fragment,{children:[r(-e),s.map(n=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:n},n)),r(s.length+1)]})});Be.displayName="QuestionNumberIndicatorList";const tt=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const n=W(r);r.classList.add("neighbour");const i=W(r);r.classList.remove("neighbour"),r.classList.add("current");const m=W(r),d=i-n,h=(e-m)/2-d;return s.removeChild(r),{defaultWidth:n,neighborWidth:i,currentWidth:m,offsetFromCenter:h}},W=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},ft=()=>{const s=g(x=>x.theme.theme),e=g(x=>x.userAnswer.answers),r=g(x=>x.testQuestion.questions),{correctAnswers:n,wrongAnswers:i}=g(x=>x.testResult),{questionCount:m,showQuestionByPage:d}=g(x=>x.testConfig),h=g(x=>x.testNavigation.currentQuestionNumber),p=N(),o=m!=="all"?parseInt(m):r.length,u=l.useMemo(()=>[...Array(o).keys()].map(x=>x+1),[o]),[a,c]=l.useState(null),f=!!a,w=x=>{c(x.currentTarget)},j=()=>{c(null)},L=x=>{let S="QuestionListMenuItem";try{const b=r[x-1];b instanceof G&&(!e||e&&!e[b==null?void 0:b.id]?S+=" unanswer":n.includes(b==null?void 0:b.id)?S+=" correct":i.includes(b==null?void 0:b.id)&&(S+=" incorrect"))}catch{console.log(`Question number ${x} does not exists`)}return x===h&&(S+=" selected"),S},T=x=>{d?p(A(x)):H(x),j()},_=x=>{const S=Math.min(h+1,o);h>=o-1&&x.currentTarget.blur(),d?p(A(S)):H(S)},Q=x=>{h<=2&&x.currentTarget.blur();const S=Math.max(h-1,1);d?p(A(S)):H(S)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":f?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":f?"true":void 0,onClick:w,children:t.jsx(oe,{className:"icon",size:16})}),t.jsx(Ye,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:a,open:f,onClose:j,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:u.map(x=>t.jsx("button",{className:L(x),onClick:()=>T(x),children:x},x))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:Q,disabled:h<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ze,{className:"icon"})})]}),t.jsx(st,{currentIndex:h,questionNumbers:u}),t.jsxs("button",{className:"NextQuestionBtn",onClick:_,disabled:h===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(es,{className:"icon"})})]})]})},H=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const m=r.offsetTop-60-20-e;window.scroll({top:m,behavior:"smooth"})};export{it as C,ot as N,at as S,dt as T,mt as a,ut as b,ht as c,ft as d,P as e,U as f,D as l,Ys as s,lt as u};
