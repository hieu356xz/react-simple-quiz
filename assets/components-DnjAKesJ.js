var Te=Object.defineProperty;var _e=(s,e,n)=>e in s?Te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var S=(s,e,n)=>_e(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as A,u as w,a as y,M as ve,b as Qe,r as c,d as H,F as se,e as Re,f as ke,g as te,P as Be,h as Ee,A as Fe,$ as Le,s as Me,O as $e,C as R,i as Pe,S as Ue,k as ne,l as L,m as De,p as z,n as W,R as He,o as ze,q as k,T as We,t as Je,v as qe,w as Ke,x as Ve}from"./vendor-DLRcHq6p.js";const I=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ge=()=>{let s=localStorage.getItem("theme");return s||(s="dark",re(s)),s},re=s=>{localStorage.setItem("theme",s)},Xe={theme:Ge()},oe=A({name:"theme",initialState:Xe,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",re(s.theme)}}}),Ye=oe.reducer,{switchTheme:Ze}=oe.actions,ae=()=>{const s=w(n=>n.theme.theme),e=y();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Ze()),children:s=="light"?t.jsx(ve,{size:"24px",style:{background:"#00000000"}}):t.jsx(Qe,{size:"24px",style:{background:"#00000000"}})})},es={sidebarOpen:!1},ie=A({name:"sidebarOpen",initialState:es,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ss=ie.reducer,{toggleSidebar:ce,setIsSidebarOpen:ts}=ie.actions,qs=()=>{const s=w(f=>f.currSubject.subject),[e,n]=c.useState(!1),r=w(f=>f.sidebarOpen.sidebarOpen),a=H("screen and (max-width: 768px)"),d=y();return c.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[r]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>d(ce()),disabled:e,children:t.jsx(se,{className:`BtnHamburgerIcon ${r?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!a&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx(Re,{color:"var(--secondary-text-color)"})}),t.jsx(I,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(I,{children:t.jsx(ae,{})})]})};class le{constructor(e){S(this,"id");S(this,"name");S(this,"subject_id");S(this,"_questions");S(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const ns=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),rs=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),os=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let M=null;const as=async()=>(M||(M=await ke.createDbWorker([{from:"inline",config:{serverMode:"full",url:os,requestChunkSize:4096}}],ns.toString(),rs.toString())),M),O=async s=>{const n=await(await as()).db.query(s);return JSON.stringify(n)},is=async s=>{try{const e=await O(`select *
            from Course 
            where id = ${s}
            limit 1`);return new le(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},cs=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await is(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},$=te("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await cs();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ls={course:null,loading:!1,error:null},ue=A({name:"currCourse",initialState:ls,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase($.pending,e=>{e.loading=!0,e.error=null}).addCase($.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase($.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),us=ue.reducer,{setCurrCourse:de}=ue.actions,ds=({children:s,...e})=>{const[n,r]=c.useState(!1),a=y(),d=H("screen and (max-width: 768px)");c.useEffect(()=>{e.currCourse?r(e.currCourse.id==e.course.id):r(!1)},[e.currCourse]);const f=()=>{a(de(e.course)),d&&a(ts(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:f,children:[t.jsx(Be,{strokeWidth:"70px",className:"icon"})," ",s]})})};class hs{constructor(e){S(this,"id");S(this,"name");S(this,"semester_id");Object.assign(this,e)}}const fs=async s=>{try{const e=await O(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new hs(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ms=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await fs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},P=te("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await ms();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ps={subject:null,loading:!1,error:null},he=A({name:"currSubject",initialState:ps,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase(P.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ws=he.reducer,{setCurrSubject:xs}=he.actions,gs=({subject:s})=>{const e=w(u=>u.currSubject.subject),n=w(u=>u.currCourse.course),[r,a]=c.useState(!1),[d,f]=c.useState(!1),[h,m]=c.useState([]),o=`SidebarGroupItem ${r?"selected":""} ${d?"expanded":""}`,l=y();c.useEffect(()=>{a((e==null?void 0:e.id)===s.id),f((e==null?void 0:e.id)===s.id)},[e]),c.useEffect(()=>{(async()=>{const i=await O(`select *
        from Course
        where subject_id = ${s.id}`),g=JSON.parse(i).map(C=>new le(C));g&&m(g)})()},[]);const x=()=>{(e==null?void 0:e.id)!==s.id&&l(de(null)),l(xs(s)),f(u=>!u)};return t.jsxs("li",{className:o,children:[t.jsx("button",{onClick:x,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(Ee,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(Fe,{height:d?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:h.map((u,i)=>t.jsx(ds,{currCourse:n,course:u,children:u.name},i))})})]})},E=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Le,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Ks=()=>{const s=w(a=>a.sidebarOpen.sidebarOpen),[e,n]=c.useState([]),r=y();return c.useEffect(()=>{(async()=>{const d=await O("select * from Subject");n(JSON.parse(d))})()},[]),t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!e||e.length==0?t.jsx(E,{}):t.jsx("ul",{children:e.map((a,d)=>t.jsx(gs,{subject:a},d))}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>r(ce())})]})},bs={activeTest:!1},fe=A({name:"activeTest",initialState:bs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),js=fe.reducer,{toggleActiveTest:me}=fe.actions,Cs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",Ss=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Ns=()=>localStorage.getItem("showQuestionByPageOption")==="true",ys={shuffleAnswer:Cs(),showAnswerOnChosen:Ss(),showQuestionByPage:Ns(),questionCount:"15"},pe=A({name:"testConfig",initialState:ys,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Is=pe.reducer,{toggleShuffleAnswer:As,setQuestionCount:G,toggleShowAnswerOnChosen:Os,toggleShowQuestionByPage:Ts}=pe.actions,_s=Me($e)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Vs=()=>{var C,T,_,v;const s=w(b=>b.theme.theme),e=w(b=>b.sidebarOpen.sidebarOpen),n=w(b=>b.currSubject),r=w(b=>b.currCourse),{shuffleAnswer:a,showAnswerOnChosen:d,showQuestionByPage:f}=w(b=>b.testConfig),[h,m]=c.useState({semester:null,loading:!1}),[o,l]=c.useState([]),[x,u]=c.useState(""),i=y();c.useEffect(()=>{(()=>{const p=[10,15,20,30,40,50,60,100,150],j=[];let N=!1;p.forEach(Q=>{var K,V;if(r.course&&Q>=((K=r.course)==null?void 0:K.question_per_test)){if(!N){const F=(V=r.course)==null?void 0:V.question_per_test;j.push(t.jsx(L,{value:F,sx:{fontSize:14},children:F},F)),N=!0}return}j.push(t.jsx(L,{value:Q,sx:{fontSize:14},children:Q},Q))}),j.push(t.jsx(L,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),l(j)})()},[r.course]),c.useEffect(()=>{const b=async()=>{var j;m({...h,loading:!0});const p=await O(`select *
        from Semester
        where id = ${(j=n.subject)==null?void 0:j.semester_id}`);m({semester:JSON.parse(p)[0],loading:!1})};n.subject&&b()},[n.subject]),c.useEffect(()=>{if(r.course){const b=r.course.question_per_test;u(b.toString()),i(G(b.toString()))}},[r.course]);const g=b=>{const p=b.target.value;u(p),i(G(p))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:h.loading||r.loading||n.loading?t.jsx(E,{}):n.subject&&r.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(C=r.course)==null?void 0:C.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(T=n.subject)==null?void 0:T.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(_=h.semester)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(v=r.course)==null?void 0:v.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:a,onClick:()=>i(As()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>i(Os()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>i(Ts()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Pe,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Ue,{value:x,onChange:g,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(_s,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>i(me()),children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},vs={questions:[]},we=A({name:"testQuestion",initialState:vs,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Qs=we.reducer,{addTestQuestion:Gs,setTestQuestion:B}=we.actions,Rs={answers:{}},xe=A({name:"userAnswer",initialState:Rs,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),ks=xe.reducer,{addUserAnswer:ge,removeUserAnswer:Bs,removeAllUserAnswerById:Es,resetUserAnwser:X}=xe.actions,Y={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},be=A({name:"testResult",initialState:Y,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>Y}}),Fs=be.reducer,{addCorrectAnswer:Ls,addWrongAnswer:Ms,setIsTestFinished:Z,setScore:$s,resetTestResut:ee}=be.actions,Ps=De({reducer:{theme:Ye,sidebarOpen:ss,currSubject:ws,currCourse:us,activeTest:js,testQuestion:Qs,userAnswer:ks,testResult:Fs,testConfig:Is},middleware:s=>s({serializableCheck:!1})}),Xs=()=>y();class J{constructor(e){S(this,"id");S(this,"_question_direction");S(this,"question_type");S(this,"_answer_option");S(this,"_correct_answer");S(this,"cdr");S(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const q={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},je=c.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:r,setSelectedValue:a})=>{const[d,f]=c.useState(""),h=w(i=>i.testResult.isTestFininshed),m=w(i=>i.userAnswer.answers[e.id]),o=w(i=>i.testConfig.showAnswerOnChosen),l=y(),x=c.useMemo(()=>{const i=z.sanitize(s.value,{USE_PROFILES:{html:!0}});return W(i,q)},[s.value]);c.useEffect(()=>{if(!h)return;const i=Number.parseInt(s.id);if(!m||m.length==0){e.correct_answer.includes(i)&&f(" unanswer");return}m&&m.includes(i)&&(e.correct_answer.includes(i)||f(" incorrect")),e.correct_answer.includes(i)&&f(" correct")},[h]),c.useEffect(()=>{if(!o||(f(""),!m||m.length==0))return;const i=Number.parseInt(s.id);m&&m.includes(i)&&(e.correct_answer.includes(i)||f(" incorrect")),e.correct_answer.includes(i)&&f(" correct")},[o,m]);const u=i=>{h||(a(i.target.value),l(Es(e.id)),l(ge({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(He,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:u,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:x})]})]})});je.displayName="RadioAnswerOption";const Us=({number:s,id:e,directionText:n,haveAnswer:r})=>{const a=c.useMemo(()=>{const d=z.sanitize(n,{USE_PROFILES:{html:!0}});return W(d,q)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!r&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:a})]})},Ce=c.memo(Us),Se=c.forwardRef(({question:s,number:e,...n},r)=>{const[a,d]=c.useState("0"),f=c.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.answer_option.length),[s.correct_answer]),h=f?"RadioQuestion":"RadioQuestion noAnswer",m=l=>{const x=Math.min(Math.max(65,l+65),90);return String.fromCharCode(x)},o=c.useCallback((l,x)=>t.jsx(je,{answerOption:l,question:s,answerOptionBullet:m(x),selectedValue:a,setSelectedValue:d},`${s.id}_${l.id}`),[a]);return t.jsxs("div",{className:h,...n,ref:r,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Se.displayName="RadioQuestion";const Ne=c.memo(Se),ye=c.memo(({answerOption:s,question:e,answerOptionBullet:n,index:r,selectedValue:a,setSelectedValue:d})=>{const[f,h]=c.useState(""),m=w(g=>g.testResult.isTestFininshed),o=w(g=>g.userAnswer.answers[e.id]),l=w(g=>g.testConfig.showAnswerOnChosen),x=y(),u=c.useMemo(()=>{const g=z.sanitize(s.value,{USE_PROFILES:{html:!0}});return W(g,q)},[s.value]);c.useEffect(()=>{if(!m)return;const g=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(g)&&h(" unanswer");return}o&&o.includes(g)&&(e.correct_answer.includes(g)||h(" incorrect")),e.correct_answer.includes(g)&&h(" correct")},[m]),c.useEffect(()=>{if(!l||(h(""),!o||o.length==0))return;const g=Number.parseInt(s.id);o&&o.includes(g)&&(e.correct_answer.includes(g)||h(" incorrect")),e.correct_answer.includes(g)&&h(" correct")},[l,o]);const i=()=>{m||(a[r]?x(Bs({id:e.id,answer:s.id})):x(ge({id:e.id,answer:s.id})),d(a.map((g,C)=>C==r?!g:g)))};return t.jsxs("div",{className:`CheckboxAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(R,{name:`question_${e.id}_${r}`,checked:a[r],onChange:i,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:u})]})]})});ye.displayName="CheckboxAnswerOption";const Ie=c.forwardRef(({question:s,number:e,...n},r)=>{const[a,d]=c.useState([!1,!1,!1,!1]),f=c.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.correct_answer.length),[s.correct_answer]),h=f?"CheckboxQuestion":"CheckboxQuestion noAnswer",m=l=>{const x=Math.min(Math.max(65,l+65),90);return String.fromCharCode(x)},o=c.useCallback((l,x)=>t.jsx(ye,{answerOption:l,question:s,answerOptionBullet:m(x),index:x,selectedValue:a,setSelectedValue:d},`${s.id}_${l.id}`),[a]);return t.jsxs("div",{className:h,...n,ref:r,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Ie.displayName="CheckboxQuestion";const Ae=c.memo(Ie),Ds=({children:s,setCurrentIndex:e,sectionRefs:n,rootSelector:r,offset:a})=>{const d=ze({sectionRefs:n,rootSelector:r,offset:a});return c.useEffect(()=>{e(d.currentElementIndexInViewport+1)},[d]),s},Ys=({setCurrentQuestionNumber:s})=>{const e=w(u=>u.testQuestion.questions),n=w(u=>u.testResult.isTestFininshed),r=w(u=>u.currCourse.course),{shuffleAnswer:a,questionCount:d}=w(u=>u.testConfig),f=y(),h=c.useRef([]),[m,o]=c.useState(-60);c.useEffect(()=>{window.innerHeight!==0&&o(-60-window.innerHeight/4)},[window.innerHeight]),c.useEffect(()=>{h.current.length!==e.length&&(h.current=Array(e.length).fill(null).map((u,i)=>h.current[i]||c.createRef()))},[e]),c.useEffect(()=>{if(n)return;f(B([])),(async()=>{const i=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),g=JSON.parse(i).map(T=>new J(T)),C=x(g);l(C),f(B(C))})()},[n]);const l=u=>{u.forEach(i=>{a&&i.shuffleable&&(i.answer_option=k(i.answer_option))})},x=u=>{const i=k(u);return i.sort((g,C)=>g.cdr-C.cdr),d==="all"||Number.isNaN(Number.parseInt(d))?i:i.slice(0,Number.parseInt(d))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer",children:t.jsx(Ds,{sectionRefs:h.current,offset:m,setCurrentIndex:s,children:e.map((u,i)=>u.question_type==="radio"?t.jsx(Ne,{ref:h.current[i],question:u,id:`questionNumber_${i+1}`,number:i+1},u.id):t.jsx(Ae,{ref:h.current[i],question:u,id:`questionNumber_${i+1}`,number:i+1},u.id))})})},Zs=({setHidePopup:s})=>{const e=w(o=>o.currSubject.subject),n=w(o=>o.testQuestion.questions),r=w(o=>o.testResult),a=y(),d=H("screen and (max-width: 768px)"),f=()=>{!r.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(a(me()),a(ee()),a(X()))},h=()=>{a(Z(!1)),a(ee()),a(X())},m=()=>{const l=Ps.getState().userAnswer.answers;let x=0;n.forEach(u=>{const i=JSON.stringify(u.correct_answer.sort()),g=JSON.stringify(l[u.id]&&[...l[u.id]].sort());i===g?(x++,a(Ls(u.id))):a(Ms(u.id));const C=parseFloat((x/n.length*10).toFixed(2));a($s(C))}),a(Z(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(We,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!d&&t.jsx(I,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:r.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:h,children:t.jsx(Je,{})})}),t.jsx(I,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",r.score]}),t.jsxs("div",{children:["Kết quả: ",r.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(I,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:m,children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(I,{children:t.jsx(ae,{})})]})},et=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:r,correctAnswers:a}=w(m=>m.testResult),d=w(m=>m.testQuestion.questions),[f,h]=c.useState("");return c.useEffect(()=>{e(!r),n<5?h("lowScore"):n<8&&h("mediumScore")},[r]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${f}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",a.length,"/",d.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},st=({currentQuestionNumber:s})=>{const e=w(o=>o.testQuestion.questions),n=w(o=>o.testResult.isTestFininshed),r=w(o=>o.currCourse.course),{shuffleAnswer:a,questionCount:d}=w(o=>o.testConfig),f=y();c.useEffect(()=>{if(n)return;f(B([])),(async()=>{const l=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),x=JSON.parse(l).map(i=>new J(i)),u=m(x);h(u),f(B(u))})()},[n]);const h=o=>{o.forEach(l=>{a&&l.shuffleable&&(l.answer_option=k(l.answer_option))})},m=o=>{const l=k(o);return l.sort((x,u)=>x.cdr-u.cdr),d==="all"||Number.isNaN(Number.parseInt(d))?l:l.slice(0,Number.parseInt(d))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((o,l)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(Ne,{question:o,number:l+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(Ae,{question:o,number:l+1})},o.id))})},Hs=({currentIndex:s,questionNumbers:e})=>{const r=c.useRef(null),a=c.useRef(null),[d,f]=c.useState(0),[h,m]=c.useState(0);return c.useEffect(()=>{if(a.current&&r.current){const o=r.current.clientWidth,{defaultWidth:l,offsetFromCenter:x}=zs(a.current,o);f(l),m(x)}},[]),c.useEffect(()=>{if(!(!d||!h)&&a.current&&r.current){const o=s-1+2,l=a.current.querySelectorAll(".QuestionNumberIndicatorItem"),x=l[o];l.forEach((u,i)=>{u.classList.remove("neighbour","current"),i===o&&u.classList.add("current"),Math.abs(i-o)===1&&u.classList.add("neighbour")}),x&&(a.current.style.transform=`translateX(${-(d*o)+h}px)`)}},[s,d,h]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:r,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:a,children:t.jsx(Oe,{questionNumbers:e,fakeItemCount:2})})})},Oe=c.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=r=>Array(e).fill(0).map((a,d)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:a},d+r));return t.jsxs(t.Fragment,{children:[n(-e),s.map(r=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:r},r)),n(s.length+1)]})});Oe.displayName="QuestionNumberIndicatorList";const zs=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",s.appendChild(n);const r=U(n);n.classList.add("neighbour");const a=U(n);n.classList.remove("neighbour"),n.classList.add("current");const d=U(n),f=a-r,h=(e-d)/2-f;return s.removeChild(n),{defaultWidth:r,neighborWidth:a,currentWidth:d,offsetFromCenter:h}},U=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},tt=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const n=w(p=>p.theme.theme),r=w(p=>p.userAnswer.answers),a=w(p=>p.testQuestion.questions),{correctAnswers:d,wrongAnswers:f}=w(p=>p.testResult),{questionCount:h,showQuestionByPage:m}=w(p=>p.testConfig),o=h!=="all"?parseInt(h):a.length,l=c.useMemo(()=>[...Array(o).keys()].map(p=>p+1),[o]),[x,u]=c.useState(null),i=!!x,g=p=>{u(p.currentTarget)},C=()=>{u(null)},T=p=>{let j="QuestionListMenuItem";try{const N=a[p-1];N instanceof J&&(!r||r&&!r[N==null?void 0:N.id]?j+=" unanswer":d.includes(N==null?void 0:N.id)?j+=" correct":f.includes(N==null?void 0:N.id)&&(j+=" incorrect"))}catch{console.log(`Question number ${p} does not exists`)}return p===s&&(j+=" selected"),j},_=p=>{m?(e(p),C()):D(p)},v=p=>{const j=Math.min(s+1,o);s>=o-1&&p.currentTarget.blur(),m?e(j):D(j)},b=p=>{s<=2&&p.currentTarget.blur();const j=Math.max(s-1,1);m?e(j):D(j)};return t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":i?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:g,children:t.jsx(se,{className:"icon",size:16})}),t.jsx(qe,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:x,open:i,onClose:C,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":n,children:t.jsx("div",{className:"QuestionListMenuContent",children:l.map(p=>t.jsx("button",{className:T(p),onClick:()=>_(p),children:p},p))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:b,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ke,{className:"icon"})})]}),t.jsx(Hs,{currentIndex:s,questionNumbers:l}),t.jsxs("button",{className:"NextQuestionBtn",onClick:v,disabled:s===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Ve,{className:"icon"})})]})]})},D=(s,e=0)=>{const n=document.getElementById(`questionNumber_${s}`);if(!n)return;const d=n.offsetTop-60-20-e;window.scroll({top:d,behavior:"smooth"})};export{Vs as C,qs as N,Ks as S,Zs as T,st as a,Ys as b,et as c,tt as d,$ as e,P as l,Ps as s,Xs as u};
