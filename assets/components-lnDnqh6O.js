var os=Object.defineProperty;var is=(s,e,r)=>e in s?os(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var C=(s,e,r)=>is(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as g,a as _,M as as,b as cs,r as l,d as re,F as we,e as ls,i as us,f as ne,P as ds,g as hs,A as ps,$ as fs,s as ge,O as xe,S as be,h as G,C as H,k as ms,l as je,m as ws,p as D,n as M,R as Se,B as gs,o as xs,q as bs,t as Ce,D as js,v as Ss,w as Cs,x as Ns,y as z,T as ys,z as Is,E as _s,G as vs,H as As}from"./vendor-DdK7EXRB.js";const Q=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Qs=()=>{let s=localStorage.getItem("theme");return s||(s="dark",Ne(s)),s},Ne=s=>{localStorage.setItem("theme",s)},Os={theme:Qs()},ye=O({name:"theme",initialState:Os,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",Ne(s.theme)}}}),Ts=ye.reducer,{switchTheme:Rs}=ye.actions,Ie=()=>{const s=g(r=>r.theme.theme),e=_();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Rs()),children:s=="light"?t.jsx(as,{size:"24px",style:{background:"#00000000"}}):t.jsx(cs,{size:"24px",style:{background:"#00000000"}})})},Es={sidebarOpen:!1},_e=O({name:"sidebarOpen",initialState:Es,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ks=_e.reducer,{toggleSidebar:ve,setIsSidebarOpen:$s}=_e.actions,Tt=()=>{const s=g(p=>p.currSubject.subject),[e,r]=l.useState(!1),o=g(p=>p.sidebarOpen.sidebarOpen),h=re("screen and (max-width: 768px)"),u=_();return l.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>u(ve()),disabled:e,children:t.jsx(we,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!h&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx(ls,{color:"var(--secondary-text-color)"})}),t.jsx(Q,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(Q,{children:t.jsx(Ie,{})})]})};class Ae{constructor(e){C(this,"id");C(this,"name");C(this,"subject_id");C(this,"_questions");C(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ds=new URL(""+new URL("sql-wasm-C1U8OeUW.wasm",import.meta.url).href,import.meta.url).toString(),$=class ${constructor(){}static async getInstance(){if(!$.instance&&(await $.initialize(),!$.instance))throw new Error("Failed to initialize the database");return $.instance}static async initialize(){const e=us({locateFile:()=>Ds}),o=(await fetch("/database.sqlite3")).arrayBuffer(),[h,u]=await Promise.all([e,o]);$.instance=new h.Database(new Uint8Array(u))}};C($,"instance",null);let se=$;const T=async s=>{const e=await se.getInstance();try{const r=e.prepare(s),o=[];for(;r.step();)o.push(r.getAsObject());return r.free(),o}catch(r){throw console.error("Error executing query:",r,"Query:",s),r}},Ms=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new Ae(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Fs=async()=>{const s=localStorage.getItem("CourseId");if(s){const e=await Ms(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},X=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Fs();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Bs={course:null,loading:!1,error:null},Qe=O({name:"currCourse",initialState:Bs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(X.pending,e=>{e.loading=!0,e.error=null}).addCase(X.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(X.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ls=Qe.reducer,{setCurrCourse:Oe}=Qe.actions,Ps=({children:s,...e})=>{const[r,o]=l.useState(!1),h=_(),u=re("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const p=()=>{h(Oe(e.course)),u&&h($s(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:p,children:[t.jsx(ds,{strokeWidth:"70px",className:"icon"})," ",s]})})};class Te{constructor(e){C(this,"id");C(this,"name");C(this,"semester_id");Object.assign(this,e)}}const Us=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new Te(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Hs=async()=>{const s=localStorage.getItem("SubjectId");if(s){const e=await Us(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},Y=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Hs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Gs={subject:null,loading:!1,error:null},Re=O({name:"currSubject",initialState:Gs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(Y.pending,e=>{e.loading=!0,e.error=null}).addCase(Y.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(Y.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),zs=Re.reducer,{setCurrSubject:Ws}=Re.actions,Js=({subject:s})=>{const e=g(n=>n.currSubject.subject),r=g(n=>n.currCourse.course),[o,h]=l.useState(!1),[u,p]=l.useState(!1),[a,m]=l.useState([]),f=`SidebarGroupItem ${o?"selected":""} ${u?"expanded":""}`,c=_();l.useEffect(()=>{h((e==null?void 0:e.id)===s.id),p((e==null?void 0:e.id)===s.id)},[e]),l.useEffect(()=>{(async()=>{const w=(await T(`select *
        from Course
        where subject_id = ${s.id}`)).map(b=>new Ae(b));w&&m(w)})()},[]);const d=()=>{(e==null?void 0:e.id)!==s.id&&c(Oe(null)),c(Ws(s)),p(n=>!n)};return t.jsxs("li",{className:f,children:[t.jsx("button",{onClick:d,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(hs,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(ps,{height:u?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:a.map((n,i)=>t.jsx(Ps,{currCourse:r,course:n,children:n.name},i))})})]})};class oe{constructor(e){C(this,"id");C(this,"name");Object.assign(this,e)}}const Vs=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new oe(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Ks=async()=>{const s=localStorage.getItem("SemesterId");if(s){const e=await Vs(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},Z=ne("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Ks();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Xs={semester:null,loading:!1,error:null},Ee=O({name:"currSemester",initialState:Xs,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(Z.pending,e=>{e.loading=!0,e.error=null}).addCase(Z.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(Z.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ys=Ee.reducer,{setCurrSemester:ce}=Ee.actions,J=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(fs,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Zs=ge(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Rt=()=>{const s=g(c=>c.sidebarOpen.sidebarOpen),e=g(c=>c.currSemester.semester),[r,o]=l.useState([]),[h,u]=l.useState([]),[p,a]=l.useState([]),m=_();l.useEffect(()=>{(async()=>{const n=(await T("select * from Subject")).map(b=>new Te(b));o(n);const w=(await T("select * from Semester")).map(b=>new oe(b));u(w)})()},[]),l.useEffect(()=>{const c=e?r.filter(d=>d.semester_id===e.id):r;a(c)},[e,r]);const f=c=>{const d=Number(c.target.value);if(d===-1)m(ce(null));else{const n=h.find(i=>i.id===d);n&&m(ce(n))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!h?t.jsx(J,{}):t.jsxs(t.Fragment,{children:[t.jsxs(be,{name:"semester",value:e&&h.length>0?e.id:-1,onChange:f,input:t.jsx(Zs,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(G,{value:-1,children:"Tất cả"}),h.map(c=>t.jsx(G,{value:c.id,children:c.name},c.id))]}),!p||p.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:p.map(c=>t.jsx(Js,{subject:c},c.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>m(ve())})]})};class V{constructor(e){C(this,"id");C(this,"_question_direction");C(this,"question_type");C(this,"_answer_option");C(this,"_correct_answer");C(this,"input_correct_answer");C(this,"cdr");C(this,"group_id");C(this,"_shuffleable");C(this,"number_answer_correct");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const qs={activeTest:!1},ke=O({name:"activeTest",initialState:qs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),et=ke.reducer,{toggleActiveTest:$e}=ke.actions,st=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",tt=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",rt=()=>localStorage.getItem("showQuestionByPageOption")==="true",nt={shuffleAnswer:st(),showAnswerOnChosen:tt(),showQuestionByPage:rt(),questionCount:"15"},De=O({name:"testConfig",initialState:nt,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),ot=De.reducer,{toggleShuffleAnswer:it,setQuestionCount:le,toggleShowAnswerOnChosen:at,toggleShowQuestionByPage:ct}=De.actions,F={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},te=s=>{const e=[],r={};return s.forEach(o=>{o.question_type==="grouping"&&o.group_id||o.question_type==="group-input"&&o.group_id||o.question_type==="drag_drop"&&o.group_id||o.question_type==="group-radio"&&o.group_id?r[o.group_id]=[...r[o.group_id]||[],o]:e.push(o)}),{filteredQuestions:e,groupedQuestions:r}},lt=ge(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Et=()=>{var y,x,v;const s=g(S=>S.theme.theme),e=g(S=>S.sidebarOpen.sidebarOpen),r=g(S=>S.currSubject),o=g(S=>S.currCourse),{shuffleAnswer:h,showAnswerOnChosen:u,showQuestionByPage:p}=g(S=>S.testConfig),[a,m]=l.useState({semester:null,loading:!1}),[f,c]=l.useState([]),[d,n]=l.useState(""),[i,w]=l.useState({value:0,loading:!1}),[b,I]=l.useState({value:0,loading:!1}),N=_();l.useEffect(()=>{(()=>{if(!o.course)return;const A=[10,15,20,30,40,50,60,80,100,150],R=[],B=o.course.question_per_test;A.includes(B)||(A.push(B),A.sort()),A.forEach(E=>{!o.course||E>=b.value||R.push(t.jsx(G,{value:E,sx:{fontSize:14},children:E},E))}),R.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),c(R)})()},[o.course,b.value]),l.useEffect(()=>{const S=async()=>{var R;m({...a,loading:!0});const A=await T(`select *
        from Semester
        where id = ${(R=r.subject)==null?void 0:R.semester_id}`);m({semester:new oe(A[0]),loading:!1})};r.subject&&S()},[r.subject]),l.useEffect(()=>{if(o.course){const A=o.course.question_per_test;n(A.toString()),N(le(A.toString()))}(async()=>{if(!o.course)return;const R=(await T(`
        SELECT *
        FROM Question
        WHERE id IN (${o.course.questions.join(",")})
      `)).map(k=>new V(k)),{filteredQuestions:B,groupedQuestions:E}=te(R),rs=B.length;let ae=B.filter(k=>!k.correct_answer.some(L=>L<0)&&(k.question_type==="radio"||k.question_type==="checkbox")).length;for(const k in E)if(Object.prototype.hasOwnProperty.call(E,k)){let L=!0;E[k].forEach(K=>{K.question_type!=="group-input"?K.correct_answer.some(ns=>ns<0)&&(L=!1):K.input_correct_answer||(L=!1)}),L&&ae++}w({value:ae,loading:!1}),I({value:rs,loading:!1})})()},[o.course]);const j=S=>{const A=S.target.value;n(A),N(le(A))};return a.loading||o.loading||r.loading||i.loading||b.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(J,{})}):!r.subject||!o.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(y=o.course)==null?void 0:y.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(x=r.subject)==null?void 0:x.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(v=a.semester)==null?void 0:v.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:b.value})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:i.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>N(it()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>N(at()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:p,onClick:()=>N(ct()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(ms,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(be,{value:f.length>1?d:"",onChange:j,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(lt,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:f})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>N($e()),children:[t.jsx(je,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},ut={questions:[],filteredQuestions:[],groupedQuestions:{}},Me=O({name:"testQuestion",initialState:ut,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload);const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o},setTestQuestion:(s,e)=>{s.questions=e.payload;const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o}}}),dt=Me.reducer,{addTestQuestion:kt,setTestQuestion:W}=Me.actions,ht={answers:{},input_answers:{}},Fe=O({name:"userAnswer",initialState:ht,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(o=>!isNaN(o));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),pt=Fe.reducer,{addUserAnswer:ie,removeUserAnswer:ft,updateUserAnswer:mt,setInputAnswer:wt,removeInputAnswer:$t,removeAllUserAnswerById:Be,resetUserAnwser:ue}=Fe.actions,de={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},Le=O({name:"testResult",initialState:de,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>de}}),gt=Le.reducer,{addCorrectAnswer:he,addWrongAnswer:pe,setIsTestFinished:fe,setScore:xt,resetTestResut:me}=Le.actions,Pe=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),bt=Pe.reducer,{setCurrentQuestion:P}=Pe.actions,jt=ws({reducer:{theme:Ts,sidebarOpen:ks,currSubject:zs,currCourse:Ls,currSemester:Ys,activeTest:et,testQuestion:dt,userAnswer:pt,testResult:gt,testConfig:ot,testNavigation:bt},middleware:s=>s({serializableCheck:!1})}),Dt=()=>_(),Ue=l.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:o,setSelectedValue:h})=>{const[u,p]=l.useState(""),a=g(i=>i.testResult.isTestFininshed),m=g(i=>i.userAnswer.answers[e.id]),f=g(i=>i.testConfig.showAnswerOnChosen),c=_(),d=l.useMemo(()=>{const i=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(i,F)},[s.value]);l.useEffect(()=>{if(!a)return;const i=Number.parseInt(s.id);if(!m||m.length==0){e.correct_answer.includes(i)&&p(" unanswer");return}m&&m.includes(i)&&(e.correct_answer.includes(i)||p(" incorrect")),e.correct_answer.includes(i)&&p(" correct")},[a]),l.useEffect(()=>{if(!f||(p(""),!m||m.length==0))return;const i=Number.parseInt(s.id);m&&m.includes(i)&&(e.correct_answer.includes(i)||p(" incorrect")),e.correct_answer.includes(i)&&p(" correct")},[f,m]);const n=i=>{a||(h(i.target.value),c(Be(e.id)),c(ie({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Se,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:n,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});Ue.displayName="RadioAnswerOption";const St=({number:s,id:e,directionText:r,haveAnswer:o,children:h})=>{const u=l.useMemo(()=>{const p=D.sanitize(r,{USE_PROFILES:{html:!0}});return M(p,F)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!o&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:u}),h&&t.jsx("div",{className:"QuestionContainerAdditional",children:h})]})},U=l.memo(St),He=l.forwardRef(({question:s,number:e,...r},o)=>{const[h,u]=l.useState("0"),p=l.useMemo(()=>s.correct_answer.some(c=>c>-1),[s.correct_answer]),a=p?"RadioQuestion":"RadioQuestion noAnswer",m=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},f=l.useCallback((c,d)=>t.jsx(Ue,{answerOption:c,question:s,answerOptionBullet:m(d),selectedValue:h,setSelectedValue:u},`${s.id}_${c.id}`),[h]);return t.jsxs("div",{className:a,...r,ref:o,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(f)})]})});He.displayName="RadioQuestion";const Ge=l.memo(He),ze=l.memo(({answerOption:s,question:e,answerOptionBullet:r,index:o,selectedValue:h,setSelectedValue:u})=>{const[p,a]=l.useState(""),m=g(w=>w.testResult.isTestFininshed),f=g(w=>w.userAnswer.answers[e.id]),c=g(w=>w.testConfig.showAnswerOnChosen),d=_(),n=l.useMemo(()=>{const w=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(w,F)},[s.value]);l.useEffect(()=>{if(!m)return;const w=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(w)&&a(" unanswer");return}f&&f.includes(w)&&(e.correct_answer.includes(w)||a(" incorrect")),e.correct_answer.includes(w)&&a(" correct")},[m]),l.useEffect(()=>{if(!c||(a(""),!f||f.length==0))return;const w=Number.parseInt(s.id);f&&f.includes(w)&&(e.correct_answer.includes(w)||a(" incorrect")),e.correct_answer.includes(w)&&a(" correct")},[c,f]);const i=()=>{m||(h[o]?d(ft({id:e.id,answer:s.id})):d(ie({id:e.id,answer:s.id})),u(h.map((w,b)=>b==o?!w:w)))};return t.jsxs("div",{className:`CheckboxAnswerOption${p}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(H,{name:`question_${e.id}_${o}`,checked:h[o],onChange:i,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:n})]})]})});ze.displayName="CheckboxAnswerOption";const We=l.forwardRef(({question:s,number:e,...r},o)=>{const[h,u]=l.useState(Array(s.answer_option.length).fill(!1)),p=l.useMemo(()=>s.correct_answer.some(c=>c>-1),[s.correct_answer]),a=p?"CheckboxQuestion":"CheckboxQuestion noAnswer",m=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},f=l.useCallback((c,d)=>t.jsx(ze,{answerOption:c,question:s,answerOptionBullet:m(d),index:d,selectedValue:h,setSelectedValue:u},`${s.id}_${c.id}`),[h]);return t.jsxs("div",{className:a,...r,ref:o,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p,children:t.jsxs("span",{className:"NumberCorrectAnswer",children:[t.jsx(gs,{className:"NumberCorrectAnswerIcon"}),"Sinh viên chọn ",s.number_answer_correct," phương án đúng nhất"]})}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(f)})]})});We.displayName="CheckboxQuestion";const Je=l.memo(We),Ve=l.memo(({answerOption:s,question:e})=>{const r=l.useMemo(()=>{const m=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(m,F)},[s.value]),{attributes:o,listeners:h,setNodeRef:u,transform:p}=xs({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id}}),a={transform:bs.Translate.toString(p)};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:u,...h,...o,style:a,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:r})})});Ve.displayName="DragDropAnswerOption";const Ct=({question:s,index:e,selectedAnswers:r,children:o})=>{const{setNodeRef:h,isOver:u}=Ce({id:s.id}),[p,a]=l.useState(""),m=g(i=>i.testResult.isTestFininshed),f=g(i=>i.userAnswer.answers[s.id]),c=g(i=>i.testConfig.showAnswerOnChosen),d=_(),n=l.useMemo(()=>{const i=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return M(i,F)},[s.question_direction]);return l.useEffect(()=>{if(!m)return;if(!f||f.length==0){s.correct_answer.length>0&&a(" unanswer");return}const i=JSON.stringify(s.correct_answer.sort()),w=JSON.stringify(f&&[...f].sort());a(i===w?" correct":" incorrect")},[m]),l.useEffect(()=>{if(!c||(a(""),!f||f.length==0))return;const i=JSON.stringify(s.correct_answer.sort()),w=JSON.stringify(f&&[...f].sort());a(i===w?" correct":" incorrect")},[c,f]),l.useEffect(()=>{m||f===void 0&&r.length===0||d(mt({id:s.id,answers:r}))},[r]),t.jsxs("div",{className:`DragDropInputQuestion${p}`,children:[t.jsx("span",{className:"DragDropInputTextDirection",children:e?`${e}) ${n}`:n}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:h,children:o}),t.jsx("p",{className:"DragDropInputMessage",style:u||o!=null&&o.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]})},Ke=l.forwardRef(({dragQuestion:s,inputQuestions:e,number:r,...o},h)=>{const[u,p]=l.useState({[s.id]:s.answer_option.map(n=>Number(n.id))}),a=s.question_type==="grouping",m=l.useMemo(()=>{let n=!0;return e.forEach(i=>{i.correct_answer.some(w=>w>-1)||(n=!1)}),n},[e]),f=m?"DragDropQuestion":"DragDropQuestion noAnswer",c=n=>{const{active:i,over:w}=n;if(!w||!i.data.current)return;const b=Number(i.data.current.answerOptionId),I=w.id;p(N=>{const j={...N};j[I]||(j[I]=[]);let y=-1;for(const x in j)if(Object.prototype.hasOwnProperty.call(j,x)&&j[x].includes(b)){y=Number(x);break}if(y!==-1)if(!a&&I!==s.id&&j[I]&&j[I].length>=1){const x=j[I][0];j[I]=[b],j[y]=j[y].filter(v=>v!==b),j[y]=[...j[y],x]}else j[y]=j[y].filter(x=>x!==b),j[I]=[...j[I],b];return j})},d=l.useCallback(n=>t.jsx(Ve,{answerOption:n,question:s},`${s.id}_${n.id}`),[s]);return t.jsx("div",{className:f,...o,ref:h,children:t.jsxs(js,{onDragEnd:c,modifiers:[Ss],children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:m,children:t.jsx(Nt,{questionId:s.id,children:s.answer_option.filter(n=>u[s.id].includes(Number(n.id))).map(d)})}),t.jsx("div",{className:`DragDropInputQuestions ${a?"card":"row"}`,children:e.map((n,i)=>t.jsx(Ct,{question:n,index:a?i+1:void 0,selectedAnswers:u[n.id]||[],children:u[n.id]&&s.answer_option.filter(w=>u[n.id].includes(Number(w.id))).map(d)},n.id))})]})})}),Nt=({children:s,questionId:e})=>{const{setNodeRef:r}=Ce({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};Ke.displayName="DragDropQuestion";const Xe=l.memo(Ke),yt=({question:s,index:e})=>{const[r,o]=l.useState(""),[h,u]=l.useState(""),p=g(i=>i.testResult.isTestFininshed),a=g(i=>i.userAnswer.input_answers[s.id]),m=g(i=>i.testConfig.showAnswerOnChosen),f=_(),c=l.useMemo(()=>{const i=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return M(i,F)},[s.question_direction]);l.useEffect(()=>{var i;if(p){if(!a){o(" unanswer");return}((i=s==null?void 0:s.input_correct_answer)==null?void 0:i.toLowerCase())===a.toLowerCase()?o(" correct"):o(" incorrect")}},[p]),l.useEffect(()=>{var i;m&&(o(""),a&&(((i=s==null?void 0:s.input_correct_answer)==null?void 0:i.toLowerCase())===a.toLowerCase()?o(" correct"):o(" incorrect")))},[m,a]);const d=l.useCallback(Cs.debounce(i=>{f(wt({id:s.id,answer:i}))},350),[f,s.id]),n=i=>{if(p)return;const w=i.target.value;u(w),d(w)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${c}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:h,onInput:n,spellCheck:!1})})]})},Ye=l.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},h)=>{const u=l.useMemo(()=>!e.some(a=>a.input_correct_answer===null),[e]),p=u?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:h,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((a,m)=>t.jsx(yt,{question:a,index:m+1},a.id))})]})});Ye.displayName="GroupInputQuestion";const Ze=l.memo(Ye),qe=l.memo(({answerOption:s,question:e,selectedValue:r,setSelectedValue:o})=>{const[h,u]=l.useState(""),p=g(n=>n.testResult.isTestFininshed),a=g(n=>n.userAnswer.answers[e.id]),m=g(n=>n.testConfig.showAnswerOnChosen),f=_(),c=l.useMemo(()=>{const n=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(n,F)},[s.value]);l.useEffect(()=>{if(!p)return;const n=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(n)&&u(" unanswer");return}a&&a.includes(n)&&(e.correct_answer.includes(n)||u(" incorrect")),e.correct_answer.includes(n)&&u(" correct")},[p]),l.useEffect(()=>{if(!m||(u(""),!a||a.length==0))return;const n=Number.parseInt(s.id);a&&a.includes(n)&&(e.correct_answer.includes(n)||u(" incorrect")),e.correct_answer.includes(n)&&u(" correct")},[m,a]);const d=n=>{p||(o(n.target.value),f(Be(e.id)),f(ie({id:e.id,answer:s.id})))};return t.jsxs("label",{className:`GroupRadioAnswerOption${h}`,children:[t.jsx(Se,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:d,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:c})]})});qe.displayName="GroupRadioAnswerOption";const It=({question:s,index:e})=>{const[r,o]=l.useState("-1"),h=l.useMemo(()=>{const u=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return M(u,F)},[s.question_direction]);return t.jsxs("div",{className:"GroupRadioInputQuestion",children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupRadioInputTextDirection",children:`${e}) ${h}`}),t.jsx("div",{className:"GroupRadioInputContainer",children:s.answer_option.map(u=>t.jsx(qe,{answerOption:u,question:s,selectedValue:r,setSelectedValue:o},u.id))})]})},es=l.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},h)=>{const u=l.useMemo(()=>{let a=!0;return e.forEach(m=>{m.correct_answer.some(f=>f>-1)||(a=!1)}),a},[e]),p=u?"GroupRadioQuestion":"GroupRadioQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:h,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"GroupRadioInputQuestions",children:e.map((a,m)=>t.jsx(It,{question:a,index:m+1},a.id))})]})});es.displayName="GroupRadioQuestion";const ss=l.memo(es),_t=({children:s,sectionRefs:e,rootSelector:r,offset:o,as:h,...u})=>{const p=Ns({sectionRefs:e,rootSelector:r,offset:o}),a=g(c=>c.testNavigation.currentQuestionNumber),m=_();l.useEffect(()=>{p.currentElementIndexInViewport===-1||p.currentElementIndexInViewport+1===a||m(P(p.currentElementIndexInViewport+1))},[p]);const f=h||"div";return t.jsx(f,{...u,children:s})},Mt=()=>{const s=g(n=>n.testQuestion.filteredQuestions),e=g(n=>n.testQuestion.groupedQuestions),r=g(n=>n.testResult.isTestFininshed),o=g(n=>n.currCourse.course),{shuffleAnswer:h,questionCount:u}=g(n=>n.testConfig),p=_(),a=l.useRef([]),[m,f]=l.useState(-60);l.useEffect(()=>{window.innerHeight!==0&&f(-60-window.innerHeight/4)},[window.innerHeight]),l.useMemo(()=>{a.current.length!==s.length&&(a.current=Array(s.length).fill(null).map((n,i)=>a.current[i]||l.createRef()))},[s.length]),l.useEffect(()=>{if(r)return;p(W([])),(async()=>{const w=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`)).map(I=>new V(I)),b=d(w);c(b),p(W(b))})()},[r]);const c=n=>{n.forEach(i=>{h&&i.shuffleable&&(i.answer_option=z(i.answer_option))})},d=n=>{const i=z(n);return i.sort((w,b)=>w.cdr-b.cdr),u==="all"||Number.isNaN(Number.parseInt(u))?i:i.slice(0,Number.parseInt(u))};return!s||s.length==0||!a.current?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx(_t,{as:"div",className:"TestContainer",sectionRefs:a.current,offset:m,children:s.map((n,i)=>n.question_type==="radio"?t.jsx(Ge,{ref:a.current[i],question:n,id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="drag_drop"||n.question_type==="grouping"?t.jsx(Xe,{ref:a.current[i],dragQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="group-input"?t.jsx(Ze,{ref:a.current[i],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="group-radio"?t.jsx(ss,{ref:a.current[i],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):t.jsx(Je,{ref:a.current[i],question:n,id:`questionNumber_${i+1}`,number:i+1},n.id))})},Ft=({setHidePopup:s})=>{const e=g(d=>d.currSubject.subject),r=g(d=>d.testQuestion.filteredQuestions),o=g(d=>d.testQuestion.groupedQuestions),h=g(d=>d.testResult),u=_(),p=re("screen and (max-width: 768px)"),a=()=>{!h.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(u($e()),u(me()),u(ue()))},m=()=>{u(fe(!1)),u(me()),u(ue())},f=(d,n)=>Array.isArray(d)&&Array.isArray(n)?JSON.stringify(d.sort())===JSON.stringify(n.sort()):typeof d=="string"&&typeof n=="string"?d.toLowerCase()===n.toLowerCase():!1,c=()=>{const d=jt.getState(),n=d.userAnswer.answers,i=d.userAnswer.input_answers;let w=0;r.forEach(b=>{if(o[b.id]){let N=!0;o[b.id].forEach(j=>{if(j.question_type!=="group-input"){const y=n[j.id]||[];f(y,j.correct_answer)||(N=!1)}else{const y=i[j.id]||null;!y||!j.input_correct_answer?N=!1:f(y,j.input_correct_answer)||(N=!1)}}),N?(w++,u(he(b.id))):u(pe(b.id))}else{let N=!0;if(b.question_type!=="group-input"){const j=n[b.id]||[];f(j,b.correct_answer)||(N=!1)}else{const j=i[b.id]||null;!j||!b.input_correct_answer?N=!1:f(j,b.input_correct_answer)||(N=!1)}N?(w++,u(he(b.id))):u(pe(b.id))}const I=parseFloat((w/r.length*10).toFixed(2));u(xt(I))}),u(fe(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:a,children:t.jsx(ys,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!p&&t.jsx(Q,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:h.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:m,children:t.jsx(Is,{})})}),t.jsx(Q,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(d=>!d),children:[t.jsxs("div",{children:["Điểm: ",h.score]}),t.jsxs("div",{children:["Kết quả: ",h.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(Q,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:c,children:[t.jsx(je,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(Q,{children:t.jsx(Ie,{})})]})},Bt=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:o,correctAnswers:h}=g(m=>m.testResult),u=g(m=>m.testQuestion.filteredQuestions),[p,a]=l.useState("");return l.useEffect(()=>{e(!o),r<5?a("lowScore"):r<8?a("mediumScore"):a("")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${p}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",h.length,"/",u.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Lt=()=>{const s=g(c=>c.testQuestion.filteredQuestions),e=g(c=>c.testQuestion.groupedQuestions),r=g(c=>c.testResult.isTestFininshed),o=g(c=>c.currCourse.course),h=g(c=>c.testNavigation.currentQuestionNumber),{shuffleAnswer:u,questionCount:p}=g(c=>c.testConfig),a=_();l.useEffect(()=>{if(r||a(P(1)),r)return;a(W([])),(async()=>{const n=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`)).map(w=>new V(w)),i=f(n);m(i),a(W(i))})()},[r]);const m=c=>{c.forEach(d=>{u&&d.shuffleable&&(d.answer_option=z(d.answer_option))})},f=c=>{const d=z(c);return d.sort((n,i)=>n.cdr-i.cdr),p==="all"||Number.isNaN(Number.parseInt(p))?d:d.slice(0,Number.parseInt(p))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((c,d)=>c.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Ge,{question:c,number:d+1})},c.id):c.question_type==="drag_drop"?t.jsx("div",{className:"DragDropQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Xe,{dragQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):c.question_type==="group-input"?t.jsx("div",{className:"GroupInputQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Ze,{topicQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):c.question_type==="group-radio"?t.jsx("div",{className:"GroupRadioQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(ss,{topicQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Je,{question:c,number:d+1})},c.id))})},vt=({currentIndex:s,questionNumbers:e})=>{const o=l.useRef(null),h=l.useRef(null),[u,p]=l.useState(0),[a,m]=l.useState(0);return l.useEffect(()=>{if(h.current&&o.current){const f=o.current.clientWidth,{defaultWidth:c,offsetFromCenter:d}=At(h.current,f);p(c),m(d)}},[]),l.useEffect(()=>{if(!(!u||!a)&&h.current&&o.current){const f=(s!==-1?s:1)-1+2,c=h.current.querySelectorAll(".QuestionNumberIndicatorItem"),d=c[f];c.forEach((n,i)=>{n.classList.remove("neighbour","current"),i===f&&n.classList.add("current"),Math.abs(i-f)===1&&n.classList.add("neighbour")}),d&&(h.current.style.transform=`translateX(${-(u*f)+a}px)`)}},[s,u,a]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:o,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:h,children:t.jsx(ts,{questionNumbers:e,fakeItemCount:2})})})},ts=l.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=o=>Array(e).fill(0).map((h,u)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:h},u+o));return t.jsxs(t.Fragment,{children:[r(-e),s.map(o=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:o},o)),r(s.length+1)]})});ts.displayName="QuestionNumberIndicatorList";const At=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const o=q(r);r.classList.add("neighbour");const h=q(r);r.classList.remove("neighbour"),r.classList.add("current");const u=q(r),p=h-o,a=(e-u)/2-p;return s.removeChild(r),{defaultWidth:o,neighborWidth:h,currentWidth:u,offsetFromCenter:a}},q=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Pt=()=>{const s=g(x=>x.theme.theme),e=g(x=>x.userAnswer.answers),r=g(x=>x.testQuestion.filteredQuestions),{correctAnswers:o,wrongAnswers:h}=g(x=>x.testResult),{questionCount:u,showQuestionByPage:p}=g(x=>x.testConfig),a=g(x=>x.testNavigation.currentQuestionNumber),m=_(),f=u!=="all"?parseInt(u):r.length,c=l.useMemo(()=>[...Array(f).keys()].map(x=>x+1),[f]),[d,n]=l.useState(null),i=!!d,w=x=>{n(x.currentTarget)},b=()=>{n(null)},I=x=>{let v="QuestionListMenuItem";try{const S=r[x-1];S instanceof V&&(!e||e&&!e[S==null?void 0:S.id]?v+=" unanswer":o.includes(S==null?void 0:S.id)?v+=" correct":h.includes(S==null?void 0:S.id)&&(v+=" incorrect"))}catch{console.log(`Question number ${x} does not exists`)}return x===a&&(v+=" selected"),v},N=x=>{p?m(P(x)):ee(x),b()},j=x=>{const v=Math.min(a+1,f);a>=f-1&&x.currentTarget.blur(),p?m(P(v)):ee(v)},y=x=>{a<=2&&x.currentTarget.blur();const v=Math.max(a-1,1);p?m(P(v)):ee(v)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":i?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:w,children:t.jsx(we,{className:"icon",size:16})}),t.jsx(_s,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:d,open:i,onClose:b,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:c.map(x=>t.jsx("button",{className:I(x),onClick:()=>N(x),children:x},x))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:y,disabled:a<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(vs,{className:"icon"})})]}),t.jsx(vt,{currentIndex:a,questionNumbers:c}),t.jsxs("button",{className:"NextQuestionBtn",onClick:j,disabled:a===f,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(As,{className:"icon"})})]})]})},ee=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const u=r.offsetTop-60-20-e;window.scroll({top:u,behavior:"smooth"})};export{Et as C,Tt as N,Rt as S,Ft as T,Lt as a,Mt as b,Bt as c,Pt as d,se as e,X as f,Z as g,Y as l,jt as s,Dt as u};
