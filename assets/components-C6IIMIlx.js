var Te=Object.defineProperty;var ve=(s,e,n)=>e in s?Te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>ve(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as A,u as w,a as S,M as _e,b as Qe,r as a,d as D,F as ee,e as Re,f as ke,g as se,P as Be,h as Ee,A as Fe,$ as Me,s as Le,O as $e,C as R,i as Pe,S as Ue,k as te,l as K,m as De,p as H,n as W,R as He,o as We,q as B,T as ze,t as Je,v as qe,w as Ke,x as Ve}from"./vendor-DLRcHq6p.js";const I=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ge=()=>{let s=localStorage.getItem("theme");return s||(s="dark",ne(s)),s},ne=s=>{localStorage.setItem("theme",s)},Xe={theme:Ge()},re=A({name:"theme",initialState:Xe,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",ne(s.theme)}}}),Ye=re.reducer,{switchTheme:Ze}=re.actions,oe=()=>{const s=w(n=>n.theme.theme),e=S();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Ze()),children:s=="light"?t.jsx(_e,{size:"24px",style:{background:"#00000000"}}):t.jsx(Qe,{size:"24px",style:{background:"#00000000"}})})},es={sidebarOpen:!1},ie=A({name:"sidebarOpen",initialState:es,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ss=ie.reducer,{toggleSidebar:ae,setIsSidebarOpen:ts}=ie.actions,Ks=()=>{const s=w(u=>u.currSubject.subject),[e,n]=a.useState(!1),r=w(u=>u.sidebarOpen.sidebarOpen),i=D("screen and (max-width: 768px)"),h=S();return a.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[r]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>h(ae()),disabled:e,children:t.jsx(ee,{className:`BtnHamburgerIcon ${r?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!i&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx(Re,{color:"var(--secondary-text-color)"})}),t.jsx(I,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(I,{children:t.jsx(oe,{})})]})};class ce{constructor(e){C(this,"id");C(this,"name");C(this,"subject_id");C(this,"_questions");C(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const ns=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),rs=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),os=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let M=null;const is=async()=>(M||(M=await ke.createDbWorker([{from:"inline",config:{serverMode:"full",url:os,requestChunkSize:4096}}],ns.toString(),rs.toString())),M),O=async s=>{const n=await(await is()).db.query(s);return JSON.stringify(n)},as=async s=>{try{const e=await O(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ce(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},cs=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await as(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},L=se("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await cs();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ls={course:null,loading:!1,error:null},le=A({name:"currCourse",initialState:ls,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(L.pending,e=>{e.loading=!0,e.error=null}).addCase(L.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase(L.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),us=le.reducer,{setCurrCourse:ue}=le.actions,ds=({children:s,...e})=>{const[n,r]=a.useState(!1),i=S(),h=D("screen and (max-width: 768px)");a.useEffect(()=>{e.currCourse?r(e.currCourse.id==e.course.id):r(!1)},[e.currCourse]);const u=()=>{i(ue(e.course)),h&&i(ts(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:u,children:[t.jsx(Be,{strokeWidth:"70px",className:"icon"})," ",s]})})};class hs{constructor(e){C(this,"id");C(this,"name");C(this,"semester_id");Object.assign(this,e)}}const ms=async s=>{try{const e=await O(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new hs(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},fs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await ms(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},$=se("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await fs();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ps={subject:null,loading:!1,error:null},de=A({name:"currSubject",initialState:ps,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase($.pending,e=>{e.loading=!0,e.error=null}).addCase($.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase($.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),gs=de.reducer,{setCurrSubject:ws}=de.actions,xs=({subject:s})=>{const e=w(l=>l.currSubject.subject),n=w(l=>l.currCourse.course),[r,i]=a.useState(!1),[h,u]=a.useState(!1),[m,g]=a.useState([]),o=`SidebarGroupItem ${r?"selected":""} ${h?"expanded":""}`,c=S();a.useEffect(()=>{i((e==null?void 0:e.id)===s.id),u((e==null?void 0:e.id)===s.id)},[e]),a.useEffect(()=>{(async()=>{const f=await O(`select *
        from Course
        where subject_id = ${s.id}`),x=JSON.parse(f).map(N=>new ce(N));x&&g(x)})()},[]);const d=()=>{(e==null?void 0:e.id)!==s.id&&c(ue(null)),c(ws(s)),u(l=>!l)};return t.jsxs("li",{className:o,children:[t.jsx("button",{onClick:d,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(Ee,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(Fe,{height:h?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:m.map((l,f)=>t.jsx(ds,{currCourse:n,course:l,children:l.name},f))})})]})},F=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Me,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Vs=()=>{const s=w(i=>i.sidebarOpen.sidebarOpen),[e,n]=a.useState([]),r=S();return a.useEffect(()=>{(async()=>{const h=await O("select * from Subject");n(JSON.parse(h))})()},[]),t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!e||e.length==0?t.jsx(F,{}):t.jsx("ul",{children:e.map((i,h)=>t.jsx(xs,{subject:i},h))}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>r(ae())})]})},bs={activeTest:!1},he=A({name:"activeTest",initialState:bs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),js=he.reducer,{toggleActiveTest:me}=he.actions,Cs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",Ss=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Ns=()=>localStorage.getItem("showQuestionByPageOption")==="true",ys={shuffleAnswer:Cs(),showAnswerOnChosen:Ss(),showQuestionByPage:Ns(),questionCount:"15"},fe=A({name:"testConfig",initialState:ys,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Is=fe.reducer,{toggleShuffleAnswer:As,setQuestionCount:V,toggleShowAnswerOnChosen:Os,toggleShowQuestionByPage:Ts}=fe.actions,vs=Le($e)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Gs=()=>{var N,T,v,_;const s=w(b=>b.theme.theme),e=w(b=>b.sidebarOpen.sidebarOpen),n=w(b=>b.currSubject),r=w(b=>b.currCourse),{shuffleAnswer:i,showAnswerOnChosen:h,showQuestionByPage:u}=w(b=>b.testConfig),[m,g]=a.useState({semester:null,loading:!1}),[o,c]=a.useState([]),[d,l]=a.useState(""),f=S();a.useEffect(()=>{(()=>{if(!r.course)return;const p=[10,15,20,30,40,50,60,80,100,150],j=[],y=r.course.question_per_test;p.includes(y)||(p.push(y),p.sort()),p.forEach(Q=>{var q;!r.course||Q>=((q=r.course)==null?void 0:q.questions.length)||j.push(t.jsx(K,{value:Q,sx:{fontSize:14},children:Q},Q))}),j.push(t.jsx(K,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),c(j)})()},[r.course]),a.useEffect(()=>{const b=async()=>{var j;g({...m,loading:!0});const p=await O(`select *
        from Semester
        where id = ${(j=n.subject)==null?void 0:j.semester_id}`);g({semester:JSON.parse(p)[0],loading:!1})};n.subject&&b()},[n.subject]),a.useEffect(()=>{if(r.course){const b=r.course.question_per_test;l(b.toString()),f(V(b.toString()))}},[r.course]);const x=b=>{const p=b.target.value;l(p),f(V(p))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:m.loading||r.loading||n.loading?t.jsx(F,{}):n.subject&&r.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(N=r.course)==null?void 0:N.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(T=n.subject)==null?void 0:T.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(v=m.semester)==null?void 0:v.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(_=r.course)==null?void 0:_.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:i,onClick:()=>f(As()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>f(Os()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>f(Ts()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Pe,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Ue,{value:d,onChange:x,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(vs,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>f(me()),children:[t.jsx(te,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},_s={questions:[]},pe=A({name:"testQuestion",initialState:_s,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Qs=pe.reducer,{addTestQuestion:Xs,setTestQuestion:E}=pe.actions,Rs={answers:{}},ge=A({name:"userAnswer",initialState:Rs,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),ks=ge.reducer,{addUserAnswer:we,removeUserAnswer:Bs,removeAllUserAnswerById:Es,resetUserAnwser:G}=ge.actions,X={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},xe=A({name:"testResult",initialState:X,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>X}}),Fs=xe.reducer,{addCorrectAnswer:Ms,addWrongAnswer:Ls,setIsTestFinished:Y,setScore:$s,resetTestResut:Z}=xe.actions,be=A({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),Ps=be.reducer,{setCurrentQuestion:k}=be.actions,Us=De({reducer:{theme:Ye,sidebarOpen:ss,currSubject:gs,currCourse:us,activeTest:js,testQuestion:Qs,userAnswer:ks,testResult:Fs,testConfig:Is,testNavigation:Ps},middleware:s=>s({serializableCheck:!1})}),Ys=()=>S();class z{constructor(e){C(this,"id");C(this,"_question_direction");C(this,"question_type");C(this,"_answer_option");C(this,"_correct_answer");C(this,"cdr");C(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const J={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},je=a.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:r,setSelectedValue:i})=>{const[h,u]=a.useState(""),m=w(f=>f.testResult.isTestFininshed),g=w(f=>f.userAnswer.answers[e.id]),o=w(f=>f.testConfig.showAnswerOnChosen),c=S(),d=a.useMemo(()=>{const f=H.sanitize(s.value,{USE_PROFILES:{html:!0}});return W(f,J)},[s.value]);a.useEffect(()=>{if(!m)return;const f=Number.parseInt(s.id);if(!g||g.length==0){e.correct_answer.includes(f)&&u(" unanswer");return}g&&g.includes(f)&&(e.correct_answer.includes(f)||u(" incorrect")),e.correct_answer.includes(f)&&u(" correct")},[m]),a.useEffect(()=>{if(!o||(u(""),!g||g.length==0))return;const f=Number.parseInt(s.id);g&&g.includes(f)&&(e.correct_answer.includes(f)||u(" incorrect")),e.correct_answer.includes(f)&&u(" correct")},[o,g]);const l=f=>{m||(i(f.target.value),c(Es(e.id)),c(we({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${h}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(He,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:l,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});je.displayName="RadioAnswerOption";const Ds=({number:s,id:e,directionText:n,haveAnswer:r})=>{const i=a.useMemo(()=>{const h=H.sanitize(n,{USE_PROFILES:{html:!0}});return W(h,J)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!r&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:i})]})},Ce=a.memo(Ds),Se=a.forwardRef(({question:s,number:e,...n},r)=>{const[i,h]=a.useState("0"),u=a.useMemo(()=>s.correct_answer.some(c=>c>0&&c<=s.answer_option.length),[s.correct_answer]),m=u?"RadioQuestion":"RadioQuestion noAnswer",g=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},o=a.useCallback((c,d)=>t.jsx(je,{answerOption:c,question:s,answerOptionBullet:g(d),selectedValue:i,setSelectedValue:h},`${s.id}_${c.id}`),[i]);return t.jsxs("div",{className:m,...n,ref:r,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Se.displayName="RadioQuestion";const Ne=a.memo(Se),ye=a.memo(({answerOption:s,question:e,answerOptionBullet:n,index:r,selectedValue:i,setSelectedValue:h})=>{const[u,m]=a.useState(""),g=w(x=>x.testResult.isTestFininshed),o=w(x=>x.userAnswer.answers[e.id]),c=w(x=>x.testConfig.showAnswerOnChosen),d=S(),l=a.useMemo(()=>{const x=H.sanitize(s.value,{USE_PROFILES:{html:!0}});return W(x,J)},[s.value]);a.useEffect(()=>{if(!g)return;const x=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(x)&&m(" unanswer");return}o&&o.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[g]),a.useEffect(()=>{if(!c||(m(""),!o||o.length==0))return;const x=Number.parseInt(s.id);o&&o.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[c,o]);const f=()=>{g||(i[r]?d(Bs({id:e.id,answer:s.id})):d(we({id:e.id,answer:s.id})),h(i.map((x,N)=>N==r?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(R,{name:`question_${e.id}_${r}`,checked:i[r],onChange:f,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:l})]})]})});ye.displayName="CheckboxAnswerOption";const Ie=a.forwardRef(({question:s,number:e,...n},r)=>{const[i,h]=a.useState([!1,!1,!1,!1]),u=a.useMemo(()=>s.correct_answer.some(c=>c>0&&c<=s.correct_answer.length),[s.correct_answer]),m=u?"CheckboxQuestion":"CheckboxQuestion noAnswer",g=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},o=a.useCallback((c,d)=>t.jsx(ye,{answerOption:c,question:s,answerOptionBullet:g(d),index:d,selectedValue:i,setSelectedValue:h},`${s.id}_${c.id}`),[i]);return t.jsxs("div",{className:m,...n,ref:r,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Ie.displayName="CheckboxQuestion";const Ae=a.memo(Ie),Hs=({children:s,sectionRefs:e,rootSelector:n,offset:r,as:i,...h})=>{const u=We({sectionRefs:e,rootSelector:n,offset:r}),m=S();a.useEffect(()=>{u.currentElementIndexInViewport!==-1&&m(k(u.currentElementIndexInViewport+1))},[u]);const g=i||"div";return t.jsx(g,{...h,children:s})},Zs=()=>{const s=w(d=>d.testQuestion.questions),e=w(d=>d.testResult.isTestFininshed),n=w(d=>d.currCourse.course),{shuffleAnswer:r,questionCount:i}=w(d=>d.testConfig),h=S(),u=a.useRef([]),[m,g]=a.useState(-60);a.useEffect(()=>{window.innerHeight!==0&&g(-60-window.innerHeight/4)},[window.innerHeight]),a.useMemo(()=>{u.current.length!==s.length&&(u.current=Array(s.length).fill(null).map((d,l)=>u.current[l]||a.createRef()))},[s.length]),a.useEffect(()=>{if(e)return;h(E([])),(async()=>{const l=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),f=JSON.parse(l).map(N=>new z(N)),x=c(f);o(x),h(E(x))})()},[e]);const o=d=>{d.forEach(l=>{r&&l.shuffleable&&(l.answer_option=B(l.answer_option))})},c=d=>{const l=B(d);return l.sort((f,x)=>f.cdr-x.cdr),i==="all"||Number.isNaN(Number.parseInt(i))?l:l.slice(0,Number.parseInt(i))};return!s||s.length==0||!u.current?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx(Hs,{as:"div",className:"TestContainer",sectionRefs:u.current,offset:m,children:s.map((d,l)=>d.question_type==="radio"?t.jsx(Ne,{ref:u.current[l],question:d,id:`questionNumber_${l+1}`,number:l+1},d.id):t.jsx(Ae,{ref:u.current[l],question:d,id:`questionNumber_${l+1}`,number:l+1},d.id))})},et=({setHidePopup:s})=>{const e=w(o=>o.currSubject.subject),n=w(o=>o.testQuestion.questions),r=w(o=>o.testResult),i=S(),h=D("screen and (max-width: 768px)"),u=()=>{!r.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(i(me()),i(Z()),i(G()))},m=()=>{i(Y(!1)),i(Z()),i(G())},g=()=>{const c=Us.getState().userAnswer.answers;let d=0;n.forEach(l=>{const f=JSON.stringify(l.correct_answer.sort()),x=JSON.stringify(c[l.id]&&[...c[l.id]].sort());f===x?(d++,i(Ms(l.id))):i(Ls(l.id));const N=parseFloat((d/n.length*10).toFixed(2));i($s(N))}),i(Y(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx(ze,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!h&&t.jsx(I,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:r.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(I,{children:t.jsx("button",{className:"IconBtn",onClick:m,children:t.jsx(Je,{})})}),t.jsx(I,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",r.score]}),t.jsxs("div",{children:["Kết quả: ",r.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(I,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:g,children:[t.jsx(te,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(I,{children:t.jsx(oe,{})})]})},st=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:r,correctAnswers:i}=w(g=>g.testResult),h=w(g=>g.testQuestion.questions),[u,m]=a.useState("");return a.useEffect(()=>{e(!r),n<5?m("lowScore"):n<8?m("mediumScore"):m("")},[r]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${u}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",i.length,"/",h.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},tt=()=>{const s=w(o=>o.testQuestion.questions),e=w(o=>o.testResult.isTestFininshed),n=w(o=>o.currCourse.course),r=w(o=>o.testNavigation.currentQuestionNumber),{shuffleAnswer:i,questionCount:h}=w(o=>o.testConfig),u=S();a.useEffect(()=>{if(e)return;u(E([])),(async()=>{const c=await O(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),d=JSON.parse(c).map(f=>new z(f)),l=g(d);m(l),u(E(l))})()},[e]);const m=o=>{o.forEach(c=>{i&&c.shuffleable&&(c.answer_option=B(c.answer_option))})},g=o=>{const c=B(o);return c.sort((d,l)=>d.cdr-l.cdr),h==="all"||Number.isNaN(Number.parseInt(h))?c:c.slice(0,Number.parseInt(h))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((o,c)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:r!==c+1?{display:"none"}:{},children:t.jsx(Ne,{question:o,number:c+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:r!==c+1?{display:"none"}:{},children:t.jsx(Ae,{question:o,number:c+1})},o.id))})},Ws=({currentIndex:s,questionNumbers:e})=>{const r=a.useRef(null),i=a.useRef(null),[h,u]=a.useState(0),[m,g]=a.useState(0);return a.useEffect(()=>{if(i.current&&r.current){const o=r.current.clientWidth,{defaultWidth:c,offsetFromCenter:d}=zs(i.current,o);u(c),g(d)}},[]),a.useEffect(()=>{if(!(!h||!m)&&i.current&&r.current){const o=(s!==-1?s:1)-1+2,c=i.current.querySelectorAll(".QuestionNumberIndicatorItem"),d=c[o];c.forEach((l,f)=>{l.classList.remove("neighbour","current"),f===o&&l.classList.add("current"),Math.abs(f-o)===1&&l.classList.add("neighbour")}),d&&(i.current.style.transform=`translateX(${-(h*o)+m}px)`)}},[s,h,m]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:r,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:i,children:t.jsx(Oe,{questionNumbers:e,fakeItemCount:2})})})},Oe=a.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=r=>Array(e).fill(0).map((i,h)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:i},h+r));return t.jsxs(t.Fragment,{children:[n(-e),s.map(r=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:r},r)),n(s.length+1)]})});Oe.displayName="QuestionNumberIndicatorList";const zs=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.transition="none",s.appendChild(n);const r=P(n);n.classList.add("neighbour");const i=P(n);n.classList.remove("neighbour"),n.classList.add("current");const h=P(n),u=i-r,m=(e-h)/2-u;return s.removeChild(n),{defaultWidth:r,neighborWidth:i,currentWidth:h,offsetFromCenter:m}},P=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},nt=()=>{const s=w(p=>p.theme.theme),e=w(p=>p.userAnswer.answers),n=w(p=>p.testQuestion.questions),{correctAnswers:r,wrongAnswers:i}=w(p=>p.testResult),{questionCount:h,showQuestionByPage:u}=w(p=>p.testConfig),m=w(p=>p.testNavigation.currentQuestionNumber),g=S(),o=h!=="all"?parseInt(h):n.length,c=a.useMemo(()=>[...Array(o).keys()].map(p=>p+1),[o]),[d,l]=a.useState(null),f=!!d,x=p=>{l(p.currentTarget)},N=()=>{l(null)},T=p=>{let j="QuestionListMenuItem";try{const y=n[p-1];y instanceof z&&(!e||e&&!e[y==null?void 0:y.id]?j+=" unanswer":r.includes(y==null?void 0:y.id)?j+=" correct":i.includes(y==null?void 0:y.id)&&(j+=" incorrect"))}catch{console.log(`Question number ${p} does not exists`)}return p===m&&(j+=" selected"),j},v=p=>{u?(g(k(p)),N()):U(p)},_=p=>{const j=Math.min(m+1,o);m>=o-1&&p.currentTarget.blur(),u?g(k(j)):U(j)},b=p=>{m<=2&&p.currentTarget.blur();const j=Math.max(m-1,1);u?g(k(j)):U(j)};return!n||n.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":f?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":f?"true":void 0,onClick:x,children:t.jsx(ee,{className:"icon",size:16})}),t.jsx(qe,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:d,open:f,onClose:N,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:c.map(p=>t.jsx("button",{className:T(p),onClick:()=>v(p),children:p},p))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:b,disabled:m<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ke,{className:"icon"})})]}),t.jsx(Ws,{currentIndex:m,questionNumbers:c}),t.jsxs("button",{className:"NextQuestionBtn",onClick:_,disabled:m===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Ve,{className:"icon"})})]})]})},U=(s,e=0)=>{const n=document.getElementById(`questionNumber_${s}`);if(!n)return;const h=n.offsetTop-60-20-e;window.scroll({top:h,behavior:"smooth"})};export{Gs as C,Ks as N,Vs as S,et as T,tt as a,Zs as b,st as c,nt as d,L as e,$ as l,Us as s,Ys as u};
