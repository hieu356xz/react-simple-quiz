var Ce=Object.defineProperty;var Se=(s,e,r)=>e in s?Ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var b=(s,e,r)=>Se(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as N,u as d,a as S,M as Ne,b as ye,r as l,d as z,F as se,e as Ie,f as Ae,g as te,P as Oe,h as Te,$ as _e,s as ve,O as ke,C as k,i as Qe,S as Re,k as ne,l as L,m as Be,p as B,n as M,R as Me,o as Q,T as $e,q as Fe,t as Ee,v as Le,w as Pe}from"./vendor-BIktREsd.js";const C=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),De=()=>{let s=localStorage.getItem("theme");return s||(s="dark",re(s)),s},re=s=>{localStorage.setItem("theme",s)},Ue={theme:De()},oe=N({name:"theme",initialState:Ue,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",re(s.theme)}}}),ze=oe.reducer,{switchTheme:Je}=oe.actions,ae=()=>{const s=d(r=>r.theme.theme),e=S();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Je()),children:s=="light"?t.jsx(Ne,{size:"24px",style:{background:"#00000000"}}):t.jsx(ye,{size:"24px",style:{background:"#00000000"}})})},He={sidebarOpen:!1},ce=N({name:"sidebarOpen",initialState:He,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),qe=ce.reducer,{toggleSidebar:We,setIsSidebarOpen:Ge}=ce.actions,Ms=()=>{const s=d(u=>u.currSubject.subject),[e,r]=l.useState(!1),o=d(u=>u.sidebarOpen.sidebarOpen),i=z("screen and (max-width: 768px)"),f=S();return l.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(C,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>f(We()),disabled:e,children:t.jsx(se,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!i&&t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx(Ie,{color:"var(--secondary-text-color)"})}),t.jsx(C,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(C,{children:t.jsx(ae,{})})]})};class ie{constructor(e){b(this,"id");b(this,"name");b(this,"subject_id");b(this,"_questions");b(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ke=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),Ve=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),Ye=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let P=null;const Xe=async()=>(P||(P=await Ae.createDbWorker([{from:"inline",config:{serverMode:"full",url:Ye,requestChunkSize:4096}}],Ke.toString(),Ve.toString())),P),A=async s=>{const r=await(await Xe()).db.query(s);return JSON.stringify(r)},Ze=async s=>{try{const e=await A(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ie(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},es=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await Ze(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},D=te("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await es();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),ss={course:null,loading:!1,error:null},le=N({name:"currCourse",initialState:ss,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(D.pending,e=>{e.loading=!0,e.error=null}).addCase(D.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(D.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ts=le.reducer,{setCurrCourse:ue}=le.actions,ns=({children:s,...e})=>{const[r,o]=l.useState(!1),i=S(),f=z("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const u=()=>{i(ue(e.course)),f&&i(Ge(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:u,children:[t.jsx(Oe,{strokeWidth:"70px",className:"icon"})," ",s]})})};class rs{constructor(e){b(this,"id");b(this,"name");b(this,"semester_id");Object.assign(this,e)}}const os=async s=>{try{const e=await A(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new rs(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},as=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await os(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},U=te("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await as();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),cs={subject:null,loading:!1,error:null},de=N({name:"currSubject",initialState:cs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(U.pending,e=>{e.loading=!0,e.error=null}).addCase(U.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(U.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),is=de.reducer,{setCurrSubject:ls}=de.actions,us=s=>{const e=d(n=>n.currSubject.subject),r=d(n=>n.currCourse.course),[o,i]=l.useState(!1),[f,u]=l.useState([]),m=S();l.useEffect(()=>{i((e==null?void 0:e.id)==s.subject.id)},[e]),l.useEffect(()=>{(async()=>{const c=await A(`select *
        from Course
        where subject_id = ${s.subject.id}`),g=JSON.parse(c).map(w=>new ie(w));g&&u(g)})()},[]);const a=()=>{(e==null?void 0:e.id)!=s.subject.id&&m(ue(null)),m(ls(s.subject))};return t.jsxs("li",{className:`SidebarGroupItem ${o?"selected":""}`,children:[t.jsx("button",{onClick:a,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.subject.name}),t.jsx(Te,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx("div",{className:`SidebarItemsContainer ${o?"show":""}`,children:t.jsx("ul",{children:f.map((n,c)=>t.jsx(ns,{currCourse:r,course:n,children:n.name},c))})})]})},$=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(_e,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),$s=()=>{const s=d(o=>o.sidebarOpen.sidebarOpen),[e,r]=l.useState([]);return l.useEffect(()=>{(async()=>{const i=await A("select * from Subject");r(JSON.parse(i))})()},[]),t.jsx("div",{className:`Sidebar ${s?"":"hide"}`,children:!e||e.length==0?t.jsx($,{}):t.jsx("ul",{children:e.map((o,i)=>t.jsx(us,{subject:o},i))})})},ds={activeTest:!1},he=N({name:"activeTest",initialState:ds,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),hs=he.reducer,{toggleActiveTest:me}=he.actions,ms=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",fs=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",ps=()=>localStorage.getItem("showQuestionByPageOption")==="true",xs={shuffleAnswer:ms(),showAnswerOnChosen:fs(),showQuestionByPage:ps(),questionCount:"15"},fe=N({name:"testConfig",initialState:xs,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),ws=fe.reducer,{toggleShuffleAnswer:gs,setQuestionCount:V,toggleShowAnswerOnChosen:js,toggleShowQuestionByPage:bs}=fe.actions,Cs=ve(ke)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Fs=()=>{var y,_,p,O;const s=d(j=>j.theme.theme),e=d(j=>j.sidebarOpen.sidebarOpen),r=d(j=>j.currSubject),o=d(j=>j.currCourse),{shuffleAnswer:i,showAnswerOnChosen:f,showQuestionByPage:u}=d(j=>j.testConfig),[m,a]=l.useState({semester:null,loading:!1}),[n,c]=l.useState([]),[g,w]=l.useState(""),h=S();l.useEffect(()=>{(()=>{const T=[10,15,20,30,40,50,60,100,150],I=[];let W=!1;T.forEach(v=>{var G,K;if(o.course&&v>=((G=o.course)==null?void 0:G.question_per_test)){if(!W){const E=(K=o.course)==null?void 0:K.question_per_test;I.push(t.jsx(L,{value:E,sx:{fontSize:14},children:E},E)),W=!0}return}I.push(t.jsx(L,{value:v,sx:{fontSize:14},children:v},v))}),I.push(t.jsx(L,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),c(I)})()},[o.course]),l.useEffect(()=>{const j=async()=>{var I;a({...m,loading:!0});const T=await A(`select *
        from Semester
        where id = ${(I=r.subject)==null?void 0:I.semester_id}`);a({semester:JSON.parse(T)[0],loading:!1})};r.subject&&j()},[r.subject]),l.useEffect(()=>{if(o.course){const j=o.course.question_per_test;w(j.toString()),h(V(j.toString()))}},[o.course]);const x=j=>{const T=j.target.value;w(T),h(V(T))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:m.loading||o.loading||r.loading?t.jsx($,{}):r.subject&&o.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(y=o.course)==null?void 0:y.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(_=r.subject)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(p=m.semester)==null?void 0:p.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(O=o.course)==null?void 0:O.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:i,onClick:()=>h(gs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>h(js()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>h(bs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Qe,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Re,{value:g,onChange:x,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Cs,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:n})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>h(me()),children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},Ss={questions:[]},pe=N({name:"testQuestion",initialState:Ss,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Ns=pe.reducer,{addTestQuestion:Es,setTestQuestion:R}=pe.actions,ys={answers:{}},xe=N({name:"userAnswer",initialState:ys,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Is=xe.reducer,{addUserAnswer:we,removeUserAnswer:As,removeAllUserAnswerById:Os,resetUserAnwser:Y}=xe.actions,X={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ge=N({name:"testResult",initialState:X,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>X}}),Ts=ge.reducer,{addCorrectAnswer:_s,addWrongAnswer:vs,setIsTestFinished:Z,setScore:ks,resetTestResut:ee}=ge.actions,Qs=Be({reducer:{theme:ze,sidebarOpen:qe,currSubject:is,currCourse:ts,activeTest:hs,testQuestion:Ns,userAnswer:Is,testResult:Ts,testConfig:ws},middleware:s=>s({serializableCheck:!1})}),Ls=()=>S();class J{constructor(e){b(this,"id");b(this,"_question_direction");b(this,"question_type");b(this,"_answer_option");b(this,"_correct_answer");b(this,"cdr");b(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const F={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},je=l.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:o,setSelectedValue:i})=>{const[f,u]=l.useState(""),m=d(h=>h.testResult.isTestFininshed),a=d(h=>h.userAnswer.answers[e.id]),n=d(h=>h.testConfig.showAnswerOnChosen),c=S(),g=l.useMemo(()=>{const h=B.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(h,F)},[s.value]);l.useEffect(()=>{if(!m)return;const h=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(h)&&u(" unanswer");return}a&&a.includes(h)&&(e.correct_answer.includes(h)||u(" incorrect")),e.correct_answer.includes(h)&&u(" correct")},[m]),l.useEffect(()=>{if(!n||(u(""),!a||a.length==0))return;const h=Number.parseInt(s.id);a&&a.includes(h)&&(e.correct_answer.includes(h)||u(" incorrect")),e.correct_answer.includes(h)&&u(" correct")},[n,a]);const w=h=>{m||(i(h.target.value),c(Os(e.id)),c(we({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Me,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:w,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});je.displayName="RadioAnswerOption";const H=l.memo(({question:s,index:e,...r})=>{const[o,i]=l.useState("0"),f=l.useMemo(()=>`RadioQuestion${s.correct_answer.includes(0)?" noAnswer":""}`,[s.correct_answer]),u=l.useMemo(()=>{const n=B.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return M(n,F)},[s.question_direction]),m=n=>{const c=Math.min(Math.max(65,n+65),90);return String.fromCharCode(c)},a=l.useCallback((n,c)=>t.jsx(je,{answerOption:n,question:s,answerOptionBullet:m(c),selectedValue:o,setSelectedValue:i},`${s.id}_${n.id}`),[o]);return t.jsxs("div",{className:f,...r,children:[t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsx("p",{className:"QuestionContainerNumber",children:`Câu ${e}: (ID-${s.id})`}),t.jsx("div",{children:u})]}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});H.displayName="RadioQuestion";const be=l.memo(({answerOption:s,question:e,answerOptionBullet:r,index:o,selectedValue:i,setSelectedValue:f})=>{const[u,m]=l.useState(""),a=d(x=>x.testResult.isTestFininshed),n=d(x=>x.userAnswer.answers[e.id]),c=d(x=>x.testConfig.showAnswerOnChosen),g=S(),w=l.useMemo(()=>{const x=B.sanitize(s.value,{USE_PROFILES:{html:!0}});return M(x,F)},[s.value]);l.useEffect(()=>{if(!a)return;const x=Number.parseInt(s.id);if(!n||n.length==0){e.correct_answer.includes(x)&&m(" unanswer");return}n&&n.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[a]),l.useEffect(()=>{if(!c||(m(""),!n||n.length==0))return;const x=Number.parseInt(s.id);n&&n.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[c,n]);const h=()=>{a||(i[o]?g(As({id:e.id,answer:s.id})):g(we({id:e.id,answer:s.id})),f(i.map((x,y)=>y==o?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(k,{name:`question_${e.id}_${o}`,checked:i[o],onChange:h,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:w})]})]})});be.displayName="CheckboxAnswerOption";const q=l.memo(({question:s,index:e,...r})=>{const[o,i]=l.useState([!1,!1,!1,!1]),f=l.useMemo(()=>`CheckboxQuestion${s.correct_answer.includes(0)?" noAnswer":""}`,[s.correct_answer]),u=l.useMemo(()=>{const n=B.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return M(n,F)},[s.question_direction]),m=n=>{const c=Math.min(Math.max(65,n+65),90);return String.fromCharCode(c)},a=l.useCallback((n,c)=>t.jsx(be,{answerOption:n,question:s,answerOptionBullet:m(c),index:c,selectedValue:o,setSelectedValue:i},`${s.id}_${n.id}`),[o]);return t.jsxs("div",{className:f,...r,children:[t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsx("p",{className:"QuestionContainerNumber",children:`Câu ${e}: (ID-${s.id})`}),t.jsx("div",{children:u})]}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});q.displayName="CheckboxQuestion";const Ps=()=>{const s=d(a=>a.testQuestion.questions),e=d(a=>a.testResult.isTestFininshed),r=d(a=>a.currCourse.course),{shuffleAnswer:o,questionCount:i}=d(a=>a.testConfig),f=S();l.useEffect(()=>{if(e)return;f(R([])),(async()=>{const n=await A(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),c=JSON.parse(n).map(w=>new J(w)),g=m(c);u(g),f(R(g))})()},[e]);const u=a=>{a.forEach(n=>{o&&n.shuffleable&&(n.answer_option=Q(n.answer_option))})},m=a=>{const n=Q(a);return n.sort((c,g)=>c.cdr-g.cdr),i==="all"||Number.isNaN(Number.parseInt(i))?n:n.slice(0,Number.parseInt(i))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx($,{})}):t.jsx("div",{className:"TestContainer",children:s.map((a,n)=>a.question_type==="radio"?t.jsx(H,{question:a,index:n+1},a.id):t.jsx(q,{question:a,index:n+1},a.id))})},Ds=({setHidePopup:s})=>{const e=d(n=>n.currSubject.subject),r=d(n=>n.testQuestion.questions),o=d(n=>n.testResult),i=S(),f=z("screen and (max-width: 768px)"),u=()=>{!o.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(i(me()),i(ee()),i(Y()))},m=()=>{i(Z(!1)),i(ee()),i(Y())},a=()=>{const c=Qs.getState().userAnswer.answers;let g=0;r.forEach(w=>{const h=JSON.stringify(w.correct_answer.sort()),x=JSON.stringify(c[w.id]&&[...c[w.id]].sort());h===x?(g++,i(_s(w.id))):i(vs(w.id));const y=parseFloat((g/r.length*10).toFixed(2));i(ks(y))}),i(Z(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(C,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx($e,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!f&&t.jsx(C,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:o.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx("button",{className:"IconBtn",onClick:m,children:t.jsx(Fe,{})})}),t.jsx(C,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(n=>!n),children:[t.jsxs("div",{children:["Điểm: ",o.score]}),t.jsxs("div",{children:["Kết quả: ",o.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(C,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:a,children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(C,{children:t.jsx(ae,{})})]})},Us=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:o,correctAnswers:i}=d(a=>a.testResult),f=d(a=>a.testQuestion.questions),[u,m]=l.useState("");return l.useEffect(()=>{e(!o),r<5?m("lowScore"):r<8&&m("mediumScore")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${u}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",i.length,"/",f.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},zs=({currentQuestionNumber:s})=>{const e=d(n=>n.testQuestion.questions),r=d(n=>n.testResult.isTestFininshed),o=d(n=>n.currCourse.course),{shuffleAnswer:i,questionCount:f}=d(n=>n.testConfig),u=S();l.useEffect(()=>{if(r)return;u(R([])),(async()=>{const c=await A(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),g=JSON.parse(c).map(h=>new J(h)),w=a(g);m(w),u(R(w))})()},[r]);const m=n=>{n.forEach(c=>{i&&c.shuffleable&&(c.answer_option=Q(c.answer_option))})},a=n=>{const c=Q(n);return c.sort((g,w)=>g.cdr-w.cdr),f==="all"||Number.isNaN(Number.parseInt(f))?c:c.slice(0,Number.parseInt(f))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx($,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((n,c)=>n.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==c+1?{display:"none"}:{},children:t.jsx(H,{question:n,index:c+1})},n.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==c+1?{display:"none"}:{},children:t.jsx(q,{question:n,index:c+1})},n.id))})},Js=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const r=d(p=>p.theme.theme),o=d(p=>p.userAnswer.answers),i=d(p=>p.testQuestion.questions),f=d(p=>p.testConfig.questionCount),u=f!=="all"?parseInt(f):i.length,m=l.useMemo(()=>[...Array(u).keys()].map(p=>p+1),[u]),[a,n]=l.useState(null),c=!!a,g=p=>{n(p.currentTarget)},w=()=>{n(null)},h=p=>{let O="QuestionListMenuItem";try{const j=i[p-1];j instanceof J&&(!o||o&&!o[j==null?void 0:j.id])&&(O+=" unanswer")}catch{console.log(`Question number ${p} does not exists`)}return p===s&&(O+=" selected"),O},x=p=>{e(p),w()},y=()=>{const p=Math.min(s+1,u);e(p)},_=()=>{const p=Math.max(s-1,1);e(p)};return t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":c?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,onClick:g,children:t.jsx(se,{className:"icon",size:16})}),t.jsx(Ee,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:a,open:c,onClose:w,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":r,children:t.jsx("div",{className:"QuestionListMenuContent",children:m.map(p=>t.jsx("button",{className:h(p),onClick:()=>x(p),children:p},p))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:_,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Le,{className:"icon"})})]}),t.jsxs("button",{className:"NextQuestionBtn",onClick:y,disabled:s===u,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Pe,{className:"icon"})})]})]})};export{Fs as C,Ms as N,$s as S,Ds as T,zs as a,Ps as b,Us as c,Js as d,D as e,U as l,Qs as s,Ls as u};
