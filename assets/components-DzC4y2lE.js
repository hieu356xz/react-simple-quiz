var ve=Object.defineProperty;var Qe=(s,e,n)=>e in s?ve(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var S=(s,e,n)=>Qe(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as I,u as w,a as N,M as Re,b as ke,r as a,d as W,F as te,e as Ee,f as Be,g as ne,P as Fe,h as Me,A as Le,$ as $e,s as Pe,O as De,C as k,i as Ue,S as We,k as re,l as G,m as He,p as H,n as z,R as ze,o as Je,q as E,T as qe,t as Ke,v as Ve,w as Ge,x as Xe}from"./vendor-DLRcHq6p.js";const y=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ye=()=>{let s=localStorage.getItem("theme");return s||(s="dark",oe(s)),s},oe=s=>{localStorage.setItem("theme",s)},Ze={theme:Ye()},ie=I({name:"theme",initialState:Ze,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",oe(s.theme)}}}),es=ie.reducer,{switchTheme:ss}=ie.actions,ae=()=>{const s=w(n=>n.theme.theme),e=N();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(ss()),children:s=="light"?t.jsx(Re,{size:"24px",style:{background:"#00000000"}}):t.jsx(ke,{size:"24px",style:{background:"#00000000"}})})},ts={sidebarOpen:!1},ce=I({name:"sidebarOpen",initialState:ts,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ns=ce.reducer,{toggleSidebar:le,setIsSidebarOpen:rs}=ce.actions,Gs=()=>{const s=w(l=>l.currSubject.subject),[e,n]=a.useState(!1),r=w(l=>l.sidebarOpen.sidebarOpen),i=W("screen and (max-width: 768px)"),h=N();return a.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[r]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>h(le()),disabled:e,children:t.jsx(te,{className:`BtnHamburgerIcon ${r?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!i&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx(Ee,{color:"var(--secondary-text-color)"})}),t.jsx(y,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(y,{children:t.jsx(ae,{})})]})};class ue{constructor(e){S(this,"id");S(this,"name");S(this,"subject_id");S(this,"_questions");S(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const os=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),is=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),as=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let L=null;const cs=async()=>(L||(L=await Be.createDbWorker([{from:"inline",config:{serverMode:"full",url:as,requestChunkSize:4096}}],os.toString(),is.toString())),L),T=async s=>{const n=await(await cs()).db.query(s);return JSON.stringify(n)},ls=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ue(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},us=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await ls(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},$=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await us();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ds={course:null,loading:!1,error:null},de=I({name:"currCourse",initialState:ds,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase($.pending,e=>{e.loading=!0,e.error=null}).addCase($.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase($.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),hs=de.reducer,{setCurrCourse:he}=de.actions,ms=({children:s,...e})=>{const[n,r]=a.useState(!1),i=N(),h=W("screen and (max-width: 768px)");a.useEffect(()=>{e.currCourse?r(e.currCourse.id==e.course.id):r(!1)},[e.currCourse]);const l=()=>{i(he(e.course)),h&&i(rs(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:l,children:[t.jsx(Fe,{strokeWidth:"70px",className:"icon"})," ",s]})})};class fs{constructor(e){S(this,"id");S(this,"name");S(this,"semester_id");Object.assign(this,e)}}const ps=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new fs(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ws=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await ps(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},P=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await ws();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),gs={subject:null,loading:!1,error:null},me=I({name:"currSubject",initialState:gs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase(P.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),xs=me.reducer,{setCurrSubject:bs}=me.actions,js=({subject:s})=>{const e=w(u=>u.currSubject.subject),n=w(u=>u.currCourse.course),[r,i]=a.useState(!1),[h,l]=a.useState(!1),[m,p]=a.useState([]),o=`SidebarGroupItem ${r?"selected":""} ${h?"expanded":""}`,c=N();a.useEffect(()=>{i((e==null?void 0:e.id)===s.id),l((e==null?void 0:e.id)===s.id)},[e]),a.useEffect(()=>{(async()=>{const f=await T(`select *
        from Course
        where subject_id = ${s.id}`),x=JSON.parse(f).map(C=>new ue(C));x&&p(x)})()},[]);const d=()=>{(e==null?void 0:e.id)!==s.id&&c(he(null)),c(bs(s)),l(u=>!u)};return t.jsxs("li",{className:o,children:[t.jsx("button",{onClick:d,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(Me,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(Le,{height:h?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:m.map((u,f)=>t.jsx(ms,{currCourse:n,course:u,children:u.name},f))})})]})},F=()=>t.jsx("div",{className:"LoadingView",children:t.jsx($e,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Xs=()=>{const s=w(i=>i.sidebarOpen.sidebarOpen),[e,n]=a.useState([]),r=N();return a.useEffect(()=>{(async()=>{const h=await T("select * from Subject");n(JSON.parse(h))})()},[]),t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!e||e.length==0?t.jsx(F,{}):t.jsx("ul",{children:e.map((i,h)=>t.jsx(js,{subject:i},h))}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>r(le())})]})},Cs={activeTest:!1},fe=I({name:"activeTest",initialState:Cs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),Ss=fe.reducer,{toggleActiveTest:pe}=fe.actions,Ns=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ys=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Is=()=>localStorage.getItem("showQuestionByPageOption")==="true",As={shuffleAnswer:Ns(),showAnswerOnChosen:ys(),showQuestionByPage:Is(),questionCount:"15"},we=I({name:"testConfig",initialState:As,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Ts=we.reducer,{toggleShuffleAnswer:Os,setQuestionCount:X,toggleShowAnswerOnChosen:_s,toggleShowQuestionByPage:vs}=we.actions,Qs=Pe(De)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Ys=()=>{var _,v,Q,g;const s=w(b=>b.theme.theme),e=w(b=>b.sidebarOpen.sidebarOpen),n=w(b=>b.currSubject),r=w(b=>b.currCourse),{shuffleAnswer:i,showAnswerOnChosen:h,showQuestionByPage:l}=w(b=>b.testConfig),[m,p]=a.useState({semester:null,loading:!1}),[o,c]=a.useState([]),[d,u]=a.useState(""),[f,x]=a.useState({value:0,loading:!1}),C=N();a.useEffect(()=>{(()=>{if(!r.course)return;const j=[10,15,20,30,40,50,60,80,100,150],A=[],K=r.course.question_per_test;j.includes(K)||(j.push(K),j.sort()),j.forEach(R=>{var V;!r.course||R>=((V=r.course)==null?void 0:V.questions.length)||A.push(t.jsx(G,{value:R,sx:{fontSize:14},children:R},R))}),A.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),c(A)})()},[r.course]),a.useEffect(()=>{const b=async()=>{var A;p({...m,loading:!0});const j=await T(`select *
        from Semester
        where id = ${(A=n.subject)==null?void 0:A.semester_id}`);p({semester:JSON.parse(j)[0],loading:!1})};n.subject&&b()},[n.subject]),a.useEffect(()=>{if(r.course){const j=r.course.question_per_test;u(j.toString()),C(X(j.toString()))}(async()=>{if(!r.course)return;const j=await T(`
        SELECT COUNT(DISTINCT Question.id) as count
        FROM Question
        WHERE id IN (${r.course.questions.join(",")})
        AND (
          (json_valid(correct_answer)
          AND json_array_length(correct_answer) > 0
          AND EXISTS (SELECT 1 FROM json_each(correct_answer) WHERE json_each.value > 0))
          OR correct_answer != 0
        )
      `),A=JSON.parse(j)[0].count;x({value:A,loading:!1})})()},[r.course]);const M=b=>{const j=b.target.value;u(j),C(X(j))};return m.loading||r.loading||n.loading||f.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(F,{})}):!n.subject||!r.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(_=r.course)==null?void 0:_.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(v=n.subject)==null?void 0:v.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(Q=m.semester)==null?void 0:Q.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(g=r.course)==null?void 0:g.questions.length})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:f.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:i,onClick:()=>C(Os()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>C(_s()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:l,onClick:()=>C(vs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Ue,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(We,{value:d,onChange:M,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Qs,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>C(pe()),children:[t.jsx(re,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},Rs={questions:[]},ge=I({name:"testQuestion",initialState:Rs,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),ks=ge.reducer,{addTestQuestion:Zs,setTestQuestion:B}=ge.actions,Es={answers:{}},xe=I({name:"userAnswer",initialState:Es,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Bs=xe.reducer,{addUserAnswer:be,removeUserAnswer:Fs,removeAllUserAnswerById:Ms,resetUserAnwser:Y}=xe.actions,Z={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},je=I({name:"testResult",initialState:Z,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>Z}}),Ls=je.reducer,{addCorrectAnswer:$s,addWrongAnswer:Ps,setIsTestFinished:ee,setScore:Ds,resetTestResut:se}=je.actions,Ce=I({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),Us=Ce.reducer,{setCurrentQuestion:O}=Ce.actions,Ws=He({reducer:{theme:es,sidebarOpen:ns,currSubject:xs,currCourse:hs,activeTest:Ss,testQuestion:ks,userAnswer:Bs,testResult:Ls,testConfig:Ts,testNavigation:Us},middleware:s=>s({serializableCheck:!1})}),et=()=>N();class J{constructor(e){S(this,"id");S(this,"_question_direction");S(this,"question_type");S(this,"_answer_option");S(this,"_correct_answer");S(this,"cdr");S(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const q={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},Se=a.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:r,setSelectedValue:i})=>{const[h,l]=a.useState(""),m=w(f=>f.testResult.isTestFininshed),p=w(f=>f.userAnswer.answers[e.id]),o=w(f=>f.testConfig.showAnswerOnChosen),c=N(),d=a.useMemo(()=>{const f=H.sanitize(s.value,{USE_PROFILES:{html:!0}});return z(f,q)},[s.value]);a.useEffect(()=>{if(!m)return;const f=Number.parseInt(s.id);if(!p||p.length==0){e.correct_answer.includes(f)&&l(" unanswer");return}p&&p.includes(f)&&(e.correct_answer.includes(f)||l(" incorrect")),e.correct_answer.includes(f)&&l(" correct")},[m]),a.useEffect(()=>{if(!o||(l(""),!p||p.length==0))return;const f=Number.parseInt(s.id);p&&p.includes(f)&&(e.correct_answer.includes(f)||l(" incorrect")),e.correct_answer.includes(f)&&l(" correct")},[o,p]);const u=f=>{m||(i(f.target.value),c(Ms(e.id)),c(be({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${h}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(ze,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:u,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});Se.displayName="RadioAnswerOption";const Hs=({number:s,id:e,directionText:n,haveAnswer:r})=>{const i=a.useMemo(()=>{const h=H.sanitize(n,{USE_PROFILES:{html:!0}});return z(h,q)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!r&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:i})]})},Ne=a.memo(Hs),ye=a.forwardRef(({question:s,number:e,...n},r)=>{const[i,h]=a.useState("0"),l=a.useMemo(()=>s.correct_answer.some(c=>c>0&&c<=s.answer_option.length),[s.correct_answer]),m=l?"RadioQuestion":"RadioQuestion noAnswer",p=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},o=a.useCallback((c,d)=>t.jsx(Se,{answerOption:c,question:s,answerOptionBullet:p(d),selectedValue:i,setSelectedValue:h},`${s.id}_${c.id}`),[i]);return t.jsxs("div",{className:m,...n,ref:r,children:[t.jsx(Ne,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});ye.displayName="RadioQuestion";const Ie=a.memo(ye),Ae=a.memo(({answerOption:s,question:e,answerOptionBullet:n,index:r,selectedValue:i,setSelectedValue:h})=>{const[l,m]=a.useState(""),p=w(x=>x.testResult.isTestFininshed),o=w(x=>x.userAnswer.answers[e.id]),c=w(x=>x.testConfig.showAnswerOnChosen),d=N(),u=a.useMemo(()=>{const x=H.sanitize(s.value,{USE_PROFILES:{html:!0}});return z(x,q)},[s.value]);a.useEffect(()=>{if(!p)return;const x=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(x)&&m(" unanswer");return}o&&o.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[p]),a.useEffect(()=>{if(!c||(m(""),!o||o.length==0))return;const x=Number.parseInt(s.id);o&&o.includes(x)&&(e.correct_answer.includes(x)||m(" incorrect")),e.correct_answer.includes(x)&&m(" correct")},[c,o]);const f=()=>{p||(i[r]?d(Fs({id:e.id,answer:s.id})):d(be({id:e.id,answer:s.id})),h(i.map((x,C)=>C==r?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${l}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(k,{name:`question_${e.id}_${r}`,checked:i[r],onChange:f,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:u})]})]})});Ae.displayName="CheckboxAnswerOption";const Te=a.forwardRef(({question:s,number:e,...n},r)=>{const[i,h]=a.useState([!1,!1,!1,!1]),l=a.useMemo(()=>s.correct_answer.some(c=>c>0&&c<=s.correct_answer.length),[s.correct_answer]),m=l?"CheckboxQuestion":"CheckboxQuestion noAnswer",p=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},o=a.useCallback((c,d)=>t.jsx(Ae,{answerOption:c,question:s,answerOptionBullet:p(d),index:d,selectedValue:i,setSelectedValue:h},`${s.id}_${c.id}`),[i]);return t.jsxs("div",{className:m,...n,ref:r,children:[t.jsx(Ne,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Te.displayName="CheckboxQuestion";const Oe=a.memo(Te),zs=({children:s,sectionRefs:e,rootSelector:n,offset:r,as:i,...h})=>{const l=Je({sectionRefs:e,rootSelector:n,offset:r}),m=N();a.useEffect(()=>{l.currentElementIndexInViewport!==-1&&m(O(l.currentElementIndexInViewport+1))},[l]);const p=i||"div";return t.jsx(p,{...h,children:s})},st=()=>{const s=w(d=>d.testQuestion.questions),e=w(d=>d.testResult.isTestFininshed),n=w(d=>d.currCourse.course),{shuffleAnswer:r,questionCount:i}=w(d=>d.testConfig),h=N(),l=a.useRef([]),[m,p]=a.useState(-60);a.useEffect(()=>{window.innerHeight!==0&&p(-60-window.innerHeight/4)},[window.innerHeight]),a.useMemo(()=>{l.current.length!==s.length&&(l.current=Array(s.length).fill(null).map((d,u)=>l.current[u]||a.createRef()))},[s.length]),a.useEffect(()=>{if(e)return;h(B([])),(async()=>{const u=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),f=JSON.parse(u).map(C=>new J(C)),x=c(f);o(x),h(B(x))})()},[e]);const o=d=>{d.forEach(u=>{r&&u.shuffleable&&(u.answer_option=E(u.answer_option))})},c=d=>{const u=E(d);return u.sort((f,x)=>f.cdr-x.cdr),i==="all"||Number.isNaN(Number.parseInt(i))?u:u.slice(0,Number.parseInt(i))};return!s||s.length==0||!l.current?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx(zs,{as:"div",className:"TestContainer",sectionRefs:l.current,offset:m,children:s.map((d,u)=>d.question_type==="radio"?t.jsx(Ie,{ref:l.current[u],question:d,id:`questionNumber_${u+1}`,number:u+1},d.id):t.jsx(Oe,{ref:l.current[u],question:d,id:`questionNumber_${u+1}`,number:u+1},d.id))})},tt=({setHidePopup:s})=>{const e=w(o=>o.currSubject.subject),n=w(o=>o.testQuestion.questions),r=w(o=>o.testResult),i=N(),h=W("screen and (max-width: 768px)"),l=()=>{!r.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(i(pe()),i(se()),i(Y()))},m=()=>{i(ee(!1)),i(se()),i(Y())},p=()=>{const c=Ws.getState().userAnswer.answers;let d=0;n.forEach(u=>{const f=JSON.stringify(u.correct_answer.sort()),x=JSON.stringify(c[u.id]&&[...c[u.id]].sort());f===x?(d++,i($s(u.id))):i(Ps(u.id));const C=parseFloat((d/n.length*10).toFixed(2));i(Ds(C))}),i(ee(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:l,children:t.jsx(qe,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!h&&t.jsx(y,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:r.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:m,children:t.jsx(Ke,{})})}),t.jsx(y,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",r.score]}),t.jsxs("div",{children:["Kết quả: ",r.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(y,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:p,children:[t.jsx(re,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(y,{children:t.jsx(ae,{})})]})},nt=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:r,correctAnswers:i}=w(p=>p.testResult),h=w(p=>p.testQuestion.questions),[l,m]=a.useState("");return a.useEffect(()=>{e(!r),n<5?m("lowScore"):n<8?m("mediumScore"):m("")},[r]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${l}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",i.length,"/",h.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},rt=()=>{const s=w(o=>o.testQuestion.questions),e=w(o=>o.testResult.isTestFininshed),n=w(o=>o.currCourse.course),r=w(o=>o.testNavigation.currentQuestionNumber),{shuffleAnswer:i,questionCount:h}=w(o=>o.testConfig),l=N();a.useEffect(()=>{if(e||l(O(1)),e)return;l(B([])),(async()=>{const c=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),d=JSON.parse(c).map(f=>new J(f)),u=p(d);m(u),l(B(u))})()},[e]);const m=o=>{o.forEach(c=>{i&&c.shuffleable&&(c.answer_option=E(c.answer_option))})},p=o=>{const c=E(o);return c.sort((d,u)=>d.cdr-u.cdr),h==="all"||Number.isNaN(Number.parseInt(h))?c:c.slice(0,Number.parseInt(h))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((o,c)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:r!==c+1?{display:"none"}:{},children:t.jsx(Ie,{question:o,number:c+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:r!==c+1?{display:"none"}:{},children:t.jsx(Oe,{question:o,number:c+1})},o.id))})},Js=({currentIndex:s,questionNumbers:e})=>{const r=a.useRef(null),i=a.useRef(null),[h,l]=a.useState(0),[m,p]=a.useState(0);return a.useEffect(()=>{if(i.current&&r.current){const o=r.current.clientWidth,{defaultWidth:c,offsetFromCenter:d}=qs(i.current,o);l(c),p(d)}},[]),a.useEffect(()=>{if(!(!h||!m)&&i.current&&r.current){const o=(s!==-1?s:1)-1+2,c=i.current.querySelectorAll(".QuestionNumberIndicatorItem"),d=c[o];c.forEach((u,f)=>{u.classList.remove("neighbour","current"),f===o&&u.classList.add("current"),Math.abs(f-o)===1&&u.classList.add("neighbour")}),d&&(i.current.style.transform=`translateX(${-(h*o)+m}px)`)}},[s,h,m]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:r,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:i,children:t.jsx(_e,{questionNumbers:e,fakeItemCount:2})})})},_e=a.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=r=>Array(e).fill(0).map((i,h)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:i},h+r));return t.jsxs(t.Fragment,{children:[n(-e),s.map(r=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:r},r)),n(s.length+1)]})});_e.displayName="QuestionNumberIndicatorList";const qs=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.transition="none",s.appendChild(n);const r=D(n);n.classList.add("neighbour");const i=D(n);n.classList.remove("neighbour"),n.classList.add("current");const h=D(n),l=i-r,m=(e-h)/2-l;return s.removeChild(n),{defaultWidth:r,neighborWidth:i,currentWidth:h,offsetFromCenter:m}},D=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},ot=()=>{const s=w(g=>g.theme.theme),e=w(g=>g.userAnswer.answers),n=w(g=>g.testQuestion.questions),{correctAnswers:r,wrongAnswers:i}=w(g=>g.testResult),{questionCount:h,showQuestionByPage:l}=w(g=>g.testConfig),m=w(g=>g.testNavigation.currentQuestionNumber),p=N(),o=h!=="all"?parseInt(h):n.length,c=a.useMemo(()=>[...Array(o).keys()].map(g=>g+1),[o]),[d,u]=a.useState(null),f=!!d,x=g=>{u(g.currentTarget)},C=()=>{u(null)},M=g=>{let b="QuestionListMenuItem";try{const j=n[g-1];j instanceof J&&(!e||e&&!e[j==null?void 0:j.id]?b+=" unanswer":r.includes(j==null?void 0:j.id)?b+=" correct":i.includes(j==null?void 0:j.id)&&(b+=" incorrect"))}catch{console.log(`Question number ${g} does not exists`)}return g===m&&(b+=" selected"),b},_=g=>{l?p(O(g)):U(g),C()},v=g=>{const b=Math.min(m+1,o);m>=o-1&&g.currentTarget.blur(),l?p(O(b)):U(b)},Q=g=>{m<=2&&g.currentTarget.blur();const b=Math.max(m-1,1);l?p(O(b)):U(b)};return!n||n.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":f?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":f?"true":void 0,onClick:x,children:t.jsx(te,{className:"icon",size:16})}),t.jsx(Ve,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:d,open:f,onClose:C,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:c.map(g=>t.jsx("button",{className:M(g),onClick:()=>_(g),children:g},g))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:Q,disabled:m<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ge,{className:"icon"})})]}),t.jsx(Js,{currentIndex:m,questionNumbers:c}),t.jsxs("button",{className:"NextQuestionBtn",onClick:v,disabled:m===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Xe,{className:"icon"})})]})]})},U=(s,e=0)=>{const n=document.getElementById(`questionNumber_${s}`);if(!n)return;const h=n.offsetTop-60-20-e;window.scroll({top:h,behavior:"smooth"})};export{Ys as C,Gs as N,Xs as S,tt as T,rt as a,st as b,nt as c,ot as d,$ as e,P as l,Ws as s,et as u};
