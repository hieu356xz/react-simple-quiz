var be=Object.defineProperty;var Se=(s,e,n)=>e in s?be(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var j=(s,e,n)=>Se(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as C,u as h,a as S,M as Ce,b as Ne,r as l,d as P,F as ye,e as Ie,f as Oe,g as ee,P as _e,h as Te,$ as Ae,s as ve,O as ke,C as T,i as Qe,S as Re,k as se,l as F,m as Be,p as k,n as Q,R as $e,o as A,T as Fe,q as Me,t as Ee,v as Le}from"./vendor-BFjsPDOm.js";const b=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Pe=()=>{let s=localStorage.getItem("theme");return s||(s="dark",te(s)),s},te=s=>{localStorage.setItem("theme",s)},De={theme:Pe()},ne=C({name:"theme",initialState:De,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",te(s.theme)}}}),Ue=ne.reducer,{switchTheme:ze}=ne.actions,re=()=>{const s=h(n=>n.theme.theme),e=S();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(ze()),children:s=="light"?t.jsx(Ce,{size:"24px",style:{background:"#00000000"}}):t.jsx(Ne,{size:"24px",style:{background:"#00000000"}})})},Je={sidebarOpen:!1},oe=C({name:"sidebarOpen",initialState:Je,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),He=oe.reducer,{toggleSidebar:qe,setIsSidebarOpen:We}=oe.actions,Bs=()=>{const s=h(d=>d.currSubject.subject),[e,n]=l.useState(!1),o=h(d=>d.sidebarOpen.sidebarOpen),c=P("screen and (max-width: 768px)"),f=S();return l.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(b,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>f(qe()),disabled:e,children:t.jsx(ye,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!c&&t.jsxs(t.Fragment,{children:[t.jsx(b,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(b,{children:t.jsx(Ie,{color:"var(--secondary-text-color)"})}),t.jsx(b,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(b,{children:t.jsx(re,{})})]})};class ae{constructor(e){j(this,"id");j(this,"name");j(this,"subject_id");j(this,"_questions");j(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ge=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),Ke=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),Ve=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let M=null;const Xe=async()=>(M||(M=await Oe.createDbWorker([{from:"inline",config:{serverMode:"full",url:Ve,requestChunkSize:4096}}],Ge.toString(),Ke.toString())),M),y=async s=>{const n=await(await Xe()).db.query(s);return JSON.stringify(n)},Ye=async s=>{try{const e=await y(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ae(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Ze=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await Ye(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},E=ee("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await Ze();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),es={course:null,loading:!1,error:null},ce=C({name:"currCourse",initialState:es,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(E.pending,e=>{e.loading=!0,e.error=null}).addCase(E.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase(E.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ss=ce.reducer,{setCurrCourse:ie}=ce.actions,ts=({children:s,...e})=>{const[n,o]=l.useState(!1),c=S(),f=P("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const d=()=>{c(ie(e.course)),f&&c(We(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:d,children:[t.jsx(_e,{strokeWidth:"70px",className:"icon"})," ",s]})})};class ns{constructor(e){j(this,"id");j(this,"name");j(this,"semester_id");Object.assign(this,e)}}const rs=async s=>{try{const e=await y(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new ns(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},os=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await rs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},L=ee("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await os();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),as={subject:null,loading:!1,error:null},le=C({name:"currSubject",initialState:as,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(L.pending,e=>{e.loading=!0,e.error=null}).addCase(L.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase(L.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),cs=le.reducer,{setCurrSubject:is}=le.actions,ls=s=>{const e=h(r=>r.currSubject.subject),n=h(r=>r.currCourse.course),[o,c]=l.useState(!1),[f,d]=l.useState([]),u=S();l.useEffect(()=>{c((e==null?void 0:e.id)==s.subject.id)},[e]),l.useEffect(()=>{(async()=>{const i=await y(`select *
        from Course
        where subject_id = ${s.subject.id}`),x=JSON.parse(i).map(w=>new ae(w));x&&d(x)})()},[]);const a=()=>{(e==null?void 0:e.id)!=s.subject.id&&u(ie(null)),u(is(s.subject))};return t.jsxs("li",{className:`SidebarGroupItem ${o?"selected":""}`,children:[t.jsx("button",{onClick:a,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.subject.name}),t.jsx(Te,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx("div",{className:`SidebarItemsContainer ${o?"show":""}`,children:t.jsx("ul",{children:f.map((r,i)=>t.jsx(ts,{currCourse:n,course:r,children:r.name},i))})})]})},R=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Ae,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),$s=()=>{const s=h(o=>o.sidebarOpen.sidebarOpen),[e,n]=l.useState([]);return l.useEffect(()=>{(async()=>{const c=await y("select * from Subject");n(JSON.parse(c))})()},[]),t.jsx("div",{className:`Sidebar ${s?"":"hide"}`,children:!e||e.length==0?t.jsx(R,{}):t.jsx("ul",{children:e.map((o,c)=>t.jsx(ls,{subject:o},c))})})},us={activeTest:!1},ue=C({name:"activeTest",initialState:us,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),ds=ue.reducer,{toggleActiveTest:de}=ue.actions,hs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ms=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",fs=()=>localStorage.getItem("showQuestionByPageOption")==="true",ps={shuffleAnswer:hs(),showAnswerOnChosen:ms(),showQuestionByPage:fs(),questionCount:"15"},he=C({name:"testConfig",initialState:ps,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),xs=he.reducer,{toggleShuffleAnswer:ws,setQuestionCount:K,toggleShowAnswerOnChosen:gs,toggleShowQuestionByPage:js}=he.actions,bs=ve(ke)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Fs=()=>{var I,z,J,H;const s=h(g=>g.theme.theme),e=h(g=>g.sidebarOpen.sidebarOpen),n=h(g=>g.currSubject),o=h(g=>g.currCourse),{shuffleAnswer:c,showAnswerOnChosen:f,showQuestionByPage:d}=h(g=>g.testConfig),[u,a]=l.useState({semester:null,loading:!1}),[r,i]=l.useState([]),[x,w]=l.useState(""),m=S();l.useEffect(()=>{(()=>{const O=[10,15,20,30,40,50,60,100,150],N=[];let q=!1;O.forEach(_=>{var W,G;if(o.course&&_>=((W=o.course)==null?void 0:W.question_per_test)){if(!q){const $=(G=o.course)==null?void 0:G.question_per_test;N.push(t.jsx(F,{value:$,sx:{fontSize:14},children:$},$)),q=!0}return}N.push(t.jsx(F,{value:_,sx:{fontSize:14},children:_},_))}),N.push(t.jsx(F,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),i(N)})()},[o.course]),l.useEffect(()=>{const g=async()=>{var N;a({...u,loading:!0});const O=await y(`select *
        from Semester
        where id = ${(N=n.subject)==null?void 0:N.semester_id}`);a({semester:JSON.parse(O)[0],loading:!1})};n.subject&&g()},[n.subject]),l.useEffect(()=>{if(o.course){const g=o.course.question_per_test;w(g.toString()),m(K(g.toString()))}},[o.course]);const p=g=>{const O=g.target.value;w(O),m(K(O))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:u.loading||o.loading||n.loading?t.jsx(R,{}):n.subject&&o.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(I=o.course)==null?void 0:I.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(z=n.subject)==null?void 0:z.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(J=u.semester)==null?void 0:J.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(H=o.course)==null?void 0:H.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(T,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:c,onClick:()=>m(ws()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(T,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>m(gs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(T,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>m(js()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Qe,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Re,{value:x,onChange:p,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(bs,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:r})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>m(de()),children:[t.jsx(se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},Ss={questions:[]},me=C({name:"testQuestion",initialState:Ss,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Cs=me.reducer,{addTestQuestion:Ms,setTestQuestion:v}=me.actions,Ns={answers:{}},fe=C({name:"userAnswer",initialState:Ns,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),ys=fe.reducer,{addUserAnswer:pe,removeUserAnswer:Is,removeAllUserAnswerById:Os,resetUserAnwser:V}=fe.actions,X={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},xe=C({name:"testResult",initialState:X,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>X}}),_s=xe.reducer,{addCorrectAnswer:Ts,addWrongAnswer:As,setIsTestFinished:Y,setScore:vs,resetTestResut:Z}=xe.actions,ks=Be({reducer:{theme:Ue,sidebarOpen:He,currSubject:cs,currCourse:ss,activeTest:ds,testQuestion:Cs,userAnswer:ys,testResult:_s,testConfig:xs},middleware:s=>s({serializableCheck:!1})}),Es=()=>S();class we{constructor(e){j(this,"id");j(this,"_question_direction");j(this,"question_type");j(this,"_answer_option");j(this,"_correct_answer");j(this,"cdr");j(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const B={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},ge=l.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:o,setSelectedValue:c})=>{const[f,d]=l.useState(""),u=h(m=>m.testResult.isTestFininshed),a=h(m=>m.userAnswer.answers[e.id]),r=h(m=>m.testConfig.showAnswerOnChosen),i=S(),x=l.useMemo(()=>{const m=k.sanitize(s.value,{USE_PROFILES:{html:!0}});return Q(m,B)},[s.value]);l.useEffect(()=>{if(!u)return;const m=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(m)&&d(" unanswer");return}a&&a.includes(m)&&(e.correct_answer.includes(m)||d(" incorrect")),e.correct_answer.includes(m)&&d(" correct")},[u]),l.useEffect(()=>{if(!r||(d(""),!a||a.length==0))return;const m=Number.parseInt(s.id);a&&a.includes(m)&&(e.correct_answer.includes(m)||d(" incorrect")),e.correct_answer.includes(m)&&d(" correct")},[r,a]);const w=m=>{u||(c(m.target.value),i(Os(e.id)),i(pe({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx($e,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:w,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:x})]})]})});ge.displayName="RadioAnswerOption";const D=l.memo(({question:s,index:e,...n})=>{const[o,c]=l.useState("0"),f=l.useMemo(()=>`RadioQuestion${s.correct_answer.includes(0)?" noAnswer":""}`,[s.correct_answer]),d=l.useMemo(()=>{const r=k.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return Q(r,B)},[s.question_direction]),u=r=>{const i=Math.min(Math.max(65,r+65),90);return String.fromCharCode(i)},a=l.useCallback((r,i)=>t.jsx(ge,{answerOption:r,question:s,answerOptionBullet:u(i),selectedValue:o,setSelectedValue:c},`${s.id}_${r.id}`),[o]);return t.jsxs("div",{className:f,...n,children:[t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsx("p",{className:"QuestionContainerNumber",children:`Câu ${e}: (ID-${s.id})`}),t.jsx("div",{children:d})]}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});D.displayName="RadioQuestion";const je=l.memo(({answerOption:s,question:e,answerOptionBullet:n,index:o,selectedValue:c,setSelectedValue:f})=>{const[d,u]=l.useState(""),a=h(p=>p.testResult.isTestFininshed),r=h(p=>p.userAnswer.answers[e.id]),i=h(p=>p.testConfig.showAnswerOnChosen),x=S(),w=l.useMemo(()=>{const p=k.sanitize(s.value,{USE_PROFILES:{html:!0}});return Q(p,B)},[s.value]);l.useEffect(()=>{if(!a)return;const p=Number.parseInt(s.id);if(!r||r.length==0){e.correct_answer.includes(p)&&u(" unanswer");return}r&&r.includes(p)&&(e.correct_answer.includes(p)||u(" incorrect")),e.correct_answer.includes(p)&&u(" correct")},[a]),l.useEffect(()=>{if(!i||(u(""),!r||r.length==0))return;const p=Number.parseInt(s.id);r&&r.includes(p)&&(e.correct_answer.includes(p)||u(" incorrect")),e.correct_answer.includes(p)&&u(" correct")},[i,r]);const m=()=>{a||(c[o]?x(Is({id:e.id,answer:s.id})):x(pe({id:e.id,answer:s.id})),f(c.map((p,I)=>I==o?!p:p)))};return t.jsxs("div",{className:`CheckboxAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(T,{name:`question_${e.id}_${o}`,checked:c[o],onChange:m,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:w})]})]})});je.displayName="CheckboxAnswerOption";const U=l.memo(({question:s,index:e,...n})=>{const[o,c]=l.useState([!1,!1,!1,!1]),f=l.useMemo(()=>`CheckboxQuestion${s.correct_answer.includes(0)?" noAnswer":""}`,[s.correct_answer]),d=l.useMemo(()=>{const r=k.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return Q(r,B)},[s.question_direction]),u=r=>{const i=Math.min(Math.max(65,r+65),90);return String.fromCharCode(i)},a=l.useCallback((r,i)=>t.jsx(je,{answerOption:r,question:s,answerOptionBullet:u(i),index:i,selectedValue:o,setSelectedValue:c},`${s.id}_${r.id}`),[o]);return t.jsxs("div",{className:f,...n,children:[t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsx("p",{className:"QuestionContainerNumber",children:`Câu ${e}: (ID-${s.id})`}),t.jsx("div",{children:d})]}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});U.displayName="CheckboxQuestion";const Ls=()=>{const s=h(a=>a.testQuestion.questions),e=h(a=>a.testResult.isTestFininshed),n=h(a=>a.currCourse.course),{shuffleAnswer:o,questionCount:c}=h(a=>a.testConfig),f=S();l.useEffect(()=>{if(e)return;f(v([])),(async()=>{const r=await y(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),i=JSON.parse(r).map(w=>new we(w)),x=u(i);d(x),f(v(x))})()},[e]);const d=a=>{a.forEach(r=>{o&&r.shuffleable&&(r.answer_option=A(r.answer_option))})},u=a=>{const r=A(a);return r.sort((i,x)=>i.cdr-x.cdr),c==="all"||Number.isNaN(Number.parseInt(c))?r:r.slice(0,Number.parseInt(c))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(R,{})}):t.jsx("div",{className:"TestContainer",children:s.map((a,r)=>a.question_type==="radio"?t.jsx(D,{question:a,index:r+1},a.id):t.jsx(U,{question:a,index:r+1},a.id))})},Ps=({setHidePopup:s})=>{const e=h(r=>r.currSubject.subject),n=h(r=>r.testQuestion.questions),o=h(r=>r.testResult),c=S(),f=P("screen and (max-width: 768px)"),d=()=>{!o.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(c(de()),c(Z()),c(V()))},u=()=>{c(Y(!1)),c(Z()),c(V())},a=()=>{const i=ks.getState().userAnswer.answers;let x=0;n.forEach(w=>{const m=JSON.stringify(w.correct_answer.sort()),p=JSON.stringify(i[w.id]&&[...i[w.id]].sort());m===p?(x++,c(Ts(w.id))):c(As(w.id));const I=parseFloat((x/n.length*10).toFixed(2));c(vs(I))}),c(Y(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(b,{children:t.jsx("button",{className:"IconBtn",onClick:d,children:t.jsx(Fe,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!f&&t.jsx(b,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:o.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(b,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx(Me,{})})}),t.jsx(b,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(r=>!r),children:[t.jsxs("div",{children:["Điểm: ",o.score]}),t.jsxs("div",{children:["Kết quả: ",o.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(b,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:a,children:[t.jsx(se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(b,{children:t.jsx(re,{})})]})},Ds=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:o,correctAnswers:c}=h(a=>a.testResult),f=h(a=>a.testQuestion.questions),[d,u]=l.useState("");return l.useEffect(()=>{e(!o),n<5?u("lowScore"):n<8&&u("mediumScore")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${d}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",c.length,"/",f.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Us=({currentQuestionNumber:s})=>{const e=h(r=>r.testQuestion.questions),n=h(r=>r.testResult.isTestFininshed),o=h(r=>r.currCourse.course),{shuffleAnswer:c,questionCount:f}=h(r=>r.testConfig),d=S();l.useEffect(()=>{if(n)return;d(v([])),(async()=>{const i=await y(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),x=JSON.parse(i).map(m=>new we(m)),w=a(x);u(w),d(v(w))})()},[n]);const u=r=>{r.forEach(i=>{c&&i.shuffleable&&(i.answer_option=A(i.answer_option))})},a=r=>{const i=A(r);return i.sort((x,w)=>x.cdr-w.cdr),f==="all"||Number.isNaN(Number.parseInt(f))?i:i.slice(0,Number.parseInt(f))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(R,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((r,i)=>r.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(D,{question:r,index:i+1})},r.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(U,{question:r,index:i+1})},r.id))})},zs=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const n=h(u=>u.testQuestion.questions.length),o=h(u=>u.testConfig.questionCount),c=o!=="all"?parseInt(o):n,f=()=>{const u=Math.min(s+1,c);e(u)},d=()=>{const u=Math.max(s-1,1);e(u)};return t.jsxs("div",{className:"Footer",children:[t.jsxs("button",{className:"PreviousQuestionBtn",onClick:d,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ee,{className:"icon"})})]}),t.jsxs("button",{className:"NextQuestionBtn",onClick:f,disabled:s===c,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(Le,{className:"icon"})})]})]})};export{Fs as C,Bs as N,$s as S,Ps as T,Us as a,Ls as b,Ds as c,zs as d,E as e,L as l,ks as s,Es as u};
