var ye=Object.defineProperty;var Ie=(s,e,n)=>e in s?ye(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var j=(s,e,n)=>Ie(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as y,u as p,a as N,M as Ae,b as Oe,r as l,d as U,F as te,e as Te,f as _e,g as ne,P as ve,h as Qe,$ as ke,s as Re,O as Be,C as Q,i as Le,S as Me,k as re,l as M,m as Ee,p as D,n as z,R as Fe,o as k,T as $e,q as Pe,t as Ue,v as De,w as ze}from"./vendor-D5nTv_za.js";const S=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),We=()=>{let s=localStorage.getItem("theme");return s||(s="dark",oe(s)),s},oe=s=>{localStorage.setItem("theme",s)},Je={theme:We()},ae=y({name:"theme",initialState:Je,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",oe(s.theme)}}}),He=ae.reducer,{switchTheme:qe}=ae.actions,ce=()=>{const s=p(n=>n.theme.theme),e=N();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(qe()),children:s=="light"?t.jsx(Ae,{size:"24px",style:{background:"#00000000"}}):t.jsx(Oe,{size:"24px",style:{background:"#00000000"}})})},Ke={sidebarOpen:!1},ie=y({name:"sidebarOpen",initialState:Ke,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),Ge=ie.reducer,{toggleSidebar:Ve,setIsSidebarOpen:Xe}=ie.actions,Us=()=>{const s=p(m=>m.currSubject.subject),[e,n]=l.useState(!1),o=p(m=>m.sidebarOpen.sidebarOpen),a=U("screen and (max-width: 768px)"),d=N();return l.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(S,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>d(Ve()),disabled:e,children:t.jsx(te,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!a&&t.jsxs(t.Fragment,{children:[t.jsx(S,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(S,{children:t.jsx(Te,{color:"var(--secondary-text-color)"})}),t.jsx(S,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(S,{children:t.jsx(ce,{})})]})};class le{constructor(e){j(this,"id");j(this,"name");j(this,"subject_id");j(this,"_questions");j(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ye=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),Ze=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),es=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let E=null;const ss=async()=>(E||(E=await _e.createDbWorker([{from:"inline",config:{serverMode:"full",url:es,requestChunkSize:4096}}],Ye.toString(),Ze.toString())),E),A=async s=>{const n=await(await ss()).db.query(s);return JSON.stringify(n)},ts=async s=>{try{const e=await A(`select *
            from Course 
            where id = ${s}
            limit 1`);return new le(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ns=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await ts(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},F=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await ns();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),rs={course:null,loading:!1,error:null},ue=y({name:"currCourse",initialState:rs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(F.pending,e=>{e.loading=!0,e.error=null}).addCase(F.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase(F.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),os=ue.reducer,{setCurrCourse:de}=ue.actions,as=({children:s,...e})=>{const[n,o]=l.useState(!1),a=N(),d=U("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const m=()=>{a(de(e.course)),d&&a(Xe(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:m,children:[t.jsx(ve,{strokeWidth:"70px",className:"icon"})," ",s]})})};class cs{constructor(e){j(this,"id");j(this,"name");j(this,"semester_id");Object.assign(this,e)}}const is=async s=>{try{const e=await A(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new cs(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ls=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await is(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},$=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await ls();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),us={subject:null,loading:!1,error:null},he=y({name:"currSubject",initialState:us,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase($.pending,e=>{e.loading=!0,e.error=null}).addCase($.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase($.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ds=he.reducer,{setCurrSubject:hs}=he.actions,ms=s=>{const e=p(r=>r.currSubject.subject),n=p(r=>r.currCourse.course),[o,a]=l.useState(!1),[d,m]=l.useState([]),h=N();l.useEffect(()=>{a((e==null?void 0:e.id)==s.subject.id)},[e]),l.useEffect(()=>{(async()=>{const i=await A(`select *
        from Course
        where subject_id = ${s.subject.id}`),w=JSON.parse(i).map(x=>new le(x));w&&m(w)})()},[]);const c=()=>{(e==null?void 0:e.id)!=s.subject.id&&h(de(null)),h(hs(s.subject))};return t.jsxs("li",{className:`SidebarGroupItem ${o?"selected":""}`,children:[t.jsx("button",{onClick:c,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.subject.name}),t.jsx(Qe,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx("div",{className:`SidebarItemsContainer ${o?"show":""}`,children:t.jsx("ul",{children:d.map((r,i)=>t.jsx(as,{currCourse:n,course:r,children:r.name},i))})})]})},B=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ke,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Ds=()=>{const s=p(o=>o.sidebarOpen.sidebarOpen),[e,n]=l.useState([]);return l.useEffect(()=>{(async()=>{const a=await A("select * from Subject");n(JSON.parse(a))})()},[]),t.jsx("div",{className:`Sidebar ${s?"":"hide"}`,children:!e||e.length==0?t.jsx(B,{}):t.jsx("ul",{children:e.map((o,a)=>t.jsx(ms,{subject:o},a))})})},fs={activeTest:!1},me=y({name:"activeTest",initialState:fs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),ps=me.reducer,{toggleActiveTest:fe}=me.actions,xs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ws=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",gs=()=>localStorage.getItem("showQuestionByPageOption")==="true",bs={shuffleAnswer:xs(),showAnswerOnChosen:ws(),showQuestionByPage:gs(),questionCount:"15"},pe=y({name:"testConfig",initialState:bs,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),js=pe.reducer,{toggleShuffleAnswer:Cs,setQuestionCount:X,toggleShowAnswerOnChosen:Ss,toggleShowQuestionByPage:Ns}=pe.actions,ys=Re(Be)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),zs=()=>{var I,O,T,_;const s=p(u=>u.theme.theme),e=p(u=>u.sidebarOpen.sidebarOpen),n=p(u=>u.currSubject),o=p(u=>u.currCourse),{shuffleAnswer:a,showAnswerOnChosen:d,showQuestionByPage:m}=p(u=>u.testConfig),[h,c]=l.useState({semester:null,loading:!1}),[r,i]=l.useState([]),[w,x]=l.useState(""),f=N();l.useEffect(()=>{(()=>{const C=[10,15,20,30,40,50,60,100,150],b=[];let K=!1;C.forEach(v=>{var G,V;if(o.course&&v>=((G=o.course)==null?void 0:G.question_per_test)){if(!K){const L=(V=o.course)==null?void 0:V.question_per_test;b.push(t.jsx(M,{value:L,sx:{fontSize:14},children:L},L)),K=!0}return}b.push(t.jsx(M,{value:v,sx:{fontSize:14},children:v},v))}),b.push(t.jsx(M,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),i(b)})()},[o.course]),l.useEffect(()=>{const u=async()=>{var b;c({...h,loading:!0});const C=await A(`select *
        from Semester
        where id = ${(b=n.subject)==null?void 0:b.semester_id}`);c({semester:JSON.parse(C)[0],loading:!1})};n.subject&&u()},[n.subject]),l.useEffect(()=>{if(o.course){const u=o.course.question_per_test;x(u.toString()),f(X(u.toString()))}},[o.course]);const g=u=>{const C=u.target.value;x(C),f(X(C))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:h.loading||o.loading||n.loading?t.jsx(B,{}):n.subject&&o.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(I=o.course)==null?void 0:I.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(O=n.subject)==null?void 0:O.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(T=h.semester)==null?void 0:T.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(_=o.course)==null?void 0:_.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:a,onClick:()=>f(Cs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>f(Ss()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:m,onClick:()=>f(Ns()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Le,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Me,{value:w,onChange:g,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(ys,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:r})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>f(fe()),children:[t.jsx(re,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},Is={questions:[]},xe=y({name:"testQuestion",initialState:Is,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),As=xe.reducer,{addTestQuestion:Ws,setTestQuestion:R}=xe.actions,Os={answers:{}},we=y({name:"userAnswer",initialState:Os,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Ts=we.reducer,{addUserAnswer:ge,removeUserAnswer:_s,removeAllUserAnswerById:vs,resetUserAnwser:Y}=we.actions,Z={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},be=y({name:"testResult",initialState:Z,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>Z}}),Qs=be.reducer,{addCorrectAnswer:ks,addWrongAnswer:Rs,setIsTestFinished:ee,setScore:Bs,resetTestResut:se}=be.actions,Ls=Ee({reducer:{theme:He,sidebarOpen:Ge,currSubject:ds,currCourse:os,activeTest:ps,testQuestion:As,userAnswer:Ts,testResult:Qs,testConfig:js},middleware:s=>s({serializableCheck:!1})}),Js=()=>N();class W{constructor(e){j(this,"id");j(this,"_question_direction");j(this,"question_type");j(this,"_answer_option");j(this,"_correct_answer");j(this,"cdr");j(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const J={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},je=l.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:o,setSelectedValue:a})=>{const[d,m]=l.useState(""),h=p(f=>f.testResult.isTestFininshed),c=p(f=>f.userAnswer.answers[e.id]),r=p(f=>f.testConfig.showAnswerOnChosen),i=N(),w=l.useMemo(()=>{const f=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return z(f,J)},[s.value]);l.useEffect(()=>{if(!h)return;const f=Number.parseInt(s.id);if(!c||c.length==0){e.correct_answer.includes(f)&&m(" unanswer");return}c&&c.includes(f)&&(e.correct_answer.includes(f)||m(" incorrect")),e.correct_answer.includes(f)&&m(" correct")},[h]),l.useEffect(()=>{if(!r||(m(""),!c||c.length==0))return;const f=Number.parseInt(s.id);c&&c.includes(f)&&(e.correct_answer.includes(f)||m(" incorrect")),e.correct_answer.includes(f)&&m(" correct")},[r,c]);const x=f=>{h||(a(f.target.value),i(vs(e.id)),i(ge({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(Fe,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:x,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:w})]})]})});je.displayName="RadioAnswerOption";const Ms=({number:s,id:e,directionText:n,haveAnswer:o})=>{const a=l.useMemo(()=>{const d=D.sanitize(n,{USE_PROFILES:{html:!0}});return z(d,J)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!o&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:a})]})},Ce=l.memo(Ms),H=l.memo(({question:s,number:e,...n})=>{const[o,a]=l.useState("0"),d=l.useMemo(()=>s.correct_answer.some(r=>r>0&&r<=s.answer_option.length),[s.correct_answer]),m=d?"RadioQuestion":"RadioQuestion noAnswer",h=r=>{const i=Math.min(Math.max(65,r+65),90);return String.fromCharCode(i)},c=l.useCallback((r,i)=>t.jsx(je,{answerOption:r,question:s,answerOptionBullet:h(i),selectedValue:o,setSelectedValue:a},`${s.id}_${r.id}`),[o]);return t.jsxs("div",{className:m,...n,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(c)})]})});H.displayName="RadioQuestion";const Se=l.memo(({answerOption:s,question:e,answerOptionBullet:n,index:o,selectedValue:a,setSelectedValue:d})=>{const[m,h]=l.useState(""),c=p(g=>g.testResult.isTestFininshed),r=p(g=>g.userAnswer.answers[e.id]),i=p(g=>g.testConfig.showAnswerOnChosen),w=N(),x=l.useMemo(()=>{const g=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return z(g,J)},[s.value]);l.useEffect(()=>{if(!c)return;const g=Number.parseInt(s.id);if(!r||r.length==0){e.correct_answer.includes(g)&&h(" unanswer");return}r&&r.includes(g)&&(e.correct_answer.includes(g)||h(" incorrect")),e.correct_answer.includes(g)&&h(" correct")},[c]),l.useEffect(()=>{if(!i||(h(""),!r||r.length==0))return;const g=Number.parseInt(s.id);r&&r.includes(g)&&(e.correct_answer.includes(g)||h(" incorrect")),e.correct_answer.includes(g)&&h(" correct")},[i,r]);const f=()=>{c||(a[o]?w(_s({id:e.id,answer:s.id})):w(ge({id:e.id,answer:s.id})),d(a.map((g,I)=>I==o?!g:g)))};return t.jsxs("div",{className:`CheckboxAnswerOption${m}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(Q,{name:`question_${e.id}_${o}`,checked:a[o],onChange:f,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:x})]})]})});Se.displayName="CheckboxAnswerOption";const q=l.memo(({question:s,number:e,...n})=>{const[o,a]=l.useState([!1,!1,!1,!1]),d=l.useMemo(()=>s.correct_answer.some(r=>r>0&&r<=s.correct_answer.length),[s.correct_answer]),m=d?"CheckboxQuestion":"CheckboxQuestion noAnswer",h=r=>{const i=Math.min(Math.max(65,r+65),90);return String.fromCharCode(i)},c=l.useCallback((r,i)=>t.jsx(Se,{answerOption:r,question:s,answerOptionBullet:h(i),index:i,selectedValue:o,setSelectedValue:a},`${s.id}_${r.id}`),[o]);return t.jsxs("div",{className:m,...n,children:[t.jsx(Ce,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(c)})]})});q.displayName="CheckboxQuestion";const Hs=()=>{const s=p(c=>c.testQuestion.questions),e=p(c=>c.testResult.isTestFininshed),n=p(c=>c.currCourse.course),{shuffleAnswer:o,questionCount:a}=p(c=>c.testConfig),d=N();l.useEffect(()=>{if(e)return;d(R([])),(async()=>{const r=await A(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`),i=JSON.parse(r).map(x=>new W(x)),w=h(i);m(w),d(R(w))})()},[e]);const m=c=>{c.forEach(r=>{o&&r.shuffleable&&(r.answer_option=k(r.answer_option))})},h=c=>{const r=k(c);return r.sort((i,w)=>i.cdr-w.cdr),a==="all"||Number.isNaN(Number.parseInt(a))?r:r.slice(0,Number.parseInt(a))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(B,{})}):t.jsx("div",{className:"TestContainer",children:s.map((c,r)=>c.question_type==="radio"?t.jsx(H,{question:c,number:r+1},c.id):t.jsx(q,{question:c,number:r+1},c.id))})},qs=({setHidePopup:s})=>{const e=p(r=>r.currSubject.subject),n=p(r=>r.testQuestion.questions),o=p(r=>r.testResult),a=N(),d=U("screen and (max-width: 768px)"),m=()=>{!o.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(a(fe()),a(se()),a(Y()))},h=()=>{a(ee(!1)),a(se()),a(Y())},c=()=>{const i=Ls.getState().userAnswer.answers;let w=0;n.forEach(x=>{const f=JSON.stringify(x.correct_answer.sort()),g=JSON.stringify(i[x.id]&&[...i[x.id]].sort());f===g?(w++,a(ks(x.id))):a(Rs(x.id));const I=parseFloat((w/n.length*10).toFixed(2));a(Bs(I))}),a(ee(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(S,{children:t.jsx("button",{className:"IconBtn",onClick:m,children:t.jsx($e,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!d&&t.jsx(S,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:o.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(S,{children:t.jsx("button",{className:"IconBtn",onClick:h,children:t.jsx(Pe,{})})}),t.jsx(S,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(r=>!r),children:[t.jsxs("div",{children:["Điểm: ",o.score]}),t.jsxs("div",{children:["Kết quả: ",o.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(S,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:c,children:[t.jsx(re,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(S,{children:t.jsx(ce,{})})]})},Ks=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:o,correctAnswers:a}=p(c=>c.testResult),d=p(c=>c.testQuestion.questions),[m,h]=l.useState("");return l.useEffect(()=>{e(!o),n<5?h("lowScore"):n<8&&h("mediumScore")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${m}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",a.length,"/",d.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Gs=({currentQuestionNumber:s})=>{const e=p(r=>r.testQuestion.questions),n=p(r=>r.testResult.isTestFininshed),o=p(r=>r.currCourse.course),{shuffleAnswer:a,questionCount:d}=p(r=>r.testConfig),m=N();l.useEffect(()=>{if(n)return;m(R([])),(async()=>{const i=await A(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),w=JSON.parse(i).map(f=>new W(f)),x=c(w);h(x),m(R(x))})()},[n]);const h=r=>{r.forEach(i=>{a&&i.shuffleable&&(i.answer_option=k(i.answer_option))})},c=r=>{const i=k(r);return i.sort((w,x)=>w.cdr-x.cdr),d==="all"||Number.isNaN(Number.parseInt(d))?i:i.slice(0,Number.parseInt(d))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(B,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((r,i)=>r.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(H,{question:r,number:i+1})},r.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(q,{question:r,number:i+1})},r.id))})},Es=({currentIndex:s,questionNumbers:e})=>{const o=l.useRef(null),a=l.useRef(null),[d,m]=l.useState(0),[h,c]=l.useState(0);return l.useEffect(()=>{if(a.current&&o.current){const r=o.current.clientWidth,{defaultWidth:i,offsetFromCenter:w}=Fs(a.current,r);m(i),c(w)}},[]),l.useEffect(()=>{if(!(!d||!h)&&a.current&&o.current){const r=s-1+2,i=a.current.querySelectorAll(".QuestionNumberIndicatorItem"),w=i[r];i.forEach((x,f)=>{x.classList.remove("neighbour","current"),f===r&&x.classList.add("current"),Math.abs(f-r)===1&&x.classList.add("neighbour")}),w&&(a.current.style.transform=`translateX(${-(d*r)+h}px)`)}},[s,d,h]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:o,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:a,children:t.jsx(Ne,{questionNumbers:e,fakeItemCount:2})})})},Ne=l.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=o=>Array(e).fill(0).map((a,d)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:a},d+o));return t.jsxs(t.Fragment,{children:[n(-e),s.map(o=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:o},o)),n(s.length+1)]})});Ne.displayName="QuestionNumberIndicatorList";const Fs=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",s.appendChild(n);const o=P(n);n.classList.add("neighbour");const a=P(n);n.classList.remove("neighbour"),n.classList.add("current");const d=P(n),m=a-o,h=(e-d)/2-m;return s.removeChild(n),{defaultWidth:o,neighborWidth:a,currentWidth:d,offsetFromCenter:h}},P=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},Vs=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const n=p(u=>u.theme.theme),o=p(u=>u.userAnswer.answers),a=p(u=>u.testQuestion.questions),{correctAnswers:d,wrongAnswers:m}=p(u=>u.testResult),h=p(u=>u.testConfig.questionCount),c=h!=="all"?parseInt(h):a.length,r=l.useMemo(()=>[...Array(c).keys()].map(u=>u+1),[c]),[i,w]=l.useState(null),x=!!i,f=u=>{w(u.currentTarget)},g=()=>{w(null)},I=u=>{let C="QuestionListMenuItem";try{const b=a[u-1];b instanceof W&&(!o||o&&!o[b==null?void 0:b.id]?C+=" unanswer":d.includes(b==null?void 0:b.id)?C+=" correct":m.includes(b==null?void 0:b.id)&&(C+=" incorrect"))}catch{console.log(`Question number ${u} does not exists`)}return u===s&&(C+=" selected"),C},O=u=>{e(u),g()},T=()=>{const u=Math.min(s+1,c);e(u)},_=()=>{const u=Math.max(s-1,1);e(u)};return t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":x?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":x?"true":void 0,onClick:f,children:t.jsx(te,{className:"icon",size:16})}),t.jsx(Ue,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:i,open:x,onClose:g,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":n,children:t.jsx("div",{className:"QuestionListMenuContent",children:r.map(u=>t.jsx("button",{className:I(u),onClick:()=>O(u),children:u},u))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:_,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(De,{className:"icon"})})]}),t.jsx(Es,{currentIndex:s,questionNumbers:r}),t.jsxs("button",{className:"NextQuestionBtn",onClick:T,disabled:s===c,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(ze,{className:"icon"})})]})]})};export{zs as C,Us as N,Ds as S,qs as T,Gs as a,Hs as b,Ks as c,Vs as d,F as e,$ as l,Ls as s,Js as u};
