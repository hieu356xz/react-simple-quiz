var ts=Object.defineProperty;var rs=(s,e,r)=>e in s?ts(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var C=(s,e,r)=>rs(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as w,a as I,M as ns,b as os,r as l,d as re,F as fe,e as is,f as as,g as ne,P as cs,h as ls,A as us,$ as ds,s as we,O as ge,S as xe,i as G,C as H,k as hs,l as Se,m as ps,p as $,n as D,R as be,B as ms,o as fs,q as ws,t as je,D as gs,v as xs,w as Ss,x as bs,y as z,T as js,z as Cs,E as Ns,G as ys,H as _s}from"./vendor-CWJemwrG.js";const Q=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Is=()=>{let s=localStorage.getItem("theme");return s||(s="dark",Ce(s)),s},Ce=s=>{localStorage.setItem("theme",s)},vs={theme:Is()},Ne=O({name:"theme",initialState:vs,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",Ce(s.theme)}}}),As=Ne.reducer,{switchTheme:Qs}=Ne.actions,ye=()=>{const s=w(r=>r.theme.theme),e=I();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Qs()),children:s=="light"?t.jsx(ns,{size:"24px",style:{background:"#00000000"}}):t.jsx(os,{size:"24px",style:{background:"#00000000"}})})},Os={sidebarOpen:!1},_e=O({name:"sidebarOpen",initialState:Os,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),Ts=_e.reducer,{toggleSidebar:Ie,setIsSidebarOpen:Rs}=_e.actions,Et=()=>{const s=w(p=>p.currSubject.subject),[e,r]=l.useState(!1),o=w(p=>p.sidebarOpen.sidebarOpen),h=re("screen and (max-width: 768px)"),u=I();return l.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>u(Ie()),disabled:e,children:t.jsx(fe,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!h&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx(is,{color:"var(--secondary-text-color)"})}),t.jsx(Q,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(Q,{children:t.jsx(ye,{})})]})};class ve{constructor(e){C(this,"id");C(this,"name");C(this,"subject_id");C(this,"_questions");C(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Es=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),ks=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),$s=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let X=null;const Ds=async()=>(X||(X=await as.createDbWorker([{from:"inline",config:{serverMode:"full",url:$s,requestChunkSize:4096}}],Es.toString(),ks.toString())),X),T=async s=>{const r=await(await Ds()).db.query(s);return JSON.stringify(r)},Ms=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ve(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Fs=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await Ms(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},Y=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Fs();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Bs={course:null,loading:!1,error:null},Ae=O({name:"currCourse",initialState:Bs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(Y.pending,e=>{e.loading=!0,e.error=null}).addCase(Y.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(Y.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ls=Ae.reducer,{setCurrCourse:Qe}=Ae.actions,Ps=({children:s,...e})=>{const[r,o]=l.useState(!1),h=I(),u=re("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const p=()=>{h(Qe(e.course)),u&&h(Rs(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:p,children:[t.jsx(cs,{strokeWidth:"70px",className:"icon"})," ",s]})})};class Us{constructor(e){C(this,"id");C(this,"name");C(this,"semester_id");Object.assign(this,e)}}const Hs=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new Us(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Gs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await Hs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},Z=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Gs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),zs={subject:null,loading:!1,error:null},Oe=O({name:"currSubject",initialState:zs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(Z.pending,e=>{e.loading=!0,e.error=null}).addCase(Z.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(Z.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Js=Oe.reducer,{setCurrSubject:Ws}=Oe.actions,Vs=({subject:s})=>{const e=w(n=>n.currSubject.subject),r=w(n=>n.currCourse.course),[o,h]=l.useState(!1),[u,p]=l.useState(!1),[a,f]=l.useState([]),m=`SidebarGroupItem ${o?"selected":""} ${u?"expanded":""}`,c=I();l.useEffect(()=>{h((e==null?void 0:e.id)===s.id),p((e==null?void 0:e.id)===s.id)},[e]),l.useEffect(()=>{(async()=>{const i=await T(`select *
        from Course
        where subject_id = ${s.id}`),g=JSON.parse(i).map(b=>new ve(b));g&&f(g)})()},[]);const d=()=>{(e==null?void 0:e.id)!==s.id&&c(Qe(null)),c(Ws(s)),p(n=>!n)};return t.jsxs("li",{className:m,children:[t.jsx("button",{onClick:d,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(ls,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(us,{height:u?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:a.map((n,i)=>t.jsx(Ps,{currCourse:r,course:n,children:n.name},i))})})]})};class Ks{constructor(e){C(this,"id");C(this,"name");Object.assign(this,e)}}const Xs=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new Ks(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Ys=async()=>{let s=localStorage.getItem("SemesterId");if(s){const e=await Xs(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},q=ne("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Ys();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Zs={semester:null,loading:!1,error:null},Te=O({name:"currSemester",initialState:Zs,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(q.pending,e=>{e.loading=!0,e.error=null}).addCase(q.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(q.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),qs=Te.reducer,{setCurrSemester:ae}=Te.actions,W=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ds,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),et=we(ge)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),kt=()=>{const s=w(c=>c.sidebarOpen.sidebarOpen),e=w(c=>c.currSemester.semester),[r,o]=l.useState([]),[h,u]=l.useState([]),[p,a]=l.useState([]),f=I();l.useEffect(()=>{(async()=>{const d=await T("select * from Subject");o(JSON.parse(d));const n=await T("select * from Semester");u(JSON.parse(n))})()},[]),l.useEffect(()=>{const c=e?r.filter(d=>d.semester_id===e.id):r;a(c)},[e,r]);const m=c=>{const d=Number(c.target.value);if(d===-1)f(ae(null));else{const n=h.find(i=>i.id===d);n&&f(ae(n))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!h?t.jsx(W,{}):t.jsxs(t.Fragment,{children:[t.jsxs(xe,{name:"semester",value:e&&h.length>0?e.id:-1,onChange:m,input:t.jsx(et,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(G,{value:-1,children:"Tất cả"}),h.map(c=>t.jsx(G,{value:c.id,children:c.name},c.id))]}),!p||p.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:p.map(c=>t.jsx(Vs,{subject:c},c.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>f(Ie())})]})};class V{constructor(e){C(this,"id");C(this,"_question_direction");C(this,"question_type");C(this,"_answer_option");C(this,"_correct_answer");C(this,"input_correct_answer");C(this,"cdr");C(this,"group_id");C(this,"_shuffleable");C(this,"number_answer_correct");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const st={activeTest:!1},Re=O({name:"activeTest",initialState:st,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),tt=Re.reducer,{toggleActiveTest:Ee}=Re.actions,rt=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",nt=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",ot=()=>localStorage.getItem("showQuestionByPageOption")==="true",it={shuffleAnswer:rt(),showAnswerOnChosen:nt(),showQuestionByPage:ot(),questionCount:"15"},ke=O({name:"testConfig",initialState:it,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),at=ke.reducer,{toggleShuffleAnswer:ct,setQuestionCount:ce,toggleShowAnswerOnChosen:lt,toggleShowQuestionByPage:ut}=ke.actions,M={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},te=s=>{const e=[],r={};return s.forEach(o=>{o.question_type==="grouping"&&o.group_id||o.question_type==="group-input"&&o.group_id||o.question_type==="drag_drop"&&o.group_id||o.question_type==="group-radio"&&o.group_id?r[o.group_id]=[...r[o.group_id]||[],o]:e.push(o)}),{filteredQuestions:e,groupedQuestions:r}},dt=we(ge)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),$t=()=>{var y,x,v;const s=w(j=>j.theme.theme),e=w(j=>j.sidebarOpen.sidebarOpen),r=w(j=>j.currSubject),o=w(j=>j.currCourse),{shuffleAnswer:h,showAnswerOnChosen:u,showQuestionByPage:p}=w(j=>j.testConfig),[a,f]=l.useState({semester:null,loading:!1}),[m,c]=l.useState([]),[d,n]=l.useState(""),[i,g]=l.useState({value:0,loading:!1}),[b,_]=l.useState({value:0,loading:!1}),N=I();l.useEffect(()=>{(()=>{if(!o.course)return;const A=[10,15,20,30,40,50,60,80,100,150],R=[],F=o.course.question_per_test;A.includes(F)||(A.push(F),A.sort()),A.forEach(E=>{var U;!o.course||E>=((U=o.course)==null?void 0:U.questions.length)||R.push(t.jsx(G,{value:E,sx:{fontSize:14},children:E},E))}),R.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),c(R)})()},[o.course]),l.useEffect(()=>{const j=async()=>{var R;f({...a,loading:!0});const A=await T(`select *
        from Semester
        where id = ${(R=r.subject)==null?void 0:R.semester_id}`);f({semester:JSON.parse(A)[0],loading:!1})};r.subject&&j()},[r.subject]),l.useEffect(()=>{if(o.course){const A=o.course.question_per_test;n(A.toString()),N(ce(A.toString()))}(async()=>{if(!o.course)return;const A=await T(`
        SELECT *
        FROM Question
        WHERE id IN (${o.course.questions.join(",")})
      `),R=JSON.parse(A).map(k=>new V(k)),{filteredQuestions:F,groupedQuestions:E}=te(R),U=F.length;let ie=F.filter(k=>!k.correct_answer.some(B=>B<0)&&(k.question_type==="radio"||k.question_type==="checkbox")).length;for(const k in E)if(E.hasOwnProperty(k)){let B=!0;E[k].forEach(K=>{K.question_type!=="group-input"?K.correct_answer.some(ss=>ss<0)&&(B=!1):K.input_correct_answer||(B=!1)}),B&&ie++}g({value:ie,loading:!1}),_({value:U,loading:!1})})()},[o.course]);const S=j=>{const A=j.target.value;n(A),N(ce(A))};return a.loading||o.loading||r.loading||i.loading||b.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(W,{})}):!r.subject||!o.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(y=o.course)==null?void 0:y.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(x=r.subject)==null?void 0:x.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(v=a.semester)==null?void 0:v.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:b.value})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:i.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>N(ct()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>N(lt()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:p,onClick:()=>N(ut()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(hs,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(xe,{value:d,onChange:S,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(dt,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:m})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>N(Ee()),children:[t.jsx(Se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},ht={questions:[],filteredQuestions:[],groupedQuestions:{}},$e=O({name:"testQuestion",initialState:ht,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload);const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o},setTestQuestion:(s,e)=>{s.questions=e.payload;const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o}}}),pt=$e.reducer,{addTestQuestion:Dt,setTestQuestion:J}=$e.actions,mt={answers:{},input_answers:{}},De=O({name:"userAnswer",initialState:mt,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(o=>!isNaN(o));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),ft=De.reducer,{addUserAnswer:oe,removeUserAnswer:wt,updateUserAnswer:gt,setInputAnswer:xt,removeInputAnswer:Mt,removeAllUserAnswerById:Me,resetUserAnwser:le}=De.actions,ue={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},Fe=O({name:"testResult",initialState:ue,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>ue}}),St=Fe.reducer,{addCorrectAnswer:de,addWrongAnswer:he,setIsTestFinished:pe,setScore:bt,resetTestResut:me}=Fe.actions,Be=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),jt=Be.reducer,{setCurrentQuestion:L}=Be.actions,Ct=ps({reducer:{theme:As,sidebarOpen:Ts,currSubject:Js,currCourse:Ls,currSemester:qs,activeTest:tt,testQuestion:pt,userAnswer:ft,testResult:St,testConfig:at,testNavigation:jt},middleware:s=>s({serializableCheck:!1})}),Ft=()=>I(),Le=l.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:o,setSelectedValue:h})=>{const[u,p]=l.useState(""),a=w(i=>i.testResult.isTestFininshed),f=w(i=>i.userAnswer.answers[e.id]),m=w(i=>i.testConfig.showAnswerOnChosen),c=I(),d=l.useMemo(()=>{const i=$.sanitize(s.value,{USE_PROFILES:{html:!0}});return D(i,M)},[s.value]);l.useEffect(()=>{if(!a)return;const i=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(i)&&p(" unanswer");return}f&&f.includes(i)&&(e.correct_answer.includes(i)||p(" incorrect")),e.correct_answer.includes(i)&&p(" correct")},[a]),l.useEffect(()=>{if(!m||(p(""),!f||f.length==0))return;const i=Number.parseInt(s.id);f&&f.includes(i)&&(e.correct_answer.includes(i)||p(" incorrect")),e.correct_answer.includes(i)&&p(" correct")},[m,f]);const n=i=>{a||(h(i.target.value),c(Me(e.id)),c(oe({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(be,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:n,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});Le.displayName="RadioAnswerOption";const Nt=({number:s,id:e,directionText:r,haveAnswer:o,children:h})=>{const u=l.useMemo(()=>{const p=$.sanitize(r,{USE_PROFILES:{html:!0}});return D(p,M)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!o&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:u}),h&&t.jsx("div",{className:"QuestionContainerAdditional",children:h})]})},P=l.memo(Nt),Pe=l.forwardRef(({question:s,number:e,...r},o)=>{const[h,u]=l.useState("0"),p=l.useMemo(()=>s.correct_answer.some(c=>c>-1),[s.correct_answer]),a=p?"RadioQuestion":"RadioQuestion noAnswer",f=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},m=l.useCallback((c,d)=>t.jsx(Le,{answerOption:c,question:s,answerOptionBullet:f(d),selectedValue:h,setSelectedValue:u},`${s.id}_${c.id}`),[h]);return t.jsxs("div",{className:a,...r,ref:o,children:[t.jsx(P,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(m)})]})});Pe.displayName="RadioQuestion";const Ue=l.memo(Pe),He=l.memo(({answerOption:s,question:e,answerOptionBullet:r,index:o,selectedValue:h,setSelectedValue:u})=>{const[p,a]=l.useState(""),f=w(g=>g.testResult.isTestFininshed),m=w(g=>g.userAnswer.answers[e.id]),c=w(g=>g.testConfig.showAnswerOnChosen),d=I(),n=l.useMemo(()=>{const g=$.sanitize(s.value,{USE_PROFILES:{html:!0}});return D(g,M)},[s.value]);l.useEffect(()=>{if(!f)return;const g=Number.parseInt(s.id);if(!m||m.length==0){e.correct_answer.includes(g)&&a(" unanswer");return}m&&m.includes(g)&&(e.correct_answer.includes(g)||a(" incorrect")),e.correct_answer.includes(g)&&a(" correct")},[f]),l.useEffect(()=>{if(!c||(a(""),!m||m.length==0))return;const g=Number.parseInt(s.id);m&&m.includes(g)&&(e.correct_answer.includes(g)||a(" incorrect")),e.correct_answer.includes(g)&&a(" correct")},[c,m]);const i=()=>{f||(h[o]?d(wt({id:e.id,answer:s.id})):d(oe({id:e.id,answer:s.id})),u(h.map((g,b)=>b==o?!g:g)))};return t.jsxs("div",{className:`CheckboxAnswerOption${p}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(H,{name:`question_${e.id}_${o}`,checked:h[o],onChange:i,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:n})]})]})});He.displayName="CheckboxAnswerOption";const Ge=l.forwardRef(({question:s,number:e,...r},o)=>{const[h,u]=l.useState([!1,!1,!1,!1]),p=l.useMemo(()=>s.correct_answer.some(c=>c>-1),[s.correct_answer]),a=p?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=c=>{const d=Math.min(Math.max(65,c+65),90);return String.fromCharCode(d)},m=l.useCallback((c,d)=>t.jsx(He,{answerOption:c,question:s,answerOptionBullet:f(d),index:d,selectedValue:h,setSelectedValue:u},`${s.id}_${c.id}`),[h]);return t.jsxs("div",{className:a,...r,ref:o,children:[t.jsx(P,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p,children:t.jsxs("span",{className:"NumberCorrectAnswer",children:[t.jsx(ms,{className:"NumberCorrectAnswerIcon"}),"Sinh viên chọn ",s.number_answer_correct," phương án đúng nhất"]})}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(m)})]})});Ge.displayName="CheckboxQuestion";const ze=l.memo(Ge),Je=l.memo(({answerOption:s,question:e})=>{const r=l.useMemo(()=>{const f=$.sanitize(s.value,{USE_PROFILES:{html:!0}});return D(f,M)},[s.value]),{attributes:o,listeners:h,setNodeRef:u,transform:p}=fs({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id}}),a={transform:ws.Translate.toString(p)};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:u,...h,...o,style:a,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:r})})});Je.displayName="DragDropAnswerOption";const yt=({question:s,index:e,selectedAnswers:r,children:o})=>{const{setNodeRef:h,isOver:u}=je({id:s.id}),[p,a]=l.useState(""),f=w(i=>i.testResult.isTestFininshed),m=w(i=>i.userAnswer.answers[s.id]),c=w(i=>i.testConfig.showAnswerOnChosen),d=I(),n=l.useMemo(()=>{const i=$.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return D(i,M)},[s.question_direction]);return l.useEffect(()=>{if(!f)return;if(!m||m.length==0){s.correct_answer.length>0&&a(" unanswer");return}const i=JSON.stringify(s.correct_answer.sort()),g=JSON.stringify(m&&[...m].sort());a(i===g?" correct":" incorrect")},[f]),l.useEffect(()=>{if(!c||(a(""),!m||m.length==0))return;const i=JSON.stringify(s.correct_answer.sort()),g=JSON.stringify(m&&[...m].sort());a(i===g?" correct":" incorrect")},[c,m]),l.useEffect(()=>{f||m===void 0&&r.length===0||d(gt({id:s.id,answers:r}))},[r]),t.jsxs("div",{className:`DragDropInputQuestion${p}`,children:[t.jsx("span",{className:"DragDropInputTextDirection",children:e?`${e}) ${n}`:n}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:h,children:o}),t.jsx("p",{className:"DragDropInputMessage",style:u||o!=null&&o.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]})},We=l.forwardRef(({dragQuestion:s,inputQuestions:e,number:r,...o},h)=>{const[u,p]=l.useState({[s.id]:s.answer_option.map(n=>Number(n.id))}),a=s.question_type==="grouping",f=l.useMemo(()=>{let n=!0;return e.forEach(i=>{i.correct_answer.some(g=>g>-1)||(n=!1)}),n},[e]),m=f?"DragDropQuestion":"DragDropQuestion noAnswer",c=n=>{const{active:i,over:g}=n;if(!g||!i.data.current)return;const b=Number(i.data.current.answerOptionId),_=g.id;p(N=>{const S={...N};S[_]||(S[_]=[]);let y=-1;for(const x in S)if(S.hasOwnProperty(x)&&S[x].includes(b)){y=Number(x);break}if(y!==-1)if(!a&&_!==s.id&&S[_]&&S[_].length>=1){const x=S[_][0];S[_]=[b],S[y]=S[y].filter(v=>v!==b),S[y]=[...S[y],x]}else S[y]=S[y].filter(x=>x!==b),S[_]=[...S[_],b];return S})},d=l.useCallback(n=>t.jsx(Je,{answerOption:n,question:s},`${s.id}_${n.id}`),[s]);return t.jsx("div",{className:m,...o,ref:h,children:t.jsxs(gs,{onDragEnd:c,modifiers:[xs],children:[t.jsx(P,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:f,children:t.jsx(_t,{questionId:s.id,children:s.answer_option.filter(n=>u[s.id].includes(Number(n.id))).map(d)})}),t.jsx("div",{className:`DragDropInputQuestions ${a?"card":"row"}`,children:e.map((n,i)=>t.jsx(yt,{question:n,index:a?i+1:void 0,selectedAnswers:u[n.id]||[],children:u[n.id]&&s.answer_option.filter(g=>u[n.id].includes(Number(g.id))).map(d)},n.id))})]})})}),_t=({children:s,questionId:e})=>{const{setNodeRef:r}=je({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};We.displayName="DragDropQuestion";const Ve=l.memo(We),It=({question:s,index:e})=>{const[r,o]=l.useState(""),[h,u]=l.useState(""),p=w(i=>i.testResult.isTestFininshed),a=w(i=>i.userAnswer.input_answers[s.id]),f=w(i=>i.testConfig.showAnswerOnChosen),m=I(),c=l.useMemo(()=>{const i=$.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return D(i,M)},[s.question_direction]);l.useEffect(()=>{var i;if(p){if(!a){o(" unanswer");return}((i=s==null?void 0:s.input_correct_answer)==null?void 0:i.toLowerCase())===a.toLowerCase()?o(" correct"):o(" incorrect")}},[p]),l.useEffect(()=>{var i;f&&(o(""),a&&(((i=s==null?void 0:s.input_correct_answer)==null?void 0:i.toLowerCase())===a.toLowerCase()?o(" correct"):o(" incorrect")))},[f,a]);const d=l.useCallback(Ss.debounce(i=>{m(xt({id:s.id,answer:i}))},350),[m,s.id]),n=i=>{if(p)return;const g=i.target.value;u(g),d(g)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${c}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:h,onInput:n,spellCheck:!1})})]})},Ke=l.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},h)=>{const u=l.useMemo(()=>!e.some(a=>a.input_correct_answer===null),[e]),p=u?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:h,children:[t.jsx(P,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((a,f)=>t.jsx(It,{question:a,index:f+1},a.id))})]})});Ke.displayName="GroupInputQuestion";const Xe=l.memo(Ke),Ye=l.memo(({answerOption:s,question:e,selectedValue:r,setSelectedValue:o})=>{const[h,u]=l.useState(""),p=w(n=>n.testResult.isTestFininshed),a=w(n=>n.userAnswer.answers[e.id]),f=w(n=>n.testConfig.showAnswerOnChosen),m=I(),c=l.useMemo(()=>{const n=$.sanitize(s.value,{USE_PROFILES:{html:!0}});return D(n,M)},[s.value]);l.useEffect(()=>{if(!p)return;const n=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(n)&&u(" unanswer");return}a&&a.includes(n)&&(e.correct_answer.includes(n)||u(" incorrect")),e.correct_answer.includes(n)&&u(" correct")},[p]),l.useEffect(()=>{if(!f||(u(""),!a||a.length==0))return;const n=Number.parseInt(s.id);a&&a.includes(n)&&(e.correct_answer.includes(n)||u(" incorrect")),e.correct_answer.includes(n)&&u(" correct")},[f,a]);const d=n=>{p||(o(n.target.value),m(Me(e.id)),m(oe({id:e.id,answer:s.id})))};return t.jsxs("label",{className:`GroupRadioAnswerOption${h}`,children:[t.jsx(be,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:d,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:c})]})});Ye.displayName="GroupRadioAnswerOption";const vt=({question:s,index:e})=>{const[r,o]=l.useState("-1"),h=l.useMemo(()=>{const u=$.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return D(u,M)},[s.question_direction]);return t.jsxs("div",{className:"GroupRadioInputQuestion",children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupRadioInputTextDirection",children:`${e}) ${h}`}),t.jsx("div",{className:"GroupRadioInputContainer",children:s.answer_option.map(u=>t.jsx(Ye,{answerOption:u,question:s,selectedValue:r,setSelectedValue:o},u.id))})]})},Ze=l.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},h)=>{const u=l.useMemo(()=>{let a=!0;return e.forEach(f=>{f.correct_answer.some(m=>m>-1)||(a=!1)}),a},[e]),p=u?"GroupRadioQuestion":"GroupRadioQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:h,children:[t.jsx(P,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"GroupRadioInputQuestions",children:e.map((a,f)=>t.jsx(vt,{question:a,index:f+1},a.id))})]})});Ze.displayName="GroupRadioQuestion";const qe=l.memo(Ze),At=({children:s,sectionRefs:e,rootSelector:r,offset:o,as:h,...u})=>{const p=bs({sectionRefs:e,rootSelector:r,offset:o}),a=w(c=>c.testNavigation.currentQuestionNumber),f=I();l.useEffect(()=>{p.currentElementIndexInViewport===-1||p.currentElementIndexInViewport+1===a||f(L(p.currentElementIndexInViewport+1))},[p]);const m=h||"div";return t.jsx(m,{...u,children:s})},Bt=()=>{const s=w(n=>n.testQuestion.filteredQuestions),e=w(n=>n.testQuestion.groupedQuestions),r=w(n=>n.testResult.isTestFininshed),o=w(n=>n.currCourse.course),{shuffleAnswer:h,questionCount:u}=w(n=>n.testConfig),p=I(),a=l.useRef([]),[f,m]=l.useState(-60);l.useEffect(()=>{window.innerHeight!==0&&m(-60-window.innerHeight/4)},[window.innerHeight]),l.useMemo(()=>{a.current.length!==s.length&&(a.current=Array(s.length).fill(null).map((n,i)=>a.current[i]||l.createRef()))},[s.length]),l.useEffect(()=>{if(r)return;p(J([])),(async()=>{const i=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),g=JSON.parse(i).map(_=>new V(_)),b=d(g);c(b),p(J(b))})()},[r]);const c=n=>{n.forEach(i=>{h&&i.shuffleable&&(i.answer_option=z(i.answer_option))})},d=n=>{const i=z(n);return i.sort((g,b)=>g.cdr-b.cdr),u==="all"||Number.isNaN(Number.parseInt(u))?i:i.slice(0,Number.parseInt(u))};return!s||s.length==0||!a.current?t.jsx("div",{className:"TestContainer",children:t.jsx(W,{})}):t.jsx(At,{as:"div",className:"TestContainer",sectionRefs:a.current,offset:f,children:s.map((n,i)=>n.question_type==="radio"?t.jsx(Ue,{ref:a.current[i],question:n,id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="drag_drop"||n.question_type==="grouping"?t.jsx(Ve,{ref:a.current[i],dragQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="group-input"?t.jsx(Xe,{ref:a.current[i],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):n.question_type==="group-radio"?t.jsx(qe,{ref:a.current[i],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${i+1}`,number:i+1},n.id):t.jsx(ze,{ref:a.current[i],question:n,id:`questionNumber_${i+1}`,number:i+1},n.id))})},Lt=({setHidePopup:s})=>{const e=w(d=>d.currSubject.subject),r=w(d=>d.testQuestion.filteredQuestions),o=w(d=>d.testQuestion.groupedQuestions),h=w(d=>d.testResult),u=I(),p=re("screen and (max-width: 768px)"),a=()=>{!h.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(u(Ee()),u(me()),u(le()))},f=()=>{u(pe(!1)),u(me()),u(le())},m=(d,n)=>Array.isArray(d)&&Array.isArray(n)?JSON.stringify(d.sort())===JSON.stringify(n.sort()):typeof d=="string"&&typeof n=="string"?d.toLowerCase()===n.toLowerCase():!1,c=()=>{const d=Ct.getState(),n=d.userAnswer.answers,i=d.userAnswer.input_answers;let g=0;r.forEach(b=>{if(o[b.id]){let N=!0;o[b.id].forEach(S=>{if(S.question_type!=="group-input"){const y=n[S.id]||[];m(y,S.correct_answer)||(N=!1)}else{const y=i[S.id]||null;!y||!S.input_correct_answer?N=!1:m(y,S.input_correct_answer)||(N=!1)}}),N?(g++,u(de(b.id))):u(he(b.id))}else{let N=!0;if(b.question_type!=="group-input"){const S=n[b.id]||[];m(S,b.correct_answer)||(N=!1)}else{const S=i[b.id]||null;!S||!b.input_correct_answer?N=!1:m(S,b.input_correct_answer)||(N=!1)}N?(g++,u(de(b.id))):u(he(b.id))}const _=parseFloat((g/r.length*10).toFixed(2));u(bt(_))}),u(pe(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:a,children:t.jsx(js,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!p&&t.jsx(Q,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:h.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(Cs,{})})}),t.jsx(Q,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(d=>!d),children:[t.jsxs("div",{children:["Điểm: ",h.score]}),t.jsxs("div",{children:["Kết quả: ",h.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(Q,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:c,children:[t.jsx(Se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(Q,{children:t.jsx(ye,{})})]})},Pt=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:o,correctAnswers:h}=w(f=>f.testResult),u=w(f=>f.testQuestion.filteredQuestions),[p,a]=l.useState("");return l.useEffect(()=>{e(!o),r<5?a("lowScore"):r<8?a("mediumScore"):a("")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${p}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",h.length,"/",u.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Ut=()=>{const s=w(c=>c.testQuestion.filteredQuestions),e=w(c=>c.testQuestion.groupedQuestions),r=w(c=>c.testResult.isTestFininshed),o=w(c=>c.currCourse.course),h=w(c=>c.testNavigation.currentQuestionNumber),{shuffleAnswer:u,questionCount:p}=w(c=>c.testConfig),a=I();l.useEffect(()=>{if(r||a(L(1)),r)return;a(J([])),(async()=>{const d=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),n=JSON.parse(d).map(g=>new V(g)),i=m(n);f(i),a(J(i))})()},[r]);const f=c=>{c.forEach(d=>{u&&d.shuffleable&&(d.answer_option=z(d.answer_option))})},m=c=>{const d=z(c);return d.sort((n,i)=>n.cdr-i.cdr),p==="all"||Number.isNaN(Number.parseInt(p))?d:d.slice(0,Number.parseInt(p))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(W,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((c,d)=>c.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Ue,{question:c,number:d+1})},c.id):c.question_type==="drag_drop"?t.jsx("div",{className:"DragDropQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Ve,{dragQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):c.question_type==="group-input"?t.jsx("div",{className:"GroupInputQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(Xe,{topicQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):c.question_type==="group-radio"?t.jsx("div",{className:"GroupRadioQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(qe,{topicQuestion:c,inputQuestions:e[c.id]||[],number:d+1})},c.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:h!==d+1?{display:"none"}:{},children:t.jsx(ze,{question:c,number:d+1})},c.id))})},Qt=({currentIndex:s,questionNumbers:e})=>{const o=l.useRef(null),h=l.useRef(null),[u,p]=l.useState(0),[a,f]=l.useState(0);return l.useEffect(()=>{if(h.current&&o.current){const m=o.current.clientWidth,{defaultWidth:c,offsetFromCenter:d}=Ot(h.current,m);p(c),f(d)}},[]),l.useEffect(()=>{if(!(!u||!a)&&h.current&&o.current){const m=(s!==-1?s:1)-1+2,c=h.current.querySelectorAll(".QuestionNumberIndicatorItem"),d=c[m];c.forEach((n,i)=>{n.classList.remove("neighbour","current"),i===m&&n.classList.add("current"),Math.abs(i-m)===1&&n.classList.add("neighbour")}),d&&(h.current.style.transform=`translateX(${-(u*m)+a}px)`)}},[s,u,a]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:o,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:h,children:t.jsx(es,{questionNumbers:e,fakeItemCount:2})})})},es=l.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=o=>Array(e).fill(0).map((h,u)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:h},u+o));return t.jsxs(t.Fragment,{children:[r(-e),s.map(o=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:o},o)),r(s.length+1)]})});es.displayName="QuestionNumberIndicatorList";const Ot=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const o=ee(r);r.classList.add("neighbour");const h=ee(r);r.classList.remove("neighbour"),r.classList.add("current");const u=ee(r),p=h-o,a=(e-u)/2-p;return s.removeChild(r),{defaultWidth:o,neighborWidth:h,currentWidth:u,offsetFromCenter:a}},ee=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Ht=()=>{const s=w(x=>x.theme.theme),e=w(x=>x.userAnswer.answers),r=w(x=>x.testQuestion.filteredQuestions),{correctAnswers:o,wrongAnswers:h}=w(x=>x.testResult),{questionCount:u,showQuestionByPage:p}=w(x=>x.testConfig),a=w(x=>x.testNavigation.currentQuestionNumber),f=I(),m=u!=="all"?parseInt(u):r.length,c=l.useMemo(()=>[...Array(m).keys()].map(x=>x+1),[m]),[d,n]=l.useState(null),i=!!d,g=x=>{n(x.currentTarget)},b=()=>{n(null)},_=x=>{let v="QuestionListMenuItem";try{const j=r[x-1];j instanceof V&&(!e||e&&!e[j==null?void 0:j.id]?v+=" unanswer":o.includes(j==null?void 0:j.id)?v+=" correct":h.includes(j==null?void 0:j.id)&&(v+=" incorrect"))}catch{console.log(`Question number ${x} does not exists`)}return x===a&&(v+=" selected"),v},N=x=>{p?f(L(x)):se(x),b()},S=x=>{const v=Math.min(a+1,m);a>=m-1&&x.currentTarget.blur(),p?f(L(v)):se(v)},y=x=>{a<=2&&x.currentTarget.blur();const v=Math.max(a-1,1);p?f(L(v)):se(v)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":i?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:g,children:t.jsx(fe,{className:"icon",size:16})}),t.jsx(Ns,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:d,open:i,onClose:b,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:c.map(x=>t.jsx("button",{className:_(x),onClick:()=>N(x),children:x},x))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:y,disabled:a<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(ys,{className:"icon"})})]}),t.jsx(Qt,{currentIndex:a,questionNumbers:c}),t.jsxs("button",{className:"NextQuestionBtn",onClick:S,disabled:a===m,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(_s,{className:"icon"})})]})]})},se=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const u=r.offsetTop-60-20-e;window.scroll({top:u,behavior:"smooth"})};export{$t as C,Et as N,kt as S,Lt as T,Ut as a,Bt as b,Pt as c,Ht as d,Y as e,q as f,Z as l,Ct as s,Ft as u};
