var os=Object.defineProperty;var is=(s,e,r)=>e in s?os(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var y=(s,e,r)=>is(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as w,a as _,M as as,b as cs,r as a,d as re,F as we,e as ls,i as us,f as ne,P as ds,g as hs,A as ps,$ as fs,s as ge,O as xe,S as be,h as G,C as H,k as ms,l as Se,m as ws,p as D,n as F,R as je,B as gs,o as xs,q as bs,t as Ce,D as Ss,v as js,w as Cs,x as Ns,y as z,T as ys,z as Is,E as _s,G as As,H as vs}from"./vendor-DdK7EXRB.js";const Q=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Qs=()=>{let s=localStorage.getItem("theme");return s||(s="dark",Ne(s)),s},Ne=s=>{localStorage.setItem("theme",s)},Os={theme:Qs()},ye=O({name:"theme",initialState:Os,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",Ne(s.theme)}}}),Ts=ye.reducer,{switchTheme:Rs}=ye.actions,Ie=()=>{const s=w(r=>r.theme.theme),e=_();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Rs()),children:s=="light"?t.jsx(as,{size:"24px",style:{background:"#00000000"}}):t.jsx(cs,{size:"24px",style:{background:"#00000000"}})})},Es={sidebarOpen:!1},_e=O({name:"sidebarOpen",initialState:Es,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ks=_e.reducer,{toggleSidebar:Ae,setIsSidebarOpen:$s}=_e.actions,Tt=()=>{const s=w(p=>p.currSubject.subject),[e,r]=a.useState(!1),o=w(p=>p.sidebarOpen.sidebarOpen),d=re("screen and (max-width: 768px)"),l=_();return a.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>l(Ae()),disabled:e,children:t.jsx(we,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!d&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx(ls,{color:"var(--secondary-text-color)"})}),t.jsx(Q,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(Q,{children:t.jsx(Ie,{})})]})};class ve{constructor(e){y(this,"id");y(this,"name");y(this,"subject_id");y(this,"_questions");y(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ds=new URL(""+new URL("sql-wasm-C1U8OeUW.wasm",import.meta.url).href,import.meta.url).toString(),$=class ${constructor(){}static async getInstance(){if(!$.instance&&(await $.initialize(),!$.instance))throw new Error("Failed to initialize the database");return $.instance}static async initialize(){const e=us({locateFile:()=>Ds}),o=(await fetch("/database.sqlite3")).arrayBuffer(),[d,l]=await Promise.all([e,o]);$.instance=new d.Database(new Uint8Array(l))}};y($,"instance",null);let se=$;const T=async s=>{const e=await se.getInstance();try{const r=e.prepare(s),o=[];for(;r.step();)o.push(r.getAsObject());return r.free(),o}catch(r){throw console.error("Error executing query:",r,"Query:",s),r}},Fs=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ve(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Ms=async()=>{const s=localStorage.getItem("CourseId");if(s){const e=await Fs(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},X=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Ms();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Bs={course:null,loading:!1,error:null},Qe=O({name:"currCourse",initialState:Bs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(X.pending,e=>{e.loading=!0,e.error=null}).addCase(X.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(X.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ls=Qe.reducer,{setCurrCourse:Oe}=Qe.actions,Ps=({children:s,...e})=>{const[r,o]=a.useState(!1),d=_(),l=re("screen and (max-width: 768px)");a.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const p=()=>{d(Oe(e.course)),l&&d($s(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:p,children:[t.jsx(ds,{strokeWidth:"70px",className:"icon"})," ",s]})})};class Te{constructor(e){y(this,"id");y(this,"name");y(this,"semester_id");Object.assign(this,e)}}const Us=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new Te(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Hs=async()=>{const s=localStorage.getItem("SubjectId");if(s){const e=await Us(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},Y=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Hs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Gs={subject:null,loading:!1,error:null},Re=O({name:"currSubject",initialState:Gs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(Y.pending,e=>{e.loading=!0,e.error=null}).addCase(Y.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(Y.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),zs=Re.reducer,{setCurrSubject:Ws}=Re.actions,Js=({subject:s})=>{const e=w(n=>n.currSubject.subject),r=w(n=>n.currCourse.course),[o,d]=a.useState(!1),[l,p]=a.useState(!1),[c,f]=a.useState([]),m=`SidebarGroupItem ${o?"selected":""} ${l?"expanded":""}`,i=_();a.useEffect(()=>{d((e==null?void 0:e.id)===s.id),p((e==null?void 0:e.id)===s.id)},[e]),a.useEffect(()=>{(async()=>{const g=(await T(`select *
        from Course
        where subject_id = ${s.id}`)).map(x=>new ve(x));g&&f(g)})()},[]);const h=()=>{(e==null?void 0:e.id)!==s.id&&i(Oe(null)),i(Ws(s)),p(n=>!n)};return t.jsxs("li",{className:m,children:[t.jsx("button",{onClick:h,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(hs,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(ps,{height:l?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:c.map((n,u)=>t.jsx(Ps,{currCourse:r,course:n,children:n.name},u))})})]})};class oe{constructor(e){y(this,"id");y(this,"name");Object.assign(this,e)}}const Vs=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new oe(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Ks=async()=>{const s=localStorage.getItem("SemesterId");if(s){const e=await Vs(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},Z=ne("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Ks();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Xs={semester:null,loading:!1,error:null},Ee=O({name:"currSemester",initialState:Xs,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(Z.pending,e=>{e.loading=!0,e.error=null}).addCase(Z.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(Z.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ys=Ee.reducer,{setCurrSemester:ce}=Ee.actions,J=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(fs,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Zs=ge(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Rt=()=>{const s=w(i=>i.sidebarOpen.sidebarOpen),e=w(i=>i.currSemester.semester),[r,o]=a.useState([]),[d,l]=a.useState([]),[p,c]=a.useState([]),f=_();a.useEffect(()=>{(async()=>{const n=(await T("select * from Subject")).map(x=>new Te(x));o(n);const g=(await T("select * from Semester")).map(x=>new oe(x));l(g)})()},[]),a.useEffect(()=>{const i=e?r.filter(h=>h.semester_id===e.id):r;c(i)},[e,r]);const m=i=>{const h=Number(i.target.value);if(h===-1)f(ce(null));else{const n=d.find(u=>u.id===h);n&&f(ce(n))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!d?t.jsx(J,{}):t.jsxs(t.Fragment,{children:[t.jsxs(be,{name:"semester",value:e&&d.length>0?e.id:-1,onChange:m,input:t.jsx(Zs,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(G,{value:-1,children:"Tất cả"}),d.map(i=>t.jsx(G,{value:i.id,children:i.name},i.id))]}),!p||p.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:p.map(i=>t.jsx(Js,{subject:i},i.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>f(Ae())})]})};class V{constructor(e){y(this,"id");y(this,"_question_direction");y(this,"question_type");y(this,"_answer_option");y(this,"_correct_answer");y(this,"input_correct_answer");y(this,"cdr");y(this,"group_id");y(this,"_shuffleable");y(this,"number_answer_correct");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const qs={activeTest:!1},ke=O({name:"activeTest",initialState:qs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),et=ke.reducer,{toggleActiveTest:$e}=ke.actions,st=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",tt=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",rt=()=>localStorage.getItem("showQuestionByPageOption")==="true",nt={shuffleAnswer:st(),showAnswerOnChosen:tt(),showQuestionByPage:rt(),questionCount:"15"},De=O({name:"testConfig",initialState:nt,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),ot=De.reducer,{toggleShuffleAnswer:it,setQuestionCount:le,toggleShowAnswerOnChosen:at,toggleShowQuestionByPage:ct}=De.actions,M={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},te=s=>{const e=[],r={};return s.forEach(o=>{o.question_type==="grouping"&&o.group_id||o.question_type==="group-input"&&o.group_id||o.question_type==="drag_drop"&&o.group_id||o.question_type==="group-radio"&&o.group_id?r[o.group_id]=[...r[o.group_id]||[],o]:e.push(o)}),{filteredQuestions:e,groupedQuestions:r}},lt=ge(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Et=()=>{var I,S,A;const s=w(N=>N.theme.theme),e=w(N=>N.sidebarOpen.sidebarOpen),r=w(N=>N.currSubject),o=w(N=>N.currCourse),{shuffleAnswer:d,showAnswerOnChosen:l,showQuestionByPage:p}=w(N=>N.testConfig),[c,f]=a.useState({semester:null,loading:!1}),[m,i]=a.useState([]),[h,n]=a.useState(""),[u,g]=a.useState({value:0,loading:!1}),[x,C]=a.useState({value:0,loading:!1}),j=_();a.useEffect(()=>{(()=>{if(!o.course)return;const v=[10,15,20,30,40,50,60,80,100,150],R=[],B=o.course.question_per_test;v.includes(B)||(v.push(B),v.sort()),v.forEach(E=>{!o.course||E>=x.value||R.push(t.jsx(G,{value:E,sx:{fontSize:14},children:E},E))}),R.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),i(R)})()},[o.course,x.value]),a.useEffect(()=>{const N=async()=>{var R;f({...c,loading:!0});const v=await T(`select *
        from Semester
        where id = ${(R=r.subject)==null?void 0:R.semester_id}`);f({semester:new oe(v[0]),loading:!1})};r.subject&&N()},[r.subject]),a.useEffect(()=>{if(o.course){const v=o.course.question_per_test;n(v.toString()),j(le(v.toString()))}(async()=>{if(!o.course)return;const R=(await T(`
        SELECT *
        FROM Question
        WHERE id IN (${o.course.questions.join(",")})
      `)).map(k=>new V(k)),{filteredQuestions:B,groupedQuestions:E}=te(R),rs=B.length;let ae=B.filter(k=>!k.correct_answer.some(L=>L<0)&&(k.question_type==="radio"||k.question_type==="checkbox")).length;for(const k in E)if(Object.prototype.hasOwnProperty.call(E,k)){let L=!0;E[k].forEach(K=>{K.question_type!=="group-input"?K.correct_answer.some(ns=>ns<0)&&(L=!1):K.input_correct_answer||(L=!1)}),L&&ae++}g({value:ae,loading:!1}),C({value:rs,loading:!1})})()},[o.course]);const b=N=>{const v=N.target.value;n(v),j(le(v))};return c.loading||o.loading||r.loading||u.loading||x.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(J,{})}):!r.subject||!o.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(I=o.course)==null?void 0:I.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(S=r.subject)==null?void 0:S.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(A=c.semester)==null?void 0:A.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:x.value})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:u.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>j(it()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:l,onClick:()=>j(at()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:p,onClick:()=>j(ct()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(ms,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(be,{value:m.length>1?h:"",onChange:b,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(lt,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:m})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>j($e()),children:[t.jsx(Se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},ut={questions:[],filteredQuestions:[],groupedQuestions:{}},Fe=O({name:"testQuestion",initialState:ut,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload);const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o},setTestQuestion:(s,e)=>{s.questions=e.payload;const{filteredQuestions:r,groupedQuestions:o}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=o}}}),dt=Fe.reducer,{addTestQuestion:kt,setTestQuestion:W}=Fe.actions,ht={answers:{},input_answers:{}},Me=O({name:"userAnswer",initialState:ht,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(o=>!isNaN(o));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),pt=Me.reducer,{addUserAnswer:ie,removeUserAnswer:ft,updateUserAnswer:mt,setInputAnswer:wt,removeInputAnswer:$t,removeAllUserAnswerById:Be,resetUserAnwser:ue}=Me.actions,de={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},Le=O({name:"testResult",initialState:de,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>de}}),gt=Le.reducer,{addCorrectAnswer:he,addWrongAnswer:pe,setIsTestFinished:fe,setScore:xt,resetTestResut:me}=Le.actions,Pe=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),bt=Pe.reducer,{setCurrentQuestion:P}=Pe.actions,St=ws({reducer:{theme:Ts,sidebarOpen:ks,currSubject:zs,currCourse:Ls,currSemester:Ys,activeTest:et,testQuestion:dt,userAnswer:pt,testResult:gt,testConfig:ot,testNavigation:bt},middleware:s=>s({serializableCheck:!1})}),Dt=()=>_(),Ue=a.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:o,setSelectedValue:d})=>{const[l,p]=a.useState(""),c=w(u=>u.testResult.isTestFininshed),f=w(u=>u.userAnswer.answers[e.id]),m=w(u=>u.testConfig.showAnswerOnChosen),i=_(),h=a.useMemo(()=>{const u=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(u,M)},[s.value]);a.useEffect(()=>{if(!c)return;const u=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(u)&&p(" unanswer");return}f&&f.includes(u)&&(e.correct_answer.includes(u)||p(" incorrect")),e.correct_answer.includes(u)&&p(" correct")},[c]),a.useEffect(()=>{if(!m||(p(""),!f||f.length==0))return;const u=Number.parseInt(s.id);f&&f.includes(u)&&(e.correct_answer.includes(u)||p(" incorrect")),e.correct_answer.includes(u)&&p(" correct")},[m,f]);const n=u=>{c||(d(u.target.value),i(Be(e.id)),i(ie({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${l}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(je,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:n,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:h})]})]})});Ue.displayName="RadioAnswerOption";const jt=({number:s,id:e,directionText:r,haveAnswer:o,children:d})=>{const l=a.useMemo(()=>{const p=D.sanitize(r,{USE_PROFILES:{html:!0}});return F(p,M)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!o&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:l}),d&&t.jsx("div",{className:"QuestionContainerAdditional",children:d})]})},U=a.memo(jt),He=a.forwardRef(({question:s,number:e,...r},o)=>{const[d,l]=a.useState("0"),p=a.useMemo(()=>s.correct_answer.some(i=>i>-1),[s.correct_answer]),c=p?"RadioQuestion":"RadioQuestion noAnswer",f=i=>{const h=Math.min(Math.max(65,i+65),90);return String.fromCharCode(h)},m=a.useCallback((i,h)=>t.jsx(Ue,{answerOption:i,question:s,answerOptionBullet:f(h),selectedValue:d,setSelectedValue:l},`${s.id}_${i.id}`),[d]);return t.jsxs("div",{className:c,...r,ref:o,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(m)})]})});He.displayName="RadioQuestion";const Ge=a.memo(He),ze=a.memo(({answerOption:s,question:e,answerOptionBullet:r,index:o,selectedValue:d,setSelectedValue:l})=>{const[p,c]=a.useState(""),f=w(C=>C.testResult.isTestFininshed),m=w(C=>C.userAnswer.answers[e.id]),i=w(C=>C.testConfig.showAnswerOnChosen),[h,n]=a.useState(!1),u=_(),g=a.useMemo(()=>{const C=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(C,M)},[s.value]);a.useEffect(()=>{if(!f)return;const C=Number.parseInt(s.id);if(!m||m.length==0){e.correct_answer.includes(C)&&c(" unanswer");return}m&&m.includes(C)&&(e.correct_answer.includes(C)||c(" incorrect")),e.correct_answer.includes(C)&&c(" correct")},[f]),a.useEffect(()=>{if(!i||(c(""),!m||m.length==0)||(n(j=>j||m.length>=e.correct_answer.length),!h))return;const C=Number.parseInt(s.id);m&&m.includes(C)&&(e.correct_answer.includes(C)||c(" incorrect")),e.correct_answer.includes(C)&&c(" correct")},[i,h,m]);const x=()=>{f||(d[o]?u(ft({id:e.id,answer:s.id})):u(ie({id:e.id,answer:s.id})),l(d.map((C,j)=>j==o?!C:C)))};return t.jsxs("div",{className:`CheckboxAnswerOption${p}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(H,{name:`question_${e.id}_${o}`,checked:d[o],onChange:x,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});ze.displayName="CheckboxAnswerOption";const We=a.forwardRef(({question:s,number:e,...r},o)=>{const[d,l]=a.useState(Array(s.answer_option.length).fill(!1)),p=a.useMemo(()=>s.correct_answer.some(i=>i>-1),[s.correct_answer]),c=p?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=i=>{const h=Math.min(Math.max(65,i+65),90);return String.fromCharCode(h)},m=a.useCallback((i,h)=>t.jsx(ze,{answerOption:i,question:s,answerOptionBullet:f(h),index:h,selectedValue:d,setSelectedValue:l},`${s.id}_${i.id}`),[d]);return t.jsxs("div",{className:c,...r,ref:o,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p,children:t.jsxs("span",{className:"NumberCorrectAnswer",children:[t.jsx(gs,{className:"NumberCorrectAnswerIcon"}),"Sinh viên chọn ",s.number_answer_correct," phương án đúng nhất"]})}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(m)})]})});We.displayName="CheckboxQuestion";const Je=a.memo(We),Ve=a.memo(({answerOption:s,question:e})=>{const r=w(m=>m.testResult.isTestFininshed),o=a.useMemo(()=>{const m=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(m,M)},[s.value]),{attributes:d,listeners:l,setNodeRef:p,transform:c}=xs({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id},disabled:r}),f={transform:bs.Translate.toString(c),cursor:r?"default":"move"};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:p,...l,...d,style:f,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:o})})});Ve.displayName="DragDropAnswerOption";const Ct=({question:s,answerOption:e,index:r,selectedAnswers:o,children:d})=>{const{setNodeRef:l,isOver:p}=Ce({id:s.id}),[c,f]=a.useState(""),m=w(j=>j.testResult.isTestFininshed),i=w(j=>j.userAnswer.answers[s.id]),h=w(j=>j.testConfig.showAnswerOnChosen),[n,u]=a.useState(!1),g=_(),x=a.useMemo(()=>{const j=e.filter(b=>s.correct_answer.includes(Number(b.id)));return j.length>1?j.map(b=>`[${b.value}]`).join(", "):j.map(b=>b.value).join(", ")},[e,s.correct_answer]),C=a.useMemo(()=>{const j=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(j,M)},[s.question_direction]);return a.useEffect(()=>{if(!m)return;if(!i||i.length==0){s.correct_answer.length>0&&f(" unanswer");return}const j=JSON.stringify(s.correct_answer.sort()),b=JSON.stringify(i&&[...i].sort());f(j===b?" correct":" incorrect")},[m]),a.useEffect(()=>{if(!h||(f(""),!i||i.length==0)||(u(I=>I||i.length>=s.correct_answer.length),!n))return;const j=JSON.stringify(s.correct_answer.sort()),b=JSON.stringify(i&&[...i].sort());f(j===b?" correct":" incorrect")},[h,n,i]),a.useEffect(()=>{m||i===void 0&&o.length===0||g(mt({id:s.id,answers:o}))},[o]),t.jsxs("div",{className:`DragDropInputQuestion${c}`,children:[t.jsxs("div",{className:"DragDropInputWrapper",children:[t.jsx("span",{className:"DragDropInputTextDirection",children:r?`${r}) ${C}`:C}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:l,children:d}),t.jsx("p",{className:"DragDropInputMessage",style:p||d!=null&&d.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]}),x&&t.jsxs("span",{className:"DragDropInputCorrectAnswer",children:["Đáp án đúng: ",x]})]})},Ke=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},d)=>{const[l,p]=a.useState({[s.id]:s.answer_option.map(n=>Number(n.id))}),c=s.question_type==="grouping",f=a.useMemo(()=>{let n=!0;return e.forEach(u=>{u.correct_answer.some(g=>g>-1)||(n=!1)}),n},[e]),m=f?"DragDropQuestion":"DragDropQuestion noAnswer",i=n=>{const{active:u,over:g}=n;if(!g||!u.data.current)return;const x=Number(u.data.current.answerOptionId),C=g.id;p(j=>{const b={...j};b[C]||(b[C]=[]);let I=-1;for(const S in b)if(Object.prototype.hasOwnProperty.call(b,S)&&b[S].includes(x)){I=Number(S);break}if(I!==-1)if(!c&&C!==s.id&&b[C]&&b[C].length>=1){const S=b[C][0];b[C]=[x],b[I]=b[I].filter(A=>A!==x),b[I]=[...b[I],S]}else b[I]=b[I].filter(S=>S!==x),b[C]=[...b[C],x];return b})},h=a.useCallback(n=>t.jsx(Ve,{answerOption:n,question:s},`${s.id}_${n.id}`),[s]);return t.jsx("div",{className:m,...o,ref:d,children:t.jsxs(Ss,{onDragEnd:i,modifiers:[js],children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:f,children:t.jsx(Nt,{questionId:s.id,children:s.answer_option.filter(n=>l[s.id].includes(Number(n.id))).map(h)})}),t.jsx("div",{className:`DragDropInputQuestions ${c?"card":"row"}`,children:e.map((n,u)=>t.jsx(Ct,{question:n,answerOption:s.answer_option,index:c?u+1:void 0,selectedAnswers:l[n.id]||[],children:l[n.id]&&s.answer_option.filter(g=>l[n.id].includes(Number(g.id))).map(h)},n.id))})]})})}),Nt=({children:s,questionId:e})=>{const{setNodeRef:r}=Ce({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};Ke.displayName="DragDropQuestion";const Xe=a.memo(Ke),yt=({question:s,index:e})=>{const[r,o]=a.useState(""),[d,l]=a.useState(""),p=w(g=>g.testResult.isTestFininshed),c=w(g=>g.userAnswer.input_answers[s.id]),f=w(g=>g.testConfig.showAnswerOnChosen),m=_(),i=a.useMemo(()=>{const g=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(g,M)},[s.question_direction]);a.useEffect(()=>{var g;if(p){if(!c){o(" unanswer");return}((g=s==null?void 0:s.input_correct_answer)==null?void 0:g.toLowerCase())===c.toLowerCase()?o(" correct"):o(" incorrect")}},[p]),a.useEffect(()=>{var g;f&&(o(""),c&&(((g=s==null?void 0:s.input_correct_answer)==null?void 0:g.toLowerCase())===c.toLowerCase()?o(" correct"):o(" incorrect")))},[f,c]);const h=c?350:1e3,n=a.useCallback(Cs.debounce(g=>{m(wt({id:s.id,answer:g}))},h),[m,s.id,h]),u=g=>{if(p)return;const x=g.target.value;l(x),n(x)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${i}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:d,onInput:u,spellCheck:!1,style:{cursor:p?"default":"text"}})}),s.input_correct_answer&&t.jsxs("span",{className:"GroupInputInputCorrectAnswer",children:["Đáp án đúng: ",s.input_correct_answer]})]})},Ye=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},d)=>{const l=a.useMemo(()=>!e.some(c=>c.input_correct_answer===null),[e]),p=l?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:d,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((c,f)=>t.jsx(yt,{question:c,index:f+1},c.id))})]})});Ye.displayName="GroupInputQuestion";const Ze=a.memo(Ye),qe=a.memo(({answerOption:s,question:e,selectedValue:r,setSelectedValue:o})=>{const[d,l]=a.useState(""),p=w(n=>n.testResult.isTestFininshed),c=w(n=>n.userAnswer.answers[e.id]),f=w(n=>n.testConfig.showAnswerOnChosen),m=_(),i=a.useMemo(()=>{const n=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(n,M)},[s.value]);a.useEffect(()=>{if(!p)return;const n=Number.parseInt(s.id);if(!c||c.length==0){e.correct_answer.includes(n)&&l(" unanswer");return}c&&c.includes(n)&&(e.correct_answer.includes(n)||l(" incorrect")),e.correct_answer.includes(n)&&l(" correct")},[p]),a.useEffect(()=>{if(!f||(l(""),!c||c.length==0))return;const n=Number.parseInt(s.id);c&&c.includes(n)&&(e.correct_answer.includes(n)?l(" correct"):l(" incorrect"))},[f,c]);const h=n=>{p||(o(n.target.value),m(Be(e.id)),m(ie({id:e.id,answer:s.id})))};return t.jsxs("label",{className:`GroupRadioAnswerOption${d}`,children:[t.jsx(je,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:h,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:i})]})});qe.displayName="GroupRadioAnswerOption";const It=({question:s,index:e})=>{const[r,o]=a.useState("-1"),d=a.useMemo(()=>{const l=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(l,M)},[s.question_direction]);return t.jsxs("div",{className:"GroupRadioInputQuestion",children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupRadioInputTextDirection",children:`${e}) ${d}`}),t.jsx("div",{className:"GroupRadioInputContainer",children:s.answer_option.map(l=>t.jsx(qe,{answerOption:l,question:s,selectedValue:r,setSelectedValue:o},l.id))})]})},es=a.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...o},d)=>{const l=a.useMemo(()=>{let c=!0;return e.forEach(f=>{f.correct_answer.some(m=>m>-1)||(c=!1)}),c},[e]),p=l?"GroupRadioQuestion":"GroupRadioQuestion noAnswer";return t.jsxs("div",{className:p,...o,ref:d,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupRadioInputQuestions",children:e.map((c,f)=>t.jsx(It,{question:c,index:f+1},c.id))})]})});es.displayName="GroupRadioQuestion";const ss=a.memo(es),_t=({children:s,sectionRefs:e,rootSelector:r,offset:o,as:d,...l})=>{const p=Ns({sectionRefs:e,rootSelector:r,offset:o}),c=w(i=>i.testNavigation.currentQuestionNumber),f=_();a.useEffect(()=>{p.currentElementIndexInViewport===-1||p.currentElementIndexInViewport+1===c||f(P(p.currentElementIndexInViewport+1))},[p]);const m=d||"div";return t.jsx(m,{...l,children:s})},Ft=()=>{const s=w(n=>n.testQuestion.filteredQuestions),e=w(n=>n.testQuestion.groupedQuestions),r=w(n=>n.testResult.isTestFininshed),o=w(n=>n.currCourse.course),{shuffleAnswer:d,questionCount:l}=w(n=>n.testConfig),p=_(),c=a.useRef([]),[f,m]=a.useState(-60);a.useEffect(()=>{window.innerHeight!==0&&m(-60-window.innerHeight/4)},[window.innerHeight]),a.useMemo(()=>{c.current.length!==s.length&&(c.current=Array(s.length).fill(null).map((n,u)=>c.current[u]||a.createRef()))},[s.length]),a.useEffect(()=>{if(r)return;p(W([])),(async()=>{const g=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`)).map(C=>new V(C)),x=h(g);i(x),p(W(x))})()},[r]);const i=n=>{n.forEach(u=>{d&&u.shuffleable&&(u.answer_option=z(u.answer_option))})},h=n=>{const u=z(n);return u.sort((g,x)=>g.cdr-x.cdr),l==="all"||Number.isNaN(Number.parseInt(l))?u:u.slice(0,Number.parseInt(l))};return!s||s.length==0||!c.current?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx(_t,{as:"div",className:"TestContainer",sectionRefs:c.current,offset:f,children:s.map((n,u)=>n.question_type==="radio"?t.jsx(Ge,{ref:c.current[u],question:n,id:`questionNumber_${u+1}`,number:u+1},n.id):n.question_type==="drag_drop"||n.question_type==="grouping"?t.jsx(Xe,{ref:c.current[u],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${u+1}`,number:u+1},n.id):n.question_type==="group-input"?t.jsx(Ze,{ref:c.current[u],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${u+1}`,number:u+1},n.id):n.question_type==="group-radio"?t.jsx(ss,{ref:c.current[u],topicQuestion:n,inputQuestions:e[n.id]||[],id:`questionNumber_${u+1}`,number:u+1},n.id):t.jsx(Je,{ref:c.current[u],question:n,id:`questionNumber_${u+1}`,number:u+1},n.id))})},Mt=({setHidePopup:s})=>{const e=w(h=>h.currSubject.subject),r=w(h=>h.testQuestion.filteredQuestions),o=w(h=>h.testQuestion.groupedQuestions),d=w(h=>h.testResult),l=_(),p=re("screen and (max-width: 768px)"),c=()=>{!d.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(l($e()),l(me()),l(ue()))},f=()=>{l(fe(!1)),l(me()),l(ue())},m=(h,n)=>{if(Array.isArray(h)&&Array.isArray(n)){const u=JSON.stringify([...n].sort()),g=JSON.stringify([...h].sort());return u===g}else if(typeof h=="string"&&typeof n=="string")return h.toLowerCase().trim()===n.toLowerCase().trim();return!1},i=()=>{const h=St.getState(),n=h.userAnswer.answers,u=h.userAnswer.input_answers;let g=0;r.forEach(x=>{if(o[x.id]){let j=!0;o[x.id].forEach(b=>{if(b.question_type!=="group-input"){const I=n[b.id]||[];m(I,b.correct_answer)||(j=!1)}else{const I=u[b.id]||null;!I||!b.input_correct_answer?j=!1:m(I,b.input_correct_answer)||(j=!1)}}),j?(g++,l(he(x.id))):l(pe(x.id))}else{let j=!0;if(x.question_type!=="group-input"){const b=n[x.id]||[];m(b,x.correct_answer)||(j=!1)}else{const b=u[x.id]||null;!b||!x.input_correct_answer?j=!1:m(b,x.input_correct_answer)||(j=!1)}j?(g++,l(he(x.id))):l(pe(x.id))}const C=parseFloat((g/r.length*10).toFixed(2));l(xt(C))}),l(fe(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:c,children:t.jsx(ys,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!p&&t.jsx(Q,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:d.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(Is,{})})}),t.jsx(Q,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(h=>!h),children:[t.jsxs("div",{children:["Điểm: ",d.score]}),t.jsxs("div",{children:["Kết quả: ",d.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(Q,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:i,children:[t.jsx(Se,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(Q,{children:t.jsx(Ie,{})})]})},Bt=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:o,correctAnswers:d}=w(f=>f.testResult),l=w(f=>f.testQuestion.filteredQuestions),[p,c]=a.useState("");return a.useEffect(()=>{e(!o),r<5?c("lowScore"):r<8?c("mediumScore"):c("")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${p}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",d.length,"/",l.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Lt=()=>{const s=w(i=>i.testQuestion.filteredQuestions),e=w(i=>i.testQuestion.groupedQuestions),r=w(i=>i.testResult.isTestFininshed),o=w(i=>i.currCourse.course),d=w(i=>i.testNavigation.currentQuestionNumber),{shuffleAnswer:l,questionCount:p}=w(i=>i.testConfig),c=_();a.useEffect(()=>{if(r||c(P(1)),r)return;c(W([])),(async()=>{const n=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`)).map(g=>new V(g)),u=m(n);f(u),c(W(u))})()},[r]);const f=i=>{i.forEach(h=>{l&&h.shuffleable&&(h.answer_option=z(h.answer_option))})},m=i=>{const h=z(i);return h.sort((n,u)=>n.cdr-u.cdr),p==="all"||Number.isNaN(Number.parseInt(p))?h:h.slice(0,Number.parseInt(p))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((i,h)=>i.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Ge,{question:i,number:h+1})},i.id):i.question_type==="drag_drop"?t.jsx("div",{className:"DragDropQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Xe,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):i.question_type==="group-input"?t.jsx("div",{className:"GroupInputQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Ze,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):i.question_type==="group-radio"?t.jsx("div",{className:"GroupRadioQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(ss,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Je,{question:i,number:h+1})},i.id))})},At=({currentIndex:s,questionNumbers:e})=>{const o=a.useRef(null),d=a.useRef(null),[l,p]=a.useState(0),[c,f]=a.useState(0);return a.useEffect(()=>{if(d.current&&o.current){const m=o.current.clientWidth,{defaultWidth:i,offsetFromCenter:h}=vt(d.current,m);p(i),f(h)}},[]),a.useEffect(()=>{if(!(!l||!c)&&d.current&&o.current){const m=(s!==-1?s:1)-1+2,i=d.current.querySelectorAll(".QuestionNumberIndicatorItem"),h=i[m];i.forEach((n,u)=>{n.classList.remove("neighbour","current"),u===m&&n.classList.add("current"),Math.abs(u-m)===1&&n.classList.add("neighbour")}),h&&(d.current.style.transform=`translateX(${-(l*m)+c}px)`)}},[s,l,c]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:o,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:d,children:t.jsx(ts,{questionNumbers:e,fakeItemCount:2})})})},ts=a.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=o=>Array(e).fill(0).map((d,l)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:d},l+o));return t.jsxs(t.Fragment,{children:[r(-e),s.map(o=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:o},o)),r(s.length+1)]})});ts.displayName="QuestionNumberIndicatorList";const vt=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const o=q(r);r.classList.add("neighbour");const d=q(r);r.classList.remove("neighbour"),r.classList.add("current");const l=q(r),p=d-o,c=(e-l)/2-p;return s.removeChild(r),{defaultWidth:o,neighborWidth:d,currentWidth:l,offsetFromCenter:c}},q=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Pt=()=>{const s=w(S=>S.theme.theme),e=w(S=>S.userAnswer.answers),r=w(S=>S.testQuestion.filteredQuestions),{correctAnswers:o,wrongAnswers:d}=w(S=>S.testResult),{questionCount:l,showQuestionByPage:p}=w(S=>S.testConfig),c=w(S=>S.testNavigation.currentQuestionNumber),f=_(),m=l!=="all"?parseInt(l):r.length,i=a.useMemo(()=>[...Array(m).keys()].map(S=>S+1),[m]),[h,n]=a.useState(null),u=!!h,g=S=>{n(S.currentTarget)},x=()=>{n(null)},C=S=>{let A="QuestionListMenuItem";try{const N=r[S-1];N instanceof V&&(!e||e&&!e[N==null?void 0:N.id]?A+=" unanswer":o.includes(N==null?void 0:N.id)?A+=" correct":d.includes(N==null?void 0:N.id)&&(A+=" incorrect"))}catch{console.log(`Question number ${S} does not exists`)}return S===c&&(A+=" selected"),A},j=S=>{p?f(P(S)):ee(S),x()},b=S=>{const A=Math.min(c+1,m);c>=m-1&&S.currentTarget.blur(),p?f(P(A)):ee(A)},I=S=>{c<=2&&S.currentTarget.blur();const A=Math.max(c-1,1);p?f(P(A)):ee(A)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":u?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":u?"true":void 0,onClick:g,children:t.jsx(we,{className:"icon",size:16})}),t.jsx(_s,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:h,open:u,onClose:x,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:i.map(S=>t.jsx("button",{className:C(S),onClick:()=>j(S),children:S},S))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:I,disabled:c<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(As,{className:"icon"})})]}),t.jsx(At,{currentIndex:c,questionNumbers:i}),t.jsxs("button",{className:"NextQuestionBtn",onClick:b,disabled:c===m,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(vs,{className:"icon"})})]})]})},ee=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const l=r.offsetTop-60-20-e;window.scroll({top:l,behavior:"smooth"})};export{Et as C,Tt as N,Rt as S,Mt as T,Lt as a,Ft as b,Bt as c,Pt as d,se as e,X as f,Z as g,Y as l,St as s,Dt as u};
