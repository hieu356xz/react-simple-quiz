var os=Object.defineProperty;var is=(s,e,r)=>e in s?os(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var N=(s,e,r)=>is(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as x,a as _,M as as,b as cs,r as c,d as re,F as ge,e as ls,i as us,f as ne,P as ds,g as hs,A as ps,$ as fs,s as we,O as xe,S as be,h as G,C as H,k as ms,l as je,m as gs,p as D,n as F,R as Se,B as ws,o as xs,q as bs,t as Ce,D as js,v as Ss,w as Cs,x as Ns,y as z,T as ys,z as Is,E as _s,G as vs,H as As}from"./vendor-DdK7EXRB.js";const Q=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Qs=()=>{let s=localStorage.getItem("theme");return s||(s="dark",Ne(s)),s},Ne=s=>{localStorage.setItem("theme",s)},Os={theme:Qs()},ye=O({name:"theme",initialState:Os,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",Ne(s.theme)}}}),Ts=ye.reducer,{switchTheme:Rs}=ye.actions,Ie=()=>{const s=x(r=>r.theme.theme),e=_();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Rs()),children:s=="light"?t.jsx(as,{size:"24px",style:{background:"#00000000"}}):t.jsx(cs,{size:"24px",style:{background:"#00000000"}})})},Es={sidebarOpen:!1},_e=O({name:"sidebarOpen",initialState:Es,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),ks=_e.reducer,{toggleSidebar:ve,setIsSidebarOpen:$s}=_e.actions,Tt=()=>{const s=x(p=>p.currSubject.subject),[e,r]=c.useState(!1),n=x(p=>p.sidebarOpen.sidebarOpen),d=re("screen and (max-width: 768px)"),l=_();return c.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[n]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>l(ve()),disabled:e,children:t.jsx(ge,{className:`BtnHamburgerIcon ${n?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!d&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx(ls,{color:"var(--secondary-text-color)"})}),t.jsx(Q,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(Q,{children:t.jsx(Ie,{})})]})};class Ae{constructor(e){N(this,"id");N(this,"name");N(this,"subject_id");N(this,"_questions");N(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ds=new URL(""+new URL("sql-wasm-C1U8OeUW.wasm",import.meta.url).href,import.meta.url).toString(),$=class ${constructor(){}static async getInstance(){if(!$.instance&&(await $.initialize(),!$.instance))throw new Error("Failed to initialize the database");return $.instance}static async initialize(){const e=us({locateFile:()=>Ds}),n=(await fetch("/database.sqlite3")).arrayBuffer(),[d,l]=await Promise.all([e,n]);$.instance=new d.Database(new Uint8Array(l))}};N($,"instance",null);let se=$;const T=async s=>{const e=await se.getInstance();try{const r=e.prepare(s),n=[];for(;r.step();)n.push(r.getAsObject());return r.free(),n}catch(r){throw console.error("Error executing query:",r,"Query:",s),r}},Fs=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new Ae(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Ms=async()=>{const s=localStorage.getItem("CourseId");if(s){const e=await Fs(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},X=ne("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Ms();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Bs={course:null,loading:!1,error:null},Qe=O({name:"currCourse",initialState:Bs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(X.pending,e=>{e.loading=!0,e.error=null}).addCase(X.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(X.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ls=Qe.reducer,{setCurrCourse:Oe}=Qe.actions,Ps=({children:s,...e})=>{const[r,n]=c.useState(!1),d=_(),l=re("screen and (max-width: 768px)");c.useEffect(()=>{e.currCourse?n(e.currCourse.id==e.course.id):n(!1)},[e.currCourse]);const p=()=>{d(Oe(e.course)),l&&d($s(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:p,children:[t.jsx(ds,{strokeWidth:"70px",className:"icon"})," ",s]})})};class Te{constructor(e){N(this,"id");N(this,"name");N(this,"semester_id");Object.assign(this,e)}}const Us=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new Te(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Hs=async()=>{const s=localStorage.getItem("SubjectId");if(s){const e=await Us(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},Y=ne("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Hs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Gs={subject:null,loading:!1,error:null},Re=O({name:"currSubject",initialState:Gs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(Y.pending,e=>{e.loading=!0,e.error=null}).addCase(Y.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(Y.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),zs=Re.reducer,{setCurrSubject:Ws}=Re.actions,Js=({subject:s})=>{const e=x(o=>o.currSubject.subject),r=x(o=>o.currCourse.course),[n,d]=c.useState(!1),[l,p]=c.useState(!1),[a,f]=c.useState([]),g=`SidebarGroupItem ${n?"selected":""} ${l?"expanded":""}`,i=_();c.useEffect(()=>{d((e==null?void 0:e.id)===s.id),p((e==null?void 0:e.id)===s.id)},[e]),c.useEffect(()=>{(async()=>{const m=(await T(`select *
        from Course
        where subject_id = ${s.id}`)).map(w=>new Ae(w));m&&f(m)})()},[]);const h=()=>{(e==null?void 0:e.id)!==s.id&&i(Oe(null)),i(Ws(s)),p(o=>!o)};return t.jsxs("li",{className:g,children:[t.jsx("button",{onClick:h,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(hs,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(ps,{height:l?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:a.map((o,u)=>t.jsx(Ps,{currCourse:r,course:o,children:o.name},u))})})]})};class oe{constructor(e){N(this,"id");N(this,"name");Object.assign(this,e)}}const Vs=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new oe(e[0])}catch(e){return console.error("Error fetching data:",e),null}},Ks=async()=>{const s=localStorage.getItem("SemesterId");if(s){const e=await Vs(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},Z=ne("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Ks();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Xs={semester:null,loading:!1,error:null},Ee=O({name:"currSemester",initialState:Xs,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(Z.pending,e=>{e.loading=!0,e.error=null}).addCase(Z.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(Z.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ys=Ee.reducer,{setCurrSemester:ce}=Ee.actions,J=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(fs,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Zs=we(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Rt=()=>{const s=x(i=>i.sidebarOpen.sidebarOpen),e=x(i=>i.currSemester.semester),[r,n]=c.useState([]),[d,l]=c.useState([]),[p,a]=c.useState([]),f=_();c.useEffect(()=>{(async()=>{const o=(await T("select * from Subject")).map(w=>new Te(w));n(o);const m=(await T("select * from Semester")).map(w=>new oe(w));l(m)})()},[]),c.useEffect(()=>{const i=e?r.filter(h=>h.semester_id===e.id):r;a(i)},[e,r]);const g=i=>{const h=Number(i.target.value);if(h===-1)f(ce(null));else{const o=d.find(u=>u.id===h);o&&f(ce(o))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!d?t.jsx(J,{}):t.jsxs(t.Fragment,{children:[t.jsxs(be,{name:"semester",value:e&&d.length>0?e.id:-1,onChange:g,input:t.jsx(Zs,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(G,{value:-1,children:"Tất cả"}),d.map(i=>t.jsx(G,{value:i.id,children:i.name},i.id))]}),!p||p.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:p.map(i=>t.jsx(Js,{subject:i},i.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>f(ve())})]})};class V{constructor(e){N(this,"id");N(this,"_question_direction");N(this,"question_type");N(this,"_answer_option");N(this,"_correct_answer");N(this,"input_correct_answer");N(this,"cdr");N(this,"group_id");N(this,"_shuffleable");N(this,"number_answer_correct");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const qs={activeTest:!1},ke=O({name:"activeTest",initialState:qs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),et=ke.reducer,{toggleActiveTest:$e}=ke.actions,st=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",tt=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",rt=()=>localStorage.getItem("showQuestionByPageOption")==="true",nt={shuffleAnswer:st(),showAnswerOnChosen:tt(),showQuestionByPage:rt(),questionCount:"15"},De=O({name:"testConfig",initialState:nt,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),ot=De.reducer,{toggleShuffleAnswer:it,setQuestionCount:le,toggleShowAnswerOnChosen:at,toggleShowQuestionByPage:ct}=De.actions,M={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},te=s=>{const e=[],r={};return s.forEach(n=>{n.question_type==="grouping"&&n.group_id||n.question_type==="group-input"&&n.group_id||n.question_type==="drag_drop"&&n.group_id||n.question_type==="group-radio"&&n.group_id?r[n.group_id]=[...r[n.group_id]||[],n]:e.push(n)}),{filteredQuestions:e,groupedQuestions:r}},lt=we(xe)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Et=()=>{var I,b,v;const s=x(C=>C.theme.theme),e=x(C=>C.sidebarOpen.sidebarOpen),r=x(C=>C.currSubject),n=x(C=>C.currCourse),{shuffleAnswer:d,showAnswerOnChosen:l,showQuestionByPage:p}=x(C=>C.testConfig),[a,f]=c.useState({semester:null,loading:!1}),[g,i]=c.useState([]),[h,o]=c.useState(""),[u,m]=c.useState({value:0,loading:!1}),[w,S]=c.useState({value:0,loading:!1}),y=_();c.useEffect(()=>{(()=>{if(!n.course)return;const A=[10,15,20,30,40,50,60,80,100,150],R=[],B=n.course.question_per_test;A.includes(B)||(A.push(B),A.sort()),A.forEach(E=>{!n.course||E>=w.value||R.push(t.jsx(G,{value:E,sx:{fontSize:14},children:E},E))}),R.push(t.jsx(G,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),i(R)})()},[n.course,w.value]),c.useEffect(()=>{const C=async()=>{var R;f({...a,loading:!0});const A=await T(`select *
        from Semester
        where id = ${(R=r.subject)==null?void 0:R.semester_id}`);f({semester:new oe(A[0]),loading:!1})};r.subject&&C()},[r.subject]),c.useEffect(()=>{if(n.course){const A=n.course.question_per_test;o(A.toString()),y(le(A.toString()))}(async()=>{if(!n.course)return;const R=(await T(`
        SELECT *
        FROM Question
        WHERE id IN (${n.course.questions.join(",")})
      `)).map(k=>new V(k)),{filteredQuestions:B,groupedQuestions:E}=te(R),rs=B.length;let ae=B.filter(k=>!k.correct_answer.some(L=>L<0)&&(k.question_type==="radio"||k.question_type==="checkbox")).length;for(const k in E)if(Object.prototype.hasOwnProperty.call(E,k)){let L=!0;E[k].forEach(K=>{K.question_type!=="group-input"?K.correct_answer.some(ns=>ns<0)&&(L=!1):K.input_correct_answer||(L=!1)}),L&&ae++}m({value:ae,loading:!1}),S({value:rs,loading:!1})})()},[n.course]);const j=C=>{const A=C.target.value;o(A),y(le(A))};return a.loading||n.loading||r.loading||u.loading||w.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(J,{})}):!r.subject||!n.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(I=n.course)==null?void 0:I.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(b=r.subject)==null?void 0:b.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(v=a.semester)==null?void 0:v.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:w.value})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:u.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>y(it()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:l,onClick:()=>y(at()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(H,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:p,onClick:()=>y(ct()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(ms,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(be,{value:g.length>1?h:"",onChange:j,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(lt,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:g})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>y($e()),children:[t.jsx(je,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},ut={questions:[],filteredQuestions:[],groupedQuestions:{}},Fe=O({name:"testQuestion",initialState:ut,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload);const{filteredQuestions:r,groupedQuestions:n}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=n},setTestQuestion:(s,e)=>{s.questions=e.payload;const{filteredQuestions:r,groupedQuestions:n}=te(s.questions);s.filteredQuestions=r,s.groupedQuestions=n}}}),dt=Fe.reducer,{addTestQuestion:kt,setTestQuestion:W}=Fe.actions,ht={answers:{},input_answers:{}},Me=O({name:"userAnswer",initialState:ht,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(n=>!isNaN(n));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),pt=Me.reducer,{addUserAnswer:ie,removeUserAnswer:ft,updateUserAnswer:mt,setInputAnswer:gt,removeInputAnswer:$t,removeAllUserAnswerById:Be,resetUserAnwser:ue}=Me.actions,de={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},Le=O({name:"testResult",initialState:de,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>de}}),wt=Le.reducer,{addCorrectAnswer:he,addWrongAnswer:pe,setIsTestFinished:fe,setScore:xt,resetTestResut:me}=Le.actions,Pe=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),bt=Pe.reducer,{setCurrentQuestion:P}=Pe.actions,jt=gs({reducer:{theme:Ts,sidebarOpen:ks,currSubject:zs,currCourse:Ls,currSemester:Ys,activeTest:et,testQuestion:dt,userAnswer:pt,testResult:wt,testConfig:ot,testNavigation:bt},middleware:s=>s({serializableCheck:!1})}),Dt=()=>_(),Ue=c.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:n,setSelectedValue:d})=>{const[l,p]=c.useState(""),a=x(u=>u.testResult.isTestFininshed),f=x(u=>u.userAnswer.answers[e.id]),g=x(u=>u.testConfig.showAnswerOnChosen),i=_(),h=c.useMemo(()=>{const u=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(u,M)},[s.value]);c.useEffect(()=>{if(!a)return;const u=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(u)&&p(" unanswer");return}f&&f.includes(u)&&(e.correct_answer.includes(u)||p(" incorrect")),e.correct_answer.includes(u)&&p(" correct")},[a]),c.useEffect(()=>{if(!g||(p(""),!f||f.length==0))return;const u=Number.parseInt(s.id);f&&f.includes(u)&&(e.correct_answer.includes(u)||p(" incorrect")),e.correct_answer.includes(u)&&p(" correct")},[g,f]);const o=u=>{a||(d(u.target.value),i(Be(e.id)),i(ie({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${l}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Se,{name:`question_${e.id}`,checked:n===s.id,value:s.id,onChange:o,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:h})]})]})});Ue.displayName="RadioAnswerOption";const St=({number:s,id:e,directionText:r,haveAnswer:n,children:d})=>{const l=c.useMemo(()=>{const p=D.sanitize(r,{USE_PROFILES:{html:!0}});return F(p,M)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!n&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:l}),d&&t.jsx("div",{className:"QuestionContainerAdditional",children:d})]})},U=c.memo(St),He=c.forwardRef(({question:s,number:e,...r},n)=>{const[d,l]=c.useState("0"),p=c.useMemo(()=>s.correct_answer.some(i=>i>-1),[s.correct_answer]),a=p?"RadioQuestion":"RadioQuestion noAnswer",f=i=>{const h=Math.min(Math.max(65,i+65),90);return String.fromCharCode(h)},g=c.useCallback((i,h)=>t.jsx(Ue,{answerOption:i,question:s,answerOptionBullet:f(h),selectedValue:d,setSelectedValue:l},`${s.id}_${i.id}`),[d]);return t.jsxs("div",{className:a,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(g)})]})});He.displayName="RadioQuestion";const Ge=c.memo(He),ze=c.memo(({answerOption:s,question:e,answerOptionBullet:r,index:n,selectedValue:d,setSelectedValue:l})=>{const[p,a]=c.useState(""),f=x(m=>m.testResult.isTestFininshed),g=x(m=>m.userAnswer.answers[e.id]),i=x(m=>m.testConfig.showAnswerOnChosen),h=_(),o=c.useMemo(()=>{const m=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(m,M)},[s.value]);c.useEffect(()=>{if(!f)return;const m=Number.parseInt(s.id);if(!g||g.length==0){e.correct_answer.includes(m)&&a(" unanswer");return}g&&g.includes(m)&&(e.correct_answer.includes(m)||a(" incorrect")),e.correct_answer.includes(m)&&a(" correct")},[f]),c.useEffect(()=>{if(!i||(a(""),!g||g.length==0))return;const m=Number.parseInt(s.id);g&&g.includes(m)&&(e.correct_answer.includes(m)||a(" incorrect")),e.correct_answer.includes(m)&&a(" correct")},[i,g]);const u=()=>{f||(d[n]?h(ft({id:e.id,answer:s.id})):h(ie({id:e.id,answer:s.id})),l(d.map((m,w)=>w==n?!m:m)))};return t.jsxs("div",{className:`CheckboxAnswerOption${p}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(H,{name:`question_${e.id}_${n}`,checked:d[n],onChange:u,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:o})]})]})});ze.displayName="CheckboxAnswerOption";const We=c.forwardRef(({question:s,number:e,...r},n)=>{const[d,l]=c.useState(Array(s.answer_option.length).fill(!1)),p=c.useMemo(()=>s.correct_answer.some(i=>i>-1),[s.correct_answer]),a=p?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=i=>{const h=Math.min(Math.max(65,i+65),90);return String.fromCharCode(h)},g=c.useCallback((i,h)=>t.jsx(ze,{answerOption:i,question:s,answerOptionBullet:f(h),index:h,selectedValue:d,setSelectedValue:l},`${s.id}_${i.id}`),[d]);return t.jsxs("div",{className:a,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:p,children:t.jsxs("span",{className:"NumberCorrectAnswer",children:[t.jsx(ws,{className:"NumberCorrectAnswerIcon"}),"Sinh viên chọn ",s.number_answer_correct," phương án đúng nhất"]})}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(g)})]})});We.displayName="CheckboxQuestion";const Je=c.memo(We),Ve=c.memo(({answerOption:s,question:e})=>{const r=x(g=>g.testResult.isTestFininshed),n=c.useMemo(()=>{const g=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(g,M)},[s.value]),{attributes:d,listeners:l,setNodeRef:p,transform:a}=xs({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id},disabled:r}),f={transform:bs.Translate.toString(a),cursor:r?"default":"move"};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:p,...l,...d,style:f,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:n})})});Ve.displayName="DragDropAnswerOption";const Ct=({question:s,answerOption:e,index:r,selectedAnswers:n,children:d})=>{const{setNodeRef:l,isOver:p}=Ce({id:s.id}),[a,f]=c.useState(""),g=x(w=>w.testResult.isTestFininshed),i=x(w=>w.userAnswer.answers[s.id]),h=x(w=>w.testConfig.showAnswerOnChosen),o=_(),u=c.useMemo(()=>{const w=e.filter(S=>s.correct_answer.includes(Number(S.id)));return w.length>1?w.map(S=>`[${S.value}]`).join(", "):w.map(S=>S.value).join(", ")},[e,s.correct_answer]),m=c.useMemo(()=>{const w=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(w,M)},[s.question_direction]);return c.useEffect(()=>{if(!g)return;if(!i||i.length==0){s.correct_answer.length>0&&f(" unanswer");return}const w=JSON.stringify(s.correct_answer.sort()),S=JSON.stringify(i&&[...i].sort());f(w===S?" correct":" incorrect")},[g]),c.useEffect(()=>{if(!h||(f(""),!i||i.length==0))return;const w=JSON.stringify(s.correct_answer.sort()),S=JSON.stringify(i&&[...i].sort());f(w===S?" correct":" incorrect")},[h,i]),c.useEffect(()=>{g||i===void 0&&n.length===0||o(mt({id:s.id,answers:n}))},[n]),t.jsxs("div",{className:`DragDropInputQuestion${a}`,children:[t.jsxs("div",{className:"DragDropInputWrapper",children:[t.jsx("span",{className:"DragDropInputTextDirection",children:r?`${r}) ${m}`:m}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:l,children:d}),t.jsx("p",{className:"DragDropInputMessage",style:p||d!=null&&d.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]}),u&&t.jsxs("span",{className:"DragDropInputCorrectAnswer",children:["Đáp án đúng: ",u]})]})},Ke=c.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},d)=>{const[l,p]=c.useState({[s.id]:s.answer_option.map(o=>Number(o.id))}),a=s.question_type==="grouping",f=c.useMemo(()=>{let o=!0;return e.forEach(u=>{u.correct_answer.some(m=>m>-1)||(o=!1)}),o},[e]),g=f?"DragDropQuestion":"DragDropQuestion noAnswer",i=o=>{const{active:u,over:m}=o;if(!m||!u.data.current)return;const w=Number(u.data.current.answerOptionId),S=m.id;p(y=>{const j={...y};j[S]||(j[S]=[]);let I=-1;for(const b in j)if(Object.prototype.hasOwnProperty.call(j,b)&&j[b].includes(w)){I=Number(b);break}if(I!==-1)if(!a&&S!==s.id&&j[S]&&j[S].length>=1){const b=j[S][0];j[S]=[w],j[I]=j[I].filter(v=>v!==w),j[I]=[...j[I],b]}else j[I]=j[I].filter(b=>b!==w),j[S]=[...j[S],w];return j})},h=c.useCallback(o=>t.jsx(Ve,{answerOption:o,question:s},`${s.id}_${o.id}`),[s]);return t.jsx("div",{className:g,...n,ref:d,children:t.jsxs(js,{onDragEnd:i,modifiers:[Ss],children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:f,children:t.jsx(Nt,{questionId:s.id,children:s.answer_option.filter(o=>l[s.id].includes(Number(o.id))).map(h)})}),t.jsx("div",{className:`DragDropInputQuestions ${a?"card":"row"}`,children:e.map((o,u)=>t.jsx(Ct,{question:o,answerOption:s.answer_option,index:a?u+1:void 0,selectedAnswers:l[o.id]||[],children:l[o.id]&&s.answer_option.filter(m=>l[o.id].includes(Number(m.id))).map(h)},o.id))})]})})}),Nt=({children:s,questionId:e})=>{const{setNodeRef:r}=Ce({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};Ke.displayName="DragDropQuestion";const Xe=c.memo(Ke),yt=({question:s,index:e})=>{const[r,n]=c.useState(""),[d,l]=c.useState(""),p=x(m=>m.testResult.isTestFininshed),a=x(m=>m.userAnswer.input_answers[s.id]),f=x(m=>m.testConfig.showAnswerOnChosen),g=_(),i=c.useMemo(()=>{const m=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(m,M)},[s.question_direction]);c.useEffect(()=>{var m;if(p){if(!a){n(" unanswer");return}((m=s==null?void 0:s.input_correct_answer)==null?void 0:m.toLowerCase())===a.toLowerCase()?n(" correct"):n(" incorrect")}},[p]),c.useEffect(()=>{var m;f&&(n(""),a&&(((m=s==null?void 0:s.input_correct_answer)==null?void 0:m.toLowerCase())===a.toLowerCase()?n(" correct"):n(" incorrect")))},[f,a]);const h=a?350:1e3,o=c.useCallback(Cs.debounce(m=>{g(gt({id:s.id,answer:m}))},h),[g,s.id,h]),u=m=>{if(p)return;const w=m.target.value;l(w),o(w)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${i}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:d,onInput:u,spellCheck:!1,style:{cursor:p?"default":"text"}})}),s.input_correct_answer&&t.jsxs("span",{className:"GroupInputInputCorrectAnswer",children:["Đáp án đúng: ",s.input_correct_answer]})]})},Ye=c.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},d)=>{const l=c.useMemo(()=>!e.some(a=>a.input_correct_answer===null),[e]),p=l?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:p,...n,ref:d,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((a,f)=>t.jsx(yt,{question:a,index:f+1},a.id))})]})});Ye.displayName="GroupInputQuestion";const Ze=c.memo(Ye),qe=c.memo(({answerOption:s,question:e,selectedValue:r,setSelectedValue:n})=>{const[d,l]=c.useState(""),p=x(o=>o.testResult.isTestFininshed),a=x(o=>o.userAnswer.answers[e.id]),f=x(o=>o.testConfig.showAnswerOnChosen),g=_(),i=c.useMemo(()=>{const o=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return F(o,M)},[s.value]);c.useEffect(()=>{if(!p)return;const o=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(o)&&l(" unanswer");return}a&&a.includes(o)&&(e.correct_answer.includes(o)||l(" incorrect")),e.correct_answer.includes(o)&&l(" correct")},[p]),c.useEffect(()=>{if(!f||(l(""),!a||a.length==0))return;const o=Number.parseInt(s.id);a&&a.includes(o)&&(e.correct_answer.includes(o)?l(" correct"):l(" incorrect"))},[f,a]);const h=o=>{p||(n(o.target.value),g(Be(e.id)),g(ie({id:e.id,answer:s.id})))};return t.jsxs("label",{className:`GroupRadioAnswerOption${d}`,children:[t.jsx(Se,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:h,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:i})]})});qe.displayName="GroupRadioAnswerOption";const It=({question:s,index:e})=>{const[r,n]=c.useState("-1"),d=c.useMemo(()=>{const l=D.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return F(l,M)},[s.question_direction]);return t.jsxs("div",{className:"GroupRadioInputQuestion",children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupRadioInputTextDirection",children:`${e}) ${d}`}),t.jsx("div",{className:"GroupRadioInputContainer",children:s.answer_option.map(l=>t.jsx(qe,{answerOption:l,question:s,selectedValue:r,setSelectedValue:n},l.id))})]})},es=c.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},d)=>{const l=c.useMemo(()=>{let a=!0;return e.forEach(f=>{f.correct_answer.some(g=>g>-1)||(a=!1)}),a},[e]),p=l?"GroupRadioQuestion":"GroupRadioQuestion noAnswer";return t.jsxs("div",{className:p,...n,ref:d,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:l}),t.jsx("div",{className:"GroupRadioInputQuestions",children:e.map((a,f)=>t.jsx(It,{question:a,index:f+1},a.id))})]})});es.displayName="GroupRadioQuestion";const ss=c.memo(es),_t=({children:s,sectionRefs:e,rootSelector:r,offset:n,as:d,...l})=>{const p=Ns({sectionRefs:e,rootSelector:r,offset:n}),a=x(i=>i.testNavigation.currentQuestionNumber),f=_();c.useEffect(()=>{p.currentElementIndexInViewport===-1||p.currentElementIndexInViewport+1===a||f(P(p.currentElementIndexInViewport+1))},[p]);const g=d||"div";return t.jsx(g,{...l,children:s})},Ft=()=>{const s=x(o=>o.testQuestion.filteredQuestions),e=x(o=>o.testQuestion.groupedQuestions),r=x(o=>o.testResult.isTestFininshed),n=x(o=>o.currCourse.course),{shuffleAnswer:d,questionCount:l}=x(o=>o.testConfig),p=_(),a=c.useRef([]),[f,g]=c.useState(-60);c.useEffect(()=>{window.innerHeight!==0&&g(-60-window.innerHeight/4)},[window.innerHeight]),c.useMemo(()=>{a.current.length!==s.length&&(a.current=Array(s.length).fill(null).map((o,u)=>a.current[u]||c.createRef()))},[s.length]),c.useEffect(()=>{if(r)return;p(W([])),(async()=>{const m=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`)).map(S=>new V(S)),w=h(m);i(w),p(W(w))})()},[r]);const i=o=>{o.forEach(u=>{d&&u.shuffleable&&(u.answer_option=z(u.answer_option))})},h=o=>{const u=z(o);return u.sort((m,w)=>m.cdr-w.cdr),l==="all"||Number.isNaN(Number.parseInt(l))?u:u.slice(0,Number.parseInt(l))};return!s||s.length==0||!a.current?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx(_t,{as:"div",className:"TestContainer",sectionRefs:a.current,offset:f,children:s.map((o,u)=>o.question_type==="radio"?t.jsx(Ge,{ref:a.current[u],question:o,id:`questionNumber_${u+1}`,number:u+1},o.id):o.question_type==="drag_drop"||o.question_type==="grouping"?t.jsx(Xe,{ref:a.current[u],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${u+1}`,number:u+1},o.id):o.question_type==="group-input"?t.jsx(Ze,{ref:a.current[u],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${u+1}`,number:u+1},o.id):o.question_type==="group-radio"?t.jsx(ss,{ref:a.current[u],topicQuestion:o,inputQuestions:e[o.id]||[],id:`questionNumber_${u+1}`,number:u+1},o.id):t.jsx(Je,{ref:a.current[u],question:o,id:`questionNumber_${u+1}`,number:u+1},o.id))})},Mt=({setHidePopup:s})=>{const e=x(h=>h.currSubject.subject),r=x(h=>h.testQuestion.filteredQuestions),n=x(h=>h.testQuestion.groupedQuestions),d=x(h=>h.testResult),l=_(),p=re("screen and (max-width: 768px)"),a=()=>{!d.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(l($e()),l(me()),l(ue()))},f=()=>{l(fe(!1)),l(me()),l(ue())},g=(h,o)=>Array.isArray(h)&&Array.isArray(o)?JSON.stringify(h.sort())===JSON.stringify(o.sort()):typeof h=="string"&&typeof o=="string"?h.toLowerCase()===o.toLowerCase():!1,i=()=>{const h=jt.getState(),o=h.userAnswer.answers,u=h.userAnswer.input_answers;let m=0;r.forEach(w=>{if(n[w.id]){let y=!0;n[w.id].forEach(j=>{if(j.question_type!=="group-input"){const I=o[j.id]||[];g(I,j.correct_answer)||(y=!1)}else{const I=u[j.id]||null;!I||!j.input_correct_answer?y=!1:g(I,j.input_correct_answer)||(y=!1)}}),y?(m++,l(he(w.id))):l(pe(w.id))}else{let y=!0;if(w.question_type!=="group-input"){const j=o[w.id]||[];g(j,w.correct_answer)||(y=!1)}else{const j=u[w.id]||null;!j||!w.input_correct_answer?y=!1:g(j,w.input_correct_answer)||(y=!1)}y?(m++,l(he(w.id))):l(pe(w.id))}const S=parseFloat((m/r.length*10).toFixed(2));l(xt(S))}),l(fe(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:a,children:t.jsx(ys,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!p&&t.jsx(Q,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:d.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(Q,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(Is,{})})}),t.jsx(Q,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(h=>!h),children:[t.jsxs("div",{children:["Điểm: ",d.score]}),t.jsxs("div",{children:["Kết quả: ",d.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(Q,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:i,children:[t.jsx(je,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(Q,{children:t.jsx(Ie,{})})]})},Bt=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:n,correctAnswers:d}=x(f=>f.testResult),l=x(f=>f.testQuestion.filteredQuestions),[p,a]=c.useState("");return c.useEffect(()=>{e(!n),r<5?a("lowScore"):r<8?a("mediumScore"):a("")},[n]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${p}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",d.length,"/",l.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Lt=()=>{const s=x(i=>i.testQuestion.filteredQuestions),e=x(i=>i.testQuestion.groupedQuestions),r=x(i=>i.testResult.isTestFininshed),n=x(i=>i.currCourse.course),d=x(i=>i.testNavigation.currentQuestionNumber),{shuffleAnswer:l,questionCount:p}=x(i=>i.testConfig),a=_();c.useEffect(()=>{if(r||a(P(1)),r)return;a(W([])),(async()=>{const o=(await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${n==null?void 0:n.id})`)).map(m=>new V(m)),u=g(o);f(u),a(W(u))})()},[r]);const f=i=>{i.forEach(h=>{l&&h.shuffleable&&(h.answer_option=z(h.answer_option))})},g=i=>{const h=z(i);return h.sort((o,u)=>o.cdr-u.cdr),p==="all"||Number.isNaN(Number.parseInt(p))?h:h.slice(0,Number.parseInt(p))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(J,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((i,h)=>i.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Ge,{question:i,number:h+1})},i.id):i.question_type==="drag_drop"?t.jsx("div",{className:"DragDropQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Xe,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):i.question_type==="group-input"?t.jsx("div",{className:"GroupInputQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Ze,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):i.question_type==="group-radio"?t.jsx("div",{className:"GroupRadioQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(ss,{topicQuestion:i,inputQuestions:e[i.id]||[],number:h+1})},i.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:d!==h+1?{display:"none"}:{},children:t.jsx(Je,{question:i,number:h+1})},i.id))})},vt=({currentIndex:s,questionNumbers:e})=>{const n=c.useRef(null),d=c.useRef(null),[l,p]=c.useState(0),[a,f]=c.useState(0);return c.useEffect(()=>{if(d.current&&n.current){const g=n.current.clientWidth,{defaultWidth:i,offsetFromCenter:h}=At(d.current,g);p(i),f(h)}},[]),c.useEffect(()=>{if(!(!l||!a)&&d.current&&n.current){const g=(s!==-1?s:1)-1+2,i=d.current.querySelectorAll(".QuestionNumberIndicatorItem"),h=i[g];i.forEach((o,u)=>{o.classList.remove("neighbour","current"),u===g&&o.classList.add("current"),Math.abs(u-g)===1&&o.classList.add("neighbour")}),h&&(d.current.style.transform=`translateX(${-(l*g)+a}px)`)}},[s,l,a]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:n,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:d,children:t.jsx(ts,{questionNumbers:e,fakeItemCount:2})})})},ts=c.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=n=>Array(e).fill(0).map((d,l)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:d},l+n));return t.jsxs(t.Fragment,{children:[r(-e),s.map(n=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:n},n)),r(s.length+1)]})});ts.displayName="QuestionNumberIndicatorList";const At=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const n=q(r);r.classList.add("neighbour");const d=q(r);r.classList.remove("neighbour"),r.classList.add("current");const l=q(r),p=d-n,a=(e-l)/2-p;return s.removeChild(r),{defaultWidth:n,neighborWidth:d,currentWidth:l,offsetFromCenter:a}},q=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Pt=()=>{const s=x(b=>b.theme.theme),e=x(b=>b.userAnswer.answers),r=x(b=>b.testQuestion.filteredQuestions),{correctAnswers:n,wrongAnswers:d}=x(b=>b.testResult),{questionCount:l,showQuestionByPage:p}=x(b=>b.testConfig),a=x(b=>b.testNavigation.currentQuestionNumber),f=_(),g=l!=="all"?parseInt(l):r.length,i=c.useMemo(()=>[...Array(g).keys()].map(b=>b+1),[g]),[h,o]=c.useState(null),u=!!h,m=b=>{o(b.currentTarget)},w=()=>{o(null)},S=b=>{let v="QuestionListMenuItem";try{const C=r[b-1];C instanceof V&&(!e||e&&!e[C==null?void 0:C.id]?v+=" unanswer":n.includes(C==null?void 0:C.id)?v+=" correct":d.includes(C==null?void 0:C.id)&&(v+=" incorrect"))}catch{console.log(`Question number ${b} does not exists`)}return b===a&&(v+=" selected"),v},y=b=>{p?f(P(b)):ee(b),w()},j=b=>{const v=Math.min(a+1,g);a>=g-1&&b.currentTarget.blur(),p?f(P(v)):ee(v)},I=b=>{a<=2&&b.currentTarget.blur();const v=Math.max(a-1,1);p?f(P(v)):ee(v)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":u?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":u?"true":void 0,onClick:m,children:t.jsx(ge,{className:"icon",size:16})}),t.jsx(_s,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:h,open:u,onClose:w,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:i.map(b=>t.jsx("button",{className:S(b),onClick:()=>y(b),children:b},b))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:I,disabled:a<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(vs,{className:"icon"})})]}),t.jsx(vt,{currentIndex:a,questionNumbers:i}),t.jsxs("button",{className:"NextQuestionBtn",onClick:j,disabled:a===g,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(As,{className:"icon"})})]})]})},ee=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const l=r.offsetTop-60-20-e;window.scroll({top:l,behavior:"smooth"})};export{Et as C,Tt as N,Rt as S,Mt as T,Lt as a,Ft as b,Bt as c,Pt as d,se as e,X as f,Z as g,Y as l,jt as s,Dt as u};
