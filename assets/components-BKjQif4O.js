var Se=Object.defineProperty;var Ne=(s,e,r)=>e in s?Se(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var b=(s,e,r)=>Ne(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as N,u as d,a as S,M as ye,b as Ae,r as l,d as P,F as se,e as Ie,f as Oe,g as te,P as Te,h as _e,$ as ve,s as Qe,O as ke,C as Q,i as Re,S as Be,k as ne,l as $,m as Me,p as D,n as U,R as $e,o as k,T as Fe,q as Ee,t as Le,v as Pe,w as De}from"./vendor-BIktREsd.js";const C=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ue=()=>{let s=localStorage.getItem("theme");return s||(s="dark",re(s)),s},re=s=>{localStorage.setItem("theme",s)},ze={theme:Ue()},oe=N({name:"theme",initialState:ze,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",re(s.theme)}}}),Je=oe.reducer,{switchTheme:He}=oe.actions,ae=()=>{const s=d(r=>r.theme.theme),e=S();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(He()),children:s=="light"?t.jsx(ye,{size:"24px",style:{background:"#00000000"}}):t.jsx(Ae,{size:"24px",style:{background:"#00000000"}})})},We={sidebarOpen:!1},ce=N({name:"sidebarOpen",initialState:We,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),qe=ce.reducer,{toggleSidebar:Ge,setIsSidebarOpen:Ke}=ce.actions,Fs=()=>{const s=d(u=>u.currSubject.subject),[e,r]=l.useState(!1),o=d(u=>u.sidebarOpen.sidebarOpen),c=P("screen and (max-width: 768px)"),h=S();return l.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[o]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(C,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>h(Ge()),disabled:e,children:t.jsx(se,{className:`BtnHamburgerIcon ${o?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!c&&t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx(Ie,{color:"var(--secondary-text-color)"})}),t.jsx(C,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(C,{children:t.jsx(ae,{})})]})};class ie{constructor(e){b(this,"id");b(this,"name");b(this,"subject_id");b(this,"_questions");b(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const Ve=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),Ye=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),Xe=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let F=null;const Ze=async()=>(F||(F=await Oe.createDbWorker([{from:"inline",config:{serverMode:"full",url:Xe,requestChunkSize:4096}}],Ve.toString(),Ye.toString())),F),I=async s=>{const r=await(await Ze()).db.query(s);return JSON.stringify(r)},es=async s=>{try{const e=await I(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ie(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ss=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await es(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},E=te("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await ss();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),ts={course:null,loading:!1,error:null},le=N({name:"currCourse",initialState:ts,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(E.pending,e=>{e.loading=!0,e.error=null}).addCase(E.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(E.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ns=le.reducer,{setCurrCourse:ue}=le.actions,rs=({children:s,...e})=>{const[r,o]=l.useState(!1),c=S(),h=P("screen and (max-width: 768px)");l.useEffect(()=>{e.currCourse?o(e.currCourse.id==e.course.id):o(!1)},[e.currCourse]);const u=()=>{c(ue(e.course)),h&&c(Ke(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:u,children:[t.jsx(Te,{strokeWidth:"70px",className:"icon"})," ",s]})})};class os{constructor(e){b(this,"id");b(this,"name");b(this,"semester_id");Object.assign(this,e)}}const as=async s=>{try{const e=await I(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new os(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},cs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await as(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},L=te("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await cs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),is={subject:null,loading:!1,error:null},de=N({name:"currSubject",initialState:is,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(L.pending,e=>{e.loading=!0,e.error=null}).addCase(L.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(L.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ls=de.reducer,{setCurrSubject:us}=de.actions,ds=s=>{const e=d(n=>n.currSubject.subject),r=d(n=>n.currCourse.course),[o,c]=l.useState(!1),[h,u]=l.useState([]),f=S();l.useEffect(()=>{c((e==null?void 0:e.id)==s.subject.id)},[e]),l.useEffect(()=>{(async()=>{const i=await I(`select *
        from Course
        where subject_id = ${s.subject.id}`),g=JSON.parse(i).map(x=>new ie(x));g&&u(g)})()},[]);const a=()=>{(e==null?void 0:e.id)!=s.subject.id&&f(ue(null)),f(us(s.subject))};return t.jsxs("li",{className:`SidebarGroupItem ${o?"selected":""}`,children:[t.jsx("button",{onClick:a,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.subject.name}),t.jsx(_e,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx("div",{className:`SidebarItemsContainer ${o?"show":""}`,children:t.jsx("ul",{children:h.map((n,i)=>t.jsx(rs,{currCourse:r,course:n,children:n.name},i))})})]})},B=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ve,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Es=()=>{const s=d(o=>o.sidebarOpen.sidebarOpen),[e,r]=l.useState([]);return l.useEffect(()=>{(async()=>{const c=await I("select * from Subject");r(JSON.parse(c))})()},[]),t.jsx("div",{className:`Sidebar ${s?"":"hide"}`,children:!e||e.length==0?t.jsx(B,{}):t.jsx("ul",{children:e.map((o,c)=>t.jsx(ds,{subject:o},c))})})},hs={activeTest:!1},he=N({name:"activeTest",initialState:hs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),ms=he.reducer,{toggleActiveTest:me}=he.actions,fs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ps=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",ws=()=>localStorage.getItem("showQuestionByPageOption")==="true",xs={shuffleAnswer:fs(),showAnswerOnChosen:ps(),showQuestionByPage:ws(),questionCount:"15"},fe=N({name:"testConfig",initialState:xs,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),gs=fe.reducer,{toggleShuffleAnswer:js,setQuestionCount:V,toggleShowAnswerOnChosen:bs,toggleShowQuestionByPage:Cs}=fe.actions,Ss=Qe(ke)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Ls=()=>{var y,_,p,O;const s=d(j=>j.theme.theme),e=d(j=>j.sidebarOpen.sidebarOpen),r=d(j=>j.currSubject),o=d(j=>j.currCourse),{shuffleAnswer:c,showAnswerOnChosen:h,showQuestionByPage:u}=d(j=>j.testConfig),[f,a]=l.useState({semester:null,loading:!1}),[n,i]=l.useState([]),[g,x]=l.useState(""),m=S();l.useEffect(()=>{(()=>{const T=[10,15,20,30,40,50,60,100,150],A=[];let q=!1;T.forEach(v=>{var G,K;if(o.course&&v>=((G=o.course)==null?void 0:G.question_per_test)){if(!q){const M=(K=o.course)==null?void 0:K.question_per_test;A.push(t.jsx($,{value:M,sx:{fontSize:14},children:M},M)),q=!0}return}A.push(t.jsx($,{value:v,sx:{fontSize:14},children:v},v))}),A.push(t.jsx($,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),i(A)})()},[o.course]),l.useEffect(()=>{const j=async()=>{var A;a({...f,loading:!0});const T=await I(`select *
        from Semester
        where id = ${(A=r.subject)==null?void 0:A.semester_id}`);a({semester:JSON.parse(T)[0],loading:!1})};r.subject&&j()},[r.subject]),l.useEffect(()=>{if(o.course){const j=o.course.question_per_test;x(j.toString()),m(V(j.toString()))}},[o.course]);const w=j=>{const T=j.target.value;x(T),m(V(T))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:f.loading||o.loading||r.loading?t.jsx(B,{}):r.subject&&o.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(y=o.course)==null?void 0:y.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(_=r.subject)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(p=f.semester)==null?void 0:p.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(O=o.course)==null?void 0:O.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:c,onClick:()=>m(js()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>m(bs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(Q,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>m(Cs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Re,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(Be,{value:g,onChange:w,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Ss,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:n})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>m(me()),children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},Ns={questions:[]},pe=N({name:"testQuestion",initialState:Ns,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),ys=pe.reducer,{addTestQuestion:Ps,setTestQuestion:R}=pe.actions,As={answers:{}},we=N({name:"userAnswer",initialState:As,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Is=we.reducer,{addUserAnswer:xe,removeUserAnswer:Os,removeAllUserAnswerById:Ts,resetUserAnwser:Y}=we.actions,X={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ge=N({name:"testResult",initialState:X,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>X}}),_s=ge.reducer,{addCorrectAnswer:vs,addWrongAnswer:Qs,setIsTestFinished:Z,setScore:ks,resetTestResut:ee}=ge.actions,Rs=Me({reducer:{theme:Je,sidebarOpen:qe,currSubject:ls,currCourse:ns,activeTest:ms,testQuestion:ys,userAnswer:Is,testResult:_s,testConfig:gs},middleware:s=>s({serializableCheck:!1})}),Ds=()=>S();class z{constructor(e){b(this,"id");b(this,"_question_direction");b(this,"question_type");b(this,"_answer_option");b(this,"_correct_answer");b(this,"cdr");b(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const J={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},je=l.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:o,setSelectedValue:c})=>{const[h,u]=l.useState(""),f=d(m=>m.testResult.isTestFininshed),a=d(m=>m.userAnswer.answers[e.id]),n=d(m=>m.testConfig.showAnswerOnChosen),i=S(),g=l.useMemo(()=>{const m=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return U(m,J)},[s.value]);l.useEffect(()=>{if(!f)return;const m=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(m)&&u(" unanswer");return}a&&a.includes(m)&&(e.correct_answer.includes(m)||u(" incorrect")),e.correct_answer.includes(m)&&u(" correct")},[f]),l.useEffect(()=>{if(!n||(u(""),!a||a.length==0))return;const m=Number.parseInt(s.id);a&&a.includes(m)&&(e.correct_answer.includes(m)||u(" incorrect")),e.correct_answer.includes(m)&&u(" correct")},[n,a]);const x=m=>{f||(c(m.target.value),i(Ts(e.id)),i(xe({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${h}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx($e,{name:`question_${e.id}`,checked:o===s.id,value:s.id,onChange:x,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});je.displayName="RadioAnswerOption";const Bs=({number:s,id:e,directionText:r,haveAnswer:o})=>{const c=l.useMemo(()=>{const h=D.sanitize(r,{USE_PROFILES:{html:!0}});return U(h,J)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!o&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:c})]})},be=l.memo(Bs),H=l.memo(({question:s,number:e,...r})=>{const[o,c]=l.useState("0"),h=l.useMemo(()=>s.correct_answer.some(n=>n>0&&n<=s.answer_option.length),[s.correct_answer]),u=h?"RadioQuestion":"RadioQuestion noAnswer",f=n=>{const i=Math.min(Math.max(65,n+65),90);return String.fromCharCode(i)},a=l.useCallback((n,i)=>t.jsx(je,{answerOption:n,question:s,answerOptionBullet:f(i),selectedValue:o,setSelectedValue:c},`${s.id}_${n.id}`),[o]);return t.jsxs("div",{className:u,...r,children:[t.jsx(be,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:h}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});H.displayName="RadioQuestion";const Ce=l.memo(({answerOption:s,question:e,answerOptionBullet:r,index:o,selectedValue:c,setSelectedValue:h})=>{const[u,f]=l.useState(""),a=d(w=>w.testResult.isTestFininshed),n=d(w=>w.userAnswer.answers[e.id]),i=d(w=>w.testConfig.showAnswerOnChosen),g=S(),x=l.useMemo(()=>{const w=D.sanitize(s.value,{USE_PROFILES:{html:!0}});return U(w,J)},[s.value]);l.useEffect(()=>{if(!a)return;const w=Number.parseInt(s.id);if(!n||n.length==0){e.correct_answer.includes(w)&&f(" unanswer");return}n&&n.includes(w)&&(e.correct_answer.includes(w)||f(" incorrect")),e.correct_answer.includes(w)&&f(" correct")},[a]),l.useEffect(()=>{if(!i||(f(""),!n||n.length==0))return;const w=Number.parseInt(s.id);n&&n.includes(w)&&(e.correct_answer.includes(w)||f(" incorrect")),e.correct_answer.includes(w)&&f(" correct")},[i,n]);const m=()=>{a||(c[o]?g(Os({id:e.id,answer:s.id})):g(xe({id:e.id,answer:s.id})),h(c.map((w,y)=>y==o?!w:w)))};return t.jsxs("div",{className:`CheckboxAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Q,{name:`question_${e.id}_${o}`,checked:c[o],onChange:m,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:x})]})]})});Ce.displayName="CheckboxAnswerOption";const W=l.memo(({question:s,number:e,...r})=>{const[o,c]=l.useState([!1,!1,!1,!1]),h=l.useMemo(()=>s.correct_answer.some(n=>n>0&&n<=s.correct_answer.length),[s.correct_answer]),u=h?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=n=>{const i=Math.min(Math.max(65,n+65),90);return String.fromCharCode(i)},a=l.useCallback((n,i)=>t.jsx(Ce,{answerOption:n,question:s,answerOptionBullet:f(i),index:i,selectedValue:o,setSelectedValue:c},`${s.id}_${n.id}`),[o]);return t.jsxs("div",{className:u,...r,children:[t.jsx(be,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:h}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});W.displayName="CheckboxQuestion";const Us=()=>{const s=d(a=>a.testQuestion.questions),e=d(a=>a.testResult.isTestFininshed),r=d(a=>a.currCourse.course),{shuffleAnswer:o,questionCount:c}=d(a=>a.testConfig),h=S();l.useEffect(()=>{if(e)return;h(R([])),(async()=>{const n=await I(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),i=JSON.parse(n).map(x=>new z(x)),g=f(i);u(g),h(R(g))})()},[e]);const u=a=>{a.forEach(n=>{o&&n.shuffleable&&(n.answer_option=k(n.answer_option))})},f=a=>{const n=k(a);return n.sort((i,g)=>i.cdr-g.cdr),c==="all"||Number.isNaN(Number.parseInt(c))?n:n.slice(0,Number.parseInt(c))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(B,{})}):t.jsx("div",{className:"TestContainer",children:s.map((a,n)=>a.question_type==="radio"?t.jsx(H,{question:a,number:n+1},a.id):t.jsx(W,{question:a,number:n+1},a.id))})},zs=({setHidePopup:s})=>{const e=d(n=>n.currSubject.subject),r=d(n=>n.testQuestion.questions),o=d(n=>n.testResult),c=S(),h=P("screen and (max-width: 768px)"),u=()=>{!o.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(c(me()),c(ee()),c(Y()))},f=()=>{c(Z(!1)),c(ee()),c(Y())},a=()=>{const i=Rs.getState().userAnswer.answers;let g=0;r.forEach(x=>{const m=JSON.stringify(x.correct_answer.sort()),w=JSON.stringify(i[x.id]&&[...i[x.id]].sort());m===w?(g++,c(vs(x.id))):c(Qs(x.id));const y=parseFloat((g/r.length*10).toFixed(2));c(ks(y))}),c(Z(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(C,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx(Fe,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!h&&t.jsx(C,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:o.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(C,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(Ee,{})})}),t.jsx(C,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(n=>!n),children:[t.jsxs("div",{children:["Điểm: ",o.score]}),t.jsxs("div",{children:["Kết quả: ",o.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(C,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:a,children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(C,{children:t.jsx(ae,{})})]})},Js=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:o,correctAnswers:c}=d(a=>a.testResult),h=d(a=>a.testQuestion.questions),[u,f]=l.useState("");return l.useEffect(()=>{e(!o),r<5?f("lowScore"):r<8&&f("mediumScore")},[o]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${u}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",c.length,"/",h.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Hs=({currentQuestionNumber:s})=>{const e=d(n=>n.testQuestion.questions),r=d(n=>n.testResult.isTestFininshed),o=d(n=>n.currCourse.course),{shuffleAnswer:c,questionCount:h}=d(n=>n.testConfig),u=S();l.useEffect(()=>{if(r)return;u(R([])),(async()=>{const i=await I(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${o==null?void 0:o.id})`),g=JSON.parse(i).map(m=>new z(m)),x=a(g);f(x),u(R(x))})()},[r]);const f=n=>{n.forEach(i=>{c&&i.shuffleable&&(i.answer_option=k(i.answer_option))})},a=n=>{const i=k(n);return i.sort((g,x)=>g.cdr-x.cdr),h==="all"||Number.isNaN(Number.parseInt(h))?i:i.slice(0,Number.parseInt(h))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(B,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((n,i)=>n.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(H,{question:n,number:i+1})},n.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==i+1?{display:"none"}:{},children:t.jsx(W,{question:n,number:i+1})},n.id))})},Ws=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const r=d(p=>p.theme.theme),o=d(p=>p.userAnswer.answers),c=d(p=>p.testQuestion.questions),h=d(p=>p.testConfig.questionCount),u=h!=="all"?parseInt(h):c.length,f=l.useMemo(()=>[...Array(u).keys()].map(p=>p+1),[u]),[a,n]=l.useState(null),i=!!a,g=p=>{n(p.currentTarget)},x=()=>{n(null)},m=p=>{let O="QuestionListMenuItem";try{const j=c[p-1];j instanceof z&&(!o||o&&!o[j==null?void 0:j.id])&&(O+=" unanswer")}catch{console.log(`Question number ${p} does not exists`)}return p===s&&(O+=" selected"),O},w=p=>{e(p),x()},y=()=>{const p=Math.min(s+1,u);e(p)},_=()=>{const p=Math.max(s-1,1);e(p)};return t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":i?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:g,children:t.jsx(se,{className:"icon",size:16})}),t.jsx(Le,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:a,open:i,onClose:x,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":r,children:t.jsx("div",{className:"QuestionListMenuContent",children:f.map(p=>t.jsx("button",{className:m(p),onClick:()=>w(p),children:p},p))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:_,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Pe,{className:"icon"})})]}),t.jsxs("button",{className:"NextQuestionBtn",onClick:y,disabled:s===u,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(De,{className:"icon"})})]})]})};export{Ls as C,Fs as N,Es as S,zs as T,Hs as a,Us as b,Js as c,Ws as d,E as e,L as l,Rs as s,Ds as u};
