var Me=Object.defineProperty;var Fe=(s,e,r)=>e in s?Me(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var j=(s,e,r)=>Fe(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as I,u as g,a as N,M as $e,b as Le,r as c,d as z,F as oe,e as Pe,f as De,g as J,P as Ue,h as We,A as He,$ as ze,s as ae,O as ie,S as ce,i as E,C as k,k as Je,l as le,m as qe,p as q,n as K,R as Ke,o as Ge,q as B,T as Ve,t as Xe,v as Ye,w as Ze,x as es}from"./vendor-5CDF6wRa.js";const y=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),ss=()=>{let s=localStorage.getItem("theme");return s||(s="dark",ue(s)),s},ue=s=>{localStorage.setItem("theme",s)},ts={theme:ss()},de=I({name:"theme",initialState:ts,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",ue(s.theme)}}}),rs=de.reducer,{switchTheme:ns}=de.actions,he=()=>{const s=g(r=>r.theme.theme),e=N();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(ns()),children:s=="light"?t.jsx($e,{size:"24px",style:{background:"#00000000"}}):t.jsx(Le,{size:"24px",style:{background:"#00000000"}})})},os={sidebarOpen:!1},me=I({name:"sidebarOpen",initialState:os,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),as=me.reducer,{toggleSidebar:fe,setIsSidebarOpen:is}=me.actions,ot=()=>{const s=g(d=>d.currSubject.subject),[e,r]=c.useState(!1),n=g(d=>d.sidebarOpen.sidebarOpen),i=z("screen and (max-width: 768px)"),m=N();return c.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[n]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>m(fe()),disabled:e,children:t.jsx(oe,{className:`BtnHamburgerIcon ${n?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!i&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx(Pe,{color:"var(--secondary-text-color)"})}),t.jsx(y,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(y,{children:t.jsx(he,{})})]})};class pe{constructor(e){j(this,"id");j(this,"name");j(this,"subject_id");j(this,"_questions");j(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const cs=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),ls=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),us=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let L=null;const ds=async()=>(L||(L=await De.createDbWorker([{from:"inline",config:{serverMode:"full",url:us,requestChunkSize:4096}}],cs.toString(),ls.toString())),L),v=async s=>{const r=await(await ds()).db.query(s);return JSON.stringify(r)},hs=async s=>{try{const e=await v(`select *
            from Course 
            where id = ${s}
            limit 1`);return new pe(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},ms=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await hs(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},P=J("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await ms();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),fs={course:null,loading:!1,error:null},ge=I({name:"currCourse",initialState:fs,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(P.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ps=ge.reducer,{setCurrCourse:we}=ge.actions,gs=({children:s,...e})=>{const[r,n]=c.useState(!1),i=N(),m=z("screen and (max-width: 768px)");c.useEffect(()=>{e.currCourse?n(e.currCourse.id==e.course.id):n(!1)},[e.currCourse]);const d=()=>{i(we(e.course)),m&&i(is(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:d,children:[t.jsx(Ue,{strokeWidth:"70px",className:"icon"})," ",s]})})};class ws{constructor(e){j(this,"id");j(this,"name");j(this,"semester_id");Object.assign(this,e)}}const xs=async s=>{try{const e=await v(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new ws(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Ss=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await xs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},D=J("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await Ss();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),bs={subject:null,loading:!1,error:null},xe=I({name:"currSubject",initialState:bs,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(D.pending,e=>{e.loading=!0,e.error=null}).addCase(D.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(D.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),js=xe.reducer,{setCurrSubject:Cs}=xe.actions,Ns=({subject:s})=>{const e=g(u=>u.currSubject.subject),r=g(u=>u.currCourse.course),[n,i]=c.useState(!1),[m,d]=c.useState(!1),[h,f]=c.useState([]),a=`SidebarGroupItem ${n?"selected":""} ${m?"expanded":""}`,o=N();c.useEffect(()=>{i((e==null?void 0:e.id)===s.id),d((e==null?void 0:e.id)===s.id)},[e]),c.useEffect(()=>{(async()=>{const p=await v(`select *
        from Course
        where subject_id = ${s.id}`),x=JSON.parse(p).map(C=>new pe(C));x&&f(x)})()},[]);const l=()=>{(e==null?void 0:e.id)!==s.id&&o(we(null)),o(Cs(s)),d(u=>!u)};return t.jsxs("li",{className:a,children:[t.jsx("button",{onClick:l,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(We,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(He,{height:m?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:h.map((u,p)=>t.jsx(gs,{currCourse:r,course:u,children:u.name},p))})})]})};class ys{constructor(e){j(this,"id");j(this,"name");Object.assign(this,e)}}const Is=async s=>{try{const e=await v(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new ys(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},vs=async()=>{let s=localStorage.getItem("SemesterId");if(s){const e=await Is(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},U=J("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await vs();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Os={semester:null,loading:!1,error:null},Se=I({name:"currSemester",initialState:Os,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(U.pending,e=>{e.loading=!0,e.error=null}).addCase(U.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(U.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),As=Se.reducer,{setCurrSemester:Z}=Se.actions,F=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(ze,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Ts=ae(ie)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),at=()=>{const s=g(o=>o.sidebarOpen.sidebarOpen),e=g(o=>o.currSemester.semester),[r,n]=c.useState([]),[i,m]=c.useState([]),[d,h]=c.useState([]),f=N();c.useEffect(()=>{(async()=>{const l=await v("select * from Subject");n(JSON.parse(l));const u=await v("select * from Semester");m(JSON.parse(u))})()},[]),c.useEffect(()=>{const o=e?r.filter(l=>l.semester_id===e.id):r;h(o)},[e,r]);const a=o=>{const l=Number(o.target.value);if(l===-1)f(Z(null));else{const u=i.find(p=>p.id===l);u&&f(Z(u))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!i?t.jsx(F,{}):t.jsxs(t.Fragment,{children:[t.jsxs(ce,{name:"semester",value:e?e.id:-1,onChange:a,input:t.jsx(Ts,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(E,{value:-1,children:"Tất cả"}),i.map(o=>t.jsx(E,{value:o.id,children:o.name},o.id))]}),!d||d.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:d.map((o,l)=>t.jsx(Ns,{subject:o},l))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>f(fe())})]})},_s={activeTest:!1},be=I({name:"activeTest",initialState:_s,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),Qs=be.reducer,{toggleActiveTest:je}=be.actions,Rs=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",ks=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Es=()=>localStorage.getItem("showQuestionByPageOption")==="true",Bs={shuffleAnswer:Rs(),showAnswerOnChosen:ks(),showQuestionByPage:Es(),questionCount:"15"},Ce=I({name:"testConfig",initialState:Bs,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),Ms=Ce.reducer,{toggleShuffleAnswer:Fs,setQuestionCount:ee,toggleShowAnswerOnChosen:$s,toggleShowQuestionByPage:Ls}=Ce.actions,Ps=ae(ie)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),it=()=>{var T,_,Q,w;const s=g(S=>S.theme.theme),e=g(S=>S.sidebarOpen.sidebarOpen),r=g(S=>S.currSubject),n=g(S=>S.currCourse),{shuffleAnswer:i,showAnswerOnChosen:m,showQuestionByPage:d}=g(S=>S.testConfig),[h,f]=c.useState({semester:null,loading:!1}),[a,o]=c.useState([]),[l,u]=c.useState(""),[p,x]=c.useState({value:0,loading:!1}),C=N();c.useEffect(()=>{(()=>{if(!n.course)return;const b=[10,15,20,30,40,50,60,80,100,150],O=[],X=n.course.question_per_test;b.includes(X)||(b.push(X),b.sort()),b.forEach(R=>{var Y;!n.course||R>=((Y=n.course)==null?void 0:Y.questions.length)||O.push(t.jsx(E,{value:R,sx:{fontSize:14},children:R},R))}),O.push(t.jsx(E,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),o(O)})()},[n.course]),c.useEffect(()=>{const S=async()=>{var O;f({...h,loading:!0});const b=await v(`select *
        from Semester
        where id = ${(O=r.subject)==null?void 0:O.semester_id}`);f({semester:JSON.parse(b)[0],loading:!1})};r.subject&&S()},[r.subject]),c.useEffect(()=>{if(n.course){const b=n.course.question_per_test;u(b.toString()),C(ee(b.toString()))}(async()=>{if(!n.course)return;const b=await v(`
        SELECT COUNT(DISTINCT Question.id) as count
        FROM Question
        WHERE id IN (${n.course.questions.join(",")})
        AND (
          (json_valid(correct_answer)
          AND json_array_length(correct_answer) > 0
          AND EXISTS (SELECT 1 FROM json_each(correct_answer) WHERE json_each.value > 0))
          OR correct_answer != 0
        )
      `),O=JSON.parse(b)[0].count;x({value:O,loading:!1})})()},[n.course]);const $=S=>{const b=S.target.value;u(b),C(ee(b))};return h.loading||n.loading||r.loading||p.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(F,{})}):!r.subject||!n.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(T=n.course)==null?void 0:T.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(_=r.subject)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(Q=h.semester)==null?void 0:Q.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(w=n.course)==null?void 0:w.questions.length})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:p.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:i,onClick:()=>C(Fs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:m,onClick:()=>C($s()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(k,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:d,onClick:()=>C(Ls()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Je,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(ce,{value:l,onChange:$,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Ps,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:a})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>C(je()),children:[t.jsx(le,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},Ds={questions:[]},Ne=I({name:"testQuestion",initialState:Ds,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Us=Ne.reducer,{addTestQuestion:ct,setTestQuestion:M}=Ne.actions,Ws={answers:{}},ye=I({name:"userAnswer",initialState:Ws,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Hs=ye.reducer,{addUserAnswer:Ie,removeUserAnswer:zs,removeAllUserAnswerById:Js,resetUserAnwser:se}=ye.actions,te={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ve=I({name:"testResult",initialState:te,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>te}}),qs=ve.reducer,{addCorrectAnswer:Ks,addWrongAnswer:Gs,setIsTestFinished:re,setScore:Vs,resetTestResut:ne}=ve.actions,Oe=I({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),Xs=Oe.reducer,{setCurrentQuestion:A}=Oe.actions,Ys=qe({reducer:{theme:rs,sidebarOpen:as,currSubject:js,currCourse:ps,currSemester:As,activeTest:Qs,testQuestion:Us,userAnswer:Hs,testResult:qs,testConfig:Ms,testNavigation:Xs},middleware:s=>s({serializableCheck:!1})}),lt=()=>N();class G{constructor(e){j(this,"id");j(this,"_question_direction");j(this,"question_type");j(this,"_answer_option");j(this,"_correct_answer");j(this,"cdr");j(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const V={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},Ae=c.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:n,setSelectedValue:i})=>{const[m,d]=c.useState(""),h=g(p=>p.testResult.isTestFininshed),f=g(p=>p.userAnswer.answers[e.id]),a=g(p=>p.testConfig.showAnswerOnChosen),o=N(),l=c.useMemo(()=>{const p=q.sanitize(s.value,{USE_PROFILES:{html:!0}});return K(p,V)},[s.value]);c.useEffect(()=>{if(!h)return;const p=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(p)&&d(" unanswer");return}f&&f.includes(p)&&(e.correct_answer.includes(p)||d(" incorrect")),e.correct_answer.includes(p)&&d(" correct")},[h]),c.useEffect(()=>{if(!a||(d(""),!f||f.length==0))return;const p=Number.parseInt(s.id);f&&f.includes(p)&&(e.correct_answer.includes(p)||d(" incorrect")),e.correct_answer.includes(p)&&d(" correct")},[a,f]);const u=p=>{h||(i(p.target.value),o(Js(e.id)),o(Ie({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${m}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Ke,{name:`question_${e.id}`,checked:n===s.id,value:s.id,onChange:u,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:l})]})]})});Ae.displayName="RadioAnswerOption";const Zs=({number:s,id:e,directionText:r,haveAnswer:n})=>{const i=c.useMemo(()=>{const m=q.sanitize(r,{USE_PROFILES:{html:!0}});return K(m,V)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!n&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:i})]})},Te=c.memo(Zs),_e=c.forwardRef(({question:s,number:e,...r},n)=>{const[i,m]=c.useState("0"),d=c.useMemo(()=>s.correct_answer.some(o=>o>0&&o<=s.answer_option.length),[s.correct_answer]),h=d?"RadioQuestion":"RadioQuestion noAnswer",f=o=>{const l=Math.min(Math.max(65,o+65),90);return String.fromCharCode(l)},a=c.useCallback((o,l)=>t.jsx(Ae,{answerOption:o,question:s,answerOptionBullet:f(l),selectedValue:i,setSelectedValue:m},`${s.id}_${o.id}`),[i]);return t.jsxs("div",{className:h,...r,ref:n,children:[t.jsx(Te,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});_e.displayName="RadioQuestion";const Qe=c.memo(_e),Re=c.memo(({answerOption:s,question:e,answerOptionBullet:r,index:n,selectedValue:i,setSelectedValue:m})=>{const[d,h]=c.useState(""),f=g(x=>x.testResult.isTestFininshed),a=g(x=>x.userAnswer.answers[e.id]),o=g(x=>x.testConfig.showAnswerOnChosen),l=N(),u=c.useMemo(()=>{const x=q.sanitize(s.value,{USE_PROFILES:{html:!0}});return K(x,V)},[s.value]);c.useEffect(()=>{if(!f)return;const x=Number.parseInt(s.id);if(!a||a.length==0){e.correct_answer.includes(x)&&h(" unanswer");return}a&&a.includes(x)&&(e.correct_answer.includes(x)||h(" incorrect")),e.correct_answer.includes(x)&&h(" correct")},[f]),c.useEffect(()=>{if(!o||(h(""),!a||a.length==0))return;const x=Number.parseInt(s.id);a&&a.includes(x)&&(e.correct_answer.includes(x)||h(" incorrect")),e.correct_answer.includes(x)&&h(" correct")},[o,a]);const p=()=>{f||(i[n]?l(zs({id:e.id,answer:s.id})):l(Ie({id:e.id,answer:s.id})),m(i.map((x,C)=>C==n?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${d}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(k,{name:`question_${e.id}_${n}`,checked:i[n],onChange:p,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:u})]})]})});Re.displayName="CheckboxAnswerOption";const ke=c.forwardRef(({question:s,number:e,...r},n)=>{const[i,m]=c.useState([!1,!1,!1,!1]),d=c.useMemo(()=>s.correct_answer.some(o=>o>0&&o<=s.correct_answer.length),[s.correct_answer]),h=d?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=o=>{const l=Math.min(Math.max(65,o+65),90);return String.fromCharCode(l)},a=c.useCallback((o,l)=>t.jsx(Re,{answerOption:o,question:s,answerOptionBullet:f(l),index:l,selectedValue:i,setSelectedValue:m},`${s.id}_${o.id}`),[i]);return t.jsxs("div",{className:h,...r,ref:n,children:[t.jsx(Te,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:d}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(a)})]})});ke.displayName="CheckboxQuestion";const Ee=c.memo(ke),et=({children:s,sectionRefs:e,rootSelector:r,offset:n,as:i,...m})=>{const d=Ge({sectionRefs:e,rootSelector:r,offset:n}),h=N();c.useEffect(()=>{d.currentElementIndexInViewport!==-1&&h(A(d.currentElementIndexInViewport+1))},[d]);const f=i||"div";return t.jsx(f,{...m,children:s})},ut=()=>{const s=g(l=>l.testQuestion.questions),e=g(l=>l.testResult.isTestFininshed),r=g(l=>l.currCourse.course),{shuffleAnswer:n,questionCount:i}=g(l=>l.testConfig),m=N(),d=c.useRef([]),[h,f]=c.useState(-60);c.useEffect(()=>{window.innerHeight!==0&&f(-60-window.innerHeight/4)},[window.innerHeight]),c.useMemo(()=>{d.current.length!==s.length&&(d.current=Array(s.length).fill(null).map((l,u)=>d.current[u]||c.createRef()))},[s.length]),c.useEffect(()=>{if(e)return;m(M([])),(async()=>{const u=await v(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),p=JSON.parse(u).map(C=>new G(C)),x=o(p);a(x),m(M(x))})()},[e]);const a=l=>{l.forEach(u=>{n&&u.shuffleable&&(u.answer_option=B(u.answer_option))})},o=l=>{const u=B(l);return u.sort((p,x)=>p.cdr-x.cdr),i==="all"||Number.isNaN(Number.parseInt(i))?u:u.slice(0,Number.parseInt(i))};return!s||s.length==0||!d.current?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx(et,{as:"div",className:"TestContainer",sectionRefs:d.current,offset:h,children:s.map((l,u)=>l.question_type==="radio"?t.jsx(Qe,{ref:d.current[u],question:l,id:`questionNumber_${u+1}`,number:u+1},l.id):t.jsx(Ee,{ref:d.current[u],question:l,id:`questionNumber_${u+1}`,number:u+1},l.id))})},dt=({setHidePopup:s})=>{const e=g(a=>a.currSubject.subject),r=g(a=>a.testQuestion.questions),n=g(a=>a.testResult),i=N(),m=z("screen and (max-width: 768px)"),d=()=>{!n.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(i(je()),i(ne()),i(se()))},h=()=>{i(re(!1)),i(ne()),i(se())},f=()=>{const o=Ys.getState().userAnswer.answers;let l=0;r.forEach(u=>{const p=JSON.stringify(u.correct_answer.sort()),x=JSON.stringify(o[u.id]&&[...o[u.id]].sort());p===x?(l++,i(Ks(u.id))):i(Gs(u.id));const C=parseFloat((l/r.length*10).toFixed(2));i(Vs(C))}),i(re(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:d,children:t.jsx(Ve,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!m&&t.jsx(y,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:n.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:h,children:t.jsx(Xe,{})})}),t.jsx(y,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(a=>!a),children:[t.jsxs("div",{children:["Điểm: ",n.score]}),t.jsxs("div",{children:["Kết quả: ",n.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(y,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:f,children:[t.jsx(le,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(y,{children:t.jsx(he,{})})]})},ht=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:n,correctAnswers:i}=g(f=>f.testResult),m=g(f=>f.testQuestion.questions),[d,h]=c.useState("");return c.useEffect(()=>{e(!n),r<5?h("lowScore"):r<8?h("mediumScore"):h("")},[n]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${d}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",i.length,"/",m.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},mt=()=>{const s=g(a=>a.testQuestion.questions),e=g(a=>a.testResult.isTestFininshed),r=g(a=>a.currCourse.course),n=g(a=>a.testNavigation.currentQuestionNumber),{shuffleAnswer:i,questionCount:m}=g(a=>a.testConfig),d=N();c.useEffect(()=>{if(e||d(A(1)),e)return;d(M([])),(async()=>{const o=await v(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),l=JSON.parse(o).map(p=>new G(p)),u=f(l);h(u),d(M(u))})()},[e]);const h=a=>{a.forEach(o=>{i&&o.shuffleable&&(o.answer_option=B(o.answer_option))})},f=a=>{const o=B(a);return o.sort((l,u)=>l.cdr-u.cdr),m==="all"||Number.isNaN(Number.parseInt(m))?o:o.slice(0,Number.parseInt(m))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(F,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((a,o)=>a.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:n!==o+1?{display:"none"}:{},children:t.jsx(Qe,{question:a,number:o+1})},a.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:n!==o+1?{display:"none"}:{},children:t.jsx(Ee,{question:a,number:o+1})},a.id))})},st=({currentIndex:s,questionNumbers:e})=>{const n=c.useRef(null),i=c.useRef(null),[m,d]=c.useState(0),[h,f]=c.useState(0);return c.useEffect(()=>{if(i.current&&n.current){const a=n.current.clientWidth,{defaultWidth:o,offsetFromCenter:l}=tt(i.current,a);d(o),f(l)}},[]),c.useEffect(()=>{if(!(!m||!h)&&i.current&&n.current){const a=(s!==-1?s:1)-1+2,o=i.current.querySelectorAll(".QuestionNumberIndicatorItem"),l=o[a];o.forEach((u,p)=>{u.classList.remove("neighbour","current"),p===a&&u.classList.add("current"),Math.abs(p-a)===1&&u.classList.add("neighbour")}),l&&(i.current.style.transform=`translateX(${-(m*a)+h}px)`)}},[s,m,h]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:n,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:i,children:t.jsx(Be,{questionNumbers:e,fakeItemCount:2})})})},Be=c.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=n=>Array(e).fill(0).map((i,m)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:i},m+n));return t.jsxs(t.Fragment,{children:[r(-e),s.map(n=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:n},n)),r(s.length+1)]})});Be.displayName="QuestionNumberIndicatorList";const tt=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const n=W(r);r.classList.add("neighbour");const i=W(r);r.classList.remove("neighbour"),r.classList.add("current");const m=W(r),d=i-n,h=(e-m)/2-d;return s.removeChild(r),{defaultWidth:n,neighborWidth:i,currentWidth:m,offsetFromCenter:h}},W=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},ft=()=>{const s=g(w=>w.theme.theme),e=g(w=>w.userAnswer.answers),r=g(w=>w.testQuestion.questions),{correctAnswers:n,wrongAnswers:i}=g(w=>w.testResult),{questionCount:m,showQuestionByPage:d}=g(w=>w.testConfig),h=g(w=>w.testNavigation.currentQuestionNumber),f=N(),a=m!=="all"?parseInt(m):r.length,o=c.useMemo(()=>[...Array(a).keys()].map(w=>w+1),[a]),[l,u]=c.useState(null),p=!!l,x=w=>{u(w.currentTarget)},C=()=>{u(null)},$=w=>{let S="QuestionListMenuItem";try{const b=r[w-1];b instanceof G&&(!e||e&&!e[b==null?void 0:b.id]?S+=" unanswer":n.includes(b==null?void 0:b.id)?S+=" correct":i.includes(b==null?void 0:b.id)&&(S+=" incorrect"))}catch{console.log(`Question number ${w} does not exists`)}return w===h&&(S+=" selected"),S},T=w=>{d?f(A(w)):H(w),C()},_=w=>{const S=Math.min(h+1,a);h>=a-1&&w.currentTarget.blur(),d?f(A(S)):H(S)},Q=w=>{h<=2&&w.currentTarget.blur();const S=Math.max(h-1,1);d?f(A(S)):H(S)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":p?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,onClick:x,children:t.jsx(oe,{className:"icon",size:16})}),t.jsx(Ye,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:l,open:p,onClose:C,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:o.map(w=>t.jsx("button",{className:$(w),onClick:()=>T(w),children:w},w))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:Q,disabled:h<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Ze,{className:"icon"})})]}),t.jsx(st,{currentIndex:h,questionNumbers:o}),t.jsxs("button",{className:"NextQuestionBtn",onClick:_,disabled:h===a,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(es,{className:"icon"})})]})]})},H=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const m=r.offsetTop-60-20-e;window.scroll({top:m,behavior:"smooth"})};export{it as C,ot as N,at as S,dt as T,mt as a,ut as b,ht as c,ft as d,P as e,U as f,D as l,Ys as s,lt as u};
