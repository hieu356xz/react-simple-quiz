var Le=Object.defineProperty;var Pe=(s,e,r)=>e in s?Le(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var I=(s,e,r)=>Pe(s,typeof e!="symbol"?e+"":e,r);import{j as t,c as O,u as x,a as _,M as Ue,b as He,r as i,d as V,F as ie,e as We,f as ze,g as X,P as Je,h as Ge,A as Ke,$ as Ve,s as ae,O as ce,S as le,i as B,C as M,k as Xe,l as ue,m as Ye,p as R,n as k,R as Ze,o as qe,q as es,t as de,D as ss,v as ts,w as rs,x as ns,y as F,T as os,z as is,B as as,E as cs,G as ls}from"./vendor-B83Yely-.js";const v=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),us=()=>{let s=localStorage.getItem("theme");return s||(s="dark",he(s)),s},he=s=>{localStorage.setItem("theme",s)},ds={theme:us()},me=O({name:"theme",initialState:ds,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",he(s.theme)}}}),hs=me.reducer,{switchTheme:ms}=me.actions,pe=()=>{const s=x(r=>r.theme.theme),e=_();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(ms()),children:s=="light"?t.jsx(Ue,{size:"24px",style:{background:"#00000000"}}):t.jsx(He,{size:"24px",style:{background:"#00000000"}})})},ps={sidebarOpen:!1},fe=O({name:"sidebarOpen",initialState:ps,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),fs=fe.reducer,{toggleSidebar:we,setIsSidebarOpen:ws}=fe.actions,jt=()=>{const s=x(u=>u.currSubject.subject),[e,r]=i.useState(!1),n=x(u=>u.sidebarOpen.sidebarOpen),c=V("screen and (max-width: 768px)"),p=_();return i.useEffect(()=>{r(()=>!0),setTimeout(()=>r(()=>!1),350)},[n]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(v,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>p(we()),disabled:e,children:t.jsx(ie,{className:`BtnHamburgerIcon ${n?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!c&&t.jsxs(t.Fragment,{children:[t.jsx(v,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(v,{children:t.jsx(We,{color:"var(--secondary-text-color)"})}),t.jsx(v,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(v,{children:t.jsx(pe,{})})]})};class ge{constructor(e){I(this,"id");I(this,"name");I(this,"subject_id");I(this,"_questions");I(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const gs=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),xs=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),Ss=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let H=null;const bs=async()=>(H||(H=await ze.createDbWorker([{from:"inline",config:{serverMode:"full",url:Ss,requestChunkSize:4096}}],gs.toString(),xs.toString())),H),T=async s=>{const r=await(await bs()).db.query(s);return JSON.stringify(r)},js=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ge(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Cs=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await js(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},W=X("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const r=await Cs();return r||e("No course found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Ns={course:null,loading:!1,error:null},xe=O({name:"currCourse",initialState:Ns,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase(W.pending,e=>{e.loading=!0,e.error=null}).addCase(W.fulfilled,(e,r)=>{e.course=r.payload,e.loading=!1}).addCase(W.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),ys=xe.reducer,{setCurrCourse:Se}=xe.actions,Is=({children:s,...e})=>{const[r,n]=i.useState(!1),c=_(),p=V("screen and (max-width: 768px)");i.useEffect(()=>{e.currCourse?n(e.currCourse.id==e.course.id):n(!1)},[e.currCourse]);const u=()=>{c(Se(e.course)),p&&c(ws(!1))};return t.jsx("li",{className:`SidebarItem ${r?"selected":""}`,children:t.jsxs("button",{onClick:u,children:[t.jsx(Je,{strokeWidth:"70px",className:"icon"})," ",s]})})};class _s{constructor(e){I(this,"id");I(this,"name");I(this,"semester_id");Object.assign(this,e)}}const As=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new _s(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},vs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await As(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},z=X("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const r=await vs();return r||e("No subject found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),Os={subject:null,loading:!1,error:null},be=O({name:"currSubject",initialState:Os,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(z.pending,e=>{e.loading=!0,e.error=null}).addCase(z.fulfilled,(e,r)=>{e.subject=r.payload,e.loading=!1}).addCase(z.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ts=be.reducer,{setCurrSubject:Qs}=be.actions,Rs=({subject:s})=>{const e=x(m=>m.currSubject.subject),r=x(m=>m.currCourse.course),[n,c]=i.useState(!1),[p,u]=i.useState(!1),[d,f]=i.useState([]),o=`SidebarGroupItem ${n?"selected":""} ${p?"expanded":""}`,a=_();i.useEffect(()=>{c((e==null?void 0:e.id)===s.id),u((e==null?void 0:e.id)===s.id)},[e]),i.useEffect(()=>{(async()=>{const l=await T(`select *
        from Course
        where subject_id = ${s.id}`),h=JSON.parse(l).map(w=>new ge(w));h&&f(h)})()},[]);const g=()=>{(e==null?void 0:e.id)!==s.id&&a(Se(null)),a(Qs(s)),u(m=>!m)};return t.jsxs("li",{className:o,children:[t.jsx("button",{onClick:g,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.name}),t.jsx(Ge,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx(Ke,{height:p?"auto":0,duration:300,className:"SidebarItemsContainer",children:t.jsx("ul",{children:d.map((m,l)=>t.jsx(Is,{currCourse:r,course:m,children:m.name},l))})})]})};class ks{constructor(e){I(this,"id");I(this,"name");Object.assign(this,e)}}const Es=async s=>{try{const e=await T(`select *
            from Semester 
            where id = ${s}
            limit 1`);return new ks(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},Ds=async()=>{let s=localStorage.getItem("SemesterId");if(s){const e=await Es(s);if(e)return localStorage.setItem("SemesterId",e.id.toString()),e}return null},J=X("currSemester/loadCurrSemester",async(s,{rejectWithValue:e})=>{try{const r=await Ds();return r||e("No semester found in local storage")}catch(r){return r instanceof Error?e(r.message):e(String(r))}}),$s={semester:null,loading:!1,error:null},je=O({name:"currSemester",initialState:$s,reducers:{setCurrSemester:(s,e)=>{s.semester=e.payload,e.payload?localStorage.setItem("SemesterId",e.payload.id.toString()):localStorage.removeItem("SemesterId")}},extraReducers:s=>{s.addCase(J.pending,e=>{e.loading=!0,e.error=null}).addCase(J.fulfilled,(e,r)=>{e.loading=!1,e.semester=r.payload}).addCase(J.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),Ms=je.reducer,{setCurrSemester:ee}=je.actions,P=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Ve,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),Bs=ae(ce)(()=>({"& .MuiInputBase-input":{borderRadius:4,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Ct=()=>{const s=x(a=>a.sidebarOpen.sidebarOpen),e=x(a=>a.currSemester.semester),[r,n]=i.useState([]),[c,p]=i.useState([]),[u,d]=i.useState([]),f=_();i.useEffect(()=>{(async()=>{const g=await T("select * from Subject");n(JSON.parse(g));const m=await T("select * from Semester");p(JSON.parse(m))})()},[]),i.useEffect(()=>{const a=e?r.filter(g=>g.semester_id===e.id):r;d(a)},[e,r]);const o=a=>{const g=Number(a.target.value);if(g===-1)f(ee(null));else{const m=c.find(l=>l.id===g);m&&f(ee(m))}};return t.jsxs("div",{className:`Sidebar ${s?"":"hide"}`,children:[!r||!c?t.jsx(P,{}):t.jsxs(t.Fragment,{children:[t.jsxs(le,{name:"semester",value:e&&c.length>0?e.id:-1,onChange:o,input:t.jsx(Bs,{}),MenuProps:{sx:{transform:"translateX(-8px)"}},children:[t.jsx(B,{value:-1,children:"Tất cả"}),c.map(a=>t.jsx(B,{value:a.id,children:a.name},a.id))]}),!u||u.length===0?t.jsx("div",{className:"SidebarEmpty",children:t.jsx("p",{children:"Không có môn học nào trong học kỳ này"})}):t.jsx("ul",{children:u.map(a=>t.jsx(Rs,{subject:a},a.id))})]}),t.jsx("div",{className:"SidebarOverlay",onClick:()=>f(we())})]})},Fs={activeTest:!1},Ce=O({name:"activeTest",initialState:Fs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),Ls=Ce.reducer,{toggleActiveTest:Ne}=Ce.actions,Ps=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",Us=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Hs=()=>localStorage.getItem("showQuestionByPageOption")==="true",Ws={shuffleAnswer:Ps(),showAnswerOnChosen:Us(),showQuestionByPage:Hs(),questionCount:"15"},ye=O({name:"testConfig",initialState:Ws,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),zs=ye.reducer,{toggleShuffleAnswer:Js,setQuestionCount:se,toggleShowAnswerOnChosen:Gs,toggleShowQuestionByPage:Ks}=ye.actions,Vs=ae(ce)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Nt=()=>{var y,j,A,S;const s=x(b=>b.theme.theme),e=x(b=>b.sidebarOpen.sidebarOpen),r=x(b=>b.currSubject),n=x(b=>b.currCourse),{shuffleAnswer:c,showAnswerOnChosen:p,showQuestionByPage:u}=x(b=>b.testConfig),[d,f]=i.useState({semester:null,loading:!1}),[o,a]=i.useState([]),[g,m]=i.useState(""),[l,h]=i.useState({value:0,loading:!1}),w=_();i.useEffect(()=>{(()=>{if(!n.course)return;const C=[10,15,20,30,40,50,60,80,100,150],Q=[],Z=n.course.question_per_test;C.includes(Z)||(C.push(Z),C.sort()),C.forEach($=>{var q;!n.course||$>=((q=n.course)==null?void 0:q.questions.length)||Q.push(t.jsx(B,{value:$,sx:{fontSize:14},children:$},$))}),Q.push(t.jsx(B,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),a(Q)})()},[n.course]),i.useEffect(()=>{const b=async()=>{var Q;f({...d,loading:!0});const C=await T(`select *
        from Semester
        where id = ${(Q=r.subject)==null?void 0:Q.semester_id}`);f({semester:JSON.parse(C)[0],loading:!1})};r.subject&&b()},[r.subject]),i.useEffect(()=>{if(n.course){const C=n.course.question_per_test;m(C.toString()),w(se(C.toString()))}(async()=>{if(!n.course)return;const C=await T(`
        SELECT COUNT(DISTINCT Question.id) as count
        FROM Question
        WHERE id IN (${n.course.questions.join(",")})
        AND (
          (json_valid(correct_answer)
          AND json_array_length(correct_answer) > 0
          AND EXISTS (SELECT 1 FROM json_each(correct_answer) WHERE json_each.value > 0))
          OR correct_answer != 0
        )
      `),Q=JSON.parse(C)[0].count;h({value:Q,loading:!1})})()},[n.course]);const N=b=>{const C=b.target.value;m(C),w(se(C))};return d.loading||n.loading||r.loading||l.loading?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx(P,{})}):!r.subject||!n.course?t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})}):t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:t.jsx("div",{className:"CourseInfoTable",children:t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(y=n.course)==null?void 0:y.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(j=r.subject)==null?void 0:j.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(A=d.semester)==null?void 0:A.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(S=n.course)==null?void 0:S.questions.length})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi đã có đáp án"}),t.jsx("td",{children:l.value})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(M,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:c,onClick:()=>w(Js()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(M,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:p,onClick:()=>w(Gs()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(M,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:u,onClick:()=>w(Ks()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Xe,{sx:{m:0,minWidth:120},size:"small",children:t.jsx(le,{value:g,onChange:N,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Vs,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>w(Ne()),children:[t.jsx(ue,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})})})})},Xs={questions:[]},Ie=O({name:"testQuestion",initialState:Xs,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),Ys=Ie.reducer,{addTestQuestion:yt,setTestQuestion:L}=Ie.actions,Zs={answers:{},input_answers:{}},_e=O({name:"userAnswer",initialState:Zs,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(r=>r!=Number.parseInt(e.payload.answer)))},updateUserAnswer:(s,e)=>{const r=e.payload.answers.map(Number).filter(n=>!isNaN(n));s.answers[e.payload.id]=r},setInputAnswer:(s,e)=>{s.input_answers[e.payload.id]=e.payload.answer},removeInputAnswer:(s,e)=>{s.input_answers[e.payload]&&delete s.input_answers[e.payload]},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[]),s.input_answers[e.payload]&&delete s.input_answers[e.payload]},resetUserAnwser:s=>{s.answers={},s.input_answers={}}}}),qs=_e.reducer,{addUserAnswer:Ae,removeUserAnswer:et,updateUserAnswer:st,setInputAnswer:tt,removeInputAnswer:It,removeAllUserAnswerById:rt,resetUserAnwser:te}=_e.actions,re={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},ve=O({name:"testResult",initialState:re,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>re}}),nt=ve.reducer,{addCorrectAnswer:ot,addWrongAnswer:it,setIsTestFinished:ne,setScore:at,resetTestResut:oe}=ve.actions,Oe=O({name:"testNavigation",initialState:{currentQuestionNumber:1},reducers:{setCurrentQuestion:(s,e)=>{s.currentQuestionNumber=e.payload}}}),ct=Oe.reducer,{setCurrentQuestion:D}=Oe.actions,lt=Ye({reducer:{theme:hs,sidebarOpen:fs,currSubject:Ts,currCourse:ys,currSemester:Ms,activeTest:Ls,testQuestion:Ys,userAnswer:qs,testResult:nt,testConfig:zs,testNavigation:ct},middleware:s=>s({serializableCheck:!1})}),_t=()=>_();class Y{constructor(e){I(this,"id");I(this,"_question_direction");I(this,"question_type");I(this,"_answer_option");I(this,"_correct_answer");I(this,"input_correct_answer");I(this,"cdr");I(this,"group_id");I(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const r=JSON.parse(e);typeof r=="number"?this._correct_answer=[r]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const E={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},Te=i.memo(({answerOption:s,question:e,answerOptionBullet:r,selectedValue:n,setSelectedValue:c})=>{const[p,u]=i.useState(""),d=x(l=>l.testResult.isTestFininshed),f=x(l=>l.userAnswer.answers[e.id]),o=x(l=>l.testConfig.showAnswerOnChosen),a=_(),g=i.useMemo(()=>{const l=R.sanitize(s.value,{USE_PROFILES:{html:!0}});return k(l,E)},[s.value]);i.useEffect(()=>{if(!d)return;const l=Number.parseInt(s.id);if(!f||f.length==0){e.correct_answer.includes(l)&&u(" unanswer");return}f&&f.includes(l)&&(e.correct_answer.includes(l)||u(" incorrect")),e.correct_answer.includes(l)&&u(" correct")},[d]),i.useEffect(()=>{if(!o||(u(""),!f||f.length==0))return;const l=Number.parseInt(s.id);f&&f.includes(l)&&(e.correct_answer.includes(l)||u(" incorrect")),e.correct_answer.includes(l)&&u(" correct")},[o,f]);const m=l=>{d||(c(l.target.value),a(rt(e.id)),a(Ae({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${p}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(Ze,{name:`question_${e.id}`,checked:n===s.id,value:s.id,onChange:m,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});Te.displayName="RadioAnswerOption";const ut=({number:s,id:e,directionText:r,haveAnswer:n,children:c})=>{const p=i.useMemo(()=>{const u=R.sanitize(r,{USE_PROFILES:{html:!0}});return k(u,E)},[r]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!n&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:p}),c&&t.jsx("div",{className:"QuestionContainerAdditional",children:c})]})},U=i.memo(ut),Qe=i.forwardRef(({question:s,number:e,...r},n)=>{const[c,p]=i.useState("0"),u=i.useMemo(()=>s.correct_answer.some(a=>a>0&&a<=s.answer_option.length),[s.correct_answer]),d=u?"RadioQuestion":"RadioQuestion noAnswer",f=a=>{const g=Math.min(Math.max(65,a+65),90);return String.fromCharCode(g)},o=i.useCallback((a,g)=>t.jsx(Te,{answerOption:a,question:s,answerOptionBullet:f(g),selectedValue:c,setSelectedValue:p},`${s.id}_${a.id}`),[c]);return t.jsxs("div",{className:d,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Qe.displayName="RadioQuestion";const Re=i.memo(Qe),ke=i.memo(({answerOption:s,question:e,answerOptionBullet:r,index:n,selectedValue:c,setSelectedValue:p})=>{const[u,d]=i.useState(""),f=x(h=>h.testResult.isTestFininshed),o=x(h=>h.userAnswer.answers[e.id]),a=x(h=>h.testConfig.showAnswerOnChosen),g=_(),m=i.useMemo(()=>{const h=R.sanitize(s.value,{USE_PROFILES:{html:!0}});return k(h,E)},[s.value]);i.useEffect(()=>{if(!f)return;const h=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(h)&&d(" unanswer");return}o&&o.includes(h)&&(e.correct_answer.includes(h)||d(" incorrect")),e.correct_answer.includes(h)&&d(" correct")},[f]),i.useEffect(()=>{if(!a||(d(""),!o||o.length==0))return;const h=Number.parseInt(s.id);o&&o.includes(h)&&(e.correct_answer.includes(h)||d(" incorrect")),e.correct_answer.includes(h)&&d(" correct")},[a,o]);const l=()=>{f||(c[n]?g(et({id:e.id,answer:s.id})):g(Ae({id:e.id,answer:s.id})),p(c.map((h,w)=>w==n?!h:h)))};return t.jsxs("div",{className:`CheckboxAnswerOption${u}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:r}),t.jsxs("label",{children:[t.jsx(M,{name:`question_${e.id}_${n}`,checked:c[n],onChange:l,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:m})]})]})});ke.displayName="CheckboxAnswerOption";const Ee=i.forwardRef(({question:s,number:e,...r},n)=>{const[c,p]=i.useState([!1,!1,!1,!1]),u=i.useMemo(()=>s.correct_answer.some(a=>a>0&&a<=s.correct_answer.length),[s.correct_answer]),d=u?"CheckboxQuestion":"CheckboxQuestion noAnswer",f=a=>{const g=Math.min(Math.max(65,a+65),90);return String.fromCharCode(g)},o=i.useCallback((a,g)=>t.jsx(ke,{answerOption:a,question:s,answerOptionBullet:f(g),index:g,selectedValue:c,setSelectedValue:p},`${s.id}_${a.id}`),[c]);return t.jsxs("div",{className:d,...r,ref:n,children:[t.jsx(U,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:u}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Ee.displayName="CheckboxQuestion";const De=i.memo(Ee),$e=i.memo(({answerOption:s,question:e})=>{const r=i.useMemo(()=>{const f=R.sanitize(s.value,{USE_PROFILES:{html:!0}});return k(f,E)},[s.value]),{attributes:n,listeners:c,setNodeRef:p,transform:u}=qe({id:`answer-option-${e.id}-${s.id}`,data:{answerOptionId:s.id,questionId:e.id}}),d={transform:es.Translate.toString(u)};return t.jsx("span",{id:`question_${e.id}_${s.id}`,ref:p,...c,...n,style:d,className:"DragDropAnswerOption",children:t.jsx("span",{className:"AnswerOptionText",children:r})})});$e.displayName="DragDropAnswerOption";const dt=({question:s,index:e,selectedAnswers:r,children:n})=>{const{setNodeRef:c,isOver:p}=de({id:s.id}),[u,d]=i.useState(""),f=x(l=>l.testResult.isTestFininshed),o=x(l=>l.userAnswer.answers[s.id]),a=x(l=>l.testConfig.showAnswerOnChosen),g=_(),m=i.useMemo(()=>{const l=R.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return k(l,E)},[s.question_direction]);return i.useEffect(()=>{if(!f)return;if(!o||o.length==0){s.correct_answer.length>0&&d(" unanswer");return}const l=JSON.stringify(s.correct_answer.sort()),h=JSON.stringify(o&&[...o].sort());d(l===h?" correct":" incorrect")},[f]),i.useEffect(()=>{if(!a||(d(""),!o||o.length==0))return;const l=JSON.stringify(s.correct_answer.sort()),h=JSON.stringify(o&&[...o].sort());d(l===h?" correct":" incorrect")},[a,o]),i.useEffect(()=>{f||o===void 0&&r.length===0||g(st({id:s.id,answers:r}))},[r]),t.jsxs("div",{className:`DragDropInputQuestion${u}`,children:[t.jsx("span",{className:"DragDropInputTextDirection",children:e?`${e}) ${m}`:m}),t.jsxs("span",{className:"DragDropInputContainer",children:[t.jsx("div",{className:"DragDropInputDroppable",ref:c,children:n}),t.jsx("p",{className:"DragDropInputMessage",style:p||n!=null&&n.length?{display:"none"}:{},children:"Kéo và thẻ các đáp án vào đây"})]})]})},Me=i.forwardRef(({dragQuestion:s,inputQuestions:e,number:r,...n},c)=>{const[p,u]=i.useState({[s.id]:s.answer_option.map(m=>Number(m.id))}),d=s.question_type==="grouping",f=i.useMemo(()=>{let m=!0;return e.forEach(l=>{l.correct_answer.some(h=>h>0)||(m=!1)}),m},[e]),o=f?"DragDropQuestion":"DragDropQuestion noAnswer",a=m=>{const{active:l,over:h}=m;if(!h||!l.data.current)return;const w=Number(l.data.current.answerOptionId),N=h.id;u(y=>{const j={...y};j[N]||(j[N]=[]);let A=-1;for(const S in j)if(j.hasOwnProperty(S)&&j[S].includes(w)){A=Number(S);break}if(A!==-1)if(!d&&N!==s.id&&j[N]&&j[N].length>=1){const S=j[N][0];j[N]=[w],j[A]=j[A].filter(b=>b!==w),j[A]=[...j[A],S]}else j[A]=j[A].filter(S=>S!==w),j[N]=[...j[N],w];return j})},g=i.useCallback(m=>t.jsx($e,{answerOption:m,question:s},`${s.id}_${m.id}`),[s]);return t.jsx("div",{className:o,...n,ref:c,children:t.jsxs(ss,{onDragEnd:a,modifiers:[ts],children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:f,children:t.jsx(ht,{questionId:s.id,children:s.answer_option.filter(m=>p[s.id].includes(Number(m.id))).map(g)})}),t.jsx("div",{className:`DragDropInputQuestions ${d?"card":"row"}`,children:e.map((m,l)=>t.jsx(dt,{question:m,index:d?l+1:void 0,selectedAnswers:p[m.id]||[],children:p[m.id]&&s.answer_option.filter(h=>p[m.id].includes(Number(h.id))).map(g)},m.id))})]})})}),ht=({children:s,questionId:e})=>{const{setNodeRef:r}=de({id:e});return t.jsx("div",{className:"DragDropAnswerOptions",ref:r,children:s})};Me.displayName="DragDropQuestion";const mt=i.memo(Me),pt=({question:s,index:e})=>{const[r,n]=i.useState(""),[c,p]=i.useState(""),u=x(l=>l.testResult.isTestFininshed),d=x(l=>l.userAnswer.input_answers[s.id]),f=x(l=>l.testConfig.showAnswerOnChosen),o=_(),a=i.useMemo(()=>{const l=R.sanitize(s.question_direction,{USE_PROFILES:{html:!0}});return k(l,E)},[s.question_direction]);i.useEffect(()=>{if(u){if(!d){n(" unanswer");return}(s==null?void 0:s.input_correct_answer)===d?n(" correct"):n(" incorrect")}},[u]),i.useEffect(()=>{f&&(n(""),d&&((s==null?void 0:s.input_correct_answer)===d?n(" correct"):n(" incorrect")))},[f,d]);const g=i.useCallback(rs.debounce(l=>{o(tt({id:s.id,answer:l}))},350),[o,s.id]),m=l=>{if(u)return;const h=l.target.value;p(h),g(h)};return t.jsxs("div",{className:`GroupInputInputQuestion${r}`,children:[t.jsx("label",{htmlFor:`input-question-${s.id}`,className:"GroupInputInputTextDirection",children:`${e}) ${a}`}),t.jsx("span",{className:"GroupInputInputContainer",children:t.jsx("input",{type:"text",id:`input-question-${s.id}`,value:c,onInput:m,spellCheck:!1})})]})},Be=i.forwardRef(({topicQuestion:s,inputQuestions:e,number:r,...n},c)=>{const p=i.useMemo(()=>e.some(d=>d.input_correct_answer!==null),[e]),u=p?"GroupInputQuestion":"GroupInputQuestion noAnswer";return t.jsxs("div",{className:u,...n,ref:c,children:[t.jsx(U,{number:r,id:s.id,directionText:s.question_direction,haveAnswer:p}),t.jsx("div",{className:"GroupInputInputQuestions",children:e.map((d,f)=>t.jsx(pt,{question:d,index:f+1},d.id))})]})});Be.displayName="GroupInputQuestion";const ft=i.memo(Be),wt=({children:s,sectionRefs:e,rootSelector:r,offset:n,as:c,...p})=>{const u=ns({sectionRefs:e,rootSelector:r,offset:n}),d=_();i.useEffect(()=>{u.currentElementIndexInViewport!==-1&&d(D(u.currentElementIndexInViewport+1))},[u]);const f=c||"div";return t.jsx(f,{...p,children:s})},At=()=>{const s=x(h=>h.testQuestion.questions),e=x(h=>h.testResult.isTestFininshed),r=x(h=>h.currCourse.course),{shuffleAnswer:n,questionCount:c}=x(h=>h.testConfig),p=_(),u=i.useRef([]),[d,f]=i.useState(-60);i.useEffect(()=>{window.innerHeight!==0&&f(-60-window.innerHeight/4)},[window.innerHeight]),i.useMemo(()=>{u.current.length!==s.length&&(u.current=Array(s.length).fill(null).map((h,w)=>u.current[w]||i.createRef()))},[s.length]),i.useEffect(()=>{if(e)return;p(L([])),(async()=>{const w=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),N=JSON.parse(w).map(j=>new Y(j)),y=a(N);o(y),p(L(y))})()},[e]);const o=h=>{h.forEach(w=>{n&&w.shuffleable&&(w.answer_option=F(w.answer_option))})},a=h=>{const w=F(h);return w.sort((N,y)=>N.cdr-y.cdr),c==="all"||Number.isNaN(Number.parseInt(c))?w:w.slice(0,Number.parseInt(c))},g=h=>{const w=[],N={};return h.forEach(y=>{y.question_type==="grouping"||y.question_type==="group-input"&&y.group_id||y.question_type==="drag_drop"&&y.group_id?N[y.group_id]=[...N[y.group_id]||[],y]:w.push(y)}),{filteredQuestions:w,groupedQuestions:N}},{filteredQuestions:m,groupedQuestions:l}=g(s);return!s||s.length==0||!u.current?t.jsx("div",{className:"TestContainer",children:t.jsx(P,{})}):t.jsx(wt,{as:"div",className:"TestContainer",sectionRefs:u.current,offset:d,children:m.map((h,w)=>h.question_type==="radio"?t.jsx(Re,{ref:u.current[w],question:h,id:`questionNumber_${w+1}`,number:w+1},h.id):h.question_type==="drag_drop"?t.jsx(mt,{ref:u.current[w],dragQuestion:h,inputQuestions:l[h.id]||[],id:`questionNumber_${w+1}`,number:w+1},h.id):h.question_type==="group-input"?t.jsx(ft,{ref:u.current[w],topicQuestion:h,inputQuestions:l[h.id]||[],id:`questionNumber_${w+1}`,number:w+1},h.id):t.jsx(De,{ref:u.current[w],question:h,id:`questionNumber_${w+1}`,number:w+1},h.id))})},vt=({setHidePopup:s})=>{const e=x(o=>o.currSubject.subject),r=x(o=>o.testQuestion.questions),n=x(o=>o.testResult),c=_(),p=V("screen and (max-width: 768px)"),u=()=>{!n.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(c(Ne()),c(oe()),c(te()))},d=()=>{c(ne(!1)),c(oe()),c(te())},f=()=>{const a=lt.getState().userAnswer.answers;let g=0;r.forEach(m=>{const l=JSON.stringify(m.correct_answer.sort()),h=JSON.stringify(a[m.id]&&[...a[m.id]].sort());l===h?(g++,c(ot(m.id))):c(it(m.id));const w=parseFloat((g/r.length*10).toFixed(2));c(at(w))}),c(ne(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(v,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx(os,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!p&&t.jsx(v,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:n.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(v,{children:t.jsx("button",{className:"IconBtn",onClick:d,children:t.jsx(is,{})})}),t.jsx(v,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",n.score]}),t.jsxs("div",{children:["Kết quả: ",n.correctAnswers.length,"/",r.length]})]})})]}):t.jsx(v,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:f,children:[t.jsx(ue,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(v,{children:t.jsx(pe,{})})]})},Ot=({hidePopup:s,setHidePopup:e})=>{const{score:r,isTestFininshed:n,correctAnswers:c}=x(f=>f.testResult),p=x(f=>f.testQuestion.questions),[u,d]=i.useState("");return i.useEffect(()=>{e(!n),r<5?d("lowScore"):r<8?d("mediumScore"):d("")},[n]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${u}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",r]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",c.length,"/",p.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},Tt=()=>{const s=x(o=>o.testQuestion.questions),e=x(o=>o.testResult.isTestFininshed),r=x(o=>o.currCourse.course),n=x(o=>o.testNavigation.currentQuestionNumber),{shuffleAnswer:c,questionCount:p}=x(o=>o.testConfig),u=_();i.useEffect(()=>{if(e||u(D(1)),e)return;u(L([])),(async()=>{const a=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),g=JSON.parse(a).map(l=>new Y(l)),m=f(g);d(m),u(L(m))})()},[e]);const d=o=>{o.forEach(a=>{c&&a.shuffleable&&(a.answer_option=F(a.answer_option))})},f=o=>{const a=F(o);return a.sort((g,m)=>g.cdr-m.cdr),p==="all"||Number.isNaN(Number.parseInt(p))?a:a.slice(0,Number.parseInt(p))};return!s||s.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(P,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:s.map((o,a)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:n!==a+1?{display:"none"}:{},children:t.jsx(Re,{question:o,number:a+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:n!==a+1?{display:"none"}:{},children:t.jsx(De,{question:o,number:a+1})},o.id))})},gt=({currentIndex:s,questionNumbers:e})=>{const n=i.useRef(null),c=i.useRef(null),[p,u]=i.useState(0),[d,f]=i.useState(0);return i.useEffect(()=>{if(c.current&&n.current){const o=n.current.clientWidth,{defaultWidth:a,offsetFromCenter:g}=xt(c.current,o);u(a),f(g)}},[]),i.useEffect(()=>{if(!(!p||!d)&&c.current&&n.current){const o=(s!==-1?s:1)-1+2,a=c.current.querySelectorAll(".QuestionNumberIndicatorItem"),g=a[o];a.forEach((m,l)=>{m.classList.remove("neighbour","current"),l===o&&m.classList.add("current"),Math.abs(l-o)===1&&m.classList.add("neighbour")}),g&&(c.current.style.transform=`translateX(${-(p*o)+d}px)`)}},[s,p,d]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:n,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:c,children:t.jsx(Fe,{questionNumbers:e,fakeItemCount:2})})})},Fe=i.memo(({questionNumbers:s,fakeItemCount:e})=>{const r=n=>Array(e).fill(0).map((c,p)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:c},p+n));return t.jsxs(t.Fragment,{children:[r(-e),s.map(n=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:n},n)),r(s.length+1)]})});Fe.displayName="QuestionNumberIndicatorList";const xt=(s,e)=>{const r=document.createElement("div");r.className="QuestionNumberIndicatorItem",r.textContent="0",r.style.visibility="hidden",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.transition="none",s.appendChild(r);const n=G(r);r.classList.add("neighbour");const c=G(r);r.classList.remove("neighbour"),r.classList.add("current");const p=G(r),u=c-n,d=(e-p)/2-u;return s.removeChild(r),{defaultWidth:n,neighborWidth:c,currentWidth:p,offsetFromCenter:d}},G=s=>{const e=s.offsetWidth,r=getComputedStyle(s);return e+parseInt(r.marginLeft)+parseInt(r.marginRight)},Qt=()=>{const s=x(S=>S.theme.theme),e=x(S=>S.userAnswer.answers),r=x(S=>S.testQuestion.questions),{correctAnswers:n,wrongAnswers:c}=x(S=>S.testResult),{questionCount:p,showQuestionByPage:u}=x(S=>S.testConfig),d=x(S=>S.testNavigation.currentQuestionNumber),f=_(),o=p!=="all"?parseInt(p):r.length,a=i.useMemo(()=>[...Array(o).keys()].map(S=>S+1),[o]),[g,m]=i.useState(null),l=!!g,h=S=>{m(S.currentTarget)},w=()=>{m(null)},N=S=>{let b="QuestionListMenuItem";try{const C=r[S-1];C instanceof Y&&(!e||e&&!e[C==null?void 0:C.id]?b+=" unanswer":n.includes(C==null?void 0:C.id)?b+=" correct":c.includes(C==null?void 0:C.id)&&(b+=" incorrect"))}catch{console.log(`Question number ${S} does not exists`)}return S===d&&(b+=" selected"),b},y=S=>{u?f(D(S)):K(S),w()},j=S=>{const b=Math.min(d+1,o);d>=o-1&&S.currentTarget.blur(),u?f(D(b)):K(b)},A=S=>{d<=2&&S.currentTarget.blur();const b=Math.max(d-1,1);u?f(D(b)):K(b)};return!r||r.length==0?t.jsx("div",{className:"Footer"}):t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":l?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":l?"true":void 0,onClick:h,children:t.jsx(ie,{className:"icon",size:16})}),t.jsx(as,{anchorOrigin:{vertical:"top",horizontal:-10},transformOrigin:{vertical:"bottom",horizontal:"left"},anchorEl:g,open:l,onClose:w,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":s,children:t.jsx("div",{className:"QuestionListMenuContent",children:a.map(S=>t.jsx("button",{className:N(S),onClick:()=>y(S),children:S},S))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:A,disabled:d<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(cs,{className:"icon"})})]}),t.jsx(gt,{currentIndex:d,questionNumbers:a}),t.jsxs("button",{className:"NextQuestionBtn",onClick:j,disabled:d===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(ls,{className:"icon"})})]})]})},K=(s,e=0)=>{const r=document.getElementById(`questionNumber_${s}`);if(!r)return;const p=r.offsetTop-60-20-e;window.scroll({top:p,behavior:"smooth"})};export{Nt as C,jt as N,Ct as S,vt as T,Tt as a,At as b,Ot as c,Qt as d,W as e,J as f,z as l,lt as s,_t as u};
