var Te=Object.defineProperty;var Oe=(s,e,n)=>e in s?Te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var C=(s,e,n)=>Oe(s,typeof e!="symbol"?e+"":e,n);import{j as t,c as A,u as w,a as I,M as _e,b as ve,r as i,d as z,F as se,e as Qe,f as Re,g as te,P as ke,h as Be,$ as Ee,s as Fe,O as Le,C as R,i as Me,S as $e,k as ne,l as L,m as Pe,p as W,n as H,R as Ue,o as De,q as k,T as ze,t as We,v as He,w as Je,x as qe}from"./vendor-xupMW5mC.js";const y=({children:s,...e})=>t.jsx("div",{className:`NavbarItem ${e.className?e.className:""}`,children:s}),Ke=()=>{let s=localStorage.getItem("theme");return s||(s="dark",re(s)),s},re=s=>{localStorage.setItem("theme",s)},Ve={theme:Ke()},oe=A({name:"theme",initialState:Ve,reducers:{switchTheme:s=>{s.theme=s.theme=="dark"?"light":"dark",re(s.theme)}}}),Ge=oe.reducer,{switchTheme:Xe}=oe.actions,ae=()=>{const s=w(n=>n.theme.theme),e=I();return t.jsx("button",{className:"BtnToggleTheme IconBtn",onClick:()=>e(Xe()),children:s=="light"?t.jsx(_e,{size:"24px",style:{background:"#00000000"}}):t.jsx(ve,{size:"24px",style:{background:"#00000000"}})})},Ye={sidebarOpen:!1},ce=A({name:"sidebarOpen",initialState:Ye,reducers:{toggleSidebar:s=>{s.sidebarOpen=!s.sidebarOpen},setIsSidebarOpen:(s,e)=>{s.sidebarOpen=e.payload}}}),Ze=ce.reducer,{toggleSidebar:es,setIsSidebarOpen:ss}=ce.actions,Js=()=>{const s=w(f=>f.currSubject.subject),[e,n]=i.useState(!1),r=w(f=>f.sidebarOpen.sidebarOpen),a=z("screen and (max-width: 768px)"),h=I();return i.useEffect(()=>{n(()=>!0),setTimeout(()=>n(()=>!1),350)},[r]),t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"BtnHamburger IconBtn",onClick:()=>h(es()),disabled:e,children:t.jsx(se,{className:`BtnHamburgerIcon ${r?"active":""}`,style:{backgroundColor:"#00000000"}})})}),t.jsx("div",{className:"SubjectNameContainer",children:!a&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("span",{style:{textWrap:"nowrap"},children:"Môn học"})}),s&&t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx(Qe,{color:"var(--secondary-text-color)"})}),t.jsx(y,{children:t.jsx("span",{children:s==null?void 0:s.name})})]})]})}),t.jsx(y,{children:t.jsx(ae,{})})]})};class ie{constructor(e){C(this,"id");C(this,"name");C(this,"subject_id");C(this,"_questions");C(this,"question_per_test");Object.assign(this,e)}get questions(){return this._questions??[]}set questions(e){typeof e=="string"?this._questions=JSON.parse(e):this._questions=e}}const ts=new URL(""+new URL("sqlite.worker-DMS32ee_.js",import.meta.url).href,import.meta.url),ns=new URL(""+new URL("sql-wasm-Bv7gRpUo.wasm",import.meta.url).href,import.meta.url),rs=new URL(""+new URL("../database.sqlite3",import.meta.url).href,import.meta.url).toString();let M=null;const os=async()=>(M||(M=await Re.createDbWorker([{from:"inline",config:{serverMode:"full",url:rs,requestChunkSize:4096}}],ts.toString(),ns.toString())),M),T=async s=>{const n=await(await os()).db.query(s);return JSON.stringify(n)},as=async s=>{try{const e=await T(`select *
            from Course 
            where id = ${s}
            limit 1`);return new ie(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},cs=async()=>{let s=localStorage.getItem("CourseId");if(s){const e=await as(s);if(e)return localStorage.setItem("CourseId",JSON.stringify(e.id)),e}return null},$=te("currCourse/loadCurrCourse",async(s,{rejectWithValue:e})=>{try{const n=await cs();return n||e("No course found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),is={course:null,loading:!1,error:null},le=A({name:"currCourse",initialState:is,reducers:{setCurrCourse:(s,e)=>{s.course=e.payload,e.payload?localStorage.setItem("CourseId",JSON.stringify(e.payload.id)):localStorage.removeItem("CourseId")}},extraReducers:s=>{s.addCase($.pending,e=>{e.loading=!0,e.error=null}).addCase($.fulfilled,(e,n)=>{e.course=n.payload,e.loading=!1}).addCase($.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ls=le.reducer,{setCurrCourse:ue}=le.actions,us=({children:s,...e})=>{const[n,r]=i.useState(!1),a=I(),h=z("screen and (max-width: 768px)");i.useEffect(()=>{e.currCourse?r(e.currCourse.id==e.course.id):r(!1)},[e.currCourse]);const f=()=>{a(ue(e.course)),h&&a(ss(!1))};return t.jsx("li",{className:`SidebarItem ${n?"selected":""}`,children:t.jsxs("button",{onClick:f,children:[t.jsx(ke,{strokeWidth:"70px",className:"icon"})," ",s]})})};class ds{constructor(e){C(this,"id");C(this,"name");C(this,"semester_id");Object.assign(this,e)}}const hs=async s=>{try{const e=await T(`select *
            from Subject 
            where id = ${s}
            limit 1`);return new ds(JSON.parse(e)[0])}catch(e){return console.error("Error fetching data:",e),null}},fs=async()=>{let s=localStorage.getItem("SubjectId");if(s){const e=await hs(s);if(e)return localStorage.setItem("SubjectId",e.id),e}return null},P=te("currSubject/loadCurrSubject",async(s,{rejectWithValue:e})=>{try{const n=await fs();return n||e("No subject found in local storage")}catch(n){return n instanceof Error?e(n.message):e(String(n))}}),ms={subject:null,loading:!1,error:null},de=A({name:"currSubject",initialState:ms,reducers:{setCurrSubject:(s,e)=>{s.subject=e.payload,localStorage.setItem("SubjectId",e.payload.id)}},extraReducers:s=>{s.addCase(P.pending,e=>{e.loading=!0,e.error=null}).addCase(P.fulfilled,(e,n)=>{e.subject=n.payload,e.loading=!1}).addCase(P.rejected,(e,n)=>{e.loading=!1,e.error=n.payload})}}),ps=de.reducer,{setCurrSubject:ws}=de.actions,gs=s=>{const e=w(o=>o.currSubject.subject),n=w(o=>o.currCourse.course),[r,a]=i.useState(!1),[h,f]=i.useState([]),u=I();i.useEffect(()=>{a((e==null?void 0:e.id)==s.subject.id)},[e]),i.useEffect(()=>{(async()=>{const l=await T(`select *
        from Course
        where subject_id = ${s.subject.id}`),g=JSON.parse(l).map(d=>new ie(d));g&&f(g)})()},[]);const m=()=>{(e==null?void 0:e.id)!=s.subject.id&&u(ue(null)),u(ws(s.subject))};return t.jsxs("li",{className:`SidebarGroupItem ${r?"selected":""}`,children:[t.jsx("button",{onClick:m,children:t.jsxs("div",{className:"SidebarGroupItemContainer",children:[t.jsx("span",{children:s.subject.name}),t.jsx(Be,{className:"icon",style:{minWidth:"20px",minHeight:"20px"}})]})}),t.jsx("div",{className:`SidebarItemsContainer ${r?"show":""}`,children:t.jsx("ul",{children:h.map((o,l)=>t.jsx(us,{currCourse:n,course:o,children:o.name},l))})})]})},E=()=>t.jsx("div",{className:"LoadingView",children:t.jsx(Ee,{color:"var(--blue-color-2)",secondaryColor:"#193266"})}),qs=()=>{const s=w(r=>r.sidebarOpen.sidebarOpen),[e,n]=i.useState([]);return i.useEffect(()=>{(async()=>{const a=await T("select * from Subject");n(JSON.parse(a))})()},[]),t.jsx("div",{className:`Sidebar ${s?"":"hide"}`,children:!e||e.length==0?t.jsx(E,{}):t.jsx("ul",{children:e.map((r,a)=>t.jsx(gs,{subject:r},a))})})},xs={activeTest:!1},he=A({name:"activeTest",initialState:xs,reducers:{toggleActiveTest:s=>{s.activeTest=!s.activeTest}}}),bs=he.reducer,{toggleActiveTest:fe}=he.actions,js=()=>(localStorage.getItem("shuffleAnswerOption")||"true")==="true",Cs=()=>localStorage.getItem("showAnswerOnChoseOption")==="true",Ss=()=>localStorage.getItem("showQuestionByPageOption")==="true",Ns={shuffleAnswer:js(),showAnswerOnChosen:Cs(),showQuestionByPage:Ss(),questionCount:"15"},me=A({name:"testConfig",initialState:Ns,reducers:{toggleShuffleAnswer:s=>{s.shuffleAnswer=!s.shuffleAnswer,localStorage.setItem("shuffleAnswerOption",JSON.stringify(s.shuffleAnswer))},toggleShowAnswerOnChosen:s=>{s.showAnswerOnChosen=!s.showAnswerOnChosen,localStorage.setItem("showAnswerOnChoseOption",JSON.stringify(s.showAnswerOnChosen))},toggleShowQuestionByPage:s=>{s.showQuestionByPage=!s.showQuestionByPage,localStorage.setItem("showQuestionByPageOption",JSON.stringify(s.showQuestionByPage))},setQuestionCount:(s,e)=>{s.questionCount=e.payload}}}),ys=me.reducer,{toggleShuffleAnswer:Is,setQuestionCount:G,toggleShowAnswerOnChosen:As,toggleShowQuestionByPage:Ts}=me.actions,Os=Fe(Le)(()=>({"& .MuiInputBase-input":{borderRadius:4,fontSize:14,paddingTop:10,paddingBottom:10,color:"var(--primary-text-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--blue-color-2)"},"& .MuiOutlinedInput-notchedOutline":{height:"100%",border:"2px solid var(--secondary-text-color)"},"& .MuiSvgIcon-root":{color:"var(--secondary-text-color)"}})),Ks=()=>{var S,O,_,v;const s=w(b=>b.theme.theme),e=w(b=>b.sidebarOpen.sidebarOpen),n=w(b=>b.currSubject),r=w(b=>b.currCourse),{shuffleAnswer:a,showAnswerOnChosen:h,showQuestionByPage:f}=w(b=>b.testConfig),[u,m]=i.useState({semester:null,loading:!1}),[o,l]=i.useState([]),[g,d]=i.useState(""),c=I();i.useEffect(()=>{(()=>{const p=[10,15,20,30,40,50,60,100,150],j=[];let N=!1;p.forEach(Q=>{var K,V;if(r.course&&Q>=((K=r.course)==null?void 0:K.question_per_test)){if(!N){const F=(V=r.course)==null?void 0:V.question_per_test;j.push(t.jsx(L,{value:F,sx:{fontSize:14},children:F},F)),N=!0}return}j.push(t.jsx(L,{value:Q,sx:{fontSize:14},children:Q},Q))}),j.push(t.jsx(L,{value:"all",sx:{fontSize:14},children:"Tất cả"},"all")),l(j)})()},[r.course]),i.useEffect(()=>{const b=async()=>{var j;m({...u,loading:!0});const p=await T(`select *
        from Semester
        where id = ${(j=n.subject)==null?void 0:j.semester_id}`);m({semester:JSON.parse(p)[0],loading:!1})};n.subject&&b()},[n.subject]),i.useEffect(()=>{if(r.course){const b=r.course.question_per_test;d(b.toString()),c(G(b.toString()))}},[r.course]);const x=b=>{const p=b.target.value;d(p),c(G(p))};return t.jsx("div",{className:`CourseInfo ${e?"shrink":""}`,children:u.loading||r.loading||n.loading?t.jsx(E,{}):n.subject&&r.course?t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:(S=r.course)==null?void 0:S.name})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học phần"}),t.jsx("td",{children:(O=n.subject)==null?void 0:O.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Học kì"}),t.jsx("td",{children:(_=u.semester)==null?void 0:_.name})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi hiện có"}),t.jsx("td",{children:(v=r.course)==null?void 0:v.questions.length})]}),t.jsx("tr",{className:"CourseInfoTableHeader",children:t.jsx("th",{colSpan:2,children:"Tùy chỉnh"})}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Đảo đáp án"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:a,onClick:()=>c(Is()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện đáp án ngay sau khi chọn"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:h,onClick:()=>c(As()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Hiện từng câu hỏi theo trang"}),t.jsx("td",{children:t.jsx(R,{sx:{padding:"4px",margin:"-4px",color:"var(--secondary-text-color)"},checked:f,onClick:()=>c(Ts()),inputProps:{"aria-label":"controlled"}})})]}),t.jsxs("tr",{className:"CourseInfoTableRow",children:[t.jsx("th",{children:"Số lượng câu hỏi"}),t.jsx("td",{children:t.jsx(Me,{sx:{m:0,minWidth:120},size:"small",children:t.jsx($e,{value:g,onChange:x,displayEmpty:!0,inputProps:{"aria-label":"Without label"},input:t.jsx(Os,{}),MenuProps:{PaperProps:{sx:{backgroundColor:"var(--background-color)",fontSize:14,color:"var(--primary-text-color)"},"data-theme":s}},children:o})})})]}),t.jsx("tr",{className:"CourseInfoTableRow",children:t.jsx("th",{colSpan:2,children:t.jsxs("button",{className:"BtnDoTest",onClick:()=>c(fe()),children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"15px",style:{backgroundColor:"#00000000"}}),"Làm bài"]})})})]})}):t.jsx("span",{children:"Hãy chọn một bài để bắt đầu"})})},_s={questions:[]},pe=A({name:"testQuestion",initialState:_s,reducers:{addTestQuestion:(s,e)=>{s.questions.push(e.payload)},setTestQuestion:(s,e)=>{s.questions=e.payload}}}),vs=pe.reducer,{addTestQuestion:Vs,setTestQuestion:B}=pe.actions,Qs={answers:{}},we=A({name:"userAnswer",initialState:Qs,reducers:{addUserAnswer:(s,e)=>{s.answers[e.payload.id]?s.answers[e.payload.id].push(Number.parseInt(e.payload.answer)):s.answers[e.payload.id]=[Number.parseInt(e.payload.answer)]},removeUserAnswer:(s,e)=>{s.answers[e.payload.id]&&(s.answers[e.payload.id]=s.answers[e.payload.id].filter(n=>n!=Number.parseInt(e.payload.answer)))},removeAllUserAnswerById:(s,e)=>{s.answers[e.payload]&&(s.answers[e.payload]=[])},resetUserAnwser:s=>{s.answers={}}}}),Rs=we.reducer,{addUserAnswer:ge,removeUserAnswer:ks,removeAllUserAnswerById:Bs,resetUserAnwser:X}=we.actions,Y={isTestFininshed:!1,correctAnswers:[],wrongAnswers:[],score:0},xe=A({name:"testResult",initialState:Y,reducers:{setIsTestFinished:(s,e)=>{s.isTestFininshed=e.payload},addCorrectAnswer:(s,e)=>{s.correctAnswers.push(e.payload)},addWrongAnswer:(s,e)=>{s.wrongAnswers.push(e.payload)},setScore:(s,e)=>{s.score=e.payload},resetTestResut:()=>Y}}),Es=xe.reducer,{addCorrectAnswer:Fs,addWrongAnswer:Ls,setIsTestFinished:Z,setScore:Ms,resetTestResut:ee}=xe.actions,$s=Pe({reducer:{theme:Ge,sidebarOpen:Ze,currSubject:ps,currCourse:ls,activeTest:bs,testQuestion:vs,userAnswer:Rs,testResult:Es,testConfig:ys},middleware:s=>s({serializableCheck:!1})}),Gs=()=>I();class J{constructor(e){C(this,"id");C(this,"_question_direction");C(this,"question_type");C(this,"_answer_option");C(this,"_correct_answer");C(this,"cdr");C(this,"_shuffleable");Object.assign(this,e)}get question_direction(){return this._question_direction??""}set question_direction(e){this._question_direction=e.replace(/\\"/g,'"')}get answer_option(){return this._answer_option??[]}set answer_option(e){typeof e=="string"?this._answer_option=JSON.parse(e):this._answer_option=e}get correct_answer(){return this._correct_answer??[]}set correct_answer(e){if(typeof e=="number")this._correct_answer=[e];else if(typeof e=="string"){const n=JSON.parse(e);typeof n=="number"?this._correct_answer=[n]:this._correct_answer=JSON.parse(e)}else this._correct_answer=e}get shuffleable(){return this._shuffleable??!1}set shuffleable(e){typeof e=="number"?this._shuffleable=e!==0:this._shuffleable=e}}const q={replace(s){const e=s;e.attribs&&e.attribs["data-org"]==="serverAws"&&(e.attribs.src=`https://pczxqazwgbrrqalnwolo.supabase.co/storage/v1/object/public/react-simple-quiz-images/${e.attribs.src}.png`)}},be=i.memo(({answerOption:s,question:e,answerOptionBullet:n,selectedValue:r,setSelectedValue:a})=>{const[h,f]=i.useState(""),u=w(c=>c.testResult.isTestFininshed),m=w(c=>c.userAnswer.answers[e.id]),o=w(c=>c.testConfig.showAnswerOnChosen),l=I(),g=i.useMemo(()=>{const c=W.sanitize(s.value,{USE_PROFILES:{html:!0}});return H(c,q)},[s.value]);i.useEffect(()=>{if(!u)return;const c=Number.parseInt(s.id);if(!m||m.length==0){e.correct_answer.includes(c)&&f(" unanswer");return}m&&m.includes(c)&&(e.correct_answer.includes(c)||f(" incorrect")),e.correct_answer.includes(c)&&f(" correct")},[u]),i.useEffect(()=>{if(!o||(f(""),!m||m.length==0))return;const c=Number.parseInt(s.id);m&&m.includes(c)&&(e.correct_answer.includes(c)||f(" incorrect")),e.correct_answer.includes(c)&&f(" correct")},[o,m]);const d=c=>{u||(a(c.target.value),l(Bs(e.id)),l(ge({id:e.id,answer:s.id})))};return t.jsxs("div",{className:`RadioAnswerOption${h}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(Ue,{name:`question_${e.id}`,checked:r===s.id,value:s.id,onChange:d,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:g})]})]})});be.displayName="RadioAnswerOption";const Ps=({number:s,id:e,directionText:n,haveAnswer:r})=>{const a=i.useMemo(()=>{const h=W.sanitize(n,{USE_PROFILES:{html:!0}});return H(h,q)},[n]);return t.jsxs("div",{className:"QuestionContainerDirection",children:[t.jsxs("div",{className:"QuestionContainerHeader",children:[t.jsx("span",{className:"QuestionContainerNumber",children:`Câu ${s}: (ID-${e})`}),!r&&t.jsx("span",{className:"QuestionNoAnswerMessage",children:"Chưa có đáp án"})]}),t.jsx("div",{className:"QuestionContainerContent",children:a})]})},je=i.memo(Ps),Ce=i.forwardRef(({question:s,number:e,...n},r)=>{const[a,h]=i.useState("0"),f=i.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.answer_option.length),[s.correct_answer]),u=f?"RadioQuestion":"RadioQuestion noAnswer",m=l=>{const g=Math.min(Math.max(65,l+65),90);return String.fromCharCode(g)},o=i.useCallback((l,g)=>t.jsx(be,{answerOption:l,question:s,answerOptionBullet:m(g),selectedValue:a,setSelectedValue:h},`${s.id}_${l.id}`),[a]);return t.jsxs("div",{className:u,...n,ref:r,children:[t.jsx(je,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});Ce.displayName="RadioQuestion";const Se=i.memo(Ce),Ne=i.memo(({answerOption:s,question:e,answerOptionBullet:n,index:r,selectedValue:a,setSelectedValue:h})=>{const[f,u]=i.useState(""),m=w(x=>x.testResult.isTestFininshed),o=w(x=>x.userAnswer.answers[e.id]),l=w(x=>x.testConfig.showAnswerOnChosen),g=I(),d=i.useMemo(()=>{const x=W.sanitize(s.value,{USE_PROFILES:{html:!0}});return H(x,q)},[s.value]);i.useEffect(()=>{if(!m)return;const x=Number.parseInt(s.id);if(!o||o.length==0){e.correct_answer.includes(x)&&u(" unanswer");return}o&&o.includes(x)&&(e.correct_answer.includes(x)||u(" incorrect")),e.correct_answer.includes(x)&&u(" correct")},[m]),i.useEffect(()=>{if(!l||(u(""),!o||o.length==0))return;const x=Number.parseInt(s.id);o&&o.includes(x)&&(e.correct_answer.includes(x)||u(" incorrect")),e.correct_answer.includes(x)&&u(" correct")},[l,o]);const c=()=>{m||(a[r]?g(ks({id:e.id,answer:s.id})):g(ge({id:e.id,answer:s.id})),h(a.map((x,S)=>S==r?!x:x)))};return t.jsxs("div",{className:`CheckboxAnswerOption${f}`,children:[t.jsx("span",{className:"AnswerOptionBullet",children:n}),t.jsxs("label",{children:[t.jsx(R,{name:`question_${e.id}_${r}`,checked:a[r],onChange:c,sx:{color:"var(--secondary-text-color)",padding:"8px",margin:"-8px"}}),t.jsx("span",{className:"AnswerOptionText",children:d})]})]})});Ne.displayName="CheckboxAnswerOption";const ye=i.forwardRef(({question:s,number:e,...n},r)=>{const[a,h]=i.useState([!1,!1,!1,!1]),f=i.useMemo(()=>s.correct_answer.some(l=>l>0&&l<=s.correct_answer.length),[s.correct_answer]),u=f?"CheckboxQuestion":"CheckboxQuestion noAnswer",m=l=>{const g=Math.min(Math.max(65,l+65),90);return String.fromCharCode(g)},o=i.useCallback((l,g)=>t.jsx(Ne,{answerOption:l,question:s,answerOptionBullet:m(g),index:g,selectedValue:a,setSelectedValue:h},`${s.id}_${l.id}`),[a]);return t.jsxs("div",{className:u,...n,ref:r,children:[t.jsx(je,{number:e,id:s.id,directionText:s.question_direction,haveAnswer:f}),t.jsx("div",{className:"AnswerOptions",children:s.answer_option.map(o)})]})});ye.displayName="CheckboxQuestion";const Ie=i.memo(ye),Us=({children:s,setCurrentIndex:e,sectionRefs:n,rootSelector:r,offset:a})=>{const h=De({sectionRefs:n,rootSelector:r,offset:a});return i.useEffect(()=>{e(h.currentElementIndexInViewport+1)},[h]),s},Xs=({setCurrentQuestionNumber:s})=>{const e=w(d=>d.testQuestion.questions),n=w(d=>d.testResult.isTestFininshed),r=w(d=>d.currCourse.course),{shuffleAnswer:a,questionCount:h}=w(d=>d.testConfig),f=I(),u=i.useRef([]),[m,o]=i.useState(-60);i.useEffect(()=>{window.innerHeight!==0&&o(-60-window.innerHeight/4)},[window.innerHeight]),i.useEffect(()=>{u.current.length!==e.length&&(u.current=Array(e.length).fill(null).map((d,c)=>u.current[c]||i.createRef()))},[e]),i.useEffect(()=>{if(n)return;f(B([])),(async()=>{const c=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),x=JSON.parse(c).map(O=>new J(O)),S=g(x);l(S),f(B(S))})()},[n]);const l=d=>{d.forEach(c=>{a&&c.shuffleable&&(c.answer_option=k(c.answer_option))})},g=d=>{const c=k(d);return c.sort((x,S)=>x.cdr-S.cdr),h==="all"||Number.isNaN(Number.parseInt(h))?c:c.slice(0,Number.parseInt(h))};return!e||e.length==0||!u.current||!u.current.length?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer",children:t.jsx(Us,{sectionRefs:u.current,offset:m,setCurrentIndex:s,children:e.map((d,c)=>d.question_type==="radio"?t.jsx(Se,{ref:u.current[c],question:d,id:`questionNumber_${c+1}`,number:c+1},d.id):t.jsx(Ie,{ref:u.current[c],question:d,id:`questionNumber_${c+1}`,number:c+1},d.id))})})},Ys=({setHidePopup:s})=>{const e=w(o=>o.currSubject.subject),n=w(o=>o.testQuestion.questions),r=w(o=>o.testResult),a=I(),h=z("screen and (max-width: 768px)"),f=()=>{!r.isTestFininshed&&!window.confirm("Bài kiểm tra chưa hoàn thành. Bạn có muốn chắc chắn muốn thoát không?")||(a(fe()),a(ee()),a(X()))},u=()=>{a(Z(!1)),a(ee()),a(X())},m=()=>{const l=$s.getState().userAnswer.answers;let g=0;n.forEach(d=>{const c=JSON.stringify(d.correct_answer.sort()),x=JSON.stringify(l[d.id]&&[...l[d.id]].sort());c===x?(g++,a(Fs(d.id))):a(Ls(d.id));const S=parseFloat((g/n.length*10).toFixed(2));a(Ms(S))}),a(Z(!0))};return t.jsxs("nav",{className:"Navbar",children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:f,children:t.jsx(ze,{size:"24px"})})}),t.jsxs("div",{className:"TestNavbarContainer",children:[!h&&t.jsx(y,{children:t.jsx("span",{children:e&&(e==null?void 0:e.name)})}),t.jsx("div",{className:"TestNavBarRightSide",children:r.isTestFininshed?t.jsxs(t.Fragment,{children:[t.jsx(y,{children:t.jsx("button",{className:"IconBtn",onClick:u,children:t.jsx(We,{})})}),t.jsx(y,{children:t.jsxs("button",{className:"ScoreBoxBtn",onClick:()=>s(o=>!o),children:[t.jsxs("div",{children:["Điểm: ",r.score]}),t.jsxs("div",{children:["Kết quả: ",r.correctAnswers.length,"/",n.length]})]})})]}):t.jsx(y,{children:t.jsxs("button",{className:"BtnSubmitTest",onClick:m,children:[t.jsx(ne,{className:"icon",stroke:"#e0e0e0",strokeWidth:3,size:"17px",style:{backgroundColor:"#00000000"}}),"Nộp bài"]})})})]}),t.jsx(y,{children:t.jsx(ae,{})})]})},Zs=({hidePopup:s,setHidePopup:e})=>{const{score:n,isTestFininshed:r,correctAnswers:a}=w(m=>m.testResult),h=w(m=>m.testQuestion.questions),[f,u]=i.useState("");return i.useEffect(()=>{e(!r),n<5?u("lowScore"):n<8&&u("mediumScore")},[r]),t.jsx("div",{className:`TestResultPopup ${s?"hide":""}`,children:!s&&t.jsxs("div",{className:`TestResultBox ${f}`,children:[t.jsx("h1",{children:"Kết quả"}),t.jsxs("p",{children:["Điểm của bạn: ",n]}),t.jsxs("p",{children:["Số câu trả lời đúng: ",a.length,"/",h.length]}),t.jsx("button",{onClick:()=>e(!0),children:"Đóng"})]})})},et=({currentQuestionNumber:s})=>{const e=w(o=>o.testQuestion.questions),n=w(o=>o.testResult.isTestFininshed),r=w(o=>o.currCourse.course),{shuffleAnswer:a,questionCount:h}=w(o=>o.testConfig),f=I();i.useEffect(()=>{if(n)return;f(B([])),(async()=>{const l=await T(`
        select * from Question
        where id in (select json_each.value
                      from Course, json_each(questions)
                      where Course.id = ${r==null?void 0:r.id})`),g=JSON.parse(l).map(c=>new J(c)),d=m(g);u(d),f(B(d))})()},[n]);const u=o=>{o.forEach(l=>{a&&l.shuffleable&&(l.answer_option=k(l.answer_option))})},m=o=>{const l=k(o);return l.sort((g,d)=>g.cdr-d.cdr),h==="all"||Number.isNaN(Number.parseInt(h))?l:l.slice(0,Number.parseInt(h))};return!e||e.length==0?t.jsx("div",{className:"TestContainer",children:t.jsx(E,{})}):t.jsx("div",{className:"TestContainer TestContainerPaginated",children:e.map((o,l)=>o.question_type==="radio"?t.jsx("div",{className:"RadioQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(Se,{question:o,number:l+1})},o.id):t.jsx("div",{className:"CheckboxQuestionWrapper",style:s!==l+1?{display:"none"}:{},children:t.jsx(Ie,{question:o,number:l+1})},o.id))})},Ds=({currentIndex:s,questionNumbers:e})=>{const r=i.useRef(null),a=i.useRef(null),[h,f]=i.useState(0),[u,m]=i.useState(0);return i.useEffect(()=>{if(a.current&&r.current){const o=r.current.clientWidth,{defaultWidth:l,offsetFromCenter:g}=zs(a.current,o);f(l),m(g)}},[]),i.useEffect(()=>{if(!(!h||!u)&&a.current&&r.current){const o=s-1+2,l=a.current.querySelectorAll(".QuestionNumberIndicatorItem"),g=l[o];l.forEach((d,c)=>{d.classList.remove("neighbour","current"),c===o&&d.classList.add("current"),Math.abs(c-o)===1&&d.classList.add("neighbour")}),g&&(a.current.style.transform=`translateX(${-(h*o)+u}px)`)}},[s,h,u]),t.jsx("div",{className:"QuestionNumberIndicatorContainer",ref:r,children:t.jsx("div",{className:"QuestionNumberIndicator",ref:a,children:t.jsx(Ae,{questionNumbers:e,fakeItemCount:2})})})},Ae=i.memo(({questionNumbers:s,fakeItemCount:e})=>{const n=r=>Array(e).fill(0).map((a,h)=>t.jsx("div",{className:"QuestionNumberIndicatorItem fake",children:a},h+r));return t.jsxs(t.Fragment,{children:[n(-e),s.map(r=>t.jsx("div",{className:"QuestionNumberIndicatorItem",children:r},r)),n(s.length+1)]})});Ae.displayName="QuestionNumberIndicatorList";const zs=(s,e)=>{const n=document.createElement("div");n.className="QuestionNumberIndicatorItem",n.textContent="0",n.style.visibility="hidden",n.style.position="absolute",n.style.top="0",n.style.left="0",s.appendChild(n);const r=U(n);n.classList.add("neighbour");const a=U(n);n.classList.remove("neighbour"),n.classList.add("current");const h=U(n),f=a-r,u=(e-h)/2-f;return s.removeChild(n),{defaultWidth:r,neighborWidth:a,currentWidth:h,offsetFromCenter:u}},U=s=>{const e=s.offsetWidth,n=getComputedStyle(s);return e+parseInt(n.marginLeft)+parseInt(n.marginRight)},st=({currentQuestionNumber:s,setCurrentQuestionNumber:e})=>{const n=w(p=>p.theme.theme),r=w(p=>p.userAnswer.answers),a=w(p=>p.testQuestion.questions),{correctAnswers:h,wrongAnswers:f}=w(p=>p.testResult),{questionCount:u,showQuestionByPage:m}=w(p=>p.testConfig),o=u!=="all"?parseInt(u):a.length,l=i.useMemo(()=>[...Array(o).keys()].map(p=>p+1),[o]),[g,d]=i.useState(null),c=!!g,x=p=>{d(p.currentTarget)},S=()=>{d(null)},O=p=>{let j="QuestionListMenuItem";try{const N=a[p-1];N instanceof J&&(!r||r&&!r[N==null?void 0:N.id]?j+=" unanswer":h.includes(N==null?void 0:N.id)?j+=" correct":f.includes(N==null?void 0:N.id)&&(j+=" incorrect"))}catch{console.log(`Question number ${p} does not exists`)}return p===s&&(j+=" selected"),j},_=p=>{m?(e(p),S()):D(p)},v=p=>{const j=Math.min(s+1,o);s>=o-1&&p.currentTarget.blur(),m?e(j):D(j)},b=p=>{s<=2&&p.currentTarget.blur();const j=Math.max(s-1,1);m?e(j):D(j)};return t.jsxs("div",{className:"Footer",children:[t.jsx("button",{id:"QuestionListShowBtn","aria-controls":c?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,onClick:x,children:t.jsx(se,{className:"icon",size:16})}),t.jsx(He,{anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},anchorEl:g,open:c,onClose:S,disableRestoreFocus:!1,closeAfterTransition:!0,slotProps:{paper:{sx:{backgroundColor:"var(--background-color)",color:"var(--primary-text-color)",transform:"translateY(-10px) !important"}}},"data-theme":n,children:t.jsx("div",{className:"QuestionListMenuContent",children:l.map(p=>t.jsx("button",{className:O(p),onClick:()=>_(p),children:p},p))})}),t.jsxs("button",{className:"PreviousQuestionBtn",onClick:b,disabled:s<=1,children:[t.jsx("span",{className:"PreviousQuestionBtnText",children:"Câu hỏi trước đó"}),t.jsx("span",{className:"PreviousQuestionBtnIcon",children:t.jsx(Je,{className:"icon"})})]}),t.jsx(Ds,{currentIndex:s,questionNumbers:l}),t.jsxs("button",{className:"NextQuestionBtn",onClick:v,disabled:s===o,children:[t.jsx("span",{className:"NextQuestionBtnText",children:"Câu hỏi tiếp theo"}),t.jsx("span",{className:"NextQuestionBtnIcon",children:t.jsx(qe,{className:"icon"})})]})]})},D=(s,e=0)=>{const n=document.getElementById(`questionNumber_${s}`);if(!n)return;const h=n.offsetTop-60-20-e;window.scroll({top:h,behavior:"smooth"})};export{Ks as C,Js as N,qs as S,Ys as T,et as a,Xs as b,Zs as c,st as d,$ as e,P as l,$s as s,Gs as u};
